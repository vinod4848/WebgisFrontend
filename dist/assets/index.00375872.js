var fD=Object.defineProperty;var pD=(n,t,e)=>t in n?fD(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var Tb=(n,t,e)=>(pD(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();class mD{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}const Vm=mD;class gD{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const na=gD;function yD(n,t,e){let i,s;e=e||oh;let r=0,a=n.length,o=!1;for(;r<a;)i=r+(a-r>>1),s=+e(n[i],t),s<0?r=i+1:(a=i,o=!s);return o?r:~r}function oh(n,t){return n>t?1:n<t?-1:0}function _D(n,t){return n<t?1:n>t?-1:0}function hx(n,t,e){if(n[0]<=t)return 0;const i=n.length;if(t<=n[i-1])return i-1;if(typeof e=="function"){for(let s=1;s<i;++s){const r=n[s];if(r===t)return s;if(r<t)return e(t,n[s-1],r)>0?s-1:s}return i-1}if(e>0){for(let s=1;s<i;++s)if(n[s]<t)return s-1;return i-1}if(e<0){for(let s=1;s<i;++s)if(n[s]<=t)return s;return i-1}for(let s=1;s<i;++s){if(n[s]==t)return s;if(n[s]<t)return n[s-1]-t<t-n[s]?s-1:s}return i-1}function xD(n,t,e){for(;t<e;){const i=n[t];n[t]=n[e],n[e]=i,++t,--e}}function yi(n,t){const e=Array.isArray(t)?t:[t],i=e.length;for(let s=0;s<i;s++)n[n.length]=e[s]}function Mh(n,t){const e=n.length;if(e!==t.length)return!1;for(let i=0;i<e;i++)if(n[i]!==t[i])return!1;return!0}function vD(n,t,e){const i=t||oh;return n.every(function(s,r){if(r===0)return!0;const a=i(n[r-1],s);return!(a>0||e&&a===0)})}function ph(){return!0}function du(){return!1}function Zc(){}function $S(n){let t=!1,e,i,s;return function(){const r=Array.prototype.slice.call(arguments);return(!t||this!==s||!Mh(r,i))&&(t=!0,s=this,i=r,e=n.apply(this,arguments)),e}}function YS(n){function t(){let e;try{e=n()}catch(i){return Promise.reject(i)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function yl(n){for(const t in n)delete n[t]}function al(n){let t;for(t in n)return!1;return!t}class wD extends Vm{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),s=i[t]||(i[t]=[]);s.includes(e)||s.push(e)}dispatchEvent(t){const e=typeof t=="string",i=e?t:t.type,s=this.listeners_&&this.listeners_[i];if(!s)return;const r=e?new na(t):t;r.target||(r.target=this.eventTarget_||this);const a=this.dispatching_||(this.dispatching_={}),o=this.pendingRemovals_||(this.pendingRemovals_={});i in a||(a[i]=0,o[i]=0),++a[i];let h;for(let l=0,u=s.length;l<u;++l)if("handleEvent"in s[l]?h=s[l].handleEvent(r):h=s[l].call(this,r),h===!1||r.propagationStopped){h=!1;break}if(--a[i]===0){let l=o[i];for(delete o[i];l--;)this.removeEventListener(i,Zc);delete a[i]}return h}disposeInternal(){this.listeners_&&yl(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const i=this.listeners_[t];if(!i)return;const s=i.indexOf(e);s!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[s]=Zc,++this.pendingRemovals_[t]):(i.splice(s,1),i.length===0&&delete this.listeners_[t]))}}const xf=wD,Ne={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"},le={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function ke(){throw new Error("Unimplemented abstract method.")}let bD=0;function $e(n){return n.ol_uid||(n.ol_uid=String(++bD))}function HS(n){return Math.pow(n,3)}function fu(n){return 1-HS(1-n)}function MD(n){return 3*n*n-2*n*n*n}function ED(n){return n}class SD extends xf{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(Ne.CHANGE)}release(){this.state===le.ERROR&&this.setState(le.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let t=this.interimTile;if(!t)return this;do{if(t.getState()==le.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){let t=this.interimTile;if(!t)return;let e=this;do{if(t.getState()==le.LOADED){t.interimTile=null;break}t.getState()==le.LOADING?e=t:t.getState()==le.IDLE?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==le.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){ke()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(!i)i=e,this.transitionStarts_[t]=i;else if(i===-1)return 1;const s=e-i+1e3/60;return s>=this.transition_?1:HS(s/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}const lx=SD,mh=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",TD=mh.includes("firefox"),CD=mh.includes("safari")&&!mh.includes("chrom"),AD=CD&&(mh.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(mh)),RD=mh.includes("webkit")&&!mh.includes("edge"),qS=mh.includes("macintosh"),XS=typeof devicePixelRatio<"u"?devicePixelRatio:1,jS=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,ZS=typeof Image<"u"&&Image.prototype.decode,KS=function(){let n=!1;try{const t=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return n}();function yn(n,t,e,i){let s;return e&&e.length?s=e.shift():jS?s=new OffscreenCanvas(n||300,t||300):s=document.createElement("canvas"),n&&(s.width=n),t&&(s.height=t),s.getContext("2d",i)}let _y;function Bp(){return _y||(_y=yn(1,1)),_y}function Kc(n){const t=n.canvas;t.width=1,t.height=1,n.clearRect(0,0,1,1)}function ID(n){let t=n.offsetWidth;const e=getComputedStyle(n);return t+=parseInt(e.marginLeft,10)+parseInt(e.marginRight,10),t}function ND(n){let t=n.offsetHeight;const e=getComputedStyle(n);return t+=parseInt(e.marginTop,10)+parseInt(e.marginBottom,10),t}function Cb(n,t){const e=t.parentNode;e&&e.replaceChild(n,t)}function Up(n){return n&&n.parentNode?n.parentNode.removeChild(n):null}function JS(n){for(;n.lastChild;)n.removeChild(n.lastChild)}function kD(n,t){const e=n.childNodes;for(let i=0;;++i){const s=e[i],r=t[i];if(!s&&!r)break;if(s!==r){if(!s){n.appendChild(r);continue}if(!r){n.removeChild(s),--i;continue}n.insertBefore(r,s)}}}function Gp(n){return n instanceof Image||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageBitmap?n:null}function H1(n){return n instanceof Uint8Array||n instanceof Uint8ClampedArray||n instanceof Float32Array||n instanceof DataView?n:null}let Ul=null;function LD(n){Ul||(Ul=yn(n.width,n.height,void 0,{willReadFrequently:!0}));const t=Ul.canvas,e=n.width;t.width!==e&&(t.width=e);const i=n.height;return t.height!==i&&(t.height=i),Ul.clearRect(0,0,e,i),Ul.drawImage(n,0,0),Ul.getImageData(0,0,e,i).data}const OD=[256,256];class PD extends lx{constructor(t){const e=le.IDLE;super(t.tileCoord,e,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null}getSize(){if(this.size_)return this.size_;const t=Gp(this.data_);return t?[t.width,t.height]:OD}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==le.IDLE&&this.state!==le.ERROR)return;this.state=le.LOADING,this.changed();const t=this;this.loader_().then(function(e){t.data_=e,t.state=le.LOADED,t.changed()}).catch(function(e){t.error_=e,t.state=le.ERROR,t.changed()})}}const cx=PD,QS=.5,On={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Vp(n){const t=Jr();for(let e=0,i=n.length;e<i;++e)Md(t,n[e]);return t}function ux(n,t,e){return e?(e[0]=n[0]-t,e[1]=n[1]-t,e[2]=n[2]+t,e[3]=n[3]+t,e):[n[0]-t,n[1]-t,n[2]+t,n[3]+t]}function tT(n,t){return t?(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t):n.slice()}function _l(n,t,e){let i,s;return t<n[0]?i=n[0]-t:n[2]<t?i=t-n[2]:i=0,e<n[1]?s=n[1]-e:n[3]<e?s=e-n[3]:s=0,i*i+s*s}function ol(n,t){return dx(n,t[0],t[1])}function Xh(n,t){return n[0]<=t[0]&&t[2]<=n[2]&&n[1]<=t[1]&&t[3]<=n[3]}function dx(n,t,e){return n[0]<=t&&t<=n[2]&&n[1]<=e&&e<=n[3]}function q1(n,t){const e=n[0],i=n[1],s=n[2],r=n[3],a=t[0],o=t[1];let h=On.UNKNOWN;return a<e?h=h|On.LEFT:a>s&&(h=h|On.RIGHT),o<i?h=h|On.BELOW:o>r&&(h=h|On.ABOVE),h===On.UNKNOWN&&(h=On.INTERSECTING),h}function Jr(){return[1/0,1/0,-1/0,-1/0]}function vo(n,t,e,i,s){return s?(s[0]=n,s[1]=t,s[2]=e,s[3]=i,s):[n,t,e,i]}function vf(n){return vo(1/0,1/0,-1/0,-1/0,n)}function eT(n,t){const e=n[0],i=n[1];return vo(e,i,e,i,t)}function fx(n,t,e,i,s){const r=vf(s);return nT(r,n,t,e,i)}function Wp(n,t){return n[0]==t[0]&&n[2]==t[2]&&n[1]==t[1]&&n[3]==t[3]}function iT(n,t){return t[0]<n[0]&&(n[0]=t[0]),t[2]>n[2]&&(n[2]=t[2]),t[1]<n[1]&&(n[1]=t[1]),t[3]>n[3]&&(n[3]=t[3]),n}function Md(n,t){t[0]<n[0]&&(n[0]=t[0]),t[0]>n[2]&&(n[2]=t[0]),t[1]<n[1]&&(n[1]=t[1]),t[1]>n[3]&&(n[3]=t[1])}function nT(n,t,e,i,s){for(;e<i;e+=s)FD(n,t[e],t[e+1]);return n}function FD(n,t,e){n[0]=Math.min(n[0],t),n[1]=Math.min(n[1],e),n[2]=Math.max(n[2],t),n[3]=Math.max(n[3],e)}function px(n,t){let e;return e=t(Wm(n)),e||(e=t($m(n)),e)||(e=t(Ym(n)),e)||(e=t(pu(n)),e)?e:!1}function Vd(n){let t=0;return wf(n)||(t=fi(n)*cs(n)),t}function Wm(n){return[n[0],n[1]]}function $m(n){return[n[2],n[1]]}function wo(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function DD(n,t){let e;if(t==="bottom-left")e=Wm(n);else if(t==="bottom-right")e=$m(n);else if(t==="top-left")e=pu(n);else if(t==="top-right")e=Ym(n);else throw new Error("Invalid corner");return e}function X1(n,t,e,i,s){const[r,a,o,h,l,u,f,m]=zD(n,t,e,i);return vo(Math.min(r,o,l,f),Math.min(a,h,u,m),Math.max(r,o,l,f),Math.max(a,h,u,m),s)}function zD(n,t,e,i){const s=t*i[0]/2,r=t*i[1]/2,a=Math.cos(e),o=Math.sin(e),h=s*a,l=s*o,u=r*a,f=r*o,m=n[0],g=n[1];return[m-h+f,g-l-u,m-h-f,g-l+u,m+h-f,g+l+u,m+h+f,g+l-u,m-h+f,g-l-u]}function cs(n){return n[3]-n[1]}function _r(n,t,e){const i=e||Jr();return Gs(n,t)?(n[0]>t[0]?i[0]=n[0]:i[0]=t[0],n[1]>t[1]?i[1]=n[1]:i[1]=t[1],n[2]<t[2]?i[2]=n[2]:i[2]=t[2],n[3]<t[3]?i[3]=n[3]:i[3]=t[3]):vf(i),i}function pu(n){return[n[0],n[3]]}function Ym(n){return[n[2],n[3]]}function fi(n){return n[2]-n[0]}function Gs(n,t){return n[0]<=t[2]&&n[2]>=t[0]&&n[1]<=t[3]&&n[3]>=t[1]}function wf(n){return n[2]<n[0]||n[3]<n[1]}function BD(n,t){return t?(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t):n}function UD(n,t,e){let i=!1;const s=q1(n,t),r=q1(n,e);if(s===On.INTERSECTING||r===On.INTERSECTING)i=!0;else{const a=n[0],o=n[1],h=n[2],l=n[3],u=t[0],f=t[1],m=e[0],g=e[1],y=(g-f)/(m-u);let _,w;!!(r&On.ABOVE)&&!(s&On.ABOVE)&&(_=m-(g-l)/y,i=_>=a&&_<=h),!i&&!!(r&On.RIGHT)&&!(s&On.RIGHT)&&(w=g-(m-h)*y,i=w>=o&&w<=l),!i&&!!(r&On.BELOW)&&!(s&On.BELOW)&&(_=m-(g-o)/y,i=_>=a&&_<=h),!i&&!!(r&On.LEFT)&&!(s&On.LEFT)&&(w=g-(m-a)*y,i=w>=o&&w<=l)}return i}function sT(n,t){const e=t.getExtent(),i=wo(n);if(t.canWrapX()&&(i[0]<e[0]||i[0]>=e[2])){const s=fi(e),a=Math.floor((i[0]-e[0])/s)*s;n[0]-=a,n[2]-=a}return n}function mx(n,t,e){if(t.canWrapX()){const i=t.getExtent();if(!isFinite(n[0])||!isFinite(n[2]))return[[i[0],n[1],i[2],n[3]]];sT(n,t);const s=fi(i);if(fi(n)>s&&!e)return[[i[0],n[1],i[2],n[3]]];if(n[0]<i[0])return[[n[0]+s,n[1],i[2],n[3]],[i[0],n[1],n[2],n[3]]];if(n[2]>i[2])return[[n[0],n[1],i[2],n[3]],[i[0],n[1],n[2]-s,n[3]]]}return[n]}const GD={9001:"m",9002:"ft",9003:"us-ft",9101:"radians",9102:"degrees"};function Ab(n){return GD[n]}const Wd={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class VD{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Wd[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const $d=VD,bf=6378137,yc=Math.PI*bf,WD=[-yc,-yc,yc,yc],$D=[-180,-85,180,85],E0=bf*Math.log(Math.tan(Math.PI/2));class Gl extends $d{constructor(t){super({code:t,units:"m",extent:WD,global:!0,worldExtent:$D,getPointResolution:function(e,i){return e/Math.cosh(i[1]/bf)}})}}const Rb=[new Gl("EPSG:3857"),new Gl("EPSG:102100"),new Gl("EPSG:102113"),new Gl("EPSG:900913"),new Gl("http://www.opengis.net/def/crs/EPSG/0/3857"),new Gl("http://www.opengis.net/gml/srs/epsg.xml#3857")];function YD(n,t,e){const i=n.length;e=e>1?e:2,t===void 0&&(e>2?t=n.slice():t=new Array(i));for(let s=0;s<i;s+=e){t[s]=yc*n[s]/180;let r=bf*Math.log(Math.tan(Math.PI*(+n[s+1]+90)/360));r>E0?r=E0:r<-E0&&(r=-E0),t[s+1]=r}return t}function HD(n,t,e){const i=n.length;e=e>1?e:2,t===void 0&&(e>2?t=n.slice():t=new Array(i));for(let s=0;s<i;s+=e)t[s]=180*n[s]/yc,t[s+1]=360*Math.atan(Math.exp(n[s+1]/bf))/Math.PI-90;return t}const qD=6378137,Ib=[-180,-90,180,90],XD=Math.PI*qD/180;class Dh extends $d{constructor(t,e){super({code:t,units:"degrees",extent:Ib,axisOrientation:e,global:!0,metersPerUnit:XD,worldExtent:Ib})}}const Nb=[new Dh("CRS:84"),new Dh("EPSG:4326","neu"),new Dh("urn:ogc:def:crs:OGC:1.3:CRS84"),new Dh("urn:ogc:def:crs:OGC:2:84"),new Dh("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Dh("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Dh("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let j1={};function jD(n){return j1[n]||j1[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function ZD(n,t){j1[n]=t}let Nc={};function Jc(n,t,e){const i=n.getCode(),s=t.getCode();i in Nc||(Nc[i]={}),Nc[i][s]=e}function rT(n,t){let e;return n in Nc&&t in Nc[n]&&(e=Nc[n][t]),e}function Ui(n,t,e){return Math.min(Math.max(n,t),e)}function KD(n,t,e,i,s,r){const a=s-e,o=r-i;if(a!==0||o!==0){const h=((n-e)*a+(t-i)*o)/(a*a+o*o);h>1?(e=s,i=r):h>0&&(e+=a*h,i+=o*h)}return co(n,t,e,i)}function co(n,t,e,i){const s=e-n,r=i-t;return s*s+r*r}function JD(n){const t=n.length;for(let i=0;i<t;i++){let s=i,r=Math.abs(n[i][i]);for(let o=i+1;o<t;o++){const h=Math.abs(n[o][i]);h>r&&(r=h,s=o)}if(r===0)return null;const a=n[s];n[s]=n[i],n[i]=a;for(let o=i+1;o<t;o++){const h=-n[o][i]/n[i][i];for(let l=i;l<t+1;l++)i==l?n[o][l]=0:n[o][l]+=h*n[i][l]}}const e=new Array(t);for(let i=t-1;i>=0;i--){e[i]=n[i][t]/n[i][i];for(let s=i-1;s>=0;s--)n[s][t]-=n[s][i]*e[i]}return e}function hh(n){return n*Math.PI/180}function kc(n,t){const e=n%t;return e*t<0?e+t:e}function er(n,t,e){return n+e*(t-n)}function Hm(n,t){const e=Math.pow(10,t);return Math.round(n*e)/e}function S0(n,t){return Math.floor(Hm(n,t))}function T0(n,t){return Math.ceil(Hm(n,t))}function QD(n,t){return n[0]+=+t[0],n[1]+=+t[1],n}function $p(n,t){let e=!0;for(let i=n.length-1;i>=0;--i)if(n[i]!=t[i]){e=!1;break}return e}function gx(n,t){const e=Math.cos(t),i=Math.sin(t),s=n[0]*e-n[1]*i,r=n[1]*e+n[0]*i;return n[0]=s,n[1]=r,n}function t4(n,t){return n[0]*=t,n[1]*=t,n}function aT(n,t){const e=n[0]-t[0],i=n[1]-t[1];return e*e+i*i}function oT(n,t){return Math.sqrt(aT(n,t))}function hT(n,t){if(t.canWrapX()){const e=fi(t.getExtent()),i=lT(n,t,e);i&&(n[0]-=i*e)}return n}function lT(n,t,e){const i=t.getExtent();let s=0;return t.canWrapX()&&(n[0]<i[0]||n[0]>i[2])&&(e=e||fi(i),s=Math.floor((n[0]-i[0])/e)),s}const yx=63710088e-1;function Z1(n,t,e){e=e||yx;const i=hh(n[1]),s=hh(t[1]),r=(s-i)/2,a=hh(t[0]-n[0])/2,o=Math.sin(r)*Math.sin(r)+Math.sin(a)*Math.sin(a)*Math.cos(i)*Math.cos(s);return 2*e*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))}function xy(n,t){let e=0;for(let i=0,s=n.length;i<s-1;++i)e+=Z1(n[i],n[i+1],t);return e}function _x(n,t){t=t||{};const e=t.radius||yx,i=t.projection||"EPSG:3857",s=n.getType();s!=="GeometryCollection"&&(n=n.clone().transform(i,"EPSG:4326"));let r=0,a,o,h,l,u,f;switch(s){case"Point":case"MultiPoint":break;case"LineString":case"LinearRing":{a=n.getCoordinates(),r=xy(a,e);break}case"MultiLineString":case"Polygon":{for(a=n.getCoordinates(),h=0,l=a.length;h<l;++h)r+=xy(a[h],e);break}case"MultiPolygon":{for(a=n.getCoordinates(),h=0,l=a.length;h<l;++h)for(o=a[h],u=0,f=o.length;u<f;++u)r+=xy(o[u],e);break}case"GeometryCollection":{const m=n.getGeometries();for(h=0,l=m.length;h<l;++h)r+=_x(m[h],t);break}default:throw new Error("Unsupported geometry type: "+s)}return r}function C0(n,t){let e=0;const i=n.length;let s=n[i-1][0],r=n[i-1][1];for(let a=0;a<i;a++){const o=n[a][0],h=n[a][1];e+=hh(o-s)*(2+Math.sin(hh(r))+Math.sin(hh(h))),s=o,r=h}return e*t*t/2}function xx(n,t){t=t||{};const e=t.radius||yx,i=t.projection||"EPSG:3857",s=n.getType();s!=="GeometryCollection"&&(n=n.clone().transform(i,"EPSG:4326"));let r=0,a,o,h,l,u,f;switch(s){case"Point":case"MultiPoint":case"LineString":case"MultiLineString":case"LinearRing":break;case"Polygon":{for(a=n.getCoordinates(),r=Math.abs(C0(a[0],e)),h=1,l=a.length;h<l;++h)r-=Math.abs(C0(a[h],e));break}case"MultiPolygon":{for(a=n.getCoordinates(),h=0,l=a.length;h<l;++h)for(o=a[h],r+=Math.abs(C0(o[0],e)),u=1,f=o.length;u<f;++u)r-=Math.abs(C0(o[u],e));break}case"GeometryCollection":{const m=n.getGeometries();for(h=0,l=m.length;h<l;++h)r+=xx(m[h],t);break}default:throw new Error("Unsupported geometry type: "+s)}return r}const vx={info:1,warn:2,error:3,none:4};let cT=vx.info;function uT(...n){cT>vx.warn||console.warn(...n)}function kb(...n){cT>vx.error||console.error(...n)}let K1=!0;function e4(n){K1=!(n===void 0?!0:n)}function wx(n,t){if(t!==void 0){for(let e=0,i=n.length;e<i;++e)t[e]=n[e];t=t}else t=n.slice();return t}function dT(n,t){if(t!==void 0&&n!==t){for(let e=0,i=n.length;e<i;++e)t[e]=n[e];n=t}return n}function fT(n){ZD(n.getCode(),n),Jc(n,n,wx)}function i4(n){n.forEach(fT)}function Ri(n){return typeof n=="string"?jD(n):n||null}function Lb(n,t,e,i){n=Ri(n);let s;const r=n.getPointResolutionFunc();if(r){if(s=r(t,e),i&&i!==n.getUnits()){const a=n.getMetersPerUnit();a&&(s=s*a/Wd[i])}}else{const a=n.getUnits();if(a=="degrees"&&!i||i=="degrees")s=t;else{const o=qm(n,Ri("EPSG:4326"));if(o===dT&&a!=="degrees")s=t*n.getMetersPerUnit();else{let l=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];l=o(l,l,2);const u=Z1(l.slice(0,2),l.slice(2,4)),f=Z1(l.slice(4,6),l.slice(6,8));s=(u+f)/2}const h=i?Wd[i]:n.getMetersPerUnit();h!==void 0&&(s/=h)}}return s}function J1(n){i4(n),n.forEach(function(t){n.forEach(function(e){t!==e&&Jc(t,e,wx)})})}function n4(n,t,e,i){n.forEach(function(s){t.forEach(function(r){Jc(s,r,e),Jc(r,s,i)})})}function bx(n,t){return n?typeof n=="string"?Ri(n):n:Ri(t)}function Ob(n){return function(t,e,i){const s=t.length;i=i!==void 0?i:2,e=e!==void 0?e:new Array(s);for(let r=0;r<s;r+=i){const a=n(t.slice(r,r+i)),o=a.length;for(let h=0,l=i;h<l;++h)e[r+h]=h>=o?t[r+h]:a[h]}return e}}function s4(n,t,e,i){const s=Ri(n),r=Ri(t);Jc(s,r,Ob(e)),Jc(r,s,Ob(i))}function zr(n,t){if(n===t)return!0;const e=n.getUnits()===t.getUnits();return(n.getCode()===t.getCode()||qm(n,t)===wx)&&e}function qm(n,t){const e=n.getCode(),i=t.getCode();let s=rT(e,i);return s||(s=dT),s}function Yd(n,t){const e=Ri(n),i=Ri(t);return qm(e,i)}function mu(n,t,e){return Yd(t,e)(n,void 0,n.length)}let r4=null;function a4(){return r4}function Yp(n,t){return n}function Fr(n,t){return K1&&!$p(n,[0,0])&&n[0]>=-180&&n[0]<=180&&n[1]>=-90&&n[1]<=90&&(K1=!1,uT("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),n}function Xm(n,t){return n}function jh(n,t){return n}function Pb(n,t,e){return function(i){let s,r;if(n.canWrapX()){const a=n.getExtent(),o=fi(a);i=i.slice(0),r=lT(i,n,o),r&&(i[0]=i[0]-r*o),i[0]=Ui(i[0],a[0],a[2]),i[1]=Ui(i[1],a[1],a[3]),s=e(i)}else s=e(i);return r&&t.canWrapX()&&(s[0]+=r*fi(t.getExtent())),s}}function o4(){J1(Rb),J1(Nb),n4(Nb,Rb,YD,HD)}o4();const h4=10,Fb=.25;class l4{constructor(t,e,i,s,r,a){this.sourceProj_=t,this.targetProj_=e;let o={};const h=Yd(this.targetProj_,this.sourceProj_);this.transformInv_=function(T){const A=T[0]+"/"+T[1];return o[A]||(o[A]=h(T)),o[A]},this.maxSourceExtent_=s,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&fi(s)>=fi(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?fi(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?fi(this.targetProj_.getExtent()):null;const l=pu(i),u=Ym(i),f=$m(i),m=Wm(i),g=this.transformInv_(l),y=this.transformInv_(u),_=this.transformInv_(f),w=this.transformInv_(m),M=h4+(a?Math.max(0,Math.ceil(Math.log2(Vd(i)/(a*a*256*256)))):0);if(this.addQuad_(l,u,f,m,g,y,_,w,M),this.wrapsXInSource_){let T=1/0;this.triangles_.forEach(function(A,R,I){T=Math.min(T,A.source[0][0],A.source[1][0],A.source[2][0])}),this.triangles_.forEach(A=>{if(Math.max(A.source[0][0],A.source[1][0],A.source[2][0])-T>this.sourceWorldWidth_/2){const R=[[A.source[0][0],A.source[0][1]],[A.source[1][0],A.source[1][1]],[A.source[2][0],A.source[2][1]]];R[0][0]-T>this.sourceWorldWidth_/2&&(R[0][0]-=this.sourceWorldWidth_),R[1][0]-T>this.sourceWorldWidth_/2&&(R[1][0]-=this.sourceWorldWidth_),R[2][0]-T>this.sourceWorldWidth_/2&&(R[2][0]-=this.sourceWorldWidth_);const I=Math.min(R[0][0],R[1][0],R[2][0]);Math.max(R[0][0],R[1][0],R[2][0])-I<this.sourceWorldWidth_/2&&(A.source=R)}})}o={}}addTriangle_(t,e,i,s,r,a){this.triangles_.push({source:[s,r,a],target:[t,e,i]})}addQuad_(t,e,i,s,r,a,o,h,l){const u=Vp([r,a,o,h]),f=this.sourceWorldWidth_?fi(u)/this.sourceWorldWidth_:null,m=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&f>.5&&f<1;let y=!1;if(l>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const w=Vp([t,e,i,s]);y=fi(w)/this.targetWorldWidth_>Fb||y}!g&&this.sourceProj_.isGlobal()&&f&&(y=f>Fb||y)}if(!y&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!Gs(u,this.maxSourceExtent_))return;let _=0;if(!y&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(h[0])||!isFinite(h[1]))){if(l>0)y=!0;else if(_=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(a[0])||!isFinite(a[1])?4:0)+(!isFinite(o[0])||!isFinite(o[1])?2:0)+(!isFinite(h[0])||!isFinite(h[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(l>0){if(!y){const w=[(t[0]+i[0])/2,(t[1]+i[1])/2],M=this.transformInv_(w);let T;g?T=(kc(r[0],m)+kc(o[0],m))/2-kc(M[0],m):T=(r[0]+o[0])/2-M[0];const A=(r[1]+o[1])/2-M[1];y=T*T+A*A>this.errorThresholdSquared_}if(y){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const w=[(e[0]+i[0])/2,(e[1]+i[1])/2],M=this.transformInv_(w),T=[(s[0]+t[0])/2,(s[1]+t[1])/2],A=this.transformInv_(T);this.addQuad_(t,e,w,T,r,a,M,A,l-1),this.addQuad_(T,w,i,s,A,M,o,h,l-1)}else{const w=[(t[0]+e[0])/2,(t[1]+e[1])/2],M=this.transformInv_(w),T=[(i[0]+s[0])/2,(i[1]+s[1])/2],A=this.transformInv_(T);this.addQuad_(t,w,T,s,r,M,A,h,l-1),this.addQuad_(w,e,i,T,M,a,o,A,l-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(_&11)==0&&this.addTriangle_(t,i,s,r,o,h),(_&14)==0&&this.addTriangle_(t,i,e,r,o,a),_&&((_&13)==0&&this.addTriangle_(e,s,t,a,h,r),(_&7)==0&&this.addTriangle_(e,s,i,a,h,o))}calculateSourceExtent(){const t=Jr();return this.triangles_.forEach(function(e,i,s){const r=e.source;Md(t,r[0]),Md(t,r[1]),Md(t,r[2])}),t}getTriangles(){return this.triangles_}}const pT=l4;let vy;const uo=[];function Db(n,t,e,i,s){n.beginPath(),n.moveTo(0,0),n.lineTo(t,e),n.lineTo(i,s),n.closePath(),n.save(),n.clip(),n.fillRect(0,0,Math.max(t,i)+1,Math.max(e,s)),n.restore()}function wy(n,t){return Math.abs(n[t*4]-210)>2||Math.abs(n[t*4+3]-.75*255)>2}function c4(){if(vy===void 0){const n=yn(6,6,uo);n.globalCompositeOperation="lighter",n.fillStyle="rgba(210, 0, 0, 0.75)",Db(n,4,5,4,0),Db(n,4,5,0,5);const t=n.getImageData(0,0,3,3).data;vy=wy(t,0)||wy(t,4)||wy(t,8),Kc(n),uo.push(n.canvas)}return vy}function zb(n,t,e,i){const s=mu(e,t,n);let r=Lb(t,i,e);const a=t.getMetersPerUnit();a!==void 0&&(r*=a);const o=n.getMetersPerUnit();o!==void 0&&(r/=o);const h=n.getExtent();if(!h||ol(h,s)){const l=Lb(n,r,s)/r;isFinite(l)&&l>0&&(r/=l)}return r}function mT(n,t,e,i){const s=wo(e);let r=zb(n,t,s,i);return(!isFinite(r)||r<=0)&&px(e,function(a){return r=zb(n,t,a,i),isFinite(r)&&r>0}),r}function gT(n,t,e,i,s,r,a,o,h,l,u,f,m,g){const y=yn(Math.round(e*n),Math.round(e*t),uo);if(f||(y.imageSmoothingEnabled=!1),h.length===0)return y.canvas;y.scale(e,e);function _(I){return Math.round(I*e)/e}y.globalCompositeOperation="lighter";const w=Jr();h.forEach(function(I,L,k){iT(w,I.extent)});let M;const T=e/i,A=(f?1:1+Math.pow(2,-24))/T;if(!m||h.length!==1||l!==0){if(M=yn(Math.round(fi(w)*T),Math.round(cs(w)*T),uo),f||(M.imageSmoothingEnabled=!1),s&&g){const I=(s[0]-w[0])*T,L=-(s[3]-w[3])*T,k=fi(s)*T,Y=cs(s)*T;M.rect(I,L,k,Y),M.clip()}h.forEach(function(I,L,k){if(I.image.width>0&&I.image.height>0){if(I.clipExtent){M.save();const Z=(I.clipExtent[0]-w[0])*T,ht=-(I.clipExtent[3]-w[3])*T,O=fi(I.clipExtent)*T,pt=cs(I.clipExtent)*T;M.rect(f?Z:Math.round(Z),f?ht:Math.round(ht),f?O:Math.round(Z+O)-Math.round(Z),f?pt:Math.round(ht+pt)-Math.round(ht)),M.clip()}const Y=(I.extent[0]-w[0])*T,K=-(I.extent[3]-w[3])*T,rt=fi(I.extent)*T,ut=cs(I.extent)*T;M.drawImage(I.image,l,l,I.image.width-2*l,I.image.height-2*l,f?Y:Math.round(Y),f?K:Math.round(K),f?rt:Math.round(Y+rt)-Math.round(Y),f?ut:Math.round(K+ut)-Math.round(K)),I.clipExtent&&M.restore()}})}const R=pu(a);return o.getTriangles().forEach(function(I,L,k){const Y=I.source,K=I.target;let rt=Y[0][0],ut=Y[0][1],Z=Y[1][0],ht=Y[1][1],O=Y[2][0],pt=Y[2][1];const Gt=_((K[0][0]-R[0])/r),Ft=_(-(K[0][1]-R[1])/r),oe=_((K[1][0]-R[0])/r),Dt=_(-(K[1][1]-R[1])/r),re=_((K[2][0]-R[0])/r),yt=_(-(K[2][1]-R[1])/r),gt=rt,ge=ut;rt=0,ut=0,Z-=gt,ht-=ge,O-=gt,pt-=ge;const Et=[[Z,ht,0,0,oe-Gt],[O,pt,0,0,re-Gt],[0,0,Z,ht,Dt-Ft],[0,0,O,pt,yt-Ft]],Kt=JD(Et);if(!Kt)return;if(y.save(),y.beginPath(),c4()||!f){y.moveTo(oe,Dt);const Qe=4,Te=Gt-oe,Xe=Ft-Dt;for(let ti=0;ti<Qe;ti++)y.lineTo(oe+_((ti+1)*Te/Qe),Dt+_(ti*Xe/(Qe-1))),ti!=Qe-1&&y.lineTo(oe+_((ti+1)*Te/Qe),Dt+_((ti+1)*Xe/(Qe-1)));y.lineTo(re,yt)}else y.moveTo(oe,Dt),y.lineTo(Gt,Ft),y.lineTo(re,yt);y.clip(),y.transform(Kt[0],Kt[2],Kt[1],Kt[3],Gt,Ft),y.translate(w[0]-gt,w[3]-ge);let Je;if(M)Je=M.canvas,y.scale(A,-A);else{const Qe=h[0],Te=Qe.extent;Je=Qe.image,y.scale(fi(Te)/Je.width,-cs(Te)/Je.height)}y.drawImage(Je,0,0),y.restore()}),M&&(Kc(M),uo.push(M.canvas)),u&&(y.save(),y.globalCompositeOperation="source-over",y.strokeStyle="black",y.lineWidth=1,o.getTriangles().forEach(function(I,L,k){const Y=I.target,K=(Y[0][0]-R[0])/r,rt=-(Y[0][1]-R[1])/r,ut=(Y[1][0]-R[0])/r,Z=-(Y[1][1]-R[1])/r,ht=(Y[2][0]-R[0])/r,O=-(Y[2][1]-R[1])/r;y.beginPath(),y.moveTo(ut,Z),y.lineTo(K,rt),y.lineTo(ht,O),y.closePath(),y.stroke()}),y.restore()),y.canvas}function ai(n,t,e,i,s){if(i&&i!==n&&(e=e.bind(i)),s){const a=e;e=function(){n.removeEventListener(t,e),a.apply(this,arguments)}}const r={target:n,type:t,listener:e};return n.addEventListener(t,e),r}function Hp(n,t,e,i){return ai(n,t,e,i,!0)}function Li(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),yl(n))}class u4 extends cx{constructor(t){super({tileCoord:t.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:t.interpolate,transition:t.transition}),this.pixelRatio_=t.pixelRatio,this.gutter_=t.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=t.sourceTileGrid,this.targetTileGrid_=t.targetTileGrid,this.wrappedTileCoord_=t.wrappedTileCoord||t.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const e=t.sourceProj,i=e.getExtent(),s=t.sourceTileGrid.getExtent();this.clipExtent_=e.canWrapX()?s?_r(i,s):i:s;const r=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),a=this.targetTileGrid_.getExtent();let o=this.sourceTileGrid_.getExtent();const h=a?_r(r,a):r;if(Vd(h)===0){this.state=le.EMPTY;return}i&&(o?o=_r(o,i):o=i);const l=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),u=t.targetProj,f=mT(e,u,h,l);if(!isFinite(f)||f<=0){this.state=le.EMPTY;return}const m=t.errorThreshold!==void 0?t.errorThreshold:QS;if(this.triangulation_=new pT(e,u,h,o,f*m,l),this.triangulation_.getTriangles().length===0){this.state=le.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(f);let g=this.triangulation_.calculateSourceExtent();if(o&&(e.canWrapX()?(g[1]=Ui(g[1],o[1],o[3]),g[3]=Ui(g[3],o[1],o[3])):g=_r(g,o)),!Vd(g))this.state=le.EMPTY;else{let y=0,_=0;e.canWrapX()&&(y=fi(i),_=Math.floor((g[0]-i[0])/y)),mx(g.slice(),e,!0).forEach(M=>{const T=this.sourceTileGrid_.getTileRangeForExtentAndZ(M,this.sourceZ_),A=t.getTileFunction;for(let R=T.minX;R<=T.maxX;R++)for(let I=T.minY;I<=T.maxY;I++){const L=A(this.sourceZ_,R,I,this.pixelRatio_);if(L){const k=_*y;this.sourceTiles_.push({tile:L,offset:k})}}++_}),this.sourceTiles_.length===0&&(this.state=le.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{var I;const i=e.tile;if(!i||i.getState()!==le.LOADED)return;const s=i.getSize(),r=this.gutter_;let a;const o=H1(i.getData());o?a=o:a=LD(Gp(i.getData()));const h=[s[0]+2*r,s[1]+2*r],l=a instanceof Float32Array,u=h[0]*h[1],f=l?Float32Array:Uint8Array,m=new f(a.buffer),g=f.BYTES_PER_ELEMENT,y=g*m.length/u,_=m.byteLength/h[1],w=Math.floor(_/g/h[0]),M=u*w;let T=m;if(m.length!==M){T=new f(M);let L=0,k=0;const Y=h[0]*w;for(let K=0;K<h[1];++K){for(let rt=0;rt<Y;++rt)T[L++]=m[k+rt];k+=_/g}}const A=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);A[0]+=e.offset,A[2]+=e.offset;const R=(I=this.clipExtent_)==null?void 0:I.slice();R&&(R[0]+=e.offset,R[2]+=e.offset),t.push({extent:A,clipExtent:R,data:new Uint8Array(T.buffer),dataType:f,bytesPerPixel:y,pixelSize:h})}),this.sourceTiles_.length=0,t.length===0)this.state=le.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),s=typeof i=="number"?i:i[0],r=typeof i=="number"?i:i[1],a=this.targetTileGrid_.getResolution(e),o=this.sourceTileGrid_.getResolution(this.sourceZ_),h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let l,u;const f=t[0].bytesPerPixel,m=Math.ceil(f/3);for(let g=m-1;g>=0;--g){const y=[];for(let R=0,I=t.length;R<I;++R){const L=t[R],k=L.data,Y=L.pixelSize,K=Y[0],rt=Y[1],ut=yn(K,rt,uo),Z=ut.createImageData(K,rt),ht=Z.data;let O=g*3;for(let pt=0,Gt=ht.length;pt<Gt;pt+=4)ht[pt]=k[O],ht[pt+1]=k[O+1],ht[pt+2]=k[O+2],ht[pt+3]=255,O+=f;ut.putImageData(Z,0,0),y.push({extent:L.extent,clipExtent:L.clipExtent,image:ut.canvas})}const _=gT(s,r,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),a,h,this.triangulation_,y,this.gutter_,!1,!1,!1);for(let R=0,I=y.length;R<I;++R){const k=y[R].image.getContext("2d");Kc(k),uo.push(k.canvas)}const w=_.getContext("2d"),M=w.getImageData(0,0,_.width,_.height);Kc(w),uo.push(_),l||(u=new Uint8Array(f*M.width*M.height),l=new t[0].dataType(u.buffer));const T=M.data;let A=g*3;for(let R=0,I=T.length;R<I;R+=4)T[R+3]===255?(u[A]=T[R],u[A+1]=T[R+1],u[A+2]=T[R+2]):(u[A]=0,u[A+1]=0,u[A+2]=0),A+=f}this.reprojData_=l,this.reprojSize_=[Math.round(s*this.pixelRatio_),Math.round(r*this.pixelRatio_)],this.state=le.LOADED}this.changed()}load(){if(this.state!==le.IDLE&&this.state!==le.ERROR)return;this.state=le.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const i=e.getState();if(i!==le.IDLE&&i!==le.LOADING)return;t++;const s=ai(e,Ne.CHANGE,function(){const r=e.getState();(r==le.LOADED||r==le.ERROR||r==le.EMPTY)&&(Li(s),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(s)}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e}){e.getState()==le.IDLE&&e.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(Li),this.sourcesListenerKeys_=null}}const Mx=u4;function ci(n,t){if(!n)throw new Error(t)}class d4{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const i=this.entries_[t];return ci(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(t){const e=this.entries_[t];return ci(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.key_;return t}getValues(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){var e;return(e=this.entries_[t])==null?void 0:e.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){ci(!(t in this.entries_),"Tried to set a value for a key that is used already");const i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}setSize(t){this.highWaterMark=t}}const yT=d4;function qp(n,t,e,i){return i!==void 0?(i[0]=n,i[1]=t,i[2]=e,i):[n,t,e]}function Qc(n,t,e){return n+"/"+t+"/"+e}function Ko(n){return Qc(n[0],n[1],n[2])}function f4(n){return n.split("/").map(Number)}function p4(n){return(n[1]<<n[0])+n[2]}function m4(n,t){const e=n[0],i=n[1],s=n[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const r=t.getFullTileRange(e);return r?r.containsXY(i,s):!0}class g4 extends yT{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const t=this.peekFirstKey(),i=f4(t)[0];this.forEach(s=>{s.tileCoord[0]!==i&&(this.remove(Ko(s.tileCoord)),s.release())})}}const Ex=g4,Lc={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},tu={PROPERTYCHANGE:"propertychange"};class jm extends xf{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(Ne.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=ai(this,t[r],e);return s}return ai(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const s=t.length;i=new Array(s);for(let r=0;r<s;++r)i[r]=Hp(this,t[r],e)}else i=Hp(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)y4(i);else if(Array.isArray(t))for(let s=0,r=t.length;s<r;++s)this.removeEventListener(t[s],e);else this.removeEventListener(t,e)}}jm.prototype.on;jm.prototype.once;jm.prototype.un;function y4(n){if(Array.isArray(n))for(let t=0,e=n.length;t<e;++t)Li(n[t]);else Li(n)}const _T=jm;class Bb extends na{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}class _4 extends _T{constructor(t){super(),this.on,this.once,this.un,$e(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let i;i=`change:${t}`,this.hasListener(i)&&this.dispatchEvent(new Bb(i,t,e)),i=tu.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new Bb(i,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const s=this.values_||(this.values_={});if(i)s[t]=e;else{const r=s[t];s[t]=e,r!==e&&this.notify(t,r)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){!t.values_||Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],al(this.values_)&&(this.values_=null),e||this.notify(t,i)}}}const sa=_4;class x4 extends sa{constructor(t){super(),this.projection=Ri(t.projection),this.attributions_=Ub(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(i,s){e.viewResolver=i,e.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Ub(t),this.changed()}setState(t){this.state_=t,this.changed()}}function Ub(n){return n?Array.isArray(n)?function(t){return n}:typeof n=="function"?n:function(t){return[n]}:null}const xT=x4;class vT{constructor(t,e,i,s){this.minX=t,this.maxX=e,this.minY=i,this.maxY=s}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function Vl(n,t,e,i,s){return s!==void 0?(s.minX=n,s.maxX=t,s.minY=e,s.maxY=i,s):new vT(n,t,e,i)}const wT=vT,v4=42,Sx=256;function bT(n,t,e,i,s){let r;for(t+=i;t<e;t+=i)if(r=s(n.slice(t-i,t),n.slice(t,t+i)),r)return r;return!1}function w4(n,t,e,i,s){return!px(s,function(a){return!Zh(n,t,e,i,a[0],a[1])})}function Zh(n,t,e,i,s,r){let a=0,o=n[e-i],h=n[e-i+1];for(;t<e;t+=i){const l=n[t],u=n[t+1];h<=r?u>r&&(l-o)*(r-h)-(s-o)*(u-h)>0&&a++:u<=r&&(l-o)*(r-h)-(s-o)*(u-h)<0&&a--,o=l,h=u}return a!==0}function Tx(n,t,e,i,s,r){if(e.length===0||!Zh(n,t,e[0],i,s,r))return!1;for(let a=1,o=e.length;a<o;++a)if(Zh(n,e[a-1],e[a],i,s,r))return!1;return!0}function b4(n,t,e,i,s,r){if(e.length===0)return!1;for(let a=0,o=e.length;a<o;++a){const h=e[a];if(Tx(n,t,h,i,s,r))return!0;t=h[h.length-1]}return!1}function Zm(n,t,e,i,s){const r=nT(Jr(),n,t,e,i);return Gs(s,r)?Xh(s,r)||r[0]>=s[0]&&r[2]<=s[2]||r[1]>=s[1]&&r[3]<=s[3]?!0:bT(n,t,e,i,function(a,o){return UD(s,a,o)}):!1}function M4(n,t,e,i,s){for(let r=0,a=e.length;r<a;++r){if(Zm(n,t,e[r],i,s))return!0;t=e[r]}return!1}function MT(n,t,e,i,s){return!!(Zm(n,t,e,i,s)||Zh(n,t,e,i,s[0],s[1])||Zh(n,t,e,i,s[0],s[3])||Zh(n,t,e,i,s[2],s[1])||Zh(n,t,e,i,s[2],s[3]))}function ET(n,t,e,i,s){if(!MT(n,t,e[0],i,s))return!1;if(e.length===1)return!0;for(let r=1,a=e.length;r<a;++r)if(w4(n,e[r-1],e[r],i,s)&&!Zm(n,e[r-1],e[r],i,s))return!1;return!0}function E4(n,t,e,i,s){for(let r=0,a=e.length;r<a;++r){const o=e[r];if(ET(n,t,o,i,s))return!0;t=o[o.length-1]}return!1}function Gb(n){return n[0]>0&&n[1]>0}function S4(n,t,e){return e===void 0&&(e=[0,0]),e[0]=n[0]*t+.5|0,e[1]=n[1]*t+.5|0,e}function Tn(n,t){return Array.isArray(n)?n:(t===void 0?t=[n,n]:(t[0]=n,t[1]=n),t)}const Wl=[0,0,0],Do=5;class T4{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,ci(vD(this.resolutions_,(s,r)=>r-s,!0),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let s=0,r=this.resolutions_.length-1;s<r;++s)if(!e)e=this.resolutions_[s]/this.resolutions_[s+1];else if(this.resolutions_[s]/this.resolutions_[s+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,ci(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=t.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=pu(i)),ci(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,ci(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:Sx,ci(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((s,r)=>{const a=new wT(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(i){const o=this.getTileRangeForExtentAndZ(i,r);a.minX=Math.max(o.minX,a.minX),a.maxX=Math.min(o.maxX,a.maxX),a.minY=Math.max(o.minY,a.minY),a.maxY=Math.min(o.maxY,a.maxY)}return a}):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const s=this.getTileRangeForExtentAndZ(t,e);for(let r=s.minX,a=s.maxX;r<=a;++r)for(let o=s.minY,h=s.maxY;o<=h;++o)i([e,r,o])}forEachTileCoordParentTileRange(t,e,i,s){let r,a,o,h=null,l=t[0]-1;for(this.zoomFactor_===2?(a=t[1],o=t[2]):h=this.getTileCoordExtent(t,s);l>=this.minZoom;){if(a!==void 0&&o!==void 0?(a=Math.floor(a/2),o=Math.floor(o/2),r=Vl(a,a,o,o,i)):r=this.getTileRangeForExtentAndZ(h,l,i),e(l,r))return!0;--l}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const r=t[1]*2,a=t[2]*2;return Vl(r,r+1,a,a+1,e)}const s=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const s=t[0],r=t[1],a=t[2];if(e===s)return Vl(r,a,r,a,i);if(this.zoomFactor_){const h=Math.pow(this.zoomFactor_,e-s),l=Math.floor(r*h),u=Math.floor(a*h);if(e<s)return Vl(l,l,u,u,i);const f=Math.floor(h*(r+1))-1,m=Math.floor(h*(a+1))-1;return Vl(l,f,u,m,i)}const o=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,e,i)}getTileRangeForExtentAndZ(t,e,i){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,Wl);const s=Wl[1],r=Wl[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,Wl);const a=Wl[1],o=Wl[2];return Vl(s,a,r,o,i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),s=Tn(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*s[0]*i,e[1]-(t[2]+.5)*s[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),s=this.getResolution(t[0]),r=Tn(this.getTileSize(t[0]),this.tmpSize_),a=i[0]+t[1]*r[0]*s,o=i[1]-(t[2]+1)*r[1]*s,h=a+r[0]*s,l=o+r[1]*s;return vo(a,o,h,l,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,s,r){const a=this.getZForResolution(i),o=i/this.getResolution(a),h=this.getOrigin(a),l=Tn(this.getTileSize(a),this.tmpSize_);let u=o*(t-h[0])/i/l[0],f=o*(h[1]-e)/i/l[1];return s?(u=T0(u,Do)-1,f=T0(f,Do)-1):(u=S0(u,Do),f=S0(f,Do)),qp(a,u,f,r)}getTileCoordForXYAndZ_(t,e,i,s,r){const a=this.getOrigin(i),o=this.getResolution(i),h=Tn(this.getTileSize(i),this.tmpSize_);let l=(t-a[0])/o/h[0],u=(a[1]-e)/o/h[1];return s?(l=T0(l,Do)-1,u=T0(u,Do)-1):(l=S0(l,Do),u=S0(u,Do)),qp(i,l,u,r)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const i=hx(this.resolutions_,t,e||0);return Ui(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return MT(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let s=this.minZoom;s<e;++s)i[s]=this.getTileRangeForExtentAndZ(t,s);this.fullTileRanges_=i}}const Cx=T4;function Ax(n){let t=n.getDefaultTileGrid();return t||(t=R4(n),n.setDefaultTileGrid(t)),t}function C4(n,t,e){const i=t[0],s=n.getTileCoordCenter(t),r=Km(e);if(!ol(r,s)){const a=fi(r),o=Math.ceil((r[0]-s[0])/a);return s[0]+=a*o,n.getTileCoordForCoordAndZ(s,i)}return t}function A4(n,t,e,i){i=i!==void 0?i:"top-left";const s=TT(n,t,e);return new Cx({extent:n,origin:DD(n,i),resolutions:s,tileSize:e})}function ST(n){const t=n||{},e=t.extent||Ri("EPSG:3857").getExtent(),i={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:TT(e,t.maxZoom,t.tileSize,t.maxResolution)};return new Cx(i)}function TT(n,t,e,i){t=t!==void 0?t:v4,e=Tn(e!==void 0?e:Sx);const s=cs(n),r=fi(n);i=i>0?i:Math.max(r/e[0],s/e[1]);const a=t+1,o=new Array(a);for(let h=0;h<a;++h)o[h]=i/Math.pow(2,h);return o}function R4(n,t,e,i){const s=Km(n);return A4(s,t,e,i)}function Km(n){n=Ri(n);let t=n.getExtent();if(!t){const e=180*Wd.degrees/n.getMetersPerUnit();t=vo(-e,-e,e,e)}return t}class I4 extends xT{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=t.opaque!==void 0?t.opaque:!1,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&Tn(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tileCache=new Ex(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const i=this.getTileCacheForProjection(t);i&&i.expireCache(e)}forEachLoadedTile(t,e,i,s){const r=this.getTileCacheForProjection(t);if(!r)return!1;let a=!0,o,h,l;for(let u=i.minX;u<=i.maxX;++u)for(let f=i.minY;f<=i.maxY;++f)h=Qc(e,u,f),l=!1,r.containsKey(h)&&(o=r.get(h),l=o.getState()===le.LOADED,l&&(l=s(o)!==!1)),l||(a=!1);return a}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,i,s,r){return ke()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:Ax(t)}getTileCacheForProjection(t){const e=this.getProjection();return ci(e===null||zr(e,t),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const s=this.getTileGridForProjection(i),r=this.getTilePixelRatio(e),a=Tn(s.getTileSize(t),this.tmpSize);return r==1?a:S4(a,r,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=e!==void 0?e:this.getProjection();const i=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=C4(i,t,e)),m4(t,i)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const i=this.getTileCacheForProjection(e);t>i.highWaterMark&&(i.highWaterMark=t)}useTile(t,e,i,s){}}class CT extends na{constructor(t,e){super(t),this.tile=e}}const AT=I4;class N4 extends AT{constructor(t){const e=t.projection===void 0?"EPSG:3857":t.projection;let i=t.tileGrid;i===void 0&&e&&(i=ST({extent:Km(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize})),super({cacheSize:.1,attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:e,tileGrid:i,opaque:t.opaque,state:t.state,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate}),this.gutter_=t.gutter!==void 0?t.gutter:0,this.tileSize_=t.tileSize?Tn(t.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=t.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=t.bandCount===void 0?4:t.bandCount,this.tileGridForProjection_={},this.tileCacheForProjection_={}}setTileSizes(t){this.tileSizes_=t}getTileSize(t){if(this.tileSizes_)return this.tileSizes_[t];if(this.tileSize_)return this.tileSize_;const e=this.getTileGrid();return e?Tn(e.getTileSize(t)):[256,256]}getGutterForProjection(t){const e=this.getProjection();return!e||zr(e,t)?this.gutter_:0}setLoader(t){this.loader_=t}getReprojTile_(t,e,i,s,r){const a=this.getTileCacheForProjection(s),o=Qc(t,e,i);if(a.containsKey(o)){const w=a.get(o);if(w&&w.key==this.getKey())return w}const h=this.getTileGrid(),l=Math.max.apply(null,h.getResolutions().map((w,M)=>{const T=Tn(h.getTileSize(M)),A=this.getTileSize(M);return Math.max(A[0]/T[0],A[1]/T[1])})),u=this.getTileGridForProjection(r),f=this.getTileGridForProjection(s),m=[t,e,i],g=this.getTileCoordForTileUrlFunction(m,s),y=Object.assign({sourceProj:r,sourceTileGrid:u,targetProj:s,targetTileGrid:f,tileCoord:m,wrappedTileCoord:g,pixelRatio:l,gutter:this.getGutterForProjection(r),getTileFunction:(w,M,T,A)=>this.getTile(w,M,T,A,r)},this.tileOptions),_=new Mx(y);return _.key=this.getKey(),_}getTile(t,e,i,s,r){const a=this.getProjection();if(a&&r&&!zr(a,r))return this.getReprojTile_(t,e,i,r,a);const o=this.getTileSize(t),h=Qc(t,e,i);if(this.tileCache.containsKey(h))return this.tileCache.get(h);const l=this.loader_;function u(){return YS(function(){return l(t,e,i)})}const f=Object.assign({tileCoord:[t,e,i],loader:u,size:o},this.tileOptions),m=new cx(f);return m.key=this.getKey(),m.addEventListener(Ne.CHANGE,this.handleTileChange_),this.tileCache.set(h,m),m}handleTileChange_(t){const e=t.target,i=$e(e),s=e.getState();let r;s==le.LOADING?(this.tileLoadingKeys_[i]=!0,r=Lc.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],r=s==le.ERROR?Lc.TILELOADERROR:s==le.LOADED?Lc.TILELOADEND:void 0),r&&this.dispatchEvent(new CT(r,e))}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||zr(e,t)))return this.tileGrid;const i=$e(t);return i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=Ax(t)),this.tileGridForProjection_[i]}setTileGridForProjection(t,e){const i=Ri(t);if(i){const s=$e(i);s in this.tileGridForProjection_||(this.tileGridForProjection_[s]=e)}}getTileCacheForProjection(t){const e=this.getProjection();if(!e||zr(e,t))return this.tileCache;const i=$e(t);return i in this.tileCacheForProjection_||(this.tileCacheForProjection_[i]=new Ex(.1)),this.tileCacheForProjection_[i]}expireCache(t,e){const i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(const s in this.tileCacheForProjection_){const r=this.tileCacheForProjection_[s];r.expireCache(r==i?e:{})}}clear(){super.clear();for(const t in this.tileCacheForProjection_)this.tileCacheForProjection_[t].clear()}}const k4=N4;function Kn(n){return(t,...e)=>L4(n,t,e)}function gu(n,t){return Kn(RT(n,t).get)}const{apply:L4,construct:not,defineProperty:sot,get:rot,getOwnPropertyDescriptor:RT,getPrototypeOf:Rx,has:aot,ownKeys:O4,set:oot,setPrototypeOf:hot}=Reflect,{iterator:Mf,species:lot,toStringTag:P4,for:cot}=Symbol,F4=Object,{create:Ix,defineProperty:D4,freeze:uot,is:dot}=F4,z4=Array,B4=z4.prototype,IT=B4[Mf],U4=Kn(IT),NT=ArrayBuffer,G4=NT.prototype;gu(G4,"byteLength");const Vb=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;Vb&&gu(Vb.prototype,"byteLength");const kT=Rx(Uint8Array);kT.from;const Cs=kT.prototype;Cs[Mf];Kn(Cs.keys);Kn(Cs.values);Kn(Cs.entries);Kn(Cs.set);Kn(Cs.reverse);Kn(Cs.fill);Kn(Cs.copyWithin);Kn(Cs.sort);Kn(Cs.slice);Kn(Cs.subarray);gu(Cs,"buffer");gu(Cs,"byteOffset");gu(Cs,"length");gu(Cs,P4);const V4=Uint8Array,LT=Uint16Array,Nx=Uint32Array,W4=Float32Array,Hd=Rx([][Mf]()),OT=Kn(Hd.next),$4=Kn(function*(){}().next),Y4=Rx(Hd),H4=DataView.prototype,q4=Kn(H4.getUint16),kx=WeakMap,PT=kx.prototype,FT=Kn(PT.get),X4=Kn(PT.set),DT=new kx,j4=Ix(null,{next:{value:function(){const t=FT(DT,this);return OT(t)}},[Mf]:{value:function(){return this}}});function Z4(n){if(n[Mf]===IT&&Hd.next===OT)return n;const t=Ix(j4);return X4(DT,t,U4(n)),t}const K4=new kx,J4=Ix(Y4,{next:{value:function(){const t=FT(K4,this);return $4(t)},writable:!0,configurable:!0}});for(const n of O4(Hd))n!=="next"&&D4(J4,n,RT(Hd,n));const zT=new NT(4),Q4=new W4(zT),t6=new Nx(zT),ga=new LT(512),ya=new V4(512);for(let n=0;n<256;++n){const t=n-127;t<-24?(ga[n]=0,ga[n|256]=32768,ya[n]=24,ya[n|256]=24):t<-14?(ga[n]=1024>>-t-14,ga[n|256]=1024>>-t-14|32768,ya[n]=-t-1,ya[n|256]=-t-1):t<=15?(ga[n]=t+15<<10,ga[n|256]=t+15<<10|32768,ya[n]=13,ya[n|256]=13):t<128?(ga[n]=31744,ga[n|256]=64512,ya[n]=24,ya[n|256]=24):(ga[n]=31744,ga[n|256]=64512,ya[n]=13,ya[n|256]=13)}const Lx=new Nx(2048);for(let n=1;n<1024;++n){let t=n<<13,e=0;for(;(t&8388608)===0;)t<<=1,e-=8388608;t&=-8388609,e+=947912704,Lx[n]=t|e}for(let n=1024;n<2048;++n)Lx[n]=939524096+(n-1024<<13);const yu=new Nx(64);for(let n=1;n<31;++n)yu[n]=n<<23;yu[31]=1199570944;yu[32]=2147483648;for(let n=33;n<63;++n)yu[n]=2147483648+(n-32<<23);yu[63]=3347054592;const BT=new LT(64);for(let n=1;n<64;++n)n!==32&&(BT[n]=1024);function e6(n){const t=n>>10;return t6[0]=Lx[BT[t]+(n&1023)]+yu[t],Q4[0]}function UT(n,t,...e){return e6(q4(n,t,...Z4(e)))}var wa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ed={exports:{}};function GT(n,t,e){const i=e&&e.debug||!1;i&&console.log("[xml-utils] getting "+t+" in "+n);const s=typeof n=="object"?n.outer:n,r=s.slice(0,s.indexOf(">")+1),a=['"',"'"];for(let o=0;o<a.length;o++){const h=a[o],l=t+"\\="+h+"([^"+h+"]*)"+h;i&&console.log("[xml-utils] pattern:",l);const f=new RegExp(l).exec(r);if(i&&console.log("[xml-utils] match:",f),f)return f[1]}}Ed.exports=GT;Ed.exports.default=GT;var Ox={exports:{}},Px={exports:{}},Fx={exports:{}};function VT(n,t,e){const s=new RegExp(t).exec(n.slice(e));return s?e+s.index:-1}Fx.exports=VT;Fx.exports.default=VT;var Dx={exports:{}};function WT(n,t,e){const s=new RegExp(t).exec(n.slice(e));return s?e+s.index+s[0].length-1:-1}Dx.exports=WT;Dx.exports.default=WT;var zx={exports:{}};function $T(n,t){const e=new RegExp(t,"g"),i=n.match(e);return i?i.length:0}zx.exports=$T;zx.exports.default=$T;const i6=Fx.exports,by=Dx.exports,Wb=zx.exports;function YT(n,t,e){const i=e&&e.debug||!1,s=!(e&&typeof e.nested===!1),r=e&&e.startIndex||0;i&&console.log("[xml-utils] starting findTagByName with",t," and ",e);const a=i6(n,`<${t}[ 
>/]`,r);if(i&&console.log("[xml-utils] start:",a),a===-1)return;const o=n.slice(a+t.length);let h=by(o,"^[^<]*[ /]>",0);const l=h!==-1&&o[h-1]==="/";if(i&&console.log("[xml-utils] selfClosing:",l),l===!1)if(s){let g=0,y=1,_=0;for(;(h=by(o,"[ /]"+t+">",g))!==-1;){const w=o.substring(g,h+1);if(y+=Wb(w,"<"+t+`[ 
	>]`),_+=Wb(w,"</"+t+">"),_>=y)break;g=h}}else h=by(o,"[ /]"+t+">",0);const u=a+t.length+h+1;if(i&&console.log("[xml-utils] end:",u),u===-1)return;const f=n.slice(a,u);let m;return l?m=null:m=f.slice(f.indexOf(">")+1,f.lastIndexOf("<")),{inner:m,outer:f,start:a,end:u}}Px.exports=YT;Px.exports.default=YT;const n6=Px.exports;function HT(n,t,e){const i=[],s=e&&e.debug||!1,r=e&&typeof e.nested=="boolean"?e.nested:!0;let a=e&&e.startIndex||0,o;for(;o=n6(n,t,{debug:s,startIndex:a});)r?a=o.start+1+t.length:a=o.end,i.push(o);return s&&console.log("findTagsByName found",i.length,"tags"),i}Ox.exports=HT;Ox.exports.default=HT;const Sd={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},va={};for(const n in Sd)Sd.hasOwnProperty(n)&&(va[Sd[n]]=parseInt(n,10));const s6=[va.BitsPerSample,va.ExtraSamples,va.SampleFormat,va.StripByteCounts,va.StripOffsets,va.StripRowCounts,va.TileByteCounts,va.TileOffsets,va.SubIFDs],My={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},He={};for(const n in My)My.hasOwnProperty(n)&&(He[My[n]]=parseInt(n,10));const Ps={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},r6={Unspecified:0,Assocalpha:1,Unassalpha:2},fot={Version:0,AddCompression:1},pot={None:0,Deflate:1,Zstandard:2},a6={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function o6(n,t){const{width:e,height:i}=n,s=new Uint8Array(e*i*3);let r;for(let a=0,o=0;a<n.length;++a,o+=3)r=256-n[a]/t*256,s[o]=r,s[o+1]=r,s[o+2]=r;return s}function h6(n,t){const{width:e,height:i}=n,s=new Uint8Array(e*i*3);let r;for(let a=0,o=0;a<n.length;++a,o+=3)r=n[a]/t*256,s[o]=r,s[o+1]=r,s[o+2]=r;return s}function l6(n,t){const{width:e,height:i}=n,s=new Uint8Array(e*i*3),r=t.length/3,a=t.length/3*2;for(let o=0,h=0;o<n.length;++o,h+=3){const l=n[o];s[h]=t[l]/65536*256,s[h+1]=t[l+r]/65536*256,s[h+2]=t[l+a]/65536*256}return s}function c6(n){const{width:t,height:e}=n,i=new Uint8Array(t*e*3);for(let s=0,r=0;s<n.length;s+=4,r+=3){const a=n[s],o=n[s+1],h=n[s+2],l=n[s+3];i[r]=255*((255-a)/256)*((255-l)/256),i[r+1]=255*((255-o)/256)*((255-l)/256),i[r+2]=255*((255-h)/256)*((255-l)/256)}return i}function u6(n){const{width:t,height:e}=n,i=new Uint8ClampedArray(t*e*3);for(let s=0,r=0;s<n.length;s+=3,r+=3){const a=n[s],o=n[s+1],h=n[s+2];i[r]=a+1.402*(h-128),i[r+1]=a-.34414*(o-128)-.71414*(h-128),i[r+2]=a+1.772*(o-128)}return i}const d6=.95047,f6=1,p6=1.08883;function m6(n){const{width:t,height:e}=n,i=new Uint8Array(t*e*3);for(let s=0,r=0;s<n.length;s+=3,r+=3){const a=n[s+0],o=n[s+1]<<24>>24,h=n[s+2]<<24>>24;let l=(a+16)/116,u=o/500+l,f=l-h/200,m,g,y;u=d6*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),l=f6*(l*l*l>.008856?l*l*l:(l-16/116)/7.787),f=p6*(f*f*f>.008856?f*f*f:(f-16/116)/7.787),m=u*3.2406+l*-1.5372+f*-.4986,g=u*-.9689+l*1.8758+f*.0415,y=u*.0557+l*-.204+f*1.057,m=m>.0031308?1.055*m**(1/2.4)-.055:12.92*m,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,y=y>.0031308?1.055*y**(1/2.4)-.055:12.92*y,i[r]=Math.max(0,Math.min(1,m))*255,i[r+1]=Math.max(0,Math.min(1,g))*255,i[r+2]=Math.max(0,Math.min(1,y))*255}return i}const g6="modulepreload",y6=function(n){return"/"+n},$b={},Eh=function(t,e,i){if(!e||e.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(e.map(r=>{if(r=y6(r),r in $b)return;$b[r]=!0;const a=r.endsWith(".css"),o=a?'[rel="stylesheet"]':"";if(!!i)for(let u=s.length-1;u>=0;u--){const f=s[u];if(f.href===r&&(!a||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${o}`))return;const l=document.createElement("link");if(l.rel=a?"stylesheet":g6,a||(l.as="script",l.crossOrigin=""),l.href=r,document.head.appendChild(l),a)return new Promise((u,f)=>{l.addEventListener("load",u),l.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>t())},qT=new Map;function Sh(n,t){Array.isArray(n)||(n=[n]),n.forEach(e=>qT.set(e,t))}async function XT(n){const t=qT.get(n.Compression);if(!t)throw new Error(`Unknown compression method identifier: ${n.Compression}`);const e=await t();return new e(n)}Sh([void 0,1],()=>Eh(()=>import("./raw.c45fc51f.js"),["assets/raw.c45fc51f.js","assets/basedecoder.c2fc4d47.js"]).then(n=>n.default));Sh(5,()=>Eh(()=>import("./lzw.654ab67e.js"),["assets/lzw.654ab67e.js","assets/basedecoder.c2fc4d47.js"]).then(n=>n.default));Sh(6,()=>{throw new Error("old style JPEG compression is not supported.")});Sh(7,()=>Eh(()=>import("./jpeg.0079b036.js"),["assets/jpeg.0079b036.js","assets/basedecoder.c2fc4d47.js"]).then(n=>n.default));Sh([8,32946],()=>Eh(()=>import("./deflate.dec59ca0.js"),["assets/deflate.dec59ca0.js","assets/pako.esm.48236ed7.js","assets/basedecoder.c2fc4d47.js"]).then(n=>n.default));Sh(32773,()=>Eh(()=>import("./packbits.d5c3724c.js"),["assets/packbits.d5c3724c.js","assets/basedecoder.c2fc4d47.js"]).then(n=>n.default));Sh(34887,()=>Eh(()=>import("./lerc.0812b0aa.js"),["assets/lerc.0812b0aa.js","assets/pako.esm.48236ed7.js","assets/basedecoder.c2fc4d47.js"]).then(async n=>(await n.zstd.init(),n)).then(n=>n.default));Sh(50001,()=>Eh(()=>import("./webimage.eace165f.js"),["assets/webimage.eace165f.js","assets/basedecoder.c2fc4d47.js"]).then(n=>n.default));function Jm(n,t,e,i=1){return new(Object.getPrototypeOf(n)).constructor(t*e*i)}function _6(n,t,e,i,s){const r=t/i,a=e/s;return n.map(o=>{const h=Jm(o,i,s);for(let l=0;l<s;++l){const u=Math.min(Math.round(a*l),e-1);for(let f=0;f<i;++f){const m=Math.min(Math.round(r*f),t-1),g=o[u*t+m];h[l*i+f]=g}}return h})}function Oc(n,t,e){return(1-e)*n+e*t}function x6(n,t,e,i,s){const r=t/i,a=e/s;return n.map(o=>{const h=Jm(o,i,s);for(let l=0;l<s;++l){const u=a*l,f=Math.floor(u),m=Math.min(Math.ceil(u),e-1);for(let g=0;g<i;++g){const y=r*g,_=y%1,w=Math.floor(y),M=Math.min(Math.ceil(y),t-1),T=o[f*t+w],A=o[f*t+M],R=o[m*t+w],I=o[m*t+M],L=Oc(Oc(T,A,_),Oc(R,I,_),u%1);h[l*i+g]=L}}return h})}function v6(n,t,e,i,s,r="nearest"){switch(r.toLowerCase()){case"nearest":return _6(n,t,e,i,s);case"bilinear":case"linear":return x6(n,t,e,i,s);default:throw new Error(`Unsupported resampling method: '${r}'`)}}function w6(n,t,e,i,s,r){const a=t/i,o=e/s,h=Jm(n,i,s,r);for(let l=0;l<s;++l){const u=Math.min(Math.round(o*l),e-1);for(let f=0;f<i;++f){const m=Math.min(Math.round(a*f),t-1);for(let g=0;g<r;++g){const y=n[u*t*r+m*r+g];h[l*i*r+f*r+g]=y}}}return h}function b6(n,t,e,i,s,r){const a=t/i,o=e/s,h=Jm(n,i,s,r);for(let l=0;l<s;++l){const u=o*l,f=Math.floor(u),m=Math.min(Math.ceil(u),e-1);for(let g=0;g<i;++g){const y=a*g,_=y%1,w=Math.floor(y),M=Math.min(Math.ceil(y),t-1);for(let T=0;T<r;++T){const A=n[f*t*r+w*r+T],R=n[f*t*r+M*r+T],I=n[m*t*r+w*r+T],L=n[m*t*r+M*r+T],k=Oc(Oc(A,R,_),Oc(I,L,_),u%1);h[l*i*r+g*r+T]=k}}}return h}function M6(n,t,e,i,s,r,a="nearest"){switch(a.toLowerCase()){case"nearest":return w6(n,t,e,i,s,r);case"bilinear":case"linear":return b6(n,t,e,i,s,r);default:throw new Error(`Unsupported resampling method: '${a}'`)}}function E6(n,t,e){let i=0;for(let s=t;s<e;++s)i+=n[s];return i}function Q1(n,t,e){switch(n){case 1:if(t<=8)return new Uint8Array(e);if(t<=16)return new Uint16Array(e);if(t<=32)return new Uint32Array(e);break;case 2:if(t===8)return new Int8Array(e);if(t===16)return new Int16Array(e);if(t===32)return new Int32Array(e);break;case 3:switch(t){case 16:case 32:return new Float32Array(e);case 64:return new Float64Array(e)}break}throw Error("Unsupported data format/bitsPerSample")}function S6(n,t){return(n===1||n===2)&&t<=32&&t%8===0?!1:!(n===3&&(t===16||t===32||t===64))}function T6(n,t,e,i,s,r,a){const o=new DataView(n),h=e===2?a*r:a*r*i,l=e===2?1:i,u=Q1(t,s,h),f=parseInt("1".repeat(s),2);if(t===1){let m;e===1?m=i*s:m=s;let g=r*m;(g&7)!==0&&(g=g+7&-8);for(let y=0;y<a;++y){const _=y*g;for(let w=0;w<r;++w){const M=_+w*l*s;for(let T=0;T<l;++T){const A=M+T*s,R=(y*r+w)*l+T,I=Math.floor(A/8),L=A%8;if(L+s<=8)u[R]=o.getUint8(I)>>8-s-L&f;else if(L+s<=16)u[R]=o.getUint16(I)>>16-s-L&f;else if(L+s<=24){const k=o.getUint16(I)<<8|o.getUint8(I+2);u[R]=k>>24-s-L&f}else u[R]=o.getUint32(I)>>32-s-L&f}}}}return u.buffer}class C6{constructor(t,e,i,s,r,a){this.fileDirectory=t,this.geoKeys=e,this.dataView=i,this.littleEndian=s,this.tiles=r?{}:null,this.isTiled=!t.StripOffsets;const o=t.PlanarConfiguration;if(this.planarConfiguration=typeof o>"u"?1:o,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=a}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(t){return this.isTiled||(t+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-t*this.getTileHeight()}getBytesPerPixel(){let t=0;for(let e=0;e<this.fileDirectory.BitsPerSample.length;++e)t+=this.getSampleByteSize(e);return t}getSampleByteSize(t){if(t>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${t} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[t]/8)}getReaderForSample(t){const e=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1,i=this.fileDirectory.BitsPerSample[t];switch(e){case 1:if(i<=8)return DataView.prototype.getUint8;if(i<=16)return DataView.prototype.getUint16;if(i<=32)return DataView.prototype.getUint32;break;case 2:if(i<=8)return DataView.prototype.getInt8;if(i<=16)return DataView.prototype.getInt16;if(i<=32)return DataView.prototype.getInt32;break;case 3:switch(i){case 16:return function(s,r){return UT(this,s,r)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(t=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1}getBitsPerSample(t=0){return this.fileDirectory.BitsPerSample[t]}getArrayForSample(t,e){const i=this.getSampleFormat(t),s=this.getBitsPerSample(t);return Q1(i,s,e)}async getTileOrStrip(t,e,i,s,r){const a=Math.ceil(this.getWidth()/this.getTileWidth()),o=Math.ceil(this.getHeight()/this.getTileHeight());let h;const{tiles:l}=this;this.planarConfiguration===1?h=e*a+t:this.planarConfiguration===2&&(h=i*a*o+e*a+t);let u,f;this.isTiled?(u=this.fileDirectory.TileOffsets[h],f=this.fileDirectory.TileByteCounts[h]):(u=this.fileDirectory.StripOffsets[h],f=this.fileDirectory.StripByteCounts[h]);const m=(await this.source.fetch([{offset:u,length:f}],r))[0];let g;return l===null||!l[h]?(g=(async()=>{let y=await s.decode(this.fileDirectory,m);const _=this.getSampleFormat(),w=this.getBitsPerSample();return S6(_,w)&&(y=T6(y,_,this.planarConfiguration,this.getSamplesPerPixel(),w,this.getTileWidth(),this.getBlockHeight(e))),y})(),l!==null&&(l[h]=g)):g=l[h],{x:t,y:e,sample:i,data:await g}}async _readRaster(t,e,i,s,r,a,o,h,l){const u=this.getTileWidth(),f=this.getTileHeight(),m=this.getWidth(),g=this.getHeight(),y=Math.max(Math.floor(t[0]/u),0),_=Math.min(Math.ceil(t[2]/u),Math.ceil(m/u)),w=Math.max(Math.floor(t[1]/f),0),M=Math.min(Math.ceil(t[3]/f),Math.ceil(g/f)),T=t[2]-t[0];let A=this.getBytesPerPixel();const R=[],I=[];for(let Y=0;Y<e.length;++Y)this.planarConfiguration===1?R.push(E6(this.fileDirectory.BitsPerSample,0,e[Y])/8):R.push(0),I.push(this.getReaderForSample(e[Y]));const L=[],{littleEndian:k}=this;for(let Y=w;Y<M;++Y)for(let K=y;K<_;++K){let rt;this.planarConfiguration===1&&(rt=this.getTileOrStrip(K,Y,0,r,l));for(let ut=0;ut<e.length;++ut){const Z=ut,ht=e[ut];this.planarConfiguration===2&&(A=this.getSampleByteSize(ht),rt=this.getTileOrStrip(K,Y,ht,r,l));const O=rt.then(pt=>{const Gt=pt.data,Ft=new DataView(Gt),oe=this.getBlockHeight(pt.y),Dt=pt.y*f,re=pt.x*u,yt=Dt+oe,gt=(pt.x+1)*u,ge=I[Z],Et=Math.min(oe,oe-(yt-t[3]),g-Dt),Kt=Math.min(u,u-(gt-t[2]),m-re);for(let Je=Math.max(0,t[1]-Dt);Je<Et;++Je)for(let Qe=Math.max(0,t[0]-re);Qe<Kt;++Qe){const Te=(Je*u+Qe)*A,Xe=ge.call(Ft,Te+R[Z],k);let ti;s?(ti=(Je+Dt-t[1])*T*e.length+(Qe+re-t[0])*e.length+Z,i[ti]=Xe):(ti=(Je+Dt-t[1])*T+Qe+re-t[0],i[Z][ti]=Xe)}});L.push(O)}}if(await Promise.all(L),a&&t[2]-t[0]!==a||o&&t[3]-t[1]!==o){let Y;return s?Y=M6(i,t[2]-t[0],t[3]-t[1],a,o,e.length,h):Y=v6(i,t[2]-t[0],t[3]-t[1],a,o,h),Y.width=a,Y.height=o,Y}return i.width=a||t[2]-t[0],i.height=o||t[3]-t[1],i}async readRasters({window:t,samples:e=[],interleave:i,pool:s=null,width:r,height:a,resampleMethod:o,fillValue:h,signal:l}={}){const u=t||[0,0,this.getWidth(),this.getHeight()];if(u[0]>u[2]||u[1]>u[3])throw new Error("Invalid subsets");const f=u[2]-u[0],m=u[3]-u[1],g=f*m,y=this.getSamplesPerPixel();if(!e||!e.length)for(let T=0;T<y;++T)e.push(T);else for(let T=0;T<e.length;++T)if(e[T]>=y)return Promise.reject(new RangeError(`Invalid sample index '${e[T]}'.`));let _;if(i){const T=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,A=Math.max.apply(null,this.fileDirectory.BitsPerSample);_=Q1(T,A,g*e.length),h&&_.fill(h)}else{_=[];for(let T=0;T<e.length;++T){const A=this.getArrayForSample(e[T],g);Array.isArray(h)&&T<h.length?A.fill(h[T]):h&&!Array.isArray(h)&&A.fill(h),_.push(A)}}const w=s||await XT(this.fileDirectory);return await this._readRaster(u,e,_,i,w,r,a,o,l)}async readRGB({window:t,interleave:e=!0,pool:i=null,width:s,height:r,resampleMethod:a,enableAlpha:o=!1,signal:h}={}){const l=t||[0,0,this.getWidth(),this.getHeight()];if(l[0]>l[2]||l[1]>l[3])throw new Error("Invalid subsets");const u=this.fileDirectory.PhotometricInterpretation;if(u===Ps.RGB){let M=[0,1,2];if(this.fileDirectory.ExtraSamples!==r6.Unspecified&&o){M=[];for(let T=0;T<this.fileDirectory.BitsPerSample.length;T+=1)M.push(T)}return this.readRasters({window:t,interleave:e,samples:M,pool:i,width:s,height:r,resampleMethod:a,signal:h})}let f;switch(u){case Ps.WhiteIsZero:case Ps.BlackIsZero:case Ps.Palette:f=[0];break;case Ps.CMYK:f=[0,1,2,3];break;case Ps.YCbCr:case Ps.CIELab:f=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const m={window:l,interleave:!0,samples:f,pool:i,width:s,height:r,resampleMethod:a,signal:h},{fileDirectory:g}=this,y=await this.readRasters(m),_=2**this.fileDirectory.BitsPerSample[0];let w;switch(u){case Ps.WhiteIsZero:w=o6(y,_);break;case Ps.BlackIsZero:w=h6(y,_);break;case Ps.Palette:w=l6(y,g.ColorMap);break;case Ps.CMYK:w=c6(y);break;case Ps.YCbCr:w=u6(y);break;case Ps.CIELab:w=m6(y);break;default:throw new Error("Unsupported photometric interpretation.")}if(!e){const M=new Uint8Array(w.length/3),T=new Uint8Array(w.length/3),A=new Uint8Array(w.length/3);for(let R=0,I=0;R<w.length;R+=3,++I)M[I]=w[R],T[I]=w[R+1],A[I]=w[R+2];w=[M,T,A]}return w.width=y.width,w.height=y.height,w}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const t=[];for(let e=0;e<this.fileDirectory.ModelTiepoint.length;e+=6)t.push({i:this.fileDirectory.ModelTiepoint[e],j:this.fileDirectory.ModelTiepoint[e+1],k:this.fileDirectory.ModelTiepoint[e+2],x:this.fileDirectory.ModelTiepoint[e+3],y:this.fileDirectory.ModelTiepoint[e+4],z:this.fileDirectory.ModelTiepoint[e+5]});return t}getGDALMetadata(t=null){const e={};if(!this.fileDirectory.GDAL_METADATA)return null;const i=this.fileDirectory.GDAL_METADATA;let s=Ox.exports(i,"Item");t===null?s=s.filter(r=>Ed.exports(r,"sample")===void 0):s=s.filter(r=>Number(Ed.exports(r,"sample"))===t);for(let r=0;r<s.length;++r){const a=s[r];e[Ed.exports(a,"name")]=a.inner}return e}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const t=this.fileDirectory.GDAL_NODATA;return Number(t.substring(0,t.length-1))}getOrigin(){const t=this.fileDirectory.ModelTiepoint,e=this.fileDirectory.ModelTransformation;if(t&&t.length===6)return[t[3],t[4],t[5]];if(e)return[e[3],e[7],e[11]];throw new Error("The image does not have an affine transformation.")}getResolution(t=null){const e=this.fileDirectory.ModelPixelScale,i=this.fileDirectory.ModelTransformation;if(e)return[e[0],-e[1],e[2]];if(i)return i[1]===0&&i[4]===0?[i[0],-i[5],i[10]]:[Math.sqrt(i[0]*i[0]+i[4]*i[4]),-Math.sqrt(i[1]*i[1]+i[5]*i[5]),i[10]];if(t){const[s,r,a]=t.getResolution();return[s*t.getWidth()/this.getWidth(),r*t.getHeight()/this.getHeight(),a*t.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(t=!1){const e=this.getHeight(),i=this.getWidth();if(this.fileDirectory.ModelTransformation&&!t){const[s,r,a,o,h,l,u,f]=this.fileDirectory.ModelTransformation,g=[[0,0],[0,e],[i,0],[i,e]].map(([w,M])=>[o+s*w+r*M,f+h*w+l*M]),y=g.map(w=>w[0]),_=g.map(w=>w[1]);return[Math.min(...y),Math.min(..._),Math.max(...y),Math.max(..._)]}else{const s=this.getOrigin(),r=this.getResolution(),a=s[0],o=s[1],h=a+r[0]*i,l=o+r[1]*e;return[Math.min(a,h),Math.min(o,l),Math.max(a,h),Math.max(o,l)]}}}const jT=C6;class A6{constructor(t){this._dataView=new DataView(t)}get buffer(){return this._dataView.buffer}getUint64(t,e){const i=this.getUint32(t,e),s=this.getUint32(t+4,e);let r;if(e){if(r=i+2**32*s,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}if(r=2**32*i+s,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}getInt64(t,e){let i=0;const s=(this._dataView.getUint8(t+(e?7:0))&128)>0;let r=!0;for(let a=0;a<8;a++){let o=this._dataView.getUint8(t+(e?a:7-a));s&&(r?o!==0&&(o=~(o-1)&255,r=!1):o=~o&255),i+=o*256**a}return s&&(i=-i),i}getUint8(t,e){return this._dataView.getUint8(t,e)}getInt8(t,e){return this._dataView.getInt8(t,e)}getUint16(t,e){return this._dataView.getUint16(t,e)}getInt16(t,e){return this._dataView.getInt16(t,e)}getUint32(t,e){return this._dataView.getUint32(t,e)}getInt32(t,e){return this._dataView.getInt32(t,e)}getFloat16(t,e){return UT(this._dataView,t,e)}getFloat32(t,e){return this._dataView.getFloat32(t,e)}getFloat64(t,e){return this._dataView.getFloat64(t,e)}}class R6{constructor(t,e,i,s){this._dataView=new DataView(t),this._sliceOffset=e,this._littleEndian=i,this._bigTiff=s}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(t,e){return this.sliceOffset<=t&&this.sliceTop>=t+e}readUint8(t){return this._dataView.getUint8(t-this._sliceOffset,this._littleEndian)}readInt8(t){return this._dataView.getInt8(t-this._sliceOffset,this._littleEndian)}readUint16(t){return this._dataView.getUint16(t-this._sliceOffset,this._littleEndian)}readInt16(t){return this._dataView.getInt16(t-this._sliceOffset,this._littleEndian)}readUint32(t){return this._dataView.getUint32(t-this._sliceOffset,this._littleEndian)}readInt32(t){return this._dataView.getInt32(t-this._sliceOffset,this._littleEndian)}readFloat32(t){return this._dataView.getFloat32(t-this._sliceOffset,this._littleEndian)}readFloat64(t){return this._dataView.getFloat64(t-this._sliceOffset,this._littleEndian)}readUint64(t){const e=this.readUint32(t),i=this.readUint32(t+4);let s;if(this._littleEndian){if(s=e+2**32*i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*e+i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}readInt64(t){let e=0;const i=(this._dataView.getUint8(t+(this._littleEndian?7:0))&128)>0;let s=!0;for(let r=0;r<8;r++){let a=this._dataView.getUint8(t+(this._littleEndian?r:7-r));i&&(s?a!==0&&(a=~(a-1)&255,s=!1):a=~a&255),e+=a*256**r}return i&&(e=-e),e}readOffset(t){return this._bigTiff?this.readUint64(t):this.readUint32(t)}}const I6=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class N6{constructor(t=I6,e){this.workers=null,this._awaitingDecoder=null,this.size=t,this.messageId=0,t&&(this._awaitingDecoder=e?Promise.resolve(e):new Promise(i=>{Eh(()=>import("./decoder.bb43eff6.js"),[]).then(s=>{i(s.create)})}),this._awaitingDecoder.then(i=>{this._awaitingDecoder=null,this.workers=[];for(let s=0;s<t;s++)this.workers.push({worker:i(),idle:!0})}))}async decode(t,e){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?XT(t).then(i=>i.decode(t,e)):new Promise(i=>{const s=this.workers.find(o=>o.idle)||this.workers[Math.floor(Math.random()*this.size)];s.idle=!1;const r=this.messageId++,a=o=>{o.data.id===r&&(s.idle=!0,i(o.data.decoded),s.worker.removeEventListener("message",a))};s.worker.addEventListener("message",a),s.worker.postMessage({fileDirectory:t,buffer:e,id:r},[e])})}destroy(){this.workers&&(this.workers.forEach(t=>{t.worker.terminate()}),this.workers=null)}}const k6=N6,Yb=`\r
\r
`;function ZT(n){if(typeof Object.fromEntries<"u")return Object.fromEntries(n);const t={};for(const[e,i]of n)t[e.toLowerCase()]=i;return t}function L6(n){const t=n.split(`\r
`).map(e=>{const i=e.split(":").map(s=>s.trim());return i[0]=i[0].toLowerCase(),i});return ZT(t)}function O6(n){const[t,...e]=n.split(";").map(s=>s.trim()),i=e.map(s=>s.split("="));return{type:t,params:ZT(i)}}function t_(n){let t,e,i;return n&&([,t,e,i]=n.match(/bytes (\d+)-(\d+)\/(\d+)/),t=parseInt(t,10),e=parseInt(e,10),i=parseInt(i,10)),{start:t,end:e,total:i}}function P6(n,t){let e=null;const i=new TextDecoder("ascii"),s=[],r=`--${t}`,a=`${r}--`;for(let o=0;o<10;++o)i.decode(new Uint8Array(n,o,r.length))===r&&(e=o);if(e===null)throw new Error("Could not find initial boundary");for(;e<n.byteLength;){const o=i.decode(new Uint8Array(n,e,Math.min(r.length+1024,n.byteLength-e)));if(o.length===0||o.startsWith(a))break;if(!o.startsWith(r))throw new Error("Part does not start with boundary");const h=o.substr(r.length+2);if(h.length===0)break;const l=h.indexOf(Yb),u=L6(h.substr(0,l)),{start:f,end:m,total:g}=t_(u["content-range"]),y=e+r.length+l+Yb.length,_=parseInt(m,10)+1-parseInt(f,10);s.push({headers:u,data:n.slice(y,y+_),offset:f,length:_,fileSize:g}),e=y+_+4}return s}class Bx{async fetch(t,e=void 0){return Promise.all(t.map(i=>this.fetchSlice(i,e)))}async fetchSlice(t){throw new Error(`fetching of slice ${t} not possible, not implemented`)}get fileSize(){return null}async close(){}}class F6 extends Map{constructor(t={}){if(super(),!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof t.maxAge=="number"&&t.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=t.maxSize,this.maxAge=t.maxAge||Number.POSITIVE_INFINITY,this.onEviction=t.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(t){if(typeof this.onEviction=="function")for(const[e,i]of t)this.onEviction(e,i.value)}_deleteIfExpired(t,e){return typeof e.expiry=="number"&&e.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(t,e.value),this.delete(t)):!1}_getOrDeleteIfExpired(t,e){if(this._deleteIfExpired(t,e)===!1)return e.value}_getItemValue(t,e){return e.expiry?this._getOrDeleteIfExpired(t,e):e.value}_peek(t,e){const i=e.get(t);return this._getItemValue(t,i)}_set(t,e){this.cache.set(t,e),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(t,e){this.oldCache.delete(t),this._set(t,e)}*_entriesAscending(){for(const t of this.oldCache){const[e,i]=t;this.cache.has(e)||this._deleteIfExpired(e,i)===!1&&(yield t)}for(const t of this.cache){const[e,i]=t;this._deleteIfExpired(e,i)===!1&&(yield t)}}get(t){if(this.cache.has(t)){const e=this.cache.get(t);return this._getItemValue(t,e)}if(this.oldCache.has(t)){const e=this.oldCache.get(t);if(this._deleteIfExpired(t,e)===!1)return this._moveToRecent(t,e),e.value}}set(t,e,{maxAge:i=this.maxAge}={}){const s=typeof i=="number"&&i!==Number.POSITIVE_INFINITY?Date.now()+i:void 0;return this.cache.has(t)?this.cache.set(t,{value:e,expiry:s}):this._set(t,{value:e,expiry:s}),this}has(t){return this.cache.has(t)?!this._deleteIfExpired(t,this.cache.get(t)):this.oldCache.has(t)?!this._deleteIfExpired(t,this.oldCache.get(t)):!1}peek(t){if(this.cache.has(t))return this._peek(t,this.cache);if(this.oldCache.has(t))return this._peek(t,this.oldCache)}delete(t){const e=this.cache.delete(t);return e&&this._size--,this.oldCache.delete(t)||e}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(t){if(!(t&&t>0))throw new TypeError("`maxSize` must be a number greater than 0");const e=[...this._entriesAscending()],i=e.length-t;i<0?(this.cache=new Map(e),this.oldCache=new Map,this._size=e.length):(i>0&&this._emitEvictions(e.slice(0,i)),this.oldCache=new Map(e.slice(i)),this.cache=new Map,this._size=0),this.maxSize=t}*keys(){for(const[t]of this)yield t}*values(){for(const[,t]of this)yield t}*[Symbol.iterator](){for(const t of this.cache){const[e,i]=t;this._deleteIfExpired(e,i)===!1&&(yield[e,i.value])}for(const t of this.oldCache){const[e,i]=t;this.cache.has(e)||this._deleteIfExpired(e,i)===!1&&(yield[e,i.value])}}*entriesDescending(){let t=[...this.cache];for(let e=t.length-1;e>=0;--e){const i=t[e],[s,r]=i;this._deleteIfExpired(s,r)===!1&&(yield[s,r.value])}t=[...this.oldCache];for(let e=t.length-1;e>=0;--e){const i=t[e],[s,r]=i;this.cache.has(s)||this._deleteIfExpired(s,r)===!1&&(yield[s,r.value])}}*entriesAscending(){for(const[t,e]of this._entriesAscending())yield[t,e.value]}get size(){if(!this._size)return this.oldCache.size;let t=0;for(const e of this.oldCache.keys())this.cache.has(e)||t++;return Math.min(this._size+t,this.maxSize)}entries(){return this.entriesAscending()}forEach(t,e=this){for(const[i,s]of this.entriesAscending())t.call(e,s,i,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function D6(n){return new Promise(t=>setTimeout(t,n))}function z6(n,t){const e=Array.isArray(n)?n:Array.from(n),i=Array.isArray(t)?t:Array.from(t);return e.map((s,r)=>[s,i[r]])}class eu extends Error{constructor(t){super(t),Error.captureStackTrace&&Error.captureStackTrace(this,eu),this.name="AbortError"}}class B6 extends Error{constructor(t,e){super(e),this.errors=t,this.message=e,this.name="AggregateError"}}const U6=B6;class G6{constructor(t,e,i=null){this.offset=t,this.length=e,this.data=i}get top(){return this.offset+this.length}}class Hb{constructor(t,e,i){this.offset=t,this.length=e,this.blockIds=i}}class V6 extends Bx{constructor(t,{blockSize:e=65536,cacheSize:i=100}={}){super(),this.source=t,this.blockSize=e,this.blockCache=new F6({maxSize:i,onEviction:(s,r)=>{this.evictedBlocks.set(s,r)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(t,e){const i=[],s=[],r=[];this.evictedBlocks.clear();for(const{offset:m,length:g}of t){let y=m+g;const{fileSize:_}=this;_!==null&&(y=Math.min(y,_));const w=Math.floor(m/this.blockSize)*this.blockSize;for(let M=w;M<y;M+=this.blockSize){const T=Math.floor(M/this.blockSize);!this.blockCache.has(T)&&!this.blockRequests.has(T)&&(this.blockIdsToFetch.add(T),s.push(T)),this.blockRequests.has(T)&&i.push(this.blockRequests.get(T)),r.push(T)}}await D6(),this.fetchBlocks(e);const a=[];for(const m of s)this.blockRequests.has(m)&&a.push(this.blockRequests.get(m));await Promise.allSettled(i),await Promise.allSettled(a);const o=[],h=r.filter(m=>this.abortedBlockIds.has(m)||!this.blockCache.has(m));if(h.forEach(m=>this.blockIdsToFetch.add(m)),h.length>0&&e&&!e.aborted){this.fetchBlocks(null);for(const m of h){const g=this.blockRequests.get(m);if(!g)throw new Error(`Block ${m} is not in the block requests`);o.push(g)}await Promise.allSettled(o)}if(e&&e.aborted)throw new eu("Request was aborted");const l=r.map(m=>this.blockCache.get(m)||this.evictedBlocks.get(m)),u=l.filter(m=>!m);if(u.length)throw new U6(u,"Request failed");const f=new Map(z6(r,l));return this.readSliceData(t,f)}fetchBlocks(t){if(this.blockIdsToFetch.size>0){const e=this.groupBlocks(this.blockIdsToFetch),i=this.source.fetch(e,t);for(let s=0;s<e.length;++s){const r=e[s];for(const a of r.blockIds)this.blockRequests.set(a,(async()=>{try{const o=(await i)[s],h=a*this.blockSize,l=h-o.offset,u=Math.min(l+this.blockSize,o.data.byteLength),f=o.data.slice(l,u),m=new G6(h,f.byteLength,f,a);this.blockCache.set(a,m),this.abortedBlockIds.delete(a)}catch(o){if(o.name==="AbortError")o.signal=t,this.blockCache.delete(a),this.abortedBlockIds.add(a);else throw o}finally{this.blockRequests.delete(a)}})())}this.blockIdsToFetch.clear()}}groupBlocks(t){const e=Array.from(t).sort((a,o)=>a-o);if(e.length===0)return[];let i=[],s=null;const r=[];for(const a of e)s===null||s+1===a?(i.push(a),s=a):(r.push(new Hb(i[0]*this.blockSize,i.length*this.blockSize,i)),i=[a],s=a);return r.push(new Hb(i[0]*this.blockSize,i.length*this.blockSize,i)),r}readSliceData(t,e){return t.map(i=>{let s=i.offset+i.length;this.fileSize!==null&&(s=Math.min(this.fileSize,s));const r=Math.floor(i.offset/this.blockSize),a=Math.floor(s/this.blockSize),o=new ArrayBuffer(i.length),h=new Uint8Array(o);for(let l=r;l<=a;++l){const u=e.get(l),f=u.offset-i.offset,m=u.top-s;let g=0,y=0,_;f<0?g=-f:f>0&&(y=f),m<0?_=u.length-g:_=s-u.offset-g;const w=new Uint8Array(u.data,g,_);h.set(w,y)}return o})}}class Ux{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(t){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class Gx{constructor(t){this.url=t}async request({headers:t,signal:e}={}){throw new Error("request is not implemented")}}class W6 extends Ux{constructor(t){super(),this.response=t}get status(){return this.response.status}getHeader(t){return this.response.headers.get(t)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class $6 extends Gx{constructor(t,e){super(t),this.credentials=e}async request({headers:t,signal:e}={}){const i=await fetch(this.url,{headers:t,credentials:this.credentials,signal:e});return new W6(i)}}class Y6 extends Ux{constructor(t,e){super(),this.xhr=t,this.data=e}get status(){return this.xhr.status}getHeader(t){return this.xhr.getResponseHeader(t)}async getData(){return this.data}}class H6 extends Gx{constructRequest(t,e){return new Promise((i,s)=>{const r=new XMLHttpRequest;r.open("GET",this.url),r.responseType="arraybuffer";for(const[a,o]of Object.entries(t))r.setRequestHeader(a,o);r.onload=()=>{const a=r.response;i(new Y6(r,a))},r.onerror=s,r.onabort=()=>s(new eu("Request aborted")),r.send(),e&&(e.aborted&&r.abort(),e.addEventListener("abort",()=>r.abort()))})}async request({headers:t,signal:e}={}){return await this.constructRequest(t,e)}}const Ey={};class q6 extends Ux{constructor(t,e){super(),this.response=t,this.dataPromise=e}get status(){return this.response.statusCode}getHeader(t){return this.response.headers[t]}async getData(){return await this.dataPromise}}class X6 extends Gx{constructor(t){super(t),this.parsedUrl=Ey.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",Ey)}constructRequest(t,e){return new Promise((i,s)=>{const r=this.httpApi.get({...this.parsedUrl,headers:t},a=>{const o=new Promise(h=>{const l=[];a.on("data",u=>{l.push(u)}),a.on("end",()=>{const u=Buffer.concat(l).buffer;h(u)}),a.on("error",s)});i(new q6(a,o))});r.on("error",s),e&&(e.aborted&&r.destroy(new eu("Request aborted")),e.addEventListener("abort",()=>r.destroy(new eu("Request aborted"))))})}async request({headers:t,signal:e}={}){return await this.constructRequest(t,e)}}class Vx extends Bx{constructor(t,e,i,s){super(),this.client=t,this.headers=e,this.maxRanges=i,this.allowFullFile=s,this._fileSize=null}async fetch(t,e){return this.maxRanges>=t.length?this.fetchSlices(t,e):(this.maxRanges>0&&t.length>1,Promise.all(t.map(i=>this.fetchSlice(i,e))))}async fetchSlices(t,e){const i=await this.client.request({headers:{...this.headers,Range:`bytes=${t.map(({offset:s,length:r})=>`${s}-${s+r}`).join(",")}`},signal:e});if(i.ok)if(i.status===206){const{type:s,params:r}=O6(i.getHeader("content-type"));if(s==="multipart/byteranges"){const f=P6(await i.getData(),r.boundary);return this._fileSize=f[0].fileSize||null,f}const a=await i.getData(),{start:o,end:h,total:l}=t_(i.getHeader("content-range"));this._fileSize=l||null;const u=[{data:a,offset:o,length:h-o}];if(t.length>1){const f=await Promise.all(t.slice(1).map(m=>this.fetchSlice(m,e)));return u.concat(f)}return u}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const s=await i.getData();return this._fileSize=s.byteLength,[{data:s,offset:0,length:s.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(t,e){const{offset:i,length:s}=t,r=await this.client.request({headers:{...this.headers,Range:`bytes=${i}-${i+s}`},signal:e});if(r.ok)if(r.status===206){const a=await r.getData(),{total:o}=t_(r.getHeader("content-range"));return this._fileSize=o||null,{data:a,offset:i,length:s}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const a=await r.getData();return this._fileSize=a.byteLength,{data:a,offset:0,length:a.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function Wx(n,{blockSize:t,cacheSize:e}){return t===null?n:new V6(n,{blockSize:t,cacheSize:e})}function j6(n,{headers:t={},credentials:e,maxRanges:i=0,allowFullFile:s=!1,...r}={}){const a=new $6(n,e),o=new Vx(a,t,i,s);return Wx(o,r)}function Z6(n,{headers:t={},maxRanges:e=0,allowFullFile:i=!1,...s}={}){const r=new H6(n),a=new Vx(r,t,e,i);return Wx(a,s)}function K6(n,{headers:t={},maxRanges:e=0,allowFullFile:i=!1,...s}={}){const r=new X6(n),a=new Vx(r,t,e,i);return Wx(a,s)}function e_(n,{forceXHR:t=!1,...e}={}){return typeof fetch=="function"&&!t?j6(n,e):typeof XMLHttpRequest<"u"?Z6(n,e):K6(n,e)}class J6 extends Bx{constructor(t){super(),this.file=t}async fetchSlice(t,e){return new Promise((i,s)=>{const r=this.file.slice(t.offset,t.offset+t.length),a=new FileReader;a.onload=o=>i(o.target.result),a.onerror=s,a.onabort=s,a.readAsArrayBuffer(r),e&&e.addEventListener("abort",()=>a.abort())})}}function Q6(n){return new J6(n)}function i_(n){switch(n){case He.BYTE:case He.ASCII:case He.SBYTE:case He.UNDEFINED:return 1;case He.SHORT:case He.SSHORT:return 2;case He.LONG:case He.SLONG:case He.FLOAT:case He.IFD:return 4;case He.RATIONAL:case He.SRATIONAL:case He.DOUBLE:case He.LONG8:case He.SLONG8:case He.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${n}`)}}function t8(n){const t=n.GeoKeyDirectory;if(!t)return null;const e={};for(let i=4;i<=t[3]*4;i+=4){const s=a6[t[i]],r=t[i+1]?Sd[t[i+1]]:null,a=t[i+2],o=t[i+3];let h=null;if(!r)h=o;else{if(h=n[r],typeof h>"u"||h===null)throw new Error(`Could not get value of geoKey '${s}'.`);typeof h=="string"?h=h.substring(o,o+a-1):h.subarray&&(h=h.subarray(o,o+a),a===1&&(h=h[0]))}e[s]=h}return e}function $l(n,t,e,i){let s=null,r=null;const a=i_(t);switch(t){case He.BYTE:case He.ASCII:case He.UNDEFINED:s=new Uint8Array(e),r=n.readUint8;break;case He.SBYTE:s=new Int8Array(e),r=n.readInt8;break;case He.SHORT:s=new Uint16Array(e),r=n.readUint16;break;case He.SSHORT:s=new Int16Array(e),r=n.readInt16;break;case He.LONG:case He.IFD:s=new Uint32Array(e),r=n.readUint32;break;case He.SLONG:s=new Int32Array(e),r=n.readInt32;break;case He.LONG8:case He.IFD8:s=new Array(e),r=n.readUint64;break;case He.SLONG8:s=new Array(e),r=n.readInt64;break;case He.RATIONAL:s=new Uint32Array(e*2),r=n.readUint32;break;case He.SRATIONAL:s=new Int32Array(e*2),r=n.readInt32;break;case He.FLOAT:s=new Float32Array(e),r=n.readFloat32;break;case He.DOUBLE:s=new Float64Array(e),r=n.readFloat64;break;default:throw new RangeError(`Invalid field type: ${t}`)}if(t===He.RATIONAL||t===He.SRATIONAL)for(let o=0;o<e;o+=2)s[o]=r.call(n,i+o*a),s[o+1]=r.call(n,i+(o*a+4));else for(let o=0;o<e;++o)s[o]=r.call(n,i+o*a);return t===He.ASCII?new TextDecoder("utf-8").decode(s):s}class e8{constructor(t,e,i){this.fileDirectory=t,this.geoKeyDirectory=e,this.nextIFDByteOffset=i}}class A0 extends Error{constructor(t){super(`No image at index ${t}`),this.index=t}}class KT{async readRasters(t={}){const{window:e,width:i,height:s}=t;let{resX:r,resY:a,bbox:o}=t;const h=await this.getImage();let l=h;const u=await this.getImageCount(),f=h.getBoundingBox();if(e&&o)throw new Error('Both "bbox" and "window" passed.');if(i||s){if(e){const[y,_]=h.getOrigin(),[w,M]=h.getResolution();o=[y+e[0]*w,_+e[1]*M,y+e[2]*w,_+e[3]*M]}const g=o||f;if(i){if(r)throw new Error("Both width and resX passed");r=(g[2]-g[0])/i}if(s){if(a)throw new Error("Both width and resY passed");a=(g[3]-g[1])/s}}if(r||a){const g=[];for(let y=0;y<u;++y){const _=await this.getImage(y),{SubfileType:w,NewSubfileType:M}=_.fileDirectory;(y===0||w===2||M&1)&&g.push(_)}g.sort((y,_)=>y.getWidth()-_.getWidth());for(let y=0;y<g.length;++y){const _=g[y],w=(f[2]-f[0])/_.getWidth(),M=(f[3]-f[1])/_.getHeight();if(l=_,r&&r>w||a&&a>M)break}}let m=e;if(o){const[g,y]=h.getOrigin(),[_,w]=l.getResolution(h);m=[Math.round((o[0]-g)/_),Math.round((o[1]-y)/w),Math.round((o[2]-g)/_),Math.round((o[3]-y)/w)],m=[Math.min(m[0],m[2]),Math.min(m[1],m[3]),Math.max(m[0],m[2]),Math.max(m[1],m[3])]}return l.readRasters({...t,window:m})}}class iu extends KT{constructor(t,e,i,s,r={}){super(),this.source=t,this.littleEndian=e,this.bigTiff=i,this.firstIFDOffset=s,this.cache=r.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(t,e){const i=this.bigTiff?4048:1024;return new R6((await this.source.fetch([{offset:t,length:typeof e<"u"?e:i}]))[0],t,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(t){const e=this.bigTiff?20:12,i=this.bigTiff?8:2;let s=await this.getSlice(t);const r=this.bigTiff?s.readUint64(t):s.readUint16(t),a=r*e+(this.bigTiff?16:6);s.covers(t,a)||(s=await this.getSlice(t,a));const o={};let h=t+(this.bigTiff?8:2);for(let f=0;f<r;h+=e,++f){const m=s.readUint16(h),g=s.readUint16(h+2),y=this.bigTiff?s.readUint64(h+4):s.readUint32(h+4);let _,w;const M=i_(g),T=h+(this.bigTiff?12:8);if(M*y<=(this.bigTiff?8:4))_=$l(s,g,y,T);else{const A=s.readOffset(T),R=i_(g)*y;if(s.covers(A,R))_=$l(s,g,y,A);else{const I=await this.getSlice(A,R);_=$l(I,g,y,A)}}y===1&&s6.indexOf(m)===-1&&!(g===He.RATIONAL||g===He.SRATIONAL)?w=_[0]:w=_,o[Sd[m]]=w}const l=t8(o),u=s.readOffset(t+i+e*r);return new e8(o,l,u)}async requestIFD(t){if(this.ifdRequests[t])return this.ifdRequests[t];if(t===0)return this.ifdRequests[t]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[t];if(!this.ifdRequests[t-1])try{this.ifdRequests[t-1]=this.requestIFD(t-1)}catch(e){throw e instanceof A0?new A0(t):e}return this.ifdRequests[t]=(async()=>{const e=await this.ifdRequests[t-1];if(e.nextIFDByteOffset===0)throw new A0(t);return this.parseFileDirectoryAt(e.nextIFDByteOffset)})(),this.ifdRequests[t]}async getImage(t=0){const e=await this.requestIFD(t);return new jT(e.fileDirectory,e.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let t=0,e=!0;for(;e;)try{await this.requestIFD(t),++t}catch(i){if(i instanceof A0)e=!1;else throw i}return t}async getGhostValues(){const t=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const e="GDAL_STRUCTURAL_METADATA_SIZE=",i=e.length+100;let s=await this.getSlice(t,i);if(e===$l(s,He.ASCII,e.length,t)){const a=$l(s,He.ASCII,i,t).split(`
`)[0],o=Number(a.split("=")[1].split(" ")[0])+a.length;o>i&&(s=await this.getSlice(t,o));const h=$l(s,He.ASCII,o,t);this.ghostValues={},h.split(`
`).filter(l=>l.length>0).map(l=>l.split("=")).forEach(([l,u])=>{this.ghostValues[l]=u})}return this.ghostValues}static async fromSource(t,e,i){const s=(await t.fetch([{offset:0,length:1024}],i))[0],r=new A6(s),a=r.getUint16(0,0);let o;if(a===18761)o=!0;else if(a===19789)o=!1;else throw new TypeError("Invalid byte order value.");const h=r.getUint16(2,o);let l;if(h===42)l=!1;else if(h===43){if(l=!0,r.getUint16(4,o)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const u=l?r.getUint64(8,o):r.getUint32(4,o);return new iu(t,o,l,u,e)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class i8 extends KT{constructor(t,e){super(),this.mainFile=t,this.overviewFiles=e,this.imageFiles=[t].concat(e),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const t=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(e=>e.parseFileDirectoryAt(e.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(t),this.fileDirectoriesPerFile}async getImage(t=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let e=0,i=0;for(let s=0;s<this.imageFiles.length;s++){const r=this.imageFiles[s];for(let a=0;a<this.imageCounts[s];a++){if(t===e){const o=await r.requestIFD(i);return new jT(o.fileDirectory,o.geoKeyDirectory,r.dataView,r.littleEndian,r.cache,r.source)}e++,i++}i=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const t=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(e=>e.getImageCount()));return this.imageCounts=await Promise.all(t),this.imageCount=this.imageCounts.reduce((e,i)=>e+i,0),this.imageCount}}async function n8(n,t={},e){return iu.fromSource(e_(n,t),e)}async function s8(n,t){return iu.fromSource(Q6(n),t)}async function r8(n,t=[],e={},i){const s=await iu.fromSource(e_(n,e),i),r=await Promise.all(t.map(a=>iu.fromSource(e_(a,e))));return new i8(s,r)}function a8(n){return((n.fileDirectory.NewSubfileType||0)&4)===4}function o8(n,t){if(!n)return!1;if(n===!0)return!0;if(t.getSamplesPerPixel()!==3)return!1;const e=t.fileDirectory.PhotometricInterpretation,i=Ps;return e===i.CMYK||e===i.YCbCr||e===i.CIELab||e===i.ICCLab}const qb="STATISTICS_MAXIMUM",Xb="STATISTICS_MINIMUM",Sy=256;let Ty;function h8(){return Ty||(Ty=new k6),Ty}function l8(n){try{return n.getBoundingBox()}catch{return[0,0,n.getWidth(),n.getHeight()]}}function c8(n){try{return n.getOrigin().slice(0,2)}catch{return[0,n.getHeight()]}}function u8(n,t){try{return n.getResolution(t)}catch{return[t.getWidth()/n.getWidth(),t.getHeight()/n.getHeight()]}}function d8(n){const t=n.geoKeys;if(!t)return null;if(t.ProjectedCSTypeGeoKey&&t.ProjectedCSTypeGeoKey!==32767){const e="EPSG:"+t.ProjectedCSTypeGeoKey;let i=Ri(e);if(!i){const s=Ab(t.ProjLinearUnitsGeoKey);s&&(i=new $d({code:e,units:s}))}return i}if(t.GeographicTypeGeoKey&&t.GeographicTypeGeoKey!==32767){const e="EPSG:"+t.GeographicTypeGeoKey;let i=Ri(e);if(!i){const s=Ab(t.GeogAngularUnitsGeoKey);s&&(i=new $d({code:e,units:s}))}return i}return null}function f8(n){return n.getImageCount().then(function(t){const e=new Array(t);for(let i=0;i<t;++i)e[i]=n.getImage(i);return Promise.all(e)})}function p8(n,t){let e;return n.blob?e=s8(n.blob):n.overviews?e=r8(n.url,n.overviews,t):e=n8(n.url,t),e.then(f8)}function pd(n,t,e,i,s){if(Array.isArray(n)){const r=n.length;if(!Array.isArray(t)||r!=t.length){const a=new Error(i);throw s(a),a}for(let a=0;a<r;++a)pd(n[a],t[a],e,i,s);return}if(t=t,Math.abs(n-t)>e*n)throw new Error(i)}function m8(n){return n instanceof Int8Array?-128:n instanceof Int16Array?-32768:n instanceof Int32Array?-2147483648:n instanceof Float32Array?12e-39:0}function g8(n){return n instanceof Int8Array?127:n instanceof Uint8Array||n instanceof Uint8ClampedArray?255:n instanceof Int16Array?32767:n instanceof Uint16Array?65535:n instanceof Int32Array?2147483647:n instanceof Uint32Array?4294967295:n instanceof Float32Array?34e37:255}class JT extends k4{constructor(t){super({state:"loading",tileGrid:null,projection:t.projection||null,opaque:t.opaque,transition:t.transition,interpolate:t.interpolate!==!1,wrapX:t.wrapX}),this.sourceInfo_=t.sources;const e=this.sourceInfo_.length;this.sourceOptions_=t.sourceOptions,this.sourceImagery_=new Array(e),this.sourceMasks_=new Array(e),this.resolutionFactors_=new Array(e),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=t.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=t.convertToRGB||!1,this.setKey(this.sourceInfo_.map(r=>r.url).join(","));const i=this,s=new Array(e);for(let r=0;r<e;++r)s[r]=p8(this.sourceInfo_[r],this.sourceOptions_);Promise.all(s).then(function(r){i.configure_(r)}).catch(function(r){kb(r),i.error_=r,i.setState("error")})}getError(){return this.error_}determineProjection(t){const e=t[0];for(let i=e.length-1;i>=0;--i){const s=e[i],r=d8(s);if(r){this.projection=r;break}}}configure_(t){let e,i,s,r,a;const o=new Array(t.length),h=new Array(t.length),l=new Array(t.length);let u=0;const f=t.length;for(let _=0;_<f;++_){const w=[],M=[];t[_].forEach(Y=>{a8(Y)?M.push(Y):w.push(Y)});const T=w.length;if(M.length>0&&M.length!==T)throw new Error(`Expected one mask per image found ${M.length} masks and ${T} images`);let A,R;const I=new Array(T),L=new Array(T),k=new Array(T);h[_]=new Array(T),l[_]=new Array(T);for(let Y=0;Y<T;++Y){const K=w[Y],rt=K.getGDALNoData();l[_][Y]=K.getGDALMetadata(0),h[_][Y]=rt;const ut=this.sourceInfo_[_].bands;o[_]=ut?ut.length:K.getSamplesPerPixel();const Z=T-(Y+1);A||(A=l8(K)),R||(R=c8(K));const ht=u8(K,w[0]);k[Z]=ht[0];const O=[K.getTileWidth(),K.getTileHeight()];O[0]!==O[1]&&O[1]<Sy&&(O[0]=Sy,O[1]=Sy),I[Z]=O;const pt=ht[0]/Math.abs(ht[1]);L[Z]=[O[0],O[1]/pt]}if(e?_r(e,A,e):e=A,!i)i=R;else{const Y=`Origin mismatch for source ${_}, got [${R}] but expected [${i}]`;pd(i,R,0,Y,this.viewRejector)}if(!a)a=k,this.resolutionFactors_[_]=1;else{a.length-u>k.length&&(u=a.length-k.length);const Y=a[a.length-1]/k[k.length-1];this.resolutionFactors_[_]=Y;const K=k.map(ut=>ut*=Y),rt=`Resolution mismatch for source ${_}, got [${K}] but expected [${a}]`;pd(a.slice(u,a.length),K,.02,rt,this.viewRejector)}s?pd(s.slice(u,s.length),L,.01,`Tile size mismatch for source ${_}`,this.viewRejector):s=L,r?pd(r.slice(u,r.length),I,0,`Tile size mismatch for source ${_}`,this.viewRejector):r=I,this.sourceImagery_[_]=w.reverse(),this.sourceMasks_[_]=M.reverse()}for(let _=0,w=this.sourceImagery_.length;_<w;++_){const M=this.sourceImagery_[_];for(;M.length<a.length;)M.unshift(void 0)}this.getProjection()||this.determineProjection(t),this.samplesPerPixel_=o,this.nodataValues_=h,this.metadata_=l;t:for(let _=0;_<f;++_){if(this.sourceInfo_[_].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[_].length){this.addAlpha_=!0;break}const w=h[_],M=this.sourceInfo_[_].bands;if(M){for(let T=0;T<M.length;++T)if(w[M[T]-1]!==null){this.addAlpha_=!0;break t}continue}for(let T=0;T<w.length;++T)if(w[T]!==null){this.addAlpha_=!0;break t}}let m=this.addAlpha_?1:0;for(let _=0;_<f;++_)m+=o[_];this.bandCount=m;const g=new Cx({extent:e,minZoom:u,origin:i,resolutions:a,tileSizes:s});this.tileGrid=g,this.setTileSizes(r),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const y=1;a.length===2?a=[a[0],a[1],a[1]/2]:a.length===1&&(a=[a[0]*2,a[0],a[0]/2]),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:a,center:Yp(wo(e),this.projection),extent:Xm(e,this.projection),zoom:y})}loadTile_(t,e,i){const s=this.getTileSize(t),r=this.sourceImagery_.length,a=new Array(r*2),o=this.nodataValues_,h=this.sourceInfo_,l=h8();for(let u=0;u<r;++u){const f=h[u],m=this.resolutionFactors_[u],g=[Math.round(e*(s[0]*m)),Math.round(i*(s[1]*m)),Math.round((e+1)*(s[0]*m)),Math.round((i+1)*(s[1]*m))],y=this.sourceImagery_[u][t];let _;f.bands&&(_=f.bands.map(function(R){return R-1}));let w;"nodata"in f&&f.nodata!==null?w=f.nodata:_?w=_.map(function(R){return o[u][R]}):w=o[u];const M={window:g,width:s[0],height:s[1],samples:_,fillValue:w,pool:l,interleave:!1};o8(this.convertToRGB_,y)?a[u]=y.readRGB(M):a[u]=y.readRasters(M);const T=r+u,A=this.sourceMasks_[u][t];if(!A){a[T]=Promise.resolve(null);continue}a[T]=A.readRasters({window:g,width:s[0],height:s[1],samples:[0],pool:l,interleave:!1})}return Promise.all(a).then(this.composeTile_.bind(this,s)).catch(function(u){throw kb(u),u})}composeTile_(t,e){const i=this.metadata_,s=this.sourceInfo_,r=this.sourceImagery_.length,a=this.bandCount,o=this.samplesPerPixel_,h=this.nodataValues_,l=this.normalize_,u=this.addAlpha_,f=t[0]*t[1],m=f*a;let g;l?g=new Uint8Array(m):g=new Float32Array(m);let y=0;for(let _=0;_<f;++_){let w=u;for(let M=0;M<r;++M){const T=s[M];let A=T.min,R=T.max,I,L;if(l){const k=i[M][0];A===void 0&&(k&&Xb in k?A=parseFloat(k[Xb]):A=m8(e[M][0])),R===void 0&&(k&&qb in k?R=parseFloat(k[qb]):R=g8(e[M][0])),I=255/(R-A),L=-A*I}for(let k=0;k<o[M];++k){const Y=e[M][k][_];let K;if(l?K=Ui(I*Y+L,0,255):K=Y,!u)g[y]=K;else{let rt=T.nodata;if(rt===void 0){let Z;T.bands?Z=T.bands[k]-1:Z=k,rt=h[M][Z]}const ut=isNaN(rt);(!ut&&Y!==rt||ut&&!isNaN(Y))&&(w=!1,g[y]=K)}y++}if(!w){const k=r+M,Y=e[k];Y&&!Y[0][_]&&(w=!0)}}u&&(w||(g[y]=255),y++)}return g}}JT.prototype.getView;const y8=JT,Fn={ADD:"add",REMOVE:"remove"},jb={LENGTH:"length"};class R0 extends na{constructor(t,e,i){super(t),this.element=e,this.index=i}}class _8 extends sa{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let i=0,s=this.array_.length;i<s;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,i=t.length;e<i;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let i=0,s=e.length;i<s;++i)t(e[i],i,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(jb.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new R0(Fn.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let i=0,s=e.length;i<s;++i)if(e[i]===t)return this.removeAt(i)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new R0(Fn.REMOVE,e,t)),e}setAt(t,e){const i=this.getLength();if(t>=i){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const s=this.array_[t];this.array_[t]=e,this.dispatchEvent(new R0(Fn.REMOVE,s,t)),this.dispatchEvent(new R0(Fn.ADD,e,t))}updateLength_(){this.set(jb.LENGTH,this.array_.length)}assertUnique_(t,e){for(let i=0,s=this.array_.length;i<s;++i)if(this.array_[i]===t&&i!==e)throw new Error("Duplicate item added to a unique collection")}}const Ur=_8,vi={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class x8 extends sa{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[vi.OPACITY]=t.opacity!==void 0?t.opacity:1,ci(typeof e[vi.OPACITY]=="number","Layer opacity must be a number"),e[vi.VISIBLE]=t.visible!==void 0?t.visible:!0,e[vi.Z_INDEX]=t.zIndex,e[vi.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[vi.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[vi.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[vi.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},i=this.getZIndex();return e.opacity=Ui(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=i===void 0&&!e.managed?1/0:i,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return ke()}getLayerStatesArray(t){return ke()}getExtent(){return this.get(vi.EXTENT)}getMaxResolution(){return this.get(vi.MAX_RESOLUTION)}getMinResolution(){return this.get(vi.MIN_RESOLUTION)}getMinZoom(){return this.get(vi.MIN_ZOOM)}getMaxZoom(){return this.get(vi.MAX_ZOOM)}getOpacity(){return this.get(vi.OPACITY)}getSourceState(){return ke()}getVisible(){return this.get(vi.VISIBLE)}getZIndex(){return this.get(vi.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(vi.EXTENT,t)}setMaxResolution(t){this.set(vi.MAX_RESOLUTION,t)}setMinResolution(t){this.set(vi.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(vi.MAX_ZOOM,t)}setMinZoom(t){this.set(vi.MIN_ZOOM,t)}setOpacity(t){ci(typeof t=="number","Layer opacity must be a number"),this.set(vi.OPACITY,t)}setVisible(t){this.set(vi.VISIBLE,t)}setZIndex(t){this.set(vi.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const QT=x8,Dn={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},rs={ANIMATING:0,INTERACTING:1},Nr={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function Zb(n,t,e){return function(i,s,r,a,o){if(!i)return;if(!s&&!t)return i;const h=t?0:r[0]*s,l=t?0:r[1]*s,u=o?o[0]:0,f=o?o[1]:0;let m=n[0]+h/2+u,g=n[2]-h/2+u,y=n[1]+l/2+f,_=n[3]-l/2+f;m>g&&(m=(g+m)/2,g=m),y>_&&(y=(_+y)/2,_=y);let w=Ui(i[0],m,g),M=Ui(i[1],y,_);if(a&&e&&s){const T=30*s;w+=-T*Math.log(1+Math.max(0,m-i[0])/T)+T*Math.log(1+Math.max(0,i[0]-g)/T),M+=-T*Math.log(1+Math.max(0,y-i[1])/T)+T*Math.log(1+Math.max(0,i[1]-_)/T)}return[w,M]}}function v8(n){return n}function $x(n,t,e,i){const s=fi(t)/e[0],r=cs(t)/e[1];return i?Math.min(n,Math.max(s,r)):Math.min(n,Math.min(s,r))}function Yx(n,t,e){let i=Math.min(n,t);const s=50;return i*=Math.log(1+s*Math.max(0,n/t-1))/s+1,e&&(i=Math.max(i,e),i/=Math.log(1+s*Math.max(0,e/n-1))/s+1),Ui(i,e/2,t*2)}function w8(n,t,e,i){return t=t!==void 0?t:!0,function(s,r,a,o){if(s!==void 0){const h=n[0],l=n[n.length-1],u=e?$x(h,e,a,i):h;if(o)return t?Yx(s,u,l):Ui(s,l,u);const f=Math.min(u,s),m=Math.floor(hx(n,f,r));return n[m]>u&&m<n.length-1?n[m+1]:n[m]}}}function b8(n,t,e,i,s,r){return i=i!==void 0?i:!0,e=e!==void 0?e:0,function(a,o,h,l){if(a!==void 0){const u=s?$x(t,s,h,r):t;if(l)return i?Yx(a,u,e):Ui(a,e,u);const f=1e-9,m=Math.ceil(Math.log(t/u)/Math.log(n)-f),g=-o*(.5-f)+.5,y=Math.min(u,a),_=Math.floor(Math.log(t/y)/Math.log(n)+g),w=Math.max(m,_),M=t/Math.pow(n,w);return Ui(M,e,u)}}}function Kb(n,t,e,i,s){return e=e!==void 0?e:!0,function(r,a,o,h){if(r!==void 0){const l=i?$x(n,i,o,s):n;return!e||!h?Ui(r,t,l):Yx(r,l,t)}}}function Hx(n){if(n!==void 0)return 0}function Jb(n){if(n!==void 0)return n}function M8(n){const t=2*Math.PI/n;return function(e,i){if(i)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function E8(n){const t=n===void 0?hh(5):n;return function(e,i){return i||e===void 0?e:Math.abs(e)<=t?0:e}}const qx=new Array(6);function Ts(){return[1,0,0,1,0,0]}function S8(n){return Qm(n,1,0,0,1,0,0)}function Xx(n,t){const e=n[0],i=n[1],s=n[2],r=n[3],a=n[4],o=n[5],h=t[0],l=t[1],u=t[2],f=t[3],m=t[4],g=t[5];return n[0]=e*h+s*l,n[1]=i*h+r*l,n[2]=e*u+s*f,n[3]=i*u+r*f,n[4]=e*m+s*g+a,n[5]=i*m+r*g+o,n}function Qm(n,t,e,i,s,r,a){return n[0]=t,n[1]=e,n[2]=i,n[3]=s,n[4]=r,n[5]=a,n}function T8(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n}function as(n,t){const e=t[0],i=t[1];return t[0]=n[0]*e+n[2]*i+n[4],t[1]=n[1]*e+n[3]*i+n[5],t}function C8(n,t){const e=Math.cos(t),i=Math.sin(t);return Xx(n,Qm(qx,e,i,-i,e,0,0))}function Qb(n,t,e){return Xx(n,Qm(qx,t,0,0,e,0,0))}function A8(n,t,e){return Xx(n,Qm(qx,1,0,0,1,t,e))}function ka(n,t,e,i,s,r,a,o){const h=Math.sin(r),l=Math.cos(r);return n[0]=i*l,n[1]=s*h,n[2]=-i*h,n[3]=s*l,n[4]=a*i*l-o*i*h+t,n[5]=a*s*h+o*s*l+e,n}function tC(n,t){const e=R8(t);ci(e!==0,"Transformation matrix cannot be inverted");const i=t[0],s=t[1],r=t[2],a=t[3],o=t[4],h=t[5];return n[0]=a/e,n[1]=-s/e,n[2]=-r/e,n[3]=i/e,n[4]=(r*h-a*o)/e,n[5]=-(i*h-s*o)/e,n}function R8(n){return n[0]*n[3]-n[1]*n[2]}const tM=[1e6,1e6,1e6,1e6,2,2];function I8(n){return"matrix("+n.map((e,i)=>Math.round(e*tM[i])/tM[i]).join(", ")+")"}function lh(n,t,e,i,s,r){r=r||[];let a=0;for(let o=t;o<e;o+=i){const h=n[o],l=n[o+1];r[a++]=s[0]*h+s[2]*l+s[4],r[a++]=s[1]*h+s[3]*l+s[5]}return r&&r.length!=a&&(r.length=a),r}function jx(n,t,e,i,s,r,a){a=a||[];const o=Math.cos(s),h=Math.sin(s),l=r[0],u=r[1];let f=0;for(let m=t;m<e;m+=i){const g=n[m]-l,y=n[m+1]-u;a[f++]=l+g*o-y*h,a[f++]=u+g*h+y*o;for(let _=m+2;_<m+i;++_)a[f++]=n[_]}return a&&a.length!=f&&(a.length=f),a}function N8(n,t,e,i,s,r,a,o){o=o||[];const h=a[0],l=a[1];let u=0;for(let f=t;f<e;f+=i){const m=n[f]-h,g=n[f+1]-l;o[u++]=h+s*m,o[u++]=l+r*g;for(let y=f+2;y<f+i;++y)o[u++]=n[y]}return o&&o.length!=u&&(o.length=u),o}function k8(n,t,e,i,s,r,a){a=a||[];let o=0;for(let h=t;h<e;h+=i){a[o++]=n[h]+s,a[o++]=n[h+1]+r;for(let l=h+2;l<h+i;++l)a[o++]=n[l]}return a&&a.length!=o&&(a.length=o),a}const eM=Ts();class L8 extends sa{constructor(){super(),this.extent_=Jr(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=$S((t,e,i)=>{if(!i)return this.getSimplifiedGeometry(e);const s=this.clone();return s.applyTransform(i),s.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return ke()}closestPointXY(t,e,i,s){return ke()}containsXY(t,e){const i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return ke()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&vf(e),this.extentRevision_=this.getRevision()}return BD(this.extent_,t)}rotate(t,e){ke()}scale(t,e,i){ke()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return ke()}getType(){return ke()}applyTransform(t){ke()}intersectsExtent(t){return ke()}translate(t,e){ke()}transform(t,e){const i=Ri(t),s=i.getUnits()=="tile-pixels"?function(r,a,o){const h=i.getExtent(),l=i.getWorldExtent(),u=cs(l)/cs(h);return ka(eM,l[0],l[3],u,-u,0,0,0),lh(r,0,r.length,o,eM,a),Yd(i,e)(r,a,o)}:Yd(i,e);return this.applyTransform(s),this}}const eC=L8;class Th extends eC{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return fx(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return ke()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Xp(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){ke()}setLayout(t,e,i){let s;if(t)s=Xp(t);else{for(let r=0;r<i;++r){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}s=e.length,t=xl(s)}this.layout=t,this.stride=s}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const s=this.getStride();jx(i,0,i.length,s,t,e,i),this.changed()}}scale(t,e,i){e===void 0&&(e=t),i||(i=wo(this.getExtent()));const s=this.getFlatCoordinates();if(s){const r=this.getStride();N8(s,0,s.length,r,t,e,i,s),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const s=this.getStride();k8(i,0,i.length,s,t,e,i),this.changed()}}}function xl(n){let t;return n==2?t="XY":n==3?t="XYZ":n==4&&(t="XYZM"),t}function Xp(n){let t;return n=="XY"?t=2:n=="XYZ"||n=="XYM"?t=3:n=="XYZM"&&(t=4),t}function O8(n,t,e){const i=n.getFlatCoordinates();if(!i)return null;const s=n.getStride();return lh(i,0,i.length,s,t,e)}function iM(n,t,e,i,s,r,a){const o=n[t],h=n[t+1],l=n[e]-o,u=n[e+1]-h;let f;if(l===0&&u===0)f=t;else{const m=((s-o)*l+(r-h)*u)/(l*l+u*u);if(m>1)f=e;else if(m>0){for(let g=0;g<i;++g)a[g]=er(n[t+g],n[e+g],m);a.length=i;return}else f=t}for(let m=0;m<i;++m)a[m]=n[f+m];a.length=i}function Zx(n,t,e,i,s){let r=n[t],a=n[t+1];for(t+=i;t<e;t+=i){const o=n[t],h=n[t+1],l=co(r,a,o,h);l>s&&(s=l),r=o,a=h}return s}function Kx(n,t,e,i,s){for(let r=0,a=e.length;r<a;++r){const o=e[r];s=Zx(n,t,o,i,s),t=o}return s}function P8(n,t,e,i,s){for(let r=0,a=e.length;r<a;++r){const o=e[r];s=Kx(n,t,o,i,s),t=o[o.length-1]}return s}function Jx(n,t,e,i,s,r,a,o,h,l,u){if(t==e)return l;let f,m;if(s===0){if(m=co(a,o,n[t],n[t+1]),m<l){for(f=0;f<i;++f)h[f]=n[t+f];return h.length=i,m}return l}u=u||[NaN,NaN];let g=t+i;for(;g<e;)if(iM(n,g-i,g,i,a,o,u),m=co(a,o,u[0],u[1]),m<l){for(l=m,f=0;f<i;++f)h[f]=u[f];h.length=i,g+=i}else g+=i*Math.max((Math.sqrt(m)-Math.sqrt(l))/s|0,1);if(r&&(iM(n,e-i,t,i,a,o,u),m=co(a,o,u[0],u[1]),m<l)){for(l=m,f=0;f<i;++f)h[f]=u[f];h.length=i}return l}function Qx(n,t,e,i,s,r,a,o,h,l,u){u=u||[NaN,NaN];for(let f=0,m=e.length;f<m;++f){const g=e[f];l=Jx(n,t,g,i,s,r,a,o,h,l,u),t=g}return l}function F8(n,t,e,i,s,r,a,o,h,l,u){u=u||[NaN,NaN];for(let f=0,m=e.length;f<m;++f){const g=e[f];l=Qx(n,t,g,i,s,r,a,o,h,l,u),t=g[g.length-1]}return l}function iC(n,t,e,i){for(let s=0,r=e.length;s<r;++s)n[t++]=e[s];return t}function tg(n,t,e,i){for(let s=0,r=e.length;s<r;++s){const a=e[s];for(let o=0;o<i;++o)n[t++]=a[o]}return t}function Ef(n,t,e,i,s){s=s||[];let r=0;for(let a=0,o=e.length;a<o;++a){const h=tg(n,t,e[a],i);s[r++]=h,t=h}return s.length=r,s}function nC(n,t,e,i,s){s=s||[];let r=0;for(let a=0,o=e.length;a<o;++a){const h=Ef(n,t,e[a],i,s[r]);h.length===0&&(h[0]=t),s[r++]=h,t=h[h.length-1]}return s.length=r,s}function eg(n,t,e,i,s,r,a){const o=(e-t)/i;if(o<3){for(;t<e;t+=i)r[a++]=n[t],r[a++]=n[t+1];return a}const h=new Array(o);h[0]=1,h[o-1]=1;const l=[t,e-i];let u=0;for(;l.length>0;){const f=l.pop(),m=l.pop();let g=0;const y=n[m],_=n[m+1],w=n[f],M=n[f+1];for(let T=m+i;T<f;T+=i){const A=n[T],R=n[T+1],I=KD(A,R,y,_,w,M);I>g&&(u=T,g=I)}g>s&&(h[(u-t)/i]=1,m+i<u&&l.push(m,u),u+i<f&&l.push(u,f))}for(let f=0;f<o;++f)h[f]&&(r[a++]=n[t+f*i],r[a++]=n[t+f*i+1]);return a}function sC(n,t,e,i,s,r,a,o){for(let h=0,l=e.length;h<l;++h){const u=e[h];a=eg(n,t,u,i,s,r,a),o.push(a),t=u}return a}function qh(n,t){return t*Math.round(n/t)}function D8(n,t,e,i,s,r,a){if(t==e)return a;let o=qh(n[t],s),h=qh(n[t+1],s);t+=i,r[a++]=o,r[a++]=h;let l,u;do if(l=qh(n[t],s),u=qh(n[t+1],s),t+=i,t==e)return r[a++]=l,r[a++]=u,a;while(l==o&&u==h);for(;t<e;){const f=qh(n[t],s),m=qh(n[t+1],s);if(t+=i,f==l&&m==u)continue;const g=l-o,y=u-h,_=f-o,w=m-h;if(g*w==y*_&&(g<0&&_<g||g==_||g>0&&_>g)&&(y<0&&w<y||y==w||y>0&&w>y)){l=f,u=m;continue}r[a++]=l,r[a++]=u,o=l,h=u,l=f,u=m}return r[a++]=l,r[a++]=u,a}function tv(n,t,e,i,s,r,a,o){for(let h=0,l=e.length;h<l;++h){const u=e[h];a=D8(n,t,u,i,s,r,a),o.push(a),t=u}return a}function z8(n,t,e,i,s,r,a,o){for(let h=0,l=e.length;h<l;++h){const u=e[h],f=[];a=tv(n,t,u,i,s,r,a,f),o.push(f),t=u[u.length-1]}return a}function Qo(n,t,e,i,s){s=s!==void 0?s:[];let r=0;for(let a=t;a<e;a+=i)s[r++]=n.slice(a,a+i);return s.length=r,s}function qd(n,t,e,i,s){s=s!==void 0?s:[];let r=0;for(let a=0,o=e.length;a<o;++a){const h=e[a];s[r++]=Qo(n,t,h,i,s[r]),t=h}return s.length=r,s}function n_(n,t,e,i,s){s=s!==void 0?s:[];let r=0;for(let a=0,o=e.length;a<o;++a){const h=e[a];s[r++]=h.length===1&&h[0]===t?[]:qd(n,t,h,i,s[r]),t=h[h.length-1]}return s.length=r,s}function rC(n,t,e,i){let s=0,r=n[e-i],a=n[e-i+1];for(;t<e;t+=i){const o=n[t],h=n[t+1];s+=a*o-r*h,r=o,a=h}return s/2}function aC(n,t,e,i){let s=0;for(let r=0,a=e.length;r<a;++r){const o=e[r];s+=rC(n,t,o,i),t=o}return s}function B8(n,t,e,i){let s=0;for(let r=0,a=e.length;r<a;++r){const o=e[r];s+=aC(n,t,o,i),t=o[o.length-1]}return s}class jp extends Th{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new jp(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,s){return s<_l(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Zx(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Jx(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,s))}getArea(){return rC(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Qo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=eg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new jp(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=tg(this.flatCoordinates,0,t,this.stride),this.changed()}}const nM=jp;class ev extends Th{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new ev(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){const r=this.flatCoordinates,a=co(t,e,r[0],r[1]);if(a<s){const o=this.stride;for(let h=0;h<o;++h)i[h]=r[h];return i.length=o,a}return s}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return eT(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return dx(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=iC(this.flatCoordinates,0,t,this.stride),this.changed()}}const Ra=ev;function iv(n,t,e,i,s,r,a){let o,h,l,u,f,m,g;const y=s[r+1],_=[];for(let T=0,A=e.length;T<A;++T){const R=e[T];for(u=n[R-i],m=n[R-i+1],o=t;o<R;o+=i)f=n[o],g=n[o+1],(y<=m&&g<=y||m<=y&&y<=g)&&(l=(y-m)/(g-m)*(f-u)+u,_.push(l)),u=f,m=g}let w=NaN,M=-1/0;for(_.sort(oh),u=_[0],o=1,h=_.length;o<h;++o){f=_[o];const T=Math.abs(f-u);T>M&&(l=(u+f)/2,Tx(n,t,e,i,l,y)&&(w=l,M=T)),u=f}return isNaN(w)&&(w=s[r]),a?(a.push(w,y,M),a):[w,y,M]}function oC(n,t,e,i,s){let r=[];for(let a=0,o=e.length;a<o;++a){const h=e[a];r=iv(n,t,h,i,s,2*a,r),t=h[h.length-1]}return r}function U8(n,t,e,i){for(;t<e-i;){for(let s=0;s<i;++s){const r=n[t+s];n[t+s]=n[e-i+s],n[e-i+s]=r}t+=i,e-=i}}function nv(n,t,e,i){let s=0,r=n[e-i],a=n[e-i+1];for(;t<e;t+=i){const o=n[t],h=n[t+1];s+=(o-r)*(h+a),r=o,a=h}return s===0?void 0:s>0}function sv(n,t,e,i,s){s=s!==void 0?s:!1;for(let r=0,a=e.length;r<a;++r){const o=e[r],h=nv(n,t,o,i);if(r===0){if(s&&h||!s&&!h)return!1}else if(s&&!h||!s&&h)return!1;t=o}return!0}function hC(n,t,e,i,s){for(let r=0,a=e.length;r<a;++r){const o=e[r];if(!sv(n,t,o,i,s))return!1;o.length&&(t=o[o.length-1])}return!0}function Zp(n,t,e,i,s){s=s!==void 0?s:!1;for(let r=0,a=e.length;r<a;++r){const o=e[r],h=nv(n,t,o,i);(r===0?s&&h||!s&&!h:s&&!h||!s&&h)&&U8(n,t,o,i),t=o}return t}function s_(n,t,e,i,s){for(let r=0,a=e.length;r<a;++r)t=Zp(n,t,e[r],i,s);return t}function G8(n,t){const e=[];let i=0,s=0,r;for(let a=0,o=t.length;a<o;++a){const h=t[a],l=nv(n,i,h,2);if(r===void 0&&(r=l),l===r)e.push(t.slice(s,a+1));else{if(e.length===0)continue;e[e.length-1].push(t[s])}s=a+1,i=h}return e}class ir extends Th{constructor(t,e,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&i?(this.setFlatCoordinates(e,t),this.ends_=i):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?yi(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new ir(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<_l(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Kx(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Qx(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,s))}containsXY(t,e){return Tx(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return aC(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Zp(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,qd(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=wo(this.getExtent());this.flatInteriorPoint_=iv(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Ra(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new nM(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,i=this.ends_,s=[];let r=0;for(let a=0,o=i.length;a<o;++a){const h=i[a],l=new nM(e.slice(r,h),t);s.push(l),r=h}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;sv(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Zp(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=tv(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new ir(e,"XY",i)}getType(){return"Polygon"}intersectsExtent(t){return ET(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Ef(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function sM(n){if(wf(n))throw new Error("Cannot create polygon from empty extent");const t=n[0],e=n[1],i=n[2],s=n[3],r=[t,e,t,s,i,s,i,e,t,e];return new ir(r,"XY",[r.length])}const Cy=0;class V8 extends sa{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=bx(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&e4(),t.center&&(t.center=Fr(t.center,this.projection_)),t.extent&&(t.extent=jh(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const o in Nr)delete e[o];this.setProperties(e,!0);const i=$8(t);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=i.minZoom;const s=W8(t),r=i.constraint,a=Y8(t);this.constraints_={center:s,resolution:r,rotation:a},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const i=this.getCenterInternal();if(i){const s=t||[0,0,0,0];e=e||[0,0,0,0];const r=this.getResolution(),a=r/2*(s[3]-e[3]+e[1]-s[1]),o=r/2*(s[0]-e[0]+e[2]-s[2]);this.setCenterInternal([i[0]+a,i[1]-o])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let i=0;i<e.length;++i){let s=arguments[i];s.center&&(s=Object.assign({},s),s.center=Fr(s.center,this.getProjection())),s.anchor&&(s=Object.assign({},s),s.anchor=Fr(s.anchor,this.getProjection())),e[i]=s}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,i;e>1&&typeof arguments[e-1]=="function"&&(i=arguments[e-1],--e);let s=0;for(;s<e&&!this.isDef();++s){const u=arguments[s];u.center&&this.setCenterInternal(u.center),u.zoom!==void 0?this.setZoom(u.zoom):u.resolution&&this.setResolution(u.resolution),u.rotation!==void 0&&this.setRotation(u.rotation)}if(s===e){i&&I0(i,!0);return}let r=Date.now(),a=this.targetCenter_.slice(),o=this.targetResolution_,h=this.targetRotation_;const l=[];for(;s<e;++s){const u=arguments[s],f={start:r,complete:!1,anchor:u.anchor,duration:u.duration!==void 0?u.duration:1e3,easing:u.easing||MD,callback:i};if(u.center&&(f.sourceCenter=a,f.targetCenter=u.center.slice(),a=f.targetCenter),u.zoom!==void 0?(f.sourceResolution=o,f.targetResolution=this.getResolutionForZoom(u.zoom),o=f.targetResolution):u.resolution&&(f.sourceResolution=o,f.targetResolution=u.resolution,o=f.targetResolution),u.rotation!==void 0){f.sourceRotation=h;const m=kc(u.rotation-h+Math.PI,2*Math.PI)-Math.PI;f.targetRotation=h+m,h=f.targetRotation}H8(f)?f.complete=!0:r+=f.duration,l.push(f)}this.animations_.push(l),this.setHint(rs.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[rs.ANIMATING]>0}getInteracting(){return this.hints_[rs.INTERACTING]>0}cancelAnimations(){this.setHint(rs.ANIMATING,-this.hints_[rs.ANIMATING]);let t;for(let e=0,i=this.animations_.length;e<i;++e){const s=this.animations_[e];if(s[0].callback&&I0(s[0].callback,!1),!t)for(let r=0,a=s.length;r<a;++r){const o=s[r];if(!o.complete){t=o.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let i=this.animations_.length-1;i>=0;--i){const s=this.animations_[i];let r=!0;for(let a=0,o=s.length;a<o;++a){const h=s[a];if(h.complete)continue;const l=t-h.start;let u=h.duration>0?l/h.duration:1;u>=1?(h.complete=!0,u=1):r=!1;const f=h.easing(u);if(h.sourceCenter){const m=h.sourceCenter[0],g=h.sourceCenter[1],y=h.targetCenter[0],_=h.targetCenter[1];this.nextCenter_=h.targetCenter;const w=m+f*(y-m),M=g+f*(_-g);this.targetCenter_=[w,M]}if(h.sourceResolution&&h.targetResolution){const m=f===1?h.targetResolution:h.sourceResolution+f*(h.targetResolution-h.sourceResolution);if(h.anchor){const g=this.getViewportSize_(this.getRotation()),y=this.constraints_.resolution(m,0,g,!0);this.targetCenter_=this.calculateCenterZoom(y,h.anchor)}this.nextResolution_=h.targetResolution,this.targetResolution_=m,this.applyTargetState_(!0)}if(h.sourceRotation!==void 0&&h.targetRotation!==void 0){const m=f===1?kc(h.targetRotation+Math.PI,2*Math.PI)-Math.PI:h.sourceRotation+f*(h.targetRotation-h.sourceRotation);if(h.anchor){const g=this.constraints_.rotation(m,!0);this.targetCenter_=this.calculateCenterRotate(g,h.anchor)}this.nextRotation_=h.targetRotation,this.targetRotation_=m}if(this.applyTargetState_(!0),e=!0,!h.complete)break}if(r){this.animations_[i]=null,this.setHint(rs.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const a=s[0].callback;a&&I0(a,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let i;const s=this.getCenterInternal();return s!==void 0&&(i=[s[0]-e[0],s[1]-e[1]],gx(i,t-this.getRotation()),QD(i,e)),i}calculateCenterZoom(t,e){let i;const s=this.getCenterInternal(),r=this.getResolution();if(s!==void 0&&r!==void 0){const a=e[0]-t*(e[0]-s[0])/r,o=e[1]-t*(e[1]-s[1])/r;i=[a,o]}return i}getViewportSize_(t){const e=this.viewportSize_;if(t){const i=e[0],s=e[1];return[Math.abs(i*Math.cos(t))+Math.abs(s*Math.sin(t)),Math.abs(i*Math.sin(t))+Math.abs(s*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&Yp(t,this.getProjection())}getCenterInternal(){return this.get(Nr.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return Xm(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();ci(e,"The view center is not defined");const i=this.getResolution();ci(i!==void 0,"The view resolution is not defined");const s=this.getRotation();return ci(s!==void 0,"The view rotation is not defined"),X1(e,i,s,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(Nr.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(jh(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const i=fi(t)/e[0],s=cs(t)/e[1];return Math.max(i,s)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,s=Math.log(e/i)/Math.log(t);return function(r){return e/Math.pow(t,r*s)}}getRotation(){return this.get(Nr.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,r=Math.log(i/s)/e;return function(a){return Math.log(i/a)/e/r}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const i=this.padding_;return i&&(e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),i=this.getRotation();let s=this.getCenterInternal();const r=this.padding_;if(r){const a=this.getViewportSizeMinusPadding_();s=Ay(s,this.getViewportSize_(),[a[0]/2+r[3],a[1]/2+r[0]],e,i)}return{center:s.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,i,s;if(this.resolutions_){const r=hx(this.resolutions_,t,1);e=r,i=this.resolutions_[r],r==this.resolutions_.length-1?s=2:s=i/this.resolutions_[r+1]}else i=this.maxResolution_,s=this.zoomFactor_;return e+Math.log(i/t)/Math.log(s)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=Ui(Math.floor(t),0,this.resolutions_.length-2),i=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(i,Ui(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let i;if(ci(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){ci(!wf(t),"Cannot fit empty extent provided as `geometry`");const s=jh(t,this.getProjection());i=sM(s)}else if(t.getType()==="Circle"){const s=jh(t.getExtent(),this.getProjection());i=sM(s),i.rotate(this.getRotation(),wo(s))}else i=t;this.fitInternal(i,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),i=Math.cos(e),s=Math.sin(-e),r=t.getFlatCoordinates(),a=t.getStride();let o=1/0,h=1/0,l=-1/0,u=-1/0;for(let f=0,m=r.length;f<m;f+=a){const g=r[f]*i-r[f+1]*s,y=r[f]*s+r[f+1]*i;o=Math.min(o,g),h=Math.min(h,y),l=Math.max(l,g),u=Math.max(u,y)}return[o,h,l,u]}fitInternal(t,e){e=e||{};let i=e.size;i||(i=this.getViewportSizeMinusPadding_());const s=e.padding!==void 0?e.padding:[0,0,0,0],r=e.nearest!==void 0?e.nearest:!1;let a;e.minResolution!==void 0?a=e.minResolution:e.maxZoom!==void 0?a=this.getResolutionForZoom(e.maxZoom):a=0;const o=this.rotatedExtentForGeometry(t);let h=this.getResolutionForExtentInternal(o,[i[0]-s[1]-s[3],i[1]-s[0]-s[2]]);h=isNaN(h)?a:Math.max(h,a),h=this.getConstrainedResolution(h,r?0:1);const l=this.getRotation(),u=Math.sin(l),f=Math.cos(l),m=wo(o);m[0]+=(s[1]-s[3])/2*h,m[1]+=(s[0]-s[2])/2*h;const g=m[0]*f-m[1]*u,y=m[1]*f+m[0]*u,_=this.getConstrainedCenter([g,y],h),w=e.callback?e.callback:Zc;e.duration!==void 0?this.animateInternal({resolution:h,center:_,duration:e.duration,easing:e.easing},w):(this.targetResolution_=h,this.targetCenter_=_,this.applyTargetState_(!1,!0),I0(w,!0))}centerOn(t,e,i){this.centerOnInternal(Fr(t,this.getProjection()),e,i)}centerOnInternal(t,e,i){this.setCenterInternal(Ay(t,e,i,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,i,s){let r;const a=this.padding_;if(a&&t){const o=this.getViewportSizeMinusPadding_(-i),h=Ay(t,s,[o[0]/2+a[3],o[1]/2+a[0]],e,i);r=[t[0]-h[0],t[1]-h[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=Yp(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&Fr(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const i=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*t,0,s,i);e&&(this.targetCenter_=this.calculateCenterZoom(r,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=Fr(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const i=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(s,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&Fr(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const i=this.getAnimating()||this.getInteracting()||e,s=this.constraints_.rotation(this.targetRotation_,i),r=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,0,r,i),o=this.constraints_.center(this.targetCenter_,a,r,i,this.calculateCenterShift(this.targetCenter_,a,s,r));this.get(Nr.ROTATION)!==s&&this.set(Nr.ROTATION,s),this.get(Nr.RESOLUTION)!==a&&(this.set(Nr.RESOLUTION,a),this.set("zoom",this.getZoom(),!0)),(!o||!this.get(Nr.CENTER)||!$p(this.get(Nr.CENTER),o))&&this.set(Nr.CENTER,o),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,i){t=t!==void 0?t:200;const s=e||0,r=this.constraints_.rotation(this.targetRotation_),a=this.getViewportSize_(r),o=this.constraints_.resolution(this.targetResolution_,s,a),h=this.constraints_.center(this.targetCenter_,o,a,!1,this.calculateCenterShift(this.targetCenter_,o,r,a));if(t===0&&!this.cancelAnchor_){this.targetResolution_=o,this.targetRotation_=r,this.targetCenter_=h,this.applyTargetState_();return}i=i||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==o||this.getRotation()!==r||!this.getCenterInternal()||!$p(this.getCenterInternal(),h))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:h,resolution:o,duration:t,easing:fu,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(rs.INTERACTING,1)}endInteraction(t,e,i){i=i&&Fr(i,this.getProjection()),this.endInteractionInternal(t,e,i)}endInteractionInternal(t,e,i){!this.getInteracting()||(this.setHint(rs.INTERACTING,-1),this.resolveConstraints(t,e,i))}getConstrainedCenter(t,e){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)}getConstrainedZoom(t,e){const i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i,e))}getConstrainedResolution(t,e){e=e||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,i)}}function I0(n,t){setTimeout(function(){n(t)},0)}function W8(n){if(n.extent!==void 0){const e=n.smoothExtentConstraint!==void 0?n.smoothExtentConstraint:!0;return Zb(n.extent,n.constrainOnlyCenter,e)}const t=bx(n.projection,"EPSG:3857");if(n.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Zb(e,!1,!1)}return v8}function $8(n){let t,e,i,a=n.minZoom!==void 0?n.minZoom:Cy,o=n.maxZoom!==void 0?n.maxZoom:28;const h=n.zoomFactor!==void 0?n.zoomFactor:2,l=n.multiWorld!==void 0?n.multiWorld:!1,u=n.smoothResolutionConstraint!==void 0?n.smoothResolutionConstraint:!0,f=n.showFullExtent!==void 0?n.showFullExtent:!1,m=bx(n.projection,"EPSG:3857"),g=m.getExtent();let y=n.constrainOnlyCenter,_=n.extent;if(!l&&!_&&m.isGlobal()&&(y=!1,_=g),n.resolutions!==void 0){const w=n.resolutions;e=w[a],i=w[o]!==void 0?w[o]:w[w.length-1],n.constrainResolution?t=w8(w,u,!y&&_,f):t=Kb(e,i,u,!y&&_,f)}else{const M=(g?Math.max(fi(g),cs(g)):360*Wd.degrees/m.getMetersPerUnit())/Sx/Math.pow(2,Cy),T=M/Math.pow(2,28-Cy);e=n.maxResolution,e!==void 0?a=0:e=M/Math.pow(h,a),i=n.minResolution,i===void 0&&(n.maxZoom!==void 0?n.maxResolution!==void 0?i=e/Math.pow(h,o):i=M/Math.pow(h,o):i=T),o=a+Math.floor(Math.log(e/i)/Math.log(h)),i=e/Math.pow(h,o-a),n.constrainResolution?t=b8(h,e,i,u,!y&&_,f):t=Kb(e,i,u,!y&&_,f)}return{constraint:t,maxResolution:e,minResolution:i,minZoom:a,zoomFactor:h}}function Y8(n){if(n.enableRotation!==void 0?n.enableRotation:!0){const e=n.constrainRotation;return e===void 0||e===!0?E8():e===!1?Jb:typeof e=="number"?M8(e):Jb}return Hx}function H8(n){return!(n.sourceCenter&&n.targetCenter&&!$p(n.sourceCenter,n.targetCenter)||n.sourceResolution!==n.targetResolution||n.sourceRotation!==n.targetRotation)}function Ay(n,t,e,i,s){const r=Math.cos(-s);let a=Math.sin(-s),o=n[0]*r-n[1]*a,h=n[1]*r+n[0]*a;o+=(t[0]/2-e[0])*i,h+=(e[1]-t[1]/2)*i,a=-a;const l=o*r-h*a,u=h*r+o*a;return[l,u]}const ba=V8;class q8 extends QT{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(vi.SOURCE,this.handleSourcePropertyChange_);const i=t.source?t.source:null;this.setSource(i)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(vi.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Li(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=ai(t,Ne.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const i=this.getMapInternal();!t&&i&&(t=i.getView()),t instanceof ba?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&i&&(e.layerStatesArray=i.getLayerGroup().getLayerStatesArray());let s;e.layerStatesArray?s=e.layerStatesArray.find(a=>a.layer===this):s=this.getLayerState();const r=this.getExtent();return rv(s,e.viewState)&&(!r||Gs(r,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];let e;const i=this.getSource();if(i&&(e=i.getAttributions()),!e)return[];const s=t instanceof ba?t.getViewStateAndExtent():t;let r=e(s);return Array.isArray(r)||(r=[r]),r}render(t,e){const i=this.getRenderer();return i.prepareFrame(t)?(this.rendered=!0,i.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();!e||e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(vi.MAP,t)}getMapInternal(){return this.get(vi.MAP)}setMap(t){this.mapPrecomposeKey_&&(Li(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(Li(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=ai(t,Dn.PRECOMPOSE,function(e){const s=e.frameState.layerStatesArray,r=this.getLayerState(!1);ci(!s.some(function(a){return a.layer===r.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),s.push(r)},this),this.mapRenderKey_=ai(this,Ne.CHANGE,t.render,t),this.changed())}setSource(t){this.set(vi.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function rv(n,t){if(!n.visible)return!1;const e=t.resolution;if(e<n.minResolution||e>=n.maxResolution)return!1;const i=t.zoom;return i>n.minZoom&&i<=n.maxZoom}const ig=q8;function X8(n,t,e,i,s){lC(n,t,e||0,i||n.length-1,s||j8)}function lC(n,t,e,i,s){for(;i>e;){if(i-e>600){var r=i-e+1,a=t-e+1,o=Math.log(r),h=.5*Math.exp(2*o/3),l=.5*Math.sqrt(o*h*(r-h)/r)*(a-r/2<0?-1:1),u=Math.max(e,Math.floor(t-a*h/r+l)),f=Math.min(i,Math.floor(t+(r-a)*h/r+l));lC(n,t,u,f,s)}var m=n[t],g=e,y=i;for(ju(n,e,t),s(n[i],m)>0&&ju(n,e,i);g<y;){for(ju(n,g,y),g++,y--;s(n[g],m)<0;)g++;for(;s(n[y],m)>0;)y--}s(n[e],m)===0?ju(n,e,y):(y++,ju(n,y,i)),y<=t&&(e=y+1),t<=y&&(i=y-1)}}function ju(n,t,e){var i=n[t];n[t]=n[e],n[e]=i}function j8(n,t){return n<t?-1:n>t?1:0}class cC{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const i=[];if(!k0(t,e))return i;const s=this.toBBox,r=[];for(;e;){for(let a=0;a<e.children.length;a++){const o=e.children[a],h=e.leaf?s(o):o;k0(t,h)&&(e.leaf?i.push(o):Iy(t,h)?this._all(o,i):r.push(o))}e=r.pop()}return i}collides(t){let e=this.data;if(!k0(t,e))return!1;const i=[];for(;e;){for(let s=0;s<e.children.length;s++){const r=e.children[s],a=e.leaf?this.toBBox(r):r;if(k0(t,a)){if(e.leaf||Iy(t,a))return!0;i.push(r)}}e=i.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let i=0;i<t.length;i++)this.insert(t[i]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const i=this.data;this.data=e,e=i}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=cc([]),this}remove(t,e){if(!t)return this;let i=this.data;const s=this.toBBox(t),r=[],a=[];let o,h,l;for(;i||r.length;){if(i||(i=r.pop(),h=r[r.length-1],o=a.pop(),l=!0),i.leaf){const u=Z8(t,i.children,e);if(u!==-1)return i.children.splice(u,1),r.push(i),this._condense(r),this}!l&&!i.leaf&&Iy(i,s)?(r.push(i),a.push(o),o=0,h=i,i=i.children[0]):h?(o++,i=h.children[o],l=!1):i=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const i=[];for(;t;)t.leaf?e.push(...t.children):i.push(...t.children),t=i.pop();return e}_build(t,e,i,s){const r=i-e+1;let a=this._maxEntries,o;if(r<=a)return o=cc(t.slice(e,i+1)),Yl(o,this.toBBox),o;s||(s=Math.ceil(Math.log(r)/Math.log(a)),a=Math.ceil(r/Math.pow(a,s-1))),o=cc([]),o.leaf=!1,o.height=s;const h=Math.ceil(r/a),l=h*Math.ceil(Math.sqrt(a));rM(t,e,i,l,this.compareMinX);for(let u=e;u<=i;u+=l){const f=Math.min(u+l-1,i);rM(t,u,f,h,this.compareMinY);for(let m=u;m<=f;m+=h){const g=Math.min(m+h-1,f);o.children.push(this._build(t,m,g,s-1))}}return Yl(o,this.toBBox),o}_chooseSubtree(t,e,i,s){for(;s.push(e),!(e.leaf||s.length-1===i);){let r=1/0,a=1/0,o;for(let h=0;h<e.children.length;h++){const l=e.children[h],u=Ry(l),f=Q8(t,l)-u;f<a?(a=f,r=u<r?u:r,o=l):f===a&&u<r&&(r=u,o=l)}e=o||e.children[0]}return e}_insert(t,e,i){const s=i?t:this.toBBox(t),r=[],a=this._chooseSubtree(s,this.data,e,r);for(a.children.push(t),gd(a,s);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(s,r,e)}_split(t,e){const i=t[e],s=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,s);const a=this._chooseSplitIndex(i,r,s),o=cc(i.children.splice(a,i.children.length-a));o.height=i.height,o.leaf=i.leaf,Yl(i,this.toBBox),Yl(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o)}_splitRoot(t,e){this.data=cc([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Yl(this.data,this.toBBox)}_chooseSplitIndex(t,e,i){let s,r=1/0,a=1/0;for(let o=e;o<=i-e;o++){const h=md(t,0,o,this.toBBox),l=md(t,o,i,this.toBBox),u=tz(h,l),f=Ry(h)+Ry(l);u<r?(r=u,s=o,a=f<a?f:a):u===r&&f<a&&(a=f,s=o)}return s||i-e}_chooseSplitAxis(t,e,i){const s=t.leaf?this.compareMinX:K8,r=t.leaf?this.compareMinY:J8,a=this._allDistMargin(t,e,i,s),o=this._allDistMargin(t,e,i,r);a<o&&t.children.sort(s)}_allDistMargin(t,e,i,s){t.children.sort(s);const r=this.toBBox,a=md(t,0,e,r),o=md(t,i-e,i,r);let h=N0(a)+N0(o);for(let l=e;l<i-e;l++){const u=t.children[l];gd(a,t.leaf?r(u):u),h+=N0(a)}for(let l=i-e-1;l>=e;l--){const u=t.children[l];gd(o,t.leaf?r(u):u),h+=N0(o)}return h}_adjustParentBBoxes(t,e,i){for(let s=i;s>=0;s--)gd(e[s],t)}_condense(t){for(let e=t.length-1,i;e>=0;e--)t[e].children.length===0?e>0?(i=t[e-1].children,i.splice(i.indexOf(t[e]),1)):this.clear():Yl(t[e],this.toBBox)}}function Z8(n,t,e){if(!e)return t.indexOf(n);for(let i=0;i<t.length;i++)if(e(n,t[i]))return i;return-1}function Yl(n,t){md(n,0,n.children.length,t,n)}function md(n,t,e,i,s){s||(s=cc(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let r=t;r<e;r++){const a=n.children[r];gd(s,n.leaf?i(a):a)}return s}function gd(n,t){return n.minX=Math.min(n.minX,t.minX),n.minY=Math.min(n.minY,t.minY),n.maxX=Math.max(n.maxX,t.maxX),n.maxY=Math.max(n.maxY,t.maxY),n}function K8(n,t){return n.minX-t.minX}function J8(n,t){return n.minY-t.minY}function Ry(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function N0(n){return n.maxX-n.minX+(n.maxY-n.minY)}function Q8(n,t){return(Math.max(t.maxX,n.maxX)-Math.min(t.minX,n.minX))*(Math.max(t.maxY,n.maxY)-Math.min(t.minY,n.minY))}function tz(n,t){const e=Math.max(n.minX,t.minX),i=Math.max(n.minY,t.minY),s=Math.min(n.maxX,t.maxX),r=Math.min(n.maxY,t.maxY);return Math.max(0,s-e)*Math.max(0,r-i)}function Iy(n,t){return n.minX<=t.minX&&n.minY<=t.minY&&t.maxX<=n.maxX&&t.maxY<=n.maxY}function k0(n,t){return t.minX<=n.maxX&&t.minY<=n.maxY&&t.maxX>=n.minX&&t.maxY>=n.minY}function cc(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function rM(n,t,e,i,s){const r=[t,e];for(;r.length;){if(e=r.pop(),t=r.pop(),e-t<=i)continue;const a=t+Math.ceil((e-t)/i/2)*i;X8(n,a,t,e,s),r.push(t,a,a,e)}}const Ge={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class av{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=Tn(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new av({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return ke()}getImage(t){return ke()}getHitDetectionImage(){return ke()}getPixelRatio(t){return 1}getImageState(){return ke()}getImageSize(){return ke()}getOrigin(){return ke()}getSize(){return ke()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Tn(t)}listenImageChange(t){ke()}load(){ke()}unlistenImageChange(t){ke()}ready(){return Promise.resolve()}}const uC=av,Xd={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var Yn={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};Yn.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};Yn.max=Yn.whitepoint[2].D65;Yn.rgb=function(n,t){t=t||Yn.whitepoint[2].E;var e=n[0]/t[0],i=n[1]/t[1],s=n[2]/t[2],r,a,o;return r=e*3.240969941904521+i*-1.537383177570093+s*-.498610760293,a=e*-.96924363628087+i*1.87596750150772+s*.041555057407175,o=e*.055630079696993+i*-.20397695888897+s*1.056971514242878,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:r=r*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,r=Math.min(Math.max(0,r),1),a=Math.min(Math.max(0,a),1),o=Math.min(Math.max(0,o),1),[r*255,a*255,o*255]};Xd.xyz=function(n,t){var e=n[0]/255,i=n[1]/255,s=n[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,s=s>.04045?Math.pow((s+.055)/1.055,2.4):s/12.92;var r=e*.41239079926595+i*.35758433938387+s*.18048078840183,a=e*.21263900587151+i*.71516867876775+s*.072192315360733,o=e*.019330818715591+i*.11919477979462+s*.95053215224966;return t=t||Yn.whitepoint[2].E,[r*t[0],a*t[1],o*t[2]]};const ov={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(n,t,e){var i,s,r,a,o,h,l,u,f,m,g,y,_;if(r=n[0],a=n[1],o=n[2],r===0)return[0,0,0];var w=.0011070564598794539;return t=t||"D65",e=e||2,f=Yn.whitepoint[e][t][0],m=Yn.whitepoint[e][t][1],g=Yn.whitepoint[e][t][2],y=4*f/(f+15*m+3*g),_=9*m/(f+15*m+3*g),i=a/(13*r)+y||0,s=o/(13*r)+_||0,l=r>8?m*Math.pow((r+16)/116,3):m*r*w,h=l*9*i/(4*s)||0,u=l*(12-3*i-20*s)/(4*s)||0,[h,l,u]}};Yn.luv=function(n,t,e){var i,s,r,a,o,h,l,u,f,m,g,y,_,w=.008856451679035631,M=903.2962962962961;t=t||"D65",e=e||2,f=Yn.whitepoint[e][t][0],m=Yn.whitepoint[e][t][1],g=Yn.whitepoint[e][t][2],y=4*f/(f+15*m+3*g),_=9*m/(f+15*m+3*g),h=n[0],l=n[1],u=n[2],i=4*h/(h+15*l+3*u)||0,s=9*l/(h+15*l+3*u)||0;var T=l/m;return r=T<=w?M*T:116*Math.pow(T,1/3)-16,a=13*r*(i-y),o=13*r*(s-_),[r,a,o]};var dC={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(n){var t=n[0],e=n[1],i=n[2],s,r,a;return a=i/360*2*Math.PI,s=e*Math.cos(a),r=e*Math.sin(a),[t,s,r]},xyz:function(n){return ov.xyz(dC.luv(n))}};ov.lchuv=function(n){var t=n[0],e=n[1],i=n[2],s=Math.sqrt(e*e+i*i),r=Math.atan2(i,e),a=r*360/2/Math.PI;return a<0&&(a+=360),[t,s,a]};Yn.lchuv=function(n){return ov.lchuv(Yn.luv(n))};const aM={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};var oM={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function ez(n){var u,f;var t,e=[],i=1,s;if(typeof n=="number")return{space:"rgb",values:[n>>>16,(n&65280)>>>8,n&255],alpha:1};if(typeof n=="number")return{space:"rgb",values:[n>>>16,(n&65280)>>>8,n&255],alpha:1};if(n=String(n).toLowerCase(),aM[n])e=aM[n].slice(),s="rgb";else if(n==="transparent")i=0,s="rgb",e=[0,0,0];else if(n[0]==="#"){var r=n.slice(1),a=r.length,o=a<=4;i=1,o?(e=[parseInt(r[0]+r[0],16),parseInt(r[1]+r[1],16),parseInt(r[2]+r[2],16)],a===4&&(i=parseInt(r[3]+r[3],16)/255)):(e=[parseInt(r[0]+r[1],16),parseInt(r[2]+r[3],16),parseInt(r[4]+r[5],16)],a===8&&(i=parseInt(r[6]+r[7],16)/255)),e[0]||(e[0]=0),e[1]||(e[1]=0),e[2]||(e[2]=0),s="rgb"}else if(t=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(n)){var h=t[1];s=h.replace(/a$/,"");var l=s==="cmyk"?4:s==="gray"?1:3;e=t[2].trim().split(/\s*[,\/]\s*|\s+/),s==="color"&&(s=e.shift()),e=e.map(function(m,g){if(m[m.length-1]==="%")return m=parseFloat(m)/100,g===3?m:s==="rgb"?m*255:s[0]==="h"||s[0]==="l"&&!g?m*100:s==="lab"?m*125:s==="lch"?g<2?m*150:m*360:s[0]==="o"&&!g?m:s==="oklab"?m*.4:s==="oklch"?g<2?m*.4:m*360:m;if(s[g]==="h"||g===2&&s[s.length-1]==="h"){if(oM[m]!==void 0)return oM[m];if(m.endsWith("deg"))return parseFloat(m);if(m.endsWith("turn"))return parseFloat(m)*360;if(m.endsWith("grad"))return parseFloat(m)*360/400;if(m.endsWith("rad"))return parseFloat(m)*180/Math.PI}return m==="none"?0:parseFloat(m)}),i=e.length>l?e.pop():1}else/[0-9](?:\s|\/|,)/.test(n)&&(e=n.match(/([0-9]+)/g).map(function(m){return parseFloat(m)}),s=((f=(u=n.match(/([a-z])/ig))==null?void 0:u.join(""))==null?void 0:f.toLowerCase())||"rgb");return{space:s,values:e,alpha:i}}const Ny={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(n){var t=n[0]/360,e=n[1]/100,i=n[2]/100,s,r,a,o,h,l=0;if(e===0)return h=i*255,[h,h,h];for(r=i<.5?i*(1+e):i+e-i*e,s=2*i-r,o=[0,0,0];l<3;)a=t+1/3*-(l-1),a<0?a++:a>1&&a--,h=6*a<1?s+(r-s)*6*a:2*a<1?r:3*a<2?s+(r-s)*(2/3-a)*6:s,o[l++]=h*255;return o}};Xd.hsl=function(n){var t=n[0]/255,e=n[1]/255,i=n[2]/255,s=Math.min(t,e,i),r=Math.max(t,e,i),a=r-s,o,h,l;return r===s?o=0:t===r?o=(e-i)/a:e===r?o=2+(i-t)/a:i===r&&(o=4+(t-e)/a),o=Math.min(o*60,360),o<0&&(o+=360),l=(s+r)/2,r===s?h=0:l<=.5?h=a/(r+s):h=a/(2-r-s),[o,h*100,l*100]};function iz(n){Array.isArray(n)&&n.raw&&(n=String.raw(...arguments)),n instanceof Number&&(n=+n);var t,e=ez(n);if(!e.space)return[];const i=e.space[0]==="h"?Ny.min:Xd.min,s=e.space[0]==="h"?Ny.max:Xd.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],i[0]),s[0]),t[1]=Math.min(Math.max(e.values[1],i[1]),s[1]),t[2]=Math.min(Math.max(e.values[2],i[2]),s[2]),e.space[0]==="h"&&(t=Ny.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}function nz(n){return typeof n=="string"?n:lv(n)}const sz=1024,Zu={};let ky=0;function rz(n){if(n.length===4)return n;const t=n.slice();return t[3]=1,t}function hM(n){const t=Yn.lchuv(Xd.xyz(n));return t[3]=n[3],t}function az(n){const t=Yn.rgb(dC.xyz(n));return t[3]=n[3],t}function hv(n){if(Zu.hasOwnProperty(n))return Zu[n];if(ky>=sz){let e=0;for(const i in Zu)(e++&3)===0&&(delete Zu[i],--ky)}const t=iz(n);if(t.length!==4)throw new Error('Failed to parse "'+n+'" as color');for(const e of t)if(isNaN(e))throw new Error('Failed to parse "'+n+'" as color');return fC(t),Zu[n]=t,++ky,t}function gh(n){return Array.isArray(n)?n:hv(n)}function fC(n){return n[0]=Ui(n[0]+.5|0,0,255),n[1]=Ui(n[1]+.5|0,0,255),n[2]=Ui(n[2]+.5|0,0,255),n[3]=Ui(n[3],0,1),n}function lv(n){let t=n[0];t!=(t|0)&&(t=t+.5|0);let e=n[1];e!=(e|0)&&(e=e+.5|0);let i=n[2];i!=(i|0)&&(i=i+.5|0);const s=n[3]===void 0?1:Math.round(n[3]*1e3)/1e3;return"rgba("+t+","+e+","+i+","+s+")"}function oz(n){try{return hv(n),!0}catch{return!1}}function hz(n,t,e){const i=n;let s=!0,r=!1,a=!1;const o=[Hp(i,Ne.LOAD,function(){a=!0,r||t()})];return i.src&&ZS?(r=!0,i.decode().then(function(){s&&t()}).catch(function(h){s&&(a?t():e())})):o.push(Hp(i,Ne.ERROR,e)),function(){s=!1,o.forEach(Li)}}function lz(n,t){return new Promise((e,i)=>{function s(){a(),e(n)}function r(){a(),i(new Error("Image load error"))}function a(){n.removeEventListener("load",s),n.removeEventListener("error",r)}n.addEventListener("load",s),n.addEventListener("error",r),t&&(n.src=t)})}function cz(n,t){return t&&(n.src=t),n.src&&ZS?new Promise((e,i)=>n.decode().then(()=>e(n)).catch(s=>n.complete&&n.width?e(n):i(s))):lz(n)}class uz{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const i=this.cache_[e];(t++&3)===0&&!i.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,i){const s=Ly(t,e,i);return s in this.cache_?this.cache_[s]:null}getPattern(t,e,i){const s=Ly(t,e,i);return s in this.patternCache_?this.patternCache_[s]:null}set(t,e,i,s,r){const a=Ly(t,e,i),o=a in this.cache_;this.cache_[a]=s,r&&(s.getImageState()===Ge.IDLE&&s.load(),s.getImageState()===Ge.LOADING?s.ready().then(()=>{this.patternCache_[a]=Bp().createPattern(s.getImage(1),"repeat")}):this.patternCache_[a]=Bp().createPattern(s.getImage(1),"repeat")),o||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function Ly(n,t,e){const i=e?gh(e):"null";return t+":"+n+":"+i}const Ta=new uz;let Ku=null;class dz extends xf{constructor(t,e,i,s,r){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=i,this.canvas_={},this.color_=r,this.imageState_=s===void 0?Ge.IDLE:s,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===Ge.LOADED){Ku||(Ku=yn(1,1,void 0,{willReadFrequently:!0})),Ku.drawImage(this.image_,0,0);try{Ku.getImageData(0,0,1,1),this.tainted_=!1}catch{Ku=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(Ne.CHANGE)}handleImageError_(){this.imageState_=Ge.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=Ge.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=yn(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===Ge.IDLE){this.image_||this.initializeImage_(),this.imageState_=Ge.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&cz(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==Ge.LOADED)return;const e=this.image_,i=document.createElement("canvas");i.width=Math.ceil(e.width*t),i.height=Math.ceil(e.height*t);const s=i.getContext("2d");s.scale(t,t),s.drawImage(e,0,0),s.globalCompositeOperation="multiply",s.fillStyle=nz(this.color_),s.fillRect(0,0,i.width/t,i.height/t),s.globalCompositeOperation="destination-in",s.drawImage(e,0,0),this.canvas_[t]=i}ready(){return this.ready_||(this.ready_=new Promise(t=>{this.imageState_===Ge.LOADED||this.imageState_===Ge.ERROR?t():this.addEventListener(Ne.CHANGE,function e(){(this.imageState_===Ge.LOADED||this.imageState_===Ge.ERROR)&&(this.removeEventListener(Ne.CHANGE,e),t())})})),this.ready_}}function cv(n,t,e,i,s,r){let a=t===void 0?void 0:Ta.get(t,e,s);return a||(a=new dz(n,n&&"src"in n?n.src||void 0:t,e,i,s),Ta.set(t,e,s,a,r)),r&&a&&!Ta.getPattern(t,e,s)&&Ta.set(t,e,s,a,r),a}function Ca(n){return n?Array.isArray(n)?lv(n):typeof n=="object"&&"src"in n?fz(n):n:null}function fz(n){if(!n.offset||!n.size)return Ta.getPattern(n.src,"anonymous",n.color);const t=n.src+":"+n.offset,e=Ta.getPattern(t,void 0,n.color);if(e)return e;const i=Ta.get(n.src,"anonymous",null);if(i.getImageState()!==Ge.LOADED)return null;const s=yn(n.size[0],n.size[1]);return s.drawImage(i.getImage(1),n.offset[0],n.offset[1],n.size[0],n.size[1],0,0,n.size[0],n.size[1]),cv(s.canvas,t,void 0,Ge.LOADED,n.color,!0),Ta.getPattern(t,void 0,n.color)}const L0="ol-hidden",pz="ol-selectable",ng="ol-unselectable",uv="ol-control",lM="ol-collapsed",mz=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),cM=["style","variant","weight","size","lineHeight","family"],pC=function(n){const t=n.match(mz);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,s=cM.length;i<s;++i){const r=t[i+1];r!==void 0&&(e[cM[i]]=r)}return e.families=e.family.split(/,\s?/),e},mC="10px sans-serif",Us="#000",nu="round",fo=[],po=0,su="round",jd=10,Zd="#000",Kd="center",Kp="middle",Kh=[0,0,0,0],Jd=1,to=new sa;let uc=null,r_;const a_={},gz=function(){const t="32px ",e=["monospace","serif"],i=e.length,s="wmytzilWMYTZIL@#/&?$%10\uF013";let r,a;function o(l,u,f){let m=!0;for(let g=0;g<i;++g){const y=e[g];if(a=Jp(l+" "+u+" "+t+y,s),f!=y){const _=Jp(l+" "+u+" "+t+f+","+y,s);m=m&&_!=a}}return!!m}function h(){let l=!0;const u=to.getKeys();for(let f=0,m=u.length;f<m;++f){const g=u[f];to.get(g)<100&&(o.apply(this,g.split(`
`))?(yl(a_),uc=null,r_=void 0,to.set(g,100)):(to.set(g,to.get(g)+1,!0),l=!1))}l&&(clearInterval(r),r=void 0)}return function(l){const u=pC(l);if(!u)return;const f=u.families;for(let m=0,g=f.length;m<g;++m){const y=f[m],_=u.style+`
`+u.weight+`
`+y;to.get(_)===void 0&&(to.set(_,100,!0),o(u.style,u.weight,y)||(to.set(_,0,!0),r===void 0&&(r=setInterval(h,32))))}}}(),yz=function(){let n;return function(t){let e=a_[t];if(e==null){if(jS){const i=pC(t),s=gC(t,"\u017Dg");e=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}else n||(n=document.createElement("div"),n.innerHTML="M",n.style.minHeight="0",n.style.maxHeight="none",n.style.height="auto",n.style.padding="0",n.style.border="none",n.style.position="absolute",n.style.display="block",n.style.left="-99999px"),n.style.font=t,document.body.appendChild(n),e=n.offsetHeight,document.body.removeChild(n);a_[t]=e}return e}}();function gC(n,t){return uc||(uc=yn(1,1)),n!=r_&&(uc.font=n,r_=uc.font),uc.measureText(t)}function Jp(n,t){return gC(n,t).width}function uM(n,t,e){if(t in e)return e[t];const i=t.split(`
`).reduce((s,r)=>Math.max(s,Jp(n,r)),0);return e[t]=i,i}function _z(n,t){const e=[],i=[],s=[];let r=0,a=0,o=0,h=0;for(let l=0,u=t.length;l<=u;l+=2){const f=t[l];if(f===`
`||l===u){r=Math.max(r,a),s.push(a),a=0,o+=h,h=0;continue}const m=t[l+1]||n.font,g=Jp(m,f);e.push(g),a+=g;const y=yz(m);i.push(y),h=Math.max(h,y)}return{width:r,height:o,widths:e,heights:i,lineWidths:s}}function xz(n,t,e,i,s,r,a,o,h,l,u){n.save(),e!==1&&(n.globalAlpha===void 0?n.globalAlpha=f=>f.globalAlpha*=e:n.globalAlpha*=e),t&&n.transform.apply(n,t),i.contextInstructions?(n.translate(h,l),n.scale(u[0],u[1]),vz(i,n)):u[0]<0||u[1]<0?(n.translate(h,l),n.scale(u[0],u[1]),n.drawImage(i,s,r,a,o,0,0,a,o)):n.drawImage(i,s,r,a,o,h,l,a*u[0],o*u[1]),n.restore()}function vz(n,t){const e=n.contextInstructions;for(let i=0,s=e.length;i<s;i+=2)Array.isArray(e[i+1])?t[e[i]].apply(t,e[i+1]):t[e[i]]=e[i+1]}class dv extends uC{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?Ge.LOADING:Ge.LOADED,this.imageState_===Ge.LOADING&&this.ready().then(()=>this.imageState_=Ge.LOADED),this.render()}clone(){const t=this.getScale(),e=new dv({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let e=this.canvases_[t];if(!e){const i=this.renderOptions_,s=yn(i.size*t,i.size*t);this.draw_(i,s,t),e=s.canvas,this.canvases_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let s=this.radius_,r=this.radius2_===void 0?s:this.radius2_;if(s<r){const L=s;s=r,r=L}const a=this.radius2_===void 0?this.points_:this.points_*2,o=2*Math.PI/a,h=r*Math.sin(o),l=Math.sqrt(r*r-h*h),u=s-l,f=Math.sqrt(h*h+u*u),m=f/h;if(t==="miter"&&m<=i)return m*e;const g=e/2/m,y=e/2*(u/f),w=Math.sqrt((s+g)*(s+g)+y*y)-s;if(this.radius2_===void 0||t==="bevel")return w*2;const M=s*Math.sin(o),T=Math.sqrt(s*s-M*M),A=r-T,I=Math.sqrt(M*M+A*A)/M;if(I<=i){const L=I*e/2-r-s;return 2*Math.max(w,L)}return w*2}createRenderOptions(){var f,m,g,y,_,w;let t=nu,e=su,i=0,s=null,r=0,a,o=0;this.stroke_&&(a=Ca((f=this.stroke_.getColor())!=null?f:Zd),o=(m=this.stroke_.getWidth())!=null?m:Jd,s=this.stroke_.getLineDash(),r=(g=this.stroke_.getLineDashOffset())!=null?g:0,e=(y=this.stroke_.getLineJoin())!=null?y:su,t=(_=this.stroke_.getLineCap())!=null?_:nu,i=(w=this.stroke_.getMiterLimit())!=null?w:jd);const h=this.calculateLineJoinSize_(e,o,i),l=Math.max(this.radius_,this.radius2_||0),u=Math.ceil(2*l+h);return{strokeStyle:a,strokeWidth:o,size:u,lineCap:t,lineDash:s,lineDashOffset:r,lineJoin:e,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let s=this.fill_.getColor();s===null&&(s=Us),e.fillStyle=Ca(s),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let i=this.fill_.getColor(),s=0;typeof i=="string"&&(i=gh(i)),i===null?s=1:Array.isArray(i)&&(s=i.length===4?i[3]:1),s===0&&(e=yn(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const i=this.radius_;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const s=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(e*=2);const r=this.angle_-Math.PI/2,a=2*Math.PI/e;for(let o=0;o<e;o++){const h=r+o*a,l=o%2===0?i:s;t.lineTo(l*Math.cos(h),l*Math.sin(h))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=Us,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}const yC=dv;class fv extends yC{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new fv({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}const _u=fv;class pv{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new pv({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=cv(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===Ge.IDLE&&e.load(),e.getImageState()===Ge.LOADING&&(this.patternImage_=e)}this.color_=t}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}const _n=pv;class mv{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new mv({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}const Xn=mv;class th{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=dM,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){var e;let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new th({geometry:t!=null?t:void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:(e=this.getRenderer())!=null?e:void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=dM,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function wz(n){let t;if(typeof n=="function")t=n;else{let e;Array.isArray(n)?e=n:(ci(typeof n.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[n]),t=function(){return e}}return t}let Oy=null;function _C(n,t){if(!Oy){const e=new _n({color:"rgba(255,255,255,0.4)"}),i=new Xn({color:"#3399CC",width:1.25});Oy=[new th({image:new _u({fill:e,stroke:i,radius:5}),fill:e,stroke:i})]}return Oy}function xC(){const n={},t=[255,255,255,1],e=[0,153,255,1],i=3;return n.Polygon=[new th({fill:new _n({color:[255,255,255,.5]})})],n.MultiPolygon=n.Polygon,n.LineString=[new th({stroke:new Xn({color:t,width:i+2})}),new th({stroke:new Xn({color:e,width:i})})],n.MultiLineString=n.LineString,n.Circle=n.Polygon.concat(n.LineString),n.Point=[new th({image:new _u({radius:i*2,fill:new _n({color:e}),stroke:new Xn({color:t,width:i/2})}),zIndex:1/0})],n.MultiPoint=n.Point,n.GeometryCollection=n.Polygon.concat(n.LineString,n.Point),n}function dM(n){return n.getGeometry()}const Hi=th;function fM(n,t,e,i){return e!==void 0&&i!==void 0?[e/n,i/t]:e!==void 0?e/n:i!==void 0?i/t:1}class gv extends uC{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,i=t.rotation!==void 0?t.rotation:0,s=t.scale!==void 0?t.scale:1,r=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:i,scale:s,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:r,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const a=t.img!==void 0?t.img:null;let o=t.src;ci(!(o!==void 0&&a),"`image` and `src` cannot be provided at the same time"),(o===void 0||o.length===0)&&a&&(o=a.src||$e(a)),ci(o!==void 0&&o.length>0,"A defined and non-empty `src` or `image` must be provided"),ci(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let h;if(t.src!==void 0?h=Ge.IDLE:a!==void 0&&("complete"in a?a.complete?h=a.src?Ge.LOADED:Ge.IDLE:h=Ge.LOADING:h=Ge.LOADED),this.color_=t.color!==void 0?gh(t.color):null,this.iconImage_=cv(a,o,this.crossOrigin_,h,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,t.width!==void 0||t.height!==void 0){let l,u;if(t.size)[l,u]=t.size;else{const f=this.getImage(1);if(f.width&&f.height)l=f.width,u=f.height;else if(f instanceof HTMLImageElement){this.initialOptions_=t;const m=()=>{if(this.unlistenImageChange(m),!this.initialOptions_)return;const g=this.iconImage_.getSize();this.setScale(fM(g[0],g[1],t.width,t.height))};this.listenImageChange(m);return}}l!==void 0&&this.setScale(fM(l,u,t.width,t.height))}}clone(){let t,e,i;return this.initialOptions_?(e=this.initialOptions_.width,i=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new gv({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const s=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!s)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=s[0]),this.anchorYUnits_=="fraction"&&(t[1]*=s[1])}if(this.anchorOrigin_!="top-left"){if(!s)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+s[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+s[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=i[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==Ge.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==Ge.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(Ne.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(Ne.CHANGE,t)}ready(){return this.iconImage_.ready()}}const vl=gv,bz="#333";class yv{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=Tn(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new _n({color:bz}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new yv({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Tn(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}const _v=yv;let wl=0;const bl=0,Zi=1<<wl++,xe=1<<wl++,Ms=1<<wl++,fn=1<<wl++,Wr=1<<wl++,Pc=1<<wl++,ns=Math.pow(2,wl)-1,vC={[Zi]:"boolean",[xe]:"number",[Ms]:"string",[fn]:"color",[Wr]:"number[]",[Pc]:"size"},Mz=Object.keys(vC).map(Number).sort(oh);function An(n){const t=[];for(const e of Mz)Ez(n,e)&&t.push(vC[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function Ez(n,t){return(n&t)===t}function $r(n,t){return!!(n&t)}function Sf(n,t){return n===t}class eh{constructor(t,e){this.type=t,this.value=e}}class wC{constructor(t,e,...i){this.type=t,this.operator=e,this.args=i}}function xv(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,style:{}}}function Sz(n){switch(n){case"string":return Ms;case"color":return fn;case"number":return xe;case"boolean":return Zi;case"number[]":return Wr;default:throw new Error(`Unrecognized type hint: ${n}`)}}function bi(n,t,e){switch(typeof n){case"boolean":return new eh(Zi,n);case"number":return new eh(e===Pc?Pc:xe,n);case"string":{let s=Ms;return oz(n)&&(s|=fn),Sf(s&e,bl)||(s&=e),new eh(s,n)}}if(!Array.isArray(n))throw new Error("Expression must be an array or a primitive value");if(n.length===0)throw new Error("Empty expression");if(typeof n[0]=="string")return Dz(n,t,e);for(const s of n)if(typeof s!="number")throw new Error("Expected an array of numbers");let i=Wr;return n.length===2?i|=Pc:(n.length===3||n.length===4)&&(i|=fn),e&&(i&=e),new eh(i,n)}const wt={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string"},Tz={[wt.Get]:ze(([n,t])=>t!==void 0?Sz(t.value):ns,Ke(1,2),Cz),[wt.Var]:ze(([n])=>n.type,Ke(1,1),Az),[wt.Id]:ze(xe|Ms,Ju,Rz),[wt.Concat]:ze(Ms,Ke(2,1/0),di(ns)),[wt.GeometryType]:ze(Ms,Ju,Iz),[wt.Resolution]:ze(xe,Ju),[wt.Zoom]:ze(xe,Ju),[wt.Time]:ze(xe,Ju),[wt.Any]:ze(Zi,Ke(2,1/0),di(Zi)),[wt.All]:ze(Zi,Ke(2,1/0),di(Zi)),[wt.Not]:ze(Zi,Ke(1,1),di(Zi)),[wt.Equal]:ze(Zi,Ke(2,2),di(ns),zo),[wt.NotEqual]:ze(Zi,Ke(2,2),di(ns),zo),[wt.GreaterThan]:ze(Zi,Ke(2,2),di(ns),zo),[wt.GreaterThanOrEqualTo]:ze(Zi,Ke(2,2),di(ns),zo),[wt.LessThan]:ze(Zi,Ke(2,2),di(ns),zo),[wt.LessThanOrEqualTo]:ze(Zi,Ke(2,2),di(ns),zo),[wt.Multiply]:ze(n=>{let t=xe|fn;for(let e=0;e<n.length;e++)t&=n[e].type;return t},Ke(2,1/0),di(xe|fn),zo),[wt.Coalesce]:ze(n=>{let t=ns;for(let e=1;e<n.length;e+=2)t&=n[e].type;return t&=n[n.length-1].type,t},Ke(2,1/0),di(ns),zo),[wt.Divide]:ze(xe,Ke(2,2),di(xe)),[wt.Add]:ze(xe,Ke(2,1/0),di(xe)),[wt.Subtract]:ze(xe,Ke(2,2),di(xe)),[wt.Clamp]:ze(xe,Ke(3,3),di(xe)),[wt.Mod]:ze(xe,Ke(2,2),di(xe)),[wt.Pow]:ze(xe,Ke(2,2),di(xe)),[wt.Abs]:ze(xe,Ke(1,1),di(xe)),[wt.Floor]:ze(xe,Ke(1,1),di(xe)),[wt.Ceil]:ze(xe,Ke(1,1),di(xe)),[wt.Round]:ze(xe,Ke(1,1),di(xe)),[wt.Sin]:ze(xe,Ke(1,1),di(xe)),[wt.Cos]:ze(xe,Ke(1,1),di(xe)),[wt.Atan]:ze(xe,Ke(1,2),di(xe)),[wt.Sqrt]:ze(xe,Ke(1,1),di(xe)),[wt.Match]:ze(n=>{let t=ns;for(let e=2;e<n.length;e+=2)t&=n[e].type;return t&=n[n.length-1].type,t},Ke(4,1/0),pM,kz),[wt.Between]:ze(Zi,Ke(3,3),di(xe)),[wt.Interpolate]:ze(n=>{let t=fn|xe;for(let e=3;e<n.length;e+=2)t&=n[e].type;return t},Ke(6,1/0),pM,Lz),[wt.Case]:ze(n=>{let t=ns;for(let e=1;e<n.length;e+=2)t&=n[e].type;return t&=n[n.length-1].type,t},Ke(3,1/0),Nz,Oz),[wt.In]:ze(Zi,Ke(2,2),Pz),[wt.Number]:ze(xe,Ke(1,1/0),di(ns)),[wt.String]:ze(Ms,Ke(1,1/0),di(ns)),[wt.Array]:ze(n=>n.length===2?Wr|Pc:n.length===3||n.length===4?Wr|fn:Wr,Ke(1,1/0),di(xe)),[wt.Color]:ze(fn,Ke(1,4),di(xe)),[wt.Band]:ze(xe,Ke(1,3),di(xe)),[wt.Palette]:ze(fn,Ke(2,2),Fz),[wt.ToString]:ze(Ms,Ke(1,1),di(Zi|xe|Ms|fn))};function Cz(n,t){const e=bi(n[1],t);if(!(e instanceof eh))throw new Error("Expected a literal argument for get operation");if(typeof e.value!="string")throw new Error("Expected a string argument for get operation");if(t.properties.add(e.value),n.length===3){const i=bi(n[2],t);return[e,i]}return[e]}function Az(n,t,e,i){const s=n[1];if(typeof s!="string")throw new Error("Expected a string argument for var operation");if(t.variables.add(s),!("variables"in t.style)||t.style.variables[s]===void 0)return[new eh(ns,s)];const r=t.style.variables[s],a=bi(r,t);if(a.value=s,i&&!$r(i,a.type))throw new Error(`The variable ${s} has type ${An(a.type)} but the following type was expected: ${An(i)}`);return[a]}function Rz(n,t){t.featureId=!0}function Iz(n,t){t.geometryType=!0}function Ju(n,t){const e=n[0];if(n.length!==1)throw new Error(`Expected no arguments for ${e} operation`);return[]}function Ke(n,t){return function(e,i){const s=e[0],r=e.length-1;if(n===t){if(r!==n){const a=n===1?"":"s";throw new Error(`Expected ${n} argument${a} for ${s}, got ${r}`)}}else if(r<n||r>t){const a=t===1/0?`${n} or more`:`${n} to ${t}`;throw new Error(`Expected ${a} arguments for ${s}, got ${r}`)}}}function di(n){return function(t,e){const i=t[0],s=t.length-1,r=new Array(s);for(let a=0;a<s;++a){const o=bi(t[a+1],e);if(!$r(n,o.type)){const h=An(n),l=An(o.type);throw new Error(`Unexpected type for argument ${a} of ${i} operation, got ${h} but expected ${l}`)}o.type&=n,r[a]=o}return r}}function zo(n,t,e){const i=n[0],s=n.length-1;let r=ns;for(let o=0;o<e.length;++o)r&=e[o].type;if(r===bl)throw new Error(`No common type could be found for arguments of ${i} operation`);const a=new Array(s);for(let o=0;o<s;++o)a[o]=bi(n[o+1],t,r);return a}function Nz(n,t){const e=n[0],i=n.length-1;if(i%2===0)throw new Error(`An odd amount of arguments was expected for operation ${e}, got ${JSON.stringify(i)} instead`)}function pM(n,t){const e=n[0],i=n.length-1;if(i%2===1)throw new Error(`An even amount of arguments was expected for operation ${e}, got ${JSON.stringify(i)} instead`)}function kz(n,t,e,i){const s=n.length-1;let a=bi(n[1],t).type;const o=bi(n[n.length-1],t);let h=i!==void 0?i&o.type:o.type;const l=new Array(s-2);for(let f=0;f<s-2;f+=2){const m=bi(n[f+2],t),g=bi(n[f+3],t);a&=m.type,h&=g.type,l[f]=m,l[f+1]=g}const u=Ms|xe|Zi;if(!$r(u,a))throw new Error(`Expected an input of type ${An(u)} for the interpolate operation, got ${An(a)} instead`);if(a&=u,Sf(h,bl))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(n));for(let f=0;f<s-2;f+=2){const m=bi(n[f+2],t,a),g=bi(n[f+3],t,h);l[f]=m,l[f+1]=g}return[bi(n[1],t,a),...l,bi(n[n.length-1],t,h)]}function Lz(n,t,e,i){const s=n[1];let r;switch(s[0]){case"linear":r=1;break;case"exponential":if(r=s[1],typeof r!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(r)} instead`);break;default:r=null}if(!r)throw new Error(`Invalid interpolation type: ${JSON.stringify(s)}`);r=bi(r,t);let a=bi(n[2],t);if(!$r(xe,a.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${An(a.type)} instead`);a=bi(n[2],t,xe);const o=new Array(n.length-3);for(let h=0;h<o.length;h+=2){let l=bi(n[h+3],t);if(!$r(xe,l.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${An(l.type)} at position ${h+2} instead`);let u=bi(n[h+4],t);if(!$r(xe|fn,u.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${An(u.type)} at position ${h+3} instead`);l=bi(n[h+3],t,xe),u=bi(n[h+4],t,xe|fn),o[h]=l,o[h+1]=u}return[r,a,...o]}function Oz(n,t,e,i){const s=bi(n[n.length-1],t,i);let r=i!==void 0?i&s.type:s.type;const a=new Array(n.length-1);for(let o=0;o<a.length-1;o+=2){const h=bi(n[o+1],t),l=bi(n[o+2],t,i);if(!$r(Zi,h.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${An(h.type)} at position ${o} instead`);r&=l.type,a[o]=h,a[o+1]=l}if(Sf(r,bl))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(n));for(let o=0;o<a.length-1;o+=2)a[o+1]=bi(n[o+2],t,r);return a[a.length-1]=bi(n[n.length-1],t,r),a}function Pz(n,t){let e=n[2];if(!Array.isArray(e))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof e[0]=="string"){if(e[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(e[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');e=e[1]}let i=Ms|xe;const s=new Array(e.length);for(let a=0;a<s.length;a++){const o=bi(e[a],t);i&=o.type,s[a]=o}if(Sf(i,bl))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(n));return[bi(n[1],t,i),...s]}function Fz(n,t){const e=bi(n[1],t,xe);if(e.type!==xe)throw new Error(`The first argument of palette must be an number, got ${An(e.type)} instead`);const i=n[2];if(!Array.isArray(i))throw new Error("The second argument of palette must be an array");const s=new Array(i.length);for(let r=0;r<s.length;r++){const a=bi(i[r],t,fn);if(!(a instanceof eh))throw new Error(`The palette color at index ${r} must be a literal value`);if(!$r(a.type,fn))throw new Error(`The palette color at index ${r} should be of type color, got ${An(a.type)} instead`);s[r]=a}return[e,...s]}function ze(n,...t){return function(e,i,s){const r=e[0];let a=[];for(let h=0;h<t.length;h++)a=t[h](e,i,a,s)||a;let o=typeof n=="function"?n(a):n;if(s!==void 0){if(!$r(o,s))throw new Error(`The following expression was expected to return ${An(s)}, but returns ${An(o)} instead: ${JSON.stringify(e)}`);o&=s}if(o===bl)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(e)}`);return new wC(o,r,...a)}}function Dz(n,t,e){const i=n[0],s=Tz[i];if(!s)throw new Error(`Unknown operator: ${i}`);return s(n,t,e)}function vv(n){if(!n)return"";const t=n.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return vv(n.getGeometries()[0]);default:return""}}function bC(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function Eo(n,t,e){const i=bi(n,e);if(!$r(t,i.type)){const s=An(t),r=An(i.type);throw new Error(`Expected expression to be of type ${s}, got ${r}`)}return Qr(i)}function Qr(n,t){if(n instanceof eh){if(n.type===fn&&typeof n.value=="string"){const i=hv(n.value);return function(){return i}}return function(){return n.value}}const e=n.operator;switch(e){case wt.Number:case wt.String:case wt.Coalesce:return zz(n);case wt.Get:case wt.Var:return Bz(n);case wt.Id:return i=>i.featureId;case wt.GeometryType:return i=>i.geometryType;case wt.Concat:{const i=n.args.map(s=>Qr(s));return s=>"".concat(...i.map(r=>r(s).toString()))}case wt.Resolution:return i=>i.resolution;case wt.Any:case wt.All:case wt.Between:case wt.In:case wt.Not:return Gz(n);case wt.Equal:case wt.NotEqual:case wt.LessThan:case wt.LessThanOrEqualTo:case wt.GreaterThan:case wt.GreaterThanOrEqualTo:return Uz(n);case wt.Multiply:case wt.Divide:case wt.Add:case wt.Subtract:case wt.Clamp:case wt.Mod:case wt.Pow:case wt.Abs:case wt.Floor:case wt.Ceil:case wt.Round:case wt.Sin:case wt.Cos:case wt.Atan:case wt.Sqrt:return Vz(n);case wt.Case:return Wz(n);case wt.Match:return $z(n);case wt.Interpolate:return Yz(n);case wt.ToString:return Hz(n);default:throw new Error(`Unsupported operator ${e}`)}}function zz(n,t){const e=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=Qr(n.args[r]);switch(e){case wt.Coalesce:return r=>{for(let a=0;a<i;++a){const o=s[a](r);if(typeof o<"u"&&o!==null)return o}throw new Error("Expected one of the values to be non-null")};case wt.Number:case wt.String:return r=>{for(let a=0;a<i;++a){const o=s[a](r);if(typeof o===e)return o}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function Bz(n,t){const i=n.args[0].value;switch(n.operator){case wt.Get:return s=>s.properties[i];case wt.Var:return s=>s.variables[i];default:throw new Error(`Unsupported accessor operator ${n.operator}`)}}function Uz(n,t){const e=n.operator,i=Qr(n.args[0]),s=Qr(n.args[1]);switch(e){case wt.Equal:return r=>i(r)===s(r);case wt.NotEqual:return r=>i(r)!==s(r);case wt.LessThan:return r=>i(r)<s(r);case wt.LessThanOrEqualTo:return r=>i(r)<=s(r);case wt.GreaterThan:return r=>i(r)>s(r);case wt.GreaterThanOrEqualTo:return r=>i(r)>=s(r);default:throw new Error(`Unsupported comparison operator ${e}`)}}function Gz(n,t){const e=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=Qr(n.args[r]);switch(e){case wt.Any:return r=>{for(let a=0;a<i;++a)if(s[a](r))return!0;return!1};case wt.All:return r=>{for(let a=0;a<i;++a)if(!s[a](r))return!1;return!0};case wt.Between:return r=>{const a=s[0](r),o=s[1](r),h=s[2](r);return a>=o&&a<=h};case wt.In:return r=>{const a=s[0](r);for(let o=1;o<i;++o)if(a===s[o](r))return!0;return!1};case wt.Not:return r=>!s[0](r);default:throw new Error(`Unsupported logical operator ${e}`)}}function Vz(n,t){const e=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=Qr(n.args[r]);switch(e){case wt.Multiply:return r=>{let a=1;for(let o=0;o<i;++o)a*=s[o](r);return a};case wt.Divide:return r=>s[0](r)/s[1](r);case wt.Add:return r=>{let a=0;for(let o=0;o<i;++o)a+=s[o](r);return a};case wt.Subtract:return r=>s[0](r)-s[1](r);case wt.Clamp:return r=>{const a=s[0](r),o=s[1](r);if(a<o)return o;const h=s[2](r);return a>h?h:a};case wt.Mod:return r=>s[0](r)%s[1](r);case wt.Pow:return r=>Math.pow(s[0](r),s[1](r));case wt.Abs:return r=>Math.abs(s[0](r));case wt.Floor:return r=>Math.floor(s[0](r));case wt.Ceil:return r=>Math.ceil(s[0](r));case wt.Round:return r=>Math.round(s[0](r));case wt.Sin:return r=>Math.sin(s[0](r));case wt.Cos:return r=>Math.cos(s[0](r));case wt.Atan:return i===2?r=>Math.atan2(s[0](r),s[1](r)):r=>Math.atan(s[0](r));case wt.Sqrt:return r=>Math.sqrt(s[0](r));default:throw new Error(`Unsupported numeric operator ${e}`)}}function Wz(n,t){const e=n.args.length,i=new Array(e);for(let s=0;s<e;++s)i[s]=Qr(n.args[s]);return s=>{for(let r=0;r<e-1;r+=2)if(i[r](s))return i[r+1](s);return i[e-1](s)}}function $z(n,t){const e=n.args.length,i=new Array(e);for(let s=0;s<e;++s)i[s]=Qr(n.args[s]);return s=>{const r=i[0](s);for(let a=1;a<e;a+=2)if(r===i[a](s))return i[a+1](s);return i[e-1](s)}}function Yz(n,t){const e=n.args.length,i=new Array(e);for(let s=0;s<e;++s)i[s]=Qr(n.args[s]);return s=>{const r=i[0](s),a=i[1](s);let o,h;for(let l=2;l<e;l+=2){const u=i[l](s);let f=i[l+1](s);const m=Array.isArray(f);if(m&&(f=rz(f)),u>=a)return l===2?f:m?qz(r,a,o,h,u,f):yd(r,a,o,h,u,f);o=u,h=f}return h}}function Hz(n,t){const e=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=Qr(n.args[r]);switch(e){case wt.ToString:return r=>{const a=s[0](r);return n.args[0].type===fn?lv(a):a.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function yd(n,t,e,i,s,r){const a=s-e;if(a===0)return i;const o=t-e,h=n===1?o/a:(Math.pow(n,o)-1)/(Math.pow(n,a)-1);return i+h*(r-i)}function qz(n,t,e,i,s,r){if(s-e===0)return i;const o=hM(i),h=hM(r);let l=h[2]-o[2];l>180?l-=360:l<-180&&(l+=360);const u=[yd(n,t,e,o[0],s,h[0]),yd(n,t,e,o[1],s,h[1]),o[2]+yd(n,t,e,0,s,l),yd(n,t,e,i[3],s,r[3])];return fC(az(u))}function Xz(n){return!0}function jz(n){const t=xv(),e=Zz(n,t),i=bC();return function(s,r){if(i.properties=s.getPropertiesInternal(),i.resolution=r,t.featureId){const a=s.getId();a!==void 0?i.featureId=a:i.featureId=null}return t.geometryType&&(i.geometryType=vv(s.getGeometry())),e(i)}}function mM(n){const t=xv(),e=n.length,i=new Array(e);for(let a=0;a<e;++a)i[a]=o_(n[a],t);const s=bC(),r=new Array(e);return function(a,o){if(s.properties=a.getPropertiesInternal(),s.resolution=o,t.featureId){const l=a.getId();l!==void 0?s.featureId=l:s.featureId=null}let h=0;for(let l=0;l<e;++l){const u=i[l](s);u&&(r[h]=u,h+=1)}return r.length=h,r}}function Zz(n,t){const e=n.length,i=new Array(e);for(let s=0;s<e;++s){const r=n[s],a="filter"in r?Eo(r.filter,Zi,t):Xz;let o;if(Array.isArray(r.style)){const h=r.style.length;o=new Array(h);for(let l=0;l<h;++l)o[l]=o_(r.style[l],t)}else o=[o_(r.style,t)];i[s]={filter:a,styles:o}}return function(s){const r=[];let a=!1;for(let o=0;o<e;++o){const h=i[o].filter;if(!!h(s)&&!(n[o].else&&a)){a=!0;for(const l of i[o].styles){const u=l(s);!u||r.push(u)}}}return r}}function o_(n,t){const e=Qd(n,"",t),i=tf(n,"",t),s=Kz(n,t),r=Jz(n,t),a=Vs(n,"z-index",t);if(!e&&!i&&!s&&!r&&!al(n))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(n));const o=new Hi;return function(h){let l=!0;if(e){const u=e(h);u&&(l=!1),o.setFill(u)}if(i){const u=i(h);u&&(l=!1),o.setStroke(u)}if(s){const u=s(h);u&&(l=!1),o.setText(u)}if(r){const u=r(h);u&&(l=!1),o.setImage(u)}return a&&o.setZIndex(a(h)),l?null:o}}function Qd(n,t,e){let i;if(t+"fill-pattern-src"in n?i=iB(n,t+"fill-",e):i=wv(n,t+"fill-color",e),!i)return null;const s=new _n;return function(r){const a=i(r);return a==="none"?null:(s.setColor(a),s)}}function tf(n,t,e){const i=Vs(n,t+"stroke-width",e),s=wv(n,t+"stroke-color",e);if(!i&&!s)return null;const r=ro(n,t+"stroke-line-cap",e),a=ro(n,t+"stroke-line-join",e),o=MC(n,t+"stroke-line-dash",e),h=Vs(n,t+"stroke-line-dash-offset",e),l=Vs(n,t+"stroke-miter-limit",e),u=new Xn;return function(f){if(s){const m=s(f);if(m==="none")return null;u.setColor(m)}if(i&&u.setWidth(i(f)),r){const m=r(f);if(m!=="butt"&&m!=="round"&&m!=="square")throw new Error("Expected butt, round, or square line cap");u.setLineCap(m)}if(a){const m=a(f);if(m!=="bevel"&&m!=="round"&&m!=="miter")throw new Error("Expected bevel, round, or miter line join");u.setLineJoin(m)}return o&&u.setLineDash(o(f)),h&&u.setLineDashOffset(h(f)),l&&u.setMiterLimit(l(f)),u}}function Kz(n,t){const e="text-",i=ro(n,e+"value",t);if(!i)return null;const s=Qd(n,e,t),r=Qd(n,e+"background-",t),a=tf(n,e,t),o=tf(n,e+"background-",t),h=ro(n,e+"font",t),l=Vs(n,e+"max-angle",t),u=Vs(n,e+"offset-x",t),f=Vs(n,e+"offset-y",t),m=ef(n,e+"overflow",t),g=ro(n,e+"placement",t),y=Vs(n,e+"repeat",t),_=sg(n,e+"scale",t),w=ef(n,e+"rotate-with-view",t),M=Vs(n,e+"rotation",t),T=ro(n,e+"align",t),A=ro(n,e+"justify",t),R=ro(n,e+"baseline",t),I=MC(n,e+"padding",t),L=rg(n,e+"declutter-mode"),k=new _v({declutterMode:L});return function(Y){if(k.setText(i(Y)),s&&k.setFill(s(Y)),r&&k.setBackgroundFill(r(Y)),a&&k.setStroke(a(Y)),o&&k.setBackgroundStroke(o(Y)),h&&k.setFont(h(Y)),l&&k.setMaxAngle(l(Y)),u&&k.setOffsetX(u(Y)),f&&k.setOffsetY(f(Y)),m&&k.setOverflow(m(Y)),g){const K=g(Y);if(K!=="point"&&K!=="line")throw new Error("Expected point or line for text-placement");k.setPlacement(K)}if(y&&k.setRepeat(y(Y)),_&&k.setScale(_(Y)),w&&k.setRotateWithView(w(Y)),M&&k.setRotation(M(Y)),T){const K=T(Y);if(K!=="left"&&K!=="center"&&K!=="right"&&K!=="end"&&K!=="start")throw new Error("Expected left, right, center, start, or end for text-align");k.setTextAlign(K)}if(A){const K=A(Y);if(K!=="left"&&K!=="right"&&K!=="center")throw new Error("Expected left, right, or center for text-justify");k.setJustify(K)}if(R){const K=R(Y);if(K!=="bottom"&&K!=="top"&&K!=="middle"&&K!=="alphabetic"&&K!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");k.setTextBaseline(K)}return I&&k.setPadding(I(Y)),k}}function Jz(n,t){return"icon-src"in n?Qz(n,t):"shape-points"in n?tB(n,t):"circle-radius"in n?eB(n,t):null}function Qz(n,t){const e="icon-",i=e+"src",s=EC(n[i],i),r=Qp(n,e+"anchor",t),a=sg(n,e+"scale",t),o=Vs(n,e+"opacity",t),h=Qp(n,e+"displacement",t),l=Vs(n,e+"rotation",t),u=ef(n,e+"rotate-with-view",t),f=yM(n,e+"anchor-origin"),m=_M(n,e+"anchor-x-units"),g=_M(n,e+"anchor-y-units"),y=aB(n,e+"color"),_=sB(n,e+"cross-origin"),w=rB(n,e+"offset"),M=yM(n,e+"offset-origin"),T=tm(n,e+"width"),A=tm(n,e+"height"),R=nB(n,e+"size"),I=rg(n,e+"declutter-mode"),L=new vl({src:s,anchorOrigin:f,anchorXUnits:m,anchorYUnits:g,color:y,crossOrigin:_,offset:w,offsetOrigin:M,height:A,width:T,size:R,declutterMode:I});return function(k){return o&&L.setOpacity(o(k)),h&&L.setDisplacement(h(k)),l&&L.setRotation(l(k)),u&&L.setRotateWithView(u(k)),a&&L.setScale(a(k)),r&&L.setAnchor(r(k)),L}}function tB(n,t){const e="shape-",i=e+"points",s=e+"radius",r=h_(n[i],i),a=h_(n[s],s),o=Qd(n,e,t),h=tf(n,e,t),l=sg(n,e+"scale",t),u=Qp(n,e+"displacement",t),f=Vs(n,e+"rotation",t),m=ef(n,e+"rotate-with-view",t),g=tm(n,e+"radius2"),y=tm(n,e+"angle"),_=rg(n,e+"declutter-mode"),w=new yC({points:r,radius:a,radius2:g,angle:y,declutterMode:_});return function(M){return o&&w.setFill(o(M)),h&&w.setStroke(h(M)),u&&w.setDisplacement(u(M)),f&&w.setRotation(f(M)),m&&w.setRotateWithView(m(M)),l&&w.setScale(l(M)),w}}function eB(n,t){const e="circle-",i=Qd(n,e,t),s=tf(n,e,t),r=Vs(n,e+"radius",t),a=sg(n,e+"scale",t),o=Qp(n,e+"displacement",t),h=Vs(n,e+"rotation",t),l=ef(n,e+"rotate-with-view",t),u=rg(n,e+"declutter-mode"),f=new _u({radius:5,declutterMode:u});return function(m){return r&&f.setRadius(r(m)),i&&f.setFill(i(m)),s&&f.setStroke(s(m)),o&&f.setDisplacement(o(m)),h&&f.setRotation(h(m)),l&&f.setRotateWithView(l(m)),a&&f.setScale(a(m)),f}}function Vs(n,t,e){if(!(t in n))return;const i=Eo(n[t],xe,e);return function(s){return h_(i(s),t)}}function ro(n,t,e){if(!(t in n))return null;const i=Eo(n[t],Ms,e);return function(s){return EC(i(s),t)}}function iB(n,t,e){const i=ro(n,t+"pattern-src",e),s=gM(n,t+"pattern-offset",e),r=gM(n,t+"pattern-size",e),a=wv(n,t+"color",e);return function(o){return{src:i(o),offset:s&&s(o),size:r&&r(o),color:a&&a(o)}}}function ef(n,t,e){if(!(t in n))return null;const i=Eo(n[t],Zi,e);return function(s){const r=i(s);if(typeof r!="boolean")throw new Error(`Expected a boolean for ${t}`);return r}}function wv(n,t,e){if(!(t in n))return null;const i=Eo(n[t],fn|Ms,e);return function(s){return SC(i(s),t)}}function MC(n,t,e){if(!(t in n))return null;const i=Eo(n[t],Wr,e);return function(s){return Tf(i(s),t)}}function Qp(n,t,e){if(!(t in n))return null;const i=Eo(n[t],Wr,e);return function(s){const r=Tf(i(s),t);if(r.length!==2)throw new Error(`Expected two numbers for ${t}`);return r}}function gM(n,t,e){if(!(t in n))return null;const i=Eo(n[t],Wr,e);return function(s){return TC(i(s),t)}}function sg(n,t,e){if(!(t in n))return null;const i=Eo(n[t],Wr|xe,e);return function(s){return oB(i(s),t)}}function tm(n,t){const e=n[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function nB(n,t){const e=n[t];if(e!==void 0){if(typeof e=="number")return Tn(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function sB(n,t){const e=n[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function yM(n,t){const e=n[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function _M(n,t){const e=n[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function rB(n,t){const e=n[t];if(e!==void 0)return Tf(e,t)}function rg(n,t){const e=n[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function aB(n,t){const e=n[t];if(e!==void 0)return SC(e,t)}function Tf(n,t){if(!Array.isArray(n))throw new Error(`Expected an array for ${t}`);const e=n.length;for(let i=0;i<e;++i)if(typeof n[i]!="number")throw new Error(`Expected an array of numbers for ${t}`);return n}function EC(n,t){if(typeof n!="string")throw new Error(`Expected a string for ${t}`);return n}function h_(n,t){if(typeof n!="number")throw new Error(`Expected a number for ${t}`);return n}function SC(n,t){if(typeof n=="string")return n;const e=Tf(n,t),i=e.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function TC(n,t){const e=Tf(n,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function oB(n,t){return typeof n=="number"?n:TC(n,t)}const xM={RENDER_ORDER:"renderOrder"};class hB extends ig{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(xM.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const i=this.getDeclutter();i in t.declutter||(t.declutter[i]=new cC(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(xM.RENDER_ORDER,t)}setStyle(t){this.style_=t===void 0?_C:t;const e=lB(t);this.styleFunction_=t===null?void 0:wz(e),this.changed()}}function lB(n){if(n===void 0)return _C;if(!n)return null;if(typeof n=="function"||n instanceof Hi)return n;if(!Array.isArray(n))return mM([n]);if(n.length===0)return[];const t=n.length,e=n[0];if(e instanceof Hi){const s=new Array(t);for(let r=0;r<t;++r){const a=n[r];if(!(a instanceof Hi))throw new Error("Expected a list of style instances");s[r]=a}return s}if("style"in e){const s=new Array(t);for(let r=0;r<t;++r){const a=n[r];if(!("style"in a))throw new Error("Expected a list of rules with a style property");s[r]=a}return jz(s)}return mM(n)}const CC=hB;class cB extends Vm{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){ke()}calculateMatrices2D(t){const e=t.viewState,i=t.coordinateToPixelTransform,s=t.pixelToCoordinateTransform;ka(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),tC(s,i)}forEachFeatureAtCoordinate(t,e,i,s,r,a,o,h){let l;const u=e.viewState;function f(R,I,L,k){return r.call(a,I,R?L:null,k)}const m=u.projection,g=hT(t.slice(),m),y=[[0,0]];if(m.canWrapX()&&s){const R=m.getExtent(),I=fi(R);y.push([-I,0],[I,0])}const _=e.layerStatesArray,w=_.length,M=[],T=[];for(let R=0;R<y.length;R++)for(let I=w-1;I>=0;--I){const L=_[I],k=L.layer;if(k.hasRenderer()&&rv(L,u)&&o.call(h,k)){const Y=k.getRenderer(),K=k.getSource();if(Y&&K){const rt=K.getWrapX()?g:t,ut=f.bind(null,L.managed);T[0]=rt[0]+y[R][0],T[1]=rt[1]+y[R][1],l=Y.forEachFeatureAtCoordinate(T,e,i,ut,M)}if(l)return l}}if(M.length===0)return;const A=1/M.length;return M.forEach((R,I)=>R.distanceSq+=I*A),M.sort((R,I)=>R.distanceSq-I.distanceSq),M.some(R=>l=R.callback(R.feature,R.layer,R.geometry)),l}hasFeatureAtCoordinate(t,e,i,s,r,a){return this.forEachFeatureAtCoordinate(t,e,i,s,ph,this,r,a)!==void 0}getMap(){return this.map_}renderFrame(t){ke()}scheduleExpireIconCache(t){Ta.canExpireCache()&&t.postRenderFunctions.push(uB)}}function uB(n,t){Ta.expire()}const dB=cB;class fB extends na{constructor(t,e,i,s){super(t),this.inversePixelTransform=e,this.frameState=i,this.context=s}}const Td=fB;class pB extends dB{constructor(t){super(t),this.fontChangeListenerKey_=ai(to,tu.PROPERTYCHANGE,t.redrawText.bind(t)),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=ng+" ol-layers";const i=t.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const i=this.getMap();if(i.hasListener(t)){const s=new Td(t,void 0,e);i.dispatchEvent(s)}}disposeInternal(){Li(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(Dn.PRECOMPOSE,t);const e=t.layerStatesArray.sort(function(o,h){return o.zIndex-h.zIndex});e.some(o=>o.layer instanceof CC&&o.layer.getDeclutter())&&(t.declutter={});const s=t.viewState;this.children_.length=0;const r=[];let a=null;for(let o=0,h=e.length;o<h;++o){const l=e[o];t.layerIndex=o;const u=l.layer,f=u.getSourceState();if(!rv(l,s)||f!="ready"&&f!="undefined"){u.unrender();continue}const m=u.render(t,a);!m||(m!==a&&(this.children_.push(m),a=m),r.push(l))}this.declutter(t,r),kD(this.element_,this.children_),this.dispatchRenderEvent(Dn.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,e){if(!!t.declutter){for(let i=e.length-1;i>=0;--i){const s=e[i],r=s.layer;r.getDeclutter()&&r.renderDeclutter(t,s)}e.forEach(i=>i.layer.renderDeferred(t))}}}const mB=pB;class Zo extends na{constructor(t,e){super(t),this.layer=e}}const Py={LAYERS:"layers"};class bv extends QT{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let i=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Py.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new Ur(i.slice(),{unique:!0}):ci(typeof i.getArray=="function","Expected `layers` to be an array or a `Collection`"):i=new Ur(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Li),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(ai(t,Fn.ADD,this.handleLayersAdd_,this),ai(t,Fn.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(Li);yl(this.listenerKeys_);const e=t.getArray();for(let i=0,s=e.length;i<s;i++){const r=e[i];this.registerLayerListeners_(r),this.dispatchEvent(new Zo("addlayer",r))}this.changed()}registerLayerListeners_(t){const e=[ai(t,tu.PROPERTYCHANGE,this.handleLayerChange_,this),ai(t,Ne.CHANGE,this.handleLayerChange_,this)];t instanceof bv&&e.push(ai(t,"addlayer",this.handleLayerGroupAdd_,this),ai(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[$e(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new Zo("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new Zo("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new Zo("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,i=$e(e);this.listenerKeys_[i].forEach(Li),delete this.listenerKeys_[i],this.dispatchEvent(new Zo("removelayer",e)),this.changed()}getLayers(){return this.get(Py.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const i=e.getArray();for(let s=0,r=i.length;s<r;++s)this.dispatchEvent(new Zo("removelayer",i[s]))}this.set(Py.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],i=e.length;this.getLayers().forEach(function(a){a.getLayerStatesArray(e)});const s=this.getLayerState();let r=s.zIndex;!t&&s.zIndex===void 0&&(r=0);for(let a=i,o=e.length;a<o;a++){const h=e[a];h.opacity*=s.opacity,h.visible=h.visible&&s.visible,h.maxResolution=Math.min(h.maxResolution,s.maxResolution),h.minResolution=Math.max(h.minResolution,s.minResolution),h.minZoom=Math.max(h.minZoom,s.minZoom),h.maxZoom=Math.min(h.maxZoom,s.maxZoom),s.extent!==void 0&&(h.extent!==void 0?h.extent=_r(h.extent,s.extent):h.extent=s.extent),h.zIndex===void 0&&(h.zIndex=r)}return e}getSourceState(){return"ready"}}const ag=bv;class gB extends na{constructor(t,e,i){super(t),this.map=e,this.frameState=i!==void 0?i:null}}const dc=gB;class yB extends dc{constructor(t,e,i,s,r,a){super(t,e,r),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=s!==void 0?s:!1,this.activePointers=a}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const eo=yB,wi={SINGLECLICK:"singleclick",CLICK:Ne.CLICK,DBLCLICK:Ne.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},l_={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class _B extends xf{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=ai(i,l_.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=ai(i,l_.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(Ne.TOUCHMOVE,this.boundHandleTouchMove_,KS?{passive:!1}:!1)}emulateClick_(t){let e=new eo(wi.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new eo(wi.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new eo(wi.SINGLECLICK,this.map_,t);this.dispatchEvent(i)},250)}updateActivePointers_(t){const e=t,i=e.pointerId;if(e.type==wi.POINTERUP||e.type==wi.POINTERCANCEL){delete this.trackedTouches_[i];for(const s in this.trackedTouches_)if(this.trackedTouches_[s].target!==e.target){delete this.trackedTouches_[s];break}}else(e.type==wi.POINTERDOWN||e.type==wi.POINTERMOVE)&&(this.trackedTouches_[i]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new eo(wi.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(Li),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new eo(wi.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(ai(i,wi.POINTERMOVE,this.handlePointerMove_,this),ai(i,wi.POINTERUP,this.handlePointerUp_,this),ai(this.element_,wi.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(ai(this.element_.getRootNode(),wi.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new eo(wi.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new eo(wi.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Li(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(Ne.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Li(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Li),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const xB=_B,io={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},ss={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},em=1/0;class vB{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,yl(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,i=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const s=this.keyFunction_(i);return delete this.queuedElements_[s],i}enqueue(t){ci(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=em?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,i=this.priorities_,s=e.length,r=e[t],a=i[t],o=t;for(;t<s>>1;){const h=this.getLeftChildIndex_(t),l=this.getRightChildIndex_(t),u=l<s&&i[l]<i[h]?l:h;e[t]=e[u],i[t]=i[u],t=u}e[t]=r,i[t]=a,this.siftDown_(o,t)}siftDown_(t,e){const i=this.elements_,s=this.priorities_,r=i[e],a=s[e];for(;e>t;){const o=this.getParentIndex_(e);if(s[o]>a)i[e]=i[o],s[e]=s[o],e=o;else break}i[e]=r,s[e]=a}reprioritize(){const t=this.priorityFunction_,e=this.elements_,i=this.priorities_;let s=0;const r=e.length;let a,o,h;for(o=0;o<r;++o)a=e[o],h=t(a),h==em?delete this.queuedElements_[this.keyFunction_(a)]:(i[s]=h,e[s++]=a);e.length=s,i.length=s,this.heapify_()}}const wB=vB;class bB extends wB{constructor(t,e){super(function(i){return t.apply(null,i)},function(i){return i[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(Ne.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,i=e.getState();if(i===le.LOADED||i===le.ERROR||i===le.EMPTY){i!==le.ERROR&&e.removeEventListener(Ne.CHANGE,this.boundHandleTileChange_);const s=e.getKey();s in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[s],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let i=0,s,r,a;for(;this.tilesLoading_<t&&i<e&&this.getCount()>0;)r=this.dequeue()[0],a=r.getKey(),s=r.getState(),s===le.IDLE&&!(a in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[a]=!0,++this.tilesLoading_,++i,r.load())}}const MB=bB;function EB(n,t,e,i,s){if(!n||!(e in n.wantedTiles)||!n.wantedTiles[e][t.getKey()])return em;const r=n.viewState.center,a=i[0]-r[0],o=i[1]-r[1];return 65536*Math.log(s)+Math.sqrt(a*a+o*o)/s}class SB extends sa{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){Up(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&Up(this.element);for(let e=0,i=this.listenerKeys.length;e<i;++e)Li(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==Zc&&this.listenerKeys.push(ai(t,io.POSTRENDER,this.render,this)),t.render())}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}const Mv=SB;class TB extends Mv{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const e=t.className!==void 0?t.className:"ol-attribution",i=t.tipLabel!==void 0?t.tipLabel:"Attributions",s=t.expandClassName!==void 0?t.expandClassName:e+"-expand",r=t.collapseLabel!==void 0?t.collapseLabel:"\u203A",a=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=a):this.collapseLabel_=r;const o=t.label!==void 0?t.label:"i";typeof o=="string"?(this.label_=document.createElement("span"),this.label_.textContent=o,this.label_.className=s):this.label_=o;const h=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(h),this.toggleButton_.addEventListener(Ne.CLICK,this.handleClick_.bind(this),!1);const l=e+" "+ng+" "+uv+(this.collapsed_&&this.collapsible_?" "+lM:"")+(this.collapsible_?"":" ol-uncollapsible"),u=this.element;u.className=l,u.appendChild(this.toggleButton_),u.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e=Array.from(new Set(this.getMap().getAllLayers().flatMap(s=>s.getAttributions(t)))),i=!this.getMap().getAllLayers().some(s=>s.getSource()&&s.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(i),e}async updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=await Promise.all(this.collectSourceAttributions_(t).map(s=>YS(()=>s))),i=e.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!Mh(e,this.renderedAttributions_)){JS(this.ulElement_);for(let s=0,r=e.length;s<r;++s){const a=document.createElement("li");a.innerHTML=e[s],this.ulElement_.appendChild(a)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(lM),this.collapsed_?Cb(this.collapseLabel_,this.label_):Cb(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}const CB=TB;class AB extends Mv{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",i=t.label!==void 0?t.label:"\u21E7",s=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=s,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(s));const r=t.tipLabel?t.tipLabel:"Reset rotation",a=document.createElement("button");a.className=e+"-reset",a.setAttribute("type","button"),a.title=r,a.appendChild(this.label_),a.addEventListener(Ne.CLICK,this.handleClick_.bind(this),!1);const o=e+" "+ng+" "+uv,h=this.element;h.className=o,h.appendChild(a),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(L0)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const i=e.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:fu}):e.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const i=e.viewState.rotation;if(i!=this.rotation_){const s="rotate("+i+"rad)";if(this.autoHide_){const r=this.element.classList.contains(L0);!r&&i===0?this.element.classList.add(L0):r&&i!==0&&this.element.classList.remove(L0)}this.label_.style.transform=s}this.rotation_=i}}const RB=AB;class IB extends Mv{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",i=t.delta!==void 0?t.delta:1,s=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",r=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",a=t.zoomInLabel!==void 0?t.zoomInLabel:"+",o=t.zoomOutLabel!==void 0?t.zoomOutLabel:"\u2013",h=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",l=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",u=document.createElement("button");u.className=s,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(Ne.CLICK,this.handleClick_.bind(this,i),!1);const f=document.createElement("button");f.className=r,f.setAttribute("type","button"),f.title=l,f.appendChild(typeof o=="string"?document.createTextNode(o):o),f.addEventListener(Ne.CLICK,this.handleClick_.bind(this,-i),!1);const m=e+" "+ng+" "+uv,g=this.element;g.className=m,g.appendChild(u),g.appendChild(f),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const i=this.getMap().getView();if(!i)return;const s=i.getZoom();if(s!==void 0){const r=i.getConstrainedZoom(s+t);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:r,duration:this.duration_,easing:fu})):i.setZoom(r)}}}const NB=IB;function kB(n){n=n||{};const t=new Ur;return(n.zoom!==void 0?n.zoom:!0)&&t.push(new NB(n.zoomOptions)),(n.rotate!==void 0?n.rotate:!0)&&t.push(new RB(n.rotateOptions)),(n.attribution!==void 0?n.attribution:!0)&&t.push(new CB(n.attributionOptions)),t}const c_={ACTIVE:"active"};class LB extends sa{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(c_.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(c_.ACTIVE,t)}setMap(t){this.map_=t}}function OB(n,t,e){const i=n.getCenterInternal();if(i){const s=[i[0]+t[0],i[1]+t[1]];n.animateInternal({duration:e!==void 0?e:250,easing:ED,center:n.getConstrainedCenter(s)})}}function Ev(n,t,e,i){const s=n.getZoom();if(s===void 0)return;const r=n.getConstrainedZoom(s+t),a=n.getResolutionForZoom(r);n.getAnimating()&&n.cancelAnimations(),n.animate({resolution:a,anchor:e,duration:i!==void 0?i:250,easing:fu})}const Ml=LB;class PB extends Ml{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==wi.DBLCLICK){const i=t.originalEvent,s=t.map,r=t.coordinate,a=i.shiftKey?-this.delta_:this.delta_,o=s.getView();Ev(o,a,r,this.duration_),i.preventDefault(),e=!0}return!e}}const FB=PB;class DB extends Ml{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==wi.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==wi.POINTERUP){const i=this.handleUpEvent(t);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(t.type==wi.POINTERDOWN){const i=this.handleDownEvent(t);this.handlingDownUpSequence=i,e=this.stopDown(i)}else t.type==wi.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function Sv(n){const t=n.length;let e=0,i=0;for(let s=0;s<t;s++)e+=n[s].clientX,i+=n[s].clientY;return{clientX:e/t,clientY:i/t}}const xu=DB;function u_(n){const t=arguments;return function(e){let i=!0;for(let s=0,r=t.length;s<r&&(i=i&&t[s](e),!!i);++s);return i}}const zB=function(n){const t=n.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},BB=function(n){const t=n.map.getTargetElement(),e=n.map.getOwnerDocument().activeElement;return t.contains(e)},AC=function(n){return n.map.getTargetElement().hasAttribute("tabindex")?BB(n):!0},d_=ph,RC=function(n){const t=n.originalEvent;return t.button==0&&!(RD&&qS&&t.ctrlKey)},f_=du,UB=function(n){return n.type==wi.SINGLECLICK},Tv=function(n){const t=n.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},GB=function(n){const t=n.originalEvent;return qS?t.metaKey:t.ctrlKey},Cv=function(n){const t=n.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},IC=function(n){const t=n.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},Fy=function(n){const t=n.originalEvent;return ci(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.pointerType=="mouse"},VB=function(n){const t=n.originalEvent;return ci(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.isPrimary&&t.button===0};class WB extends xu{constructor(t){super({stopDown:du}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:u_(Tv,VB);this.condition_=t.onFocusOnly?u_(AC,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const i=this.targetPointers,s=e.getEventPixel(Sv(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(s[0],s[1]),this.lastCentroid){const r=[this.lastCentroid[0]-s[0],s[1]-this.lastCentroid[1]],o=t.map.getView();t4(r,o.getResolution()),gx(r,o.getRotation()),o.adjustCenterInternal(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=s,this.lastPointersCount_=i.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,i=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const s=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),a=i.getCenterInternal(),o=e.getPixelFromCoordinateInternal(a),h=e.getCoordinateFromPixelInternal([o[0]-s*Math.cos(r),o[1]-s*Math.sin(r)]);i.animateInternal({center:i.getConstrainedCenter(h),duration:500,easing:fu})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const i=t.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}const $B=WB;class YB extends xu{constructor(t){t=t||{},super({stopDown:du}),this.condition_=t.condition?t.condition:zB,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!Fy(t))return;const e=t.map,i=e.getView();if(i.getConstraints().rotation===Hx)return;const s=e.getSize(),r=t.pixel,a=Math.atan2(s[1]/2-r[1],r[0]-s[0]/2);if(this.lastAngle_!==void 0){const o=a-this.lastAngle_;i.adjustRotationInternal(-o)}this.lastAngle_=a}handleUpEvent(t){return Fy(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return Fy(t)&&RC(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}const HB=YB;class qB extends Vm{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,i="px",s=this.element_.style;s.left=Math.min(t[0],e[0])+i,s.top=Math.min(t[1],e[1])+i,s.width=Math.abs(e[0]-t[0])+i,s.height=Math.abs(e[1]-t[1])+i}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const t=this.startPixel_,e=this.endPixel_,s=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);s[4]=s[0].slice(),this.geometry_?this.geometry_.setCoordinates([s]):this.geometry_=new ir([s])}getGeometry(){return this.geometry_}}const XB=qB,Qu={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class O0 extends na{constructor(t,e,i){super(t),this.coordinate=e,this.mapBrowserEvent=i}}class jB extends xu{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.box_=new XB(t.className||"ol-dragbox"),this.minArea_=t.minArea!==void 0?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:RC,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,i){const s=i[0]-e[0],r=i[1]-e[1];return s*s+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){!this.startPixel_||(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new O0(Qu.BOXDRAG,t.coordinate,t)))}handleUpEvent(t){if(!this.startPixel_)return!1;this.box_.setMap(null);const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new O0(e?Qu.BOXEND:Qu.BOXCANCEL,t.coordinate,t)),!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new O0(Qu.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}setActive(t){t||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new O0(Qu.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(t)}}const ZB=jB;class KB extends ZB{constructor(t){t=t||{};const e=t.condition?t.condition:Cv;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const i=this.getMap().getView();let s=this.getGeometry();if(this.out_){const r=i.rotatedExtentForGeometry(s),a=i.getResolutionForExtentInternal(r),o=i.getResolution()/a;s=s.clone(),s.scale(o*o)}i.fitInternal(s,{duration:this.duration_,easing:fu})}}const JB=KB,zh={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class QB extends Ml{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return Tv(e)&&IC(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==Ne.KEYDOWN){const i=t.originalEvent,s=i.key;if(this.condition_(t)&&(s==zh.DOWN||s==zh.LEFT||s==zh.RIGHT||s==zh.UP)){const a=t.map.getView(),o=a.getResolution()*this.pixelDelta_;let h=0,l=0;s==zh.DOWN?l=-o:s==zh.LEFT?h=-o:s==zh.RIGHT?h=o:l=o;const u=[h,l];gx(u,a.getRotation()),OB(a,u,this.duration_),i.preventDefault(),e=!0}}return!e}}const t9=QB;class e9 extends Ml{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(e){return!GB(e)&&IC(e)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==Ne.KEYDOWN||t.type==Ne.KEYPRESS){const i=t.originalEvent,s=i.key;if(this.condition_(t)&&(s==="+"||s==="-")){const r=t.map,a=s==="+"?this.delta_:-this.delta_,o=r.getView();Ev(o,a,void 0,this.duration_),i.preventDefault(),e=!0}}return!e}}const i9=e9;class n9{constructor(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let i=e-3;for(;i>0&&this.points_[i+2]>t;)i-=3;const s=this.points_[e+2]-this.points_[i+2];if(s<1e3/60)return!1;const r=this.points_[e]-this.points_[i],a=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(a,r),this.initialVelocity_=Math.sqrt(r*r+a*a)/s,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const s9=n9;class r9 extends Ml{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const e=t.condition?t.condition:d_;this.condition_=t.onFocusOnly?u_(AC,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t)||t.type!==Ne.WHEEL)return!0;const i=t.map,s=t.originalEvent;s.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate);let r;if(t.type==Ne.WHEEL&&(r=s.deltaY,TD&&s.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(r/=XS),s.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)),r===0)return!1;this.lastDelta_=r;const a=Date.now();this.startTime_===void 0&&(this.startTime_=a),(!this.mode_||a-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const o=i.getView();if(this.mode_==="trackpad"&&!(o.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(o.getAnimating()&&o.cancelAnimations(),o.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),o.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=a,!1;this.totalDelta_+=r;const h=Math.max(this.timeout_-(a-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),h),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let i=-Ui(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),Ev(e,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}const a9=r9;class o9 extends xu{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=du),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const i=this.targetPointers[0],s=this.targetPointers[1],r=Math.atan2(s.clientY-i.clientY,s.clientX-i.clientX);if(this.lastAngle_!==void 0){const h=r-this.lastAngle_;this.rotationDelta_+=h,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=h}this.lastAngle_=r;const a=t.map,o=a.getView();o.getConstraints().rotation!==Hx&&(this.anchor_=a.getCoordinateFromPixelInternal(a.getEventPixel(Sv(this.targetPointers))),this.rotating_&&(a.render(),o.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}const h9=o9;class l9 extends xu{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=du),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const i=this.targetPointers[0],s=this.targetPointers[1],r=i.clientX-s.clientX,a=i.clientY-s.clientY,o=Math.sqrt(r*r+a*a);this.lastDistance_!==void 0&&(e=this.lastDistance_/o),this.lastDistance_=o;const h=t.map,l=h.getView();e!=1&&(this.lastScaleDelta_=e),this.anchor_=h.getCoordinateFromPixelInternal(h.getEventPixel(Sv(this.targetPointers))),h.render(),l.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const i=t.map.getView(),s=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,s),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}const c9=l9;function u9(n){n=n||{};const t=new Ur,e=new s9(-.005,.05,100);return(n.altShiftDragRotate!==void 0?n.altShiftDragRotate:!0)&&t.push(new HB),(n.doubleClickZoom!==void 0?n.doubleClickZoom:!0)&&t.push(new FB({delta:n.zoomDelta,duration:n.zoomDuration})),(n.dragPan!==void 0?n.dragPan:!0)&&t.push(new $B({onFocusOnly:n.onFocusOnly,kinetic:e})),(n.pinchRotate!==void 0?n.pinchRotate:!0)&&t.push(new h9),(n.pinchZoom!==void 0?n.pinchZoom:!0)&&t.push(new c9({duration:n.zoomDuration})),(n.keyboard!==void 0?n.keyboard:!0)&&(t.push(new t9),t.push(new i9({delta:n.zoomDelta,duration:n.zoomDuration}))),(n.mouseWheelZoom!==void 0?n.mouseWheelZoom:!0)&&t.push(new a9({onFocusOnly:n.onFocusOnly,duration:n.zoomDuration})),(n.shiftDragZoom!==void 0?n.shiftDragZoom:!0)&&t.push(new JB({duration:n.zoomDuration})),t}function NC(n){if(n instanceof ig){n.setMapInternal(null);return}n instanceof ag&&n.getLayers().forEach(NC)}function kC(n,t){if(n instanceof ig){n.setMapInternal(t);return}if(n instanceof ag){const e=n.getLayers().getArray();for(let i=0,s=e.length;i<s;++i)kC(e[i],t)}}class d9 extends sa{constructor(t){super(),t=t||{},this.on,this.once,this.un;const e=f9(t);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:XS,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Ts(),this.pixelToCoordinateTransform_=Ts(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=e.controls||kB(),this.interactions=e.interactions||u9({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new MB(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(ss.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(ss.VIEW,this.handleViewChanged_),this.addChangeListener(ss.SIZE,this.handleSizeChanged_),this.addChangeListener(ss.TARGET,this.handleTargetChanged_),this.setProperties(e.values);const i=this;t.view&&!(t.view instanceof ba)&&t.view.then(function(s){i.setView(new ba(s))}),this.controls.addEventListener(Fn.ADD,s=>{s.element.setMap(this)}),this.controls.addEventListener(Fn.REMOVE,s=>{s.element.setMap(null)}),this.interactions.addEventListener(Fn.ADD,s=>{s.element.setMap(this)}),this.interactions.addEventListener(Fn.REMOVE,s=>{s.element.setMap(null)}),this.overlays_.addEventListener(Fn.ADD,s=>{this.addOverlayInternal_(s.element)}),this.overlays_.addEventListener(Fn.REMOVE,s=>{const r=s.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],s.element.setMap(null)}),this.controls.forEach(s=>{s.setMap(this)}),this.interactions.forEach(s=>{s.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){kC(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,i){if(!this.frameState_||!this.renderer_)return;const s=this.getCoordinateFromPixelInternal(t);i=i!==void 0?i:{};const r=i.hitTolerance!==void 0?i.hitTolerance:0,a=i.layerFilter!==void 0?i.layerFilter:ph,o=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(s,this.frameState_,r,o,e,null,a,null)}getFeaturesAtPixel(t,e){const i=[];return this.forEachFeatureAtPixel(t,function(s){i.push(s)},e),i}getAllLayers(){const t=[];function e(i){i.forEach(function(s){s instanceof ag?e(s.getLayers()):t.push(s)})}return e(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(t);e=e!==void 0?e:{};const s=e.layerFilter!==void 0?e.layerFilter:ph,r=e.hitTolerance!==void 0?e.hitTolerance:0,a=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,r,a,s,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const i=this.viewport_.getBoundingClientRect(),s=this.getSize(),r=i.width/s[0],a=i.height/s[1],o="changedTouches"in t?t.changedTouches[0]:t;return[(o.clientX-i.left)/r,(o.clientY-i.top)/a]}getTarget(){return this.get(ss.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return Yp(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?as(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(ss.LAYERGROUP)}setLayers(t){const e=this.getLayerGroup();if(t instanceof Ur){e.setLayers(t);return}const i=e.getLayers();i.clear(),i.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const s=t[e];if(!s.visible)continue;const r=s.layer.getRenderer();if(r&&!r.ready)return!0;const a=s.layer.getSource();if(a&&a.loading)return!0}return!1}getPixelFromCoordinate(t){const e=Fr(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?as(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(ss.SIZE)}getView(){return this.get(ss.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,i,s){return EB(this.frameState_,t,e,i,s)}handleBrowserEvent(t,e){e=e||t.type;const i=new eo(e,this,t);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,i=e.type;if(i===l_.POINTERDOWN||i===Ne.WHEEL||i===Ne.KEYDOWN){const s=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():s,a=e.target;if(this.overlayContainerStopEvent_.contains(a)||!(r===s?s.documentElement:r).contains(a))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){const s=this.getInteractions().getArray().slice();for(let r=s.length-1;r>=0;r--){const a=s[r];if(a.getMap()!==this||!a.getActive()||!this.getTargetElement())continue;if(!a.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let s=this.maxTilesLoading_,r=s;if(t){const a=t.viewHints;if(a[rs.ANIMATING]||a[rs.INTERACTING]){const o=Date.now()-t.time>8;s=o?0:8,r=o?0:2}}e.getTilesLoading()<s&&(e.reprioritize(),e.loadMoreTiles(s,r))}t&&this.renderer_&&!t.animate&&(this.renderComplete_===!0?(this.hasListener(Dn.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Dn.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new dc(io.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new dc(io.LOADSTART,this,t))));const i=this.postRenderFunctions_;for(let s=0,r=i.length;s<r;++s)i[s](this,t);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,s=this.targetChangeHandlerKeys_.length;i<s;++i)Li(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(Ne.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(Ne.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,Up(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host),this.setSize(void 0)}const t=this.getTarget(),e=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=e,!e)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new mB(this)),this.mapBrowserEventHandler_=new xB(this,this.moveTolerance_);for(const r in wi)this.mapBrowserEventHandler_.addEventListener(wi[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(Ne.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(Ne.WHEEL,this.boundHandleBrowserEvent_,KS?{passive:!1}:!1);const i=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.targetChangeHandlerKeys_=[ai(i,Ne.KEYDOWN,this.handleBrowserEvent,this),ai(i,Ne.KEYPRESS,this.handleBrowserEvent,this)];const s=e.getRootNode();s instanceof ShadowRoot&&this.resizeObserver_.observe(s.host),this.resizeObserver_.observe(e)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Li(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Li(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=ai(t,tu.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=ai(t,Ne.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Li),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new Zo("addlayer",t)),this.layerGroupPropertyListenerKeys_=[ai(t,tu.PROPERTYCHANGE,this.render,this),ai(t,Ne.CHANGE,this.render,this),ai(t,"addlayer",this.handleLayerAdd_,this),ai(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const s=t[e].layer;s.hasRenderer()&&s.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){NC(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),i=this.getView(),s=this.frameState_;let r=null;if(e!==void 0&&Gb(e)&&i&&i.isDef()){const a=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),o=i.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:X1(o.center,o.resolution,o.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:o,viewHints:a,wantedTiles:{},mapId:$e(this),renderTargets:{}},o.nextCenter&&o.nextResolution){const h=isNaN(o.nextRotation)?o.rotation:o.nextRotation;r.nextExtent=X1(o.nextCenter,o.nextResolution,h,e)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),s&&(!this.previousExtent_||!wf(this.previousExtent_)&&!Wp(r.extent,this.previousExtent_))&&(this.dispatchEvent(new dc(io.MOVESTART,this,s)),this.previousExtent_=vf(this.previousExtent_)),this.previousExtent_&&!r.viewHints[rs.ANIMATING]&&!r.viewHints[rs.INTERACTING]&&!Wp(r.extent,this.previousExtent_)&&(this.dispatchEvent(new dc(io.MOVEEND,this,r)),tT(r.extent,this.previousExtent_))),this.dispatchEvent(new dc(io.POSTRENDER,this,r)),this.renderComplete_=this.hasListener(io.LOADSTART)||this.hasListener(io.LOADEND)||this.hasListener(Dn.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new Zo("removelayer",e)),this.set(ss.LAYERGROUP,t)}setSize(t){this.set(ss.SIZE,t)}setTarget(t){this.set(ss.TARGET,t)}setView(t){if(!t||t instanceof ba){this.set(ss.VIEW,t);return}this.set(ss.VIEW,new ba);const e=this;t.then(function(i){e.setView(new ba(i))})}updateSize(){const t=this.getTargetElement();let e;if(t){const s=getComputedStyle(t),r=t.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),a=t.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth);!isNaN(r)&&!isNaN(a)&&(e=[r,a],!Gb(e)&&!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&uT("No map visible because the map container's width or height are 0."))}const i=this.getSize();e&&(!i||!Mh(e,i))&&(this.setSize(e),this.updateViewportSize_(e))}updateViewportSize_(t){const e=this.getView();e&&e.setViewportSize(t)}}function f9(n){let t=null;n.keyboardEventTarget!==void 0&&(t=typeof n.keyboardEventTarget=="string"?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);const e={},i=n.layers&&typeof n.layers.getLayers=="function"?n.layers:new ag({layers:n.layers});e[ss.LAYERGROUP]=i,e[ss.TARGET]=n.target,e[ss.VIEW]=n.view instanceof ba?n.view:new ba;let s;n.controls!==void 0&&(Array.isArray(n.controls)?s=new Ur(n.controls.slice()):(ci(typeof n.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),s=n.controls));let r;n.interactions!==void 0&&(Array.isArray(n.interactions)?r=new Ur(n.interactions.slice()):(ci(typeof n.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),r=n.interactions));let a;return n.overlays!==void 0?Array.isArray(n.overlays)?a=new Ur(n.overlays.slice()):(ci(typeof n.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),a=n.overlays):a=new Ur,{controls:s,interactions:r,keyboardEventTarget:t,overlays:a,values:e}}const p9=d9,P0={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class m9 extends ig{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getPreload(){return this.get(P0.PRELOAD)}setPreload(t){this.set(P0.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(P0.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(P0.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}const g9=m9;class y9 extends lx{constructor(t,e,i,s,r,a,o,h,l,u,f,m){super(r,le.IDLE,m),this.renderEdges_=f!==void 0?f:!1,this.pixelRatio_=o,this.gutter_=h,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=s,this.wrappedTileCoord_=a||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;const g=s.getTileCoordExtent(this.wrappedTileCoord_),y=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const w=y?_r(g,y):g;if(Vd(w)===0){this.state=le.EMPTY;return}const M=t.getExtent();M&&(_?_=_r(_,M):_=M);const T=s.getResolution(this.wrappedTileCoord_[0]),A=mT(t,i,w,T);if(!isFinite(A)||A<=0){this.state=le.EMPTY;return}const R=u!==void 0?u:QS;if(this.triangulation_=new pT(t,i,w,_,A*R,T),this.triangulation_.getTriangles().length===0){this.state=le.EMPTY;return}this.sourceZ_=e.getZForResolution(A);let I=this.triangulation_.calculateSourceExtent();if(_&&(t.canWrapX()?(I[1]=Ui(I[1],_[1],_[3]),I[3]=Ui(I[3],_[1],_[3])):I=_r(I,_)),!Vd(I))this.state=le.EMPTY;else{let L=0,k=0;t.canWrapX()&&(L=fi(M),k=Math.floor((I[0]-M[0])/L)),mx(I.slice(),t,!0).forEach(K=>{const rt=e.getTileRangeForExtentAndZ(K,this.sourceZ_);for(let ut=rt.minX;ut<=rt.maxX;ut++)for(let Z=rt.minY;Z<=rt.maxY;Z++){const ht=l(this.sourceZ_,ut,Z,o);if(ht){const O=k*L;this.sourceTiles_.push({tile:ht,offset:O})}}++k}),this.sourceTiles_.length===0&&(this.state=le.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{var s;const i=e.tile;if(i&&i.getState()==le.LOADED){const r=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);r[0]+=e.offset,r[2]+=e.offset;const a=(s=this.clipExtent_)==null?void 0:s.slice();a&&(a[0]+=e.offset,a[2]+=e.offset),t.push({extent:r,clipExtent:a,image:i.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=le.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),s=typeof i=="number"?i:i[0],r=typeof i=="number"?i:i[1],a=this.targetTileGrid_.getResolution(e),o=this.sourceTileGrid_.getResolution(this.sourceZ_),h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=gT(s,r,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),a,h,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=le.LOADED}this.changed()}load(){if(this.state==le.IDLE){this.state=le.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const i=e.getState();if(i==le.IDLE||i==le.LOADING){t++;const s=ai(e,Ne.CHANGE,function(r){const a=e.getState();(a==le.LOADED||a==le.ERROR||a==le.EMPTY)&&(Li(s),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(s)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},i,s){e.getState()==le.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Li),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Kc(this.canvas_.getContext("2d")),uo.push(this.canvas_),this.canvas_=null),super.release()}}const og=y9;class _9 extends lx{constructor(t,e,i,s,r,a){super(t,e,a),this.crossOrigin_=s,this.src_=i,this.key=i,this.image_=new Image,s!==null&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(t){this.image_=t,this.state=le.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=le.ERROR,this.unlistenImage_(),this.image_=x9(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=le.LOADED:this.state=le.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==le.ERROR&&(this.state=le.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==le.IDLE&&(this.state=le.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=hz(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function x9(){const n=yn(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}const Av=_9;class v9 extends xf{constructor(t){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=t.gutter||0,this.helper_=t.helper,this.loaded=!1,this.ready=!1}setTile(t){if(t!==this.tile)if(this.tile&&this.tile.removeEventListener(Ne.CHANGE,this.handleTileChange_),this.tile=t,this.loaded=t.getState()===le.LOADED,this.loaded)this.uploadTile();else{if(t instanceof Av){const e=t.getImage();e instanceof Image&&!e.crossOrigin&&(e.crossOrigin="anonymous")}t.addEventListener(Ne.CHANGE,this.handleTileChange_)}}uploadTile(){ke()}setReady(){this.ready=!0,this.dispatchEvent(Ne.CHANGE)}handleTileChange_(){this.tile.getState()===le.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(Ne.CHANGE,this.handleTileChange_)}}const w9=v9,Rv=34962,Iv=34963,b9=35040,Nv=35044,M9=35048,E9=5121,S9=5123,T9=5125,LC=5126,vM=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function C9(n,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!AD},t);const e=vM.length;for(let i=0;i<e;++i)try{const s=n.getContext(vM[i],t);if(s)return s}catch{}return null}const A9={STATIC_DRAW:Nv,STREAM_DRAW:b9,DYNAMIC_DRAW:M9};class R9{constructor(t,e){this.array_=null,this.type_=t,ci(t===Rv||t===Iv,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=e!==void 0?e:A9.STATIC_DRAW}ofSize(t){return this.array_=new(Dy(this.type_))(t),this}fromArray(t){return this.array_=Dy(this.type_).from(t),this}fromArrayBuffer(t){return this.array_=new(Dy(this.type_))(t),this}getType(){return this.type_}getArray(){return this.array_}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function Dy(n){switch(n){case Rv:return Float32Array;case Iv:return Uint32Array;default:return Float32Array}}const OC=R9;function PC(n,t,e){const i=e?n.LINEAR:n.NEAREST;n.bindTexture(n.TEXTURE_2D,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,i)}function I9(n,t,e,i){PC(n,t,i),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e)}function wM(n,t,e,i,s,r){const a=n.getGL();let o,h;e instanceof Float32Array?(o=a.FLOAT,n.getExtension("OES_texture_float"),h=n.getExtension("OES_texture_float_linear")!==null):(o=a.UNSIGNED_BYTE,h=!0),PC(a,t,r&&h);const l=e.byteLength/i[1];let u=1;l%8===0?u=8:l%4===0?u=4:l%2===0&&(u=2);let f;switch(s){case 1:{f=a.LUMINANCE;break}case 2:{f=a.LUMINANCE_ALPHA;break}case 3:{f=a.RGB;break}case 4:{f=a.RGBA;break}default:throw new Error(`Unsupported number of bands: ${s}`)}const m=a.getParameter(a.UNPACK_ALIGNMENT);a.pixelStorei(a.UNPACK_ALIGNMENT,u),a.texImage2D(a.TEXTURE_2D,0,f,i[0],i[1],0,f,o,e),a.pixelStorei(a.UNPACK_ALIGNMENT,m)}let fc=null;function N9(){fc=yn(1,1,void 0,{willReadFrequently:!0})}class k9 extends w9{constructor(t){super(t),this.textures=[],this.renderSize_=Tn(t.grid.getTileSize(t.tile.tileCoord[0])),this.bandCount=NaN;const e=new OC(Rv,Nv);e.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(e),this.coords=e,this.setTile(t.tile)}uploadTile(){const t=this.helper_,e=t.getGL(),i=this.tile;this.textures.length=0;let s;i instanceof Av||i instanceof og?s=i.getImage():s=i.getData();const r=Gp(s);if(r){const T=e.createTexture();this.textures.push(T),this.bandCount=4,I9(e,T,r,i.interpolate),this.setReady();return}s=H1(s);const a=i.getSize(),o=[a[0]+2*this.gutter_,a[1]+2*this.gutter_],h=s instanceof Float32Array,l=o[0]*o[1],u=h?Float32Array:Uint8Array,f=u.BYTES_PER_ELEMENT,m=s.byteLength/o[1];this.bandCount=Math.floor(m/f/o[0]);const g=Math.ceil(this.bandCount/4);if(g===1){const T=e.createTexture();this.textures.push(T),wM(t,T,s,o,this.bandCount,i.interpolate),this.setReady();return}const y=new Array(g);for(let T=0;T<g;++T){const A=e.createTexture();this.textures.push(A);const R=T<g-1?4:(this.bandCount-1)%4+1;y[T]=new u(l*R)}let _=0,w=0;const M=o[0]*this.bandCount;for(let T=0;T<o[1];++T){for(let A=0;A<M;++A){const R=s[w+A],I=Math.floor(_/this.bandCount),L=A%this.bandCount,k=Math.floor(L/4),Y=y[k],K=Y.length/l,rt=L%4;Y[I*K+rt]=R,++_}w+=m/f}for(let T=0;T<g;++T){const A=this.textures[T],R=y[T],I=R.length/l;wM(t,A,R,o,I,i.interpolate)}this.setReady()}disposeInternal(){const t=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let e=0;e<this.textures.length;++e)t.deleteTexture(this.textures[e]);this.tile.removeEventListener(Ne.CHANGE,this.handleTileChange_)}getImagePixelData_(t,e,i){const s=this.gutter_,r=this.renderSize_[0],a=this.renderSize_[1];fc||N9(),fc.clearRect(0,0,1,1);const o=t.width,h=t.height,l=o-2*s,u=h-2*s,f=s+Math.floor(l*(e/r)),m=s+Math.floor(u*(i/a));let g;try{fc.drawImage(t,f,m,1,1,0,0,1,1),g=fc.getImageData(0,0,1,1).data}catch{return fc=null,null}return g}getArrayPixelData_(t,e,i,s){const r=this.gutter_,a=this.renderSize_[0],o=this.renderSize_[1],h=e[0],l=e[1],u=h+2*r,f=l+2*r,m=r+Math.floor(h*(i/a)),g=r+Math.floor(l*(s/o));if(t instanceof DataView){const _=t.byteLength/(u*f),w=_*(g*u+m),M=t.buffer.slice(w,w+_);return new DataView(M)}const y=this.bandCount*(g*u+m);return t.slice(y,y+this.bandCount)}getPixelData(t,e){if(!this.loaded)return null;if(this.tile instanceof cx){const i=this.tile.getData(),s=H1(i);if(s){const r=this.tile.getSize();return this.getArrayPixelData_(s,r,t,e)}return this.getImagePixelData_(Gp(i),t,e)}return this.getImagePixelData_(this.tile.getImage(),t,e)}}const L9=k9;class O9 extends _T{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t}getFeatures(t){return ke()}getData(t){return null}prepareFrame(t){return ke()}renderFrame(t,e){return ke()}loadedTileCallback(t,e,i){t[e]||(t[e]={}),t[e][i.tileCoord.toString()]=i}createLoadedTileFinder(t,e,i){return(s,r)=>{const a=this.loadedTileCallback.bind(this,i,s);return t.forEachLoadedTile(e,s,r,a)}}forEachFeatureAtCoordinate(t,e,i,s,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===Ge.LOADED||e.getState()===Ge.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=Ge.LOADED&&e!=Ge.ERROR&&t.addEventListener(Ne.CHANGE,this.boundHandleImageChange_),e==Ge.IDLE&&(t.load(),e=t.getState()),e==Ge.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const FC=O9,F0={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},P9=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,F9=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class D9{constructor(t){this.gl_=t.webGlContext;const e=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=e.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=e.createFramebuffer(),this.depthBuffer_=e.createRenderbuffer();const i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,t.vertexShader||P9),e.compileShader(i);const s=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(s,t.fragmentShader||F9),e.compileShader(s),this.renderTargetProgram_=e.createProgram(),e.attachShader(this.renderTargetProgram_,i),e.attachShader(this.renderTargetProgram_,s),e.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=e.createBuffer();const r=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];e.bindBuffer(e.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),e.bufferData(e.ARRAY_BUFFER,new Float32Array(r),e.STATIC_DRAW),this.renderTargetAttribLocation_=e.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(a=>{this.uniforms_.push({value:t.uniforms[a],location:e.getUniformLocation(this.renderTargetProgram_,a)})})}getGL(){return this.gl_}init(t){const e=this.getGL(),i=[e.drawingBufferWidth*this.scaleRatio_,e.drawingBufferHeight*this.scaleRatio_];if(e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer()),e.bindRenderbuffer(e.RENDERBUFFER,this.getDepthBuffer()),e.viewport(0,0,i[0],i[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==i[0]||this.renderTargetTextureSize_[1]!==i[1]){this.renderTargetTextureSize_=i;const s=0,r=e.RGBA,a=0,o=e.RGBA,h=e.UNSIGNED_BYTE,l=null;e.bindTexture(e.TEXTURE_2D,this.renderTargetTexture_),e.texImage2D(e.TEXTURE_2D,s,r,i[0],i[1],a,o,h,l),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.renderTargetTexture_,0),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,i[0],i[1]),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthBuffer_)}}apply(t,e,i,s){const r=this.getGL(),a=t.size;if(r.bindFramebuffer(r.FRAMEBUFFER,e?e.getFrameBuffer():null),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.renderTargetTexture_),!e){const h=$e(r.canvas);if(!t.renderTargets[h]){const l=r.getContextAttributes();l&&l.preserveDrawingBuffer&&(r.clearColor(0,0,0,0),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)),t.renderTargets[h]=!0}}r.disable(r.DEPTH_TEST),r.enable(r.BLEND),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.bindBuffer(r.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),r.useProgram(this.renderTargetProgram_),r.enableVertexAttribArray(this.renderTargetAttribLocation_),r.vertexAttribPointer(this.renderTargetAttribLocation_,2,r.FLOAT,!1,0,0),r.uniform2f(this.renderTargetUniformLocation_,a[0],a[1]),r.uniform1i(this.renderTargetTextureLocation_,0);const o=t.layerStatesArray[t.layerIndex].opacity;r.uniform1f(this.renderTargetOpacityLocation_,o),this.applyUniforms(t),i&&i(r,t),r.drawArrays(r.TRIANGLES,0,6),s&&s(r,t)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(t){const e=this.getGL();let i,s=1;this.uniforms_.forEach(function(r){if(i=typeof r.value=="function"?r.value(t):r.value,i instanceof HTMLCanvasElement||i instanceof ImageData)r.texture||(r.texture=e.createTexture()),e.activeTexture(e[`TEXTURE${s}`]),e.bindTexture(e.TEXTURE_2D,r.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),i instanceof ImageData?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,i.width,i.height,0,e.UNSIGNED_BYTE,new Uint8Array(i.data)):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i),e.uniform1i(r.location,s++);else if(Array.isArray(i))switch(i.length){case 2:e.uniform2f(r.location,i[0],i[1]);return;case 3:e.uniform3f(r.location,i[0],i[1],i[2]);return;case 4:e.uniform4f(r.location,i[0],i[1],i[2],i[3]);return;default:return}else typeof i=="number"&&e.uniform1f(r.location,i)})}}const bM=D9;function DC(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function zC(n,t){return n[0]=t[0],n[1]=t[1],n[4]=t[2],n[5]=t[3],n[12]=t[4],n[13]=t[5],n}const Bo={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},_d={UNSIGNED_BYTE:E9,UNSIGNED_SHORT:S9,UNSIGNED_INT:T9,FLOAT:LC},im={};function MM(n){return"shared/"+n}let EM=0;function z9(){const n="unique/"+EM;return EM+=1,n}function B9(n){let t=im[n];if(!t){const e=document.createElement("canvas");e.width=1,e.height=1,e.style.position="absolute",e.style.left="0",t={users:0,context:C9(e)},im[n]=t}return t.users+=1,t.context}function U9(n){const t=im[n];if(!t||(t.users-=1,t.users>0))return;const e=t.context,i=e.getExtension("WEBGL_lose_context");i&&i.loseContext();const s=e.canvas;s.width=1,s.height=1,delete im[n]}class G9 extends Vm{constructor(t){super(),t=t||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=t.canvasCacheKey?MM(t.canvasCacheKey):z9(),this.gl_=B9(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const e=this.gl_.canvas;e.addEventListener(F0.LOST,this.boundHandleWebGLContextLost_),e.addEventListener(F0.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=Ts(),this.offsetScaleMatrix_=Ts(),this.tmpMat4_=DC(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],t.uniforms&&this.setUniforms(t.uniforms),this.postProcessPasses_=t.postProcesses?t.postProcesses.map(i=>new bM({webGlContext:this.gl_,scaleRatio:i.scaleRatio,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,uniforms:i.uniforms})):[new bM({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(t){this.uniforms_=[],this.addUniforms(t)}addUniforms(t){for(const e in t)this.uniforms_.push({name:e,value:t[e]})}canvasCacheKeyMatches(t){return this.canvasCacheKey_===MM(t)}getExtension(t){if(t in this.extensionCache_)return this.extensionCache_[t];const e=this.gl_.getExtension(t);return this.extensionCache_[t]=e,e}bindBuffer(t){const e=this.gl_,i=$e(t);let s=this.bufferCache_[i];if(!s){const r=e.createBuffer();s={buffer:t,webGlBuffer:r},this.bufferCache_[i]=s}e.bindBuffer(t.getType(),s.webGlBuffer)}flushBufferData(t){const e=this.gl_;this.bindBuffer(t),e.bufferData(t.getType(),t.getArray(),t.getUsage())}deleteBuffer(t){const e=this.gl_,i=$e(t),s=this.bufferCache_[i];s&&!e.isContextLost()&&e.deleteBuffer(s.webGlBuffer),delete this.bufferCache_[i]}disposeInternal(){const t=this.gl_.canvas;t.removeEventListener(F0.LOST,this.boundHandleWebGLContextLost_),t.removeEventListener(F0.RESTORED,this.boundHandleWebGLContextRestored_),U9(this.canvasCacheKey_),delete this.gl_}prepareDraw(t,e,i){const s=this.gl_,r=this.getCanvas(),a=t.size,o=t.pixelRatio;(r.width!==a[0]*o||r.height!==a[1]*o)&&(r.width=a[0]*o,r.height=a[1]*o,r.style.width=a[0]+"px",r.style.height=a[1]+"px");for(let h=this.postProcessPasses_.length-1;h>=0;h--)this.postProcessPasses_[h].init(t);s.bindTexture(s.TEXTURE_2D,null),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,e?s.ZERO:s.ONE_MINUS_SRC_ALPHA),i?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}bindTexture(t,e,i){const s=this.gl_;s.activeTexture(s.TEXTURE0+e),s.bindTexture(s.TEXTURE_2D,t),s.uniform1i(this.getUniformLocation(i),e)}prepareDrawToRenderTarget(t,e,i,s){const r=this.gl_,a=e.getSize();r.bindFramebuffer(r.FRAMEBUFFER,e.getFramebuffer()),r.bindRenderbuffer(r.RENDERBUFFER,e.getDepthbuffer()),r.viewport(0,0,a[0],a[1]),r.bindTexture(r.TEXTURE_2D,e.getTexture()),r.clearColor(0,0,0,0),r.depthRange(0,1),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,i?r.ZERO:r.ONE_MINUS_SRC_ALPHA),s?(r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL)):r.disable(r.DEPTH_TEST)}drawElements(t,e){const i=this.gl_;this.getExtension("OES_element_index_uint");const s=i.UNSIGNED_INT,r=4,a=e-t,o=t*r;i.drawElements(i.TRIANGLES,a,s,o)}finalizeDraw(t,e,i){for(let s=0,r=this.postProcessPasses_.length;s<r;s++)s===r-1?this.postProcessPasses_[s].apply(t,null,e,i):this.postProcessPasses_[s].apply(t,this.postProcessPasses_[s+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(t){const e=t.size,i=t.viewState.rotation,s=t.pixelRatio;this.setUniformFloatValue(Bo.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(Bo.ZOOM,t.viewState.zoom),this.setUniformFloatValue(Bo.RESOLUTION,t.viewState.resolution),this.setUniformFloatValue(Bo.PIXEL_RATIO,s),this.setUniformFloatVec2(Bo.VIEWPORT_SIZE_PX,[e[0],e[1]]),this.setUniformFloatValue(Bo.ROTATION,i)}applyHitDetectionUniform(t){const e=this.getUniformLocation(Bo.HIT_DETECTION);this.getGL().uniform1i(e,t?1:0),t&&this.setUniformFloatValue(Bo.PIXEL_RATIO,.5)}applyUniforms(t){const e=this.gl_;let i,s=0;this.uniforms_.forEach(r=>{if(i=typeof r.value=="function"?r.value(t):r.value,i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof ImageData||i instanceof WebGLTexture){i instanceof WebGLTexture&&!r.texture?(r.prevValue=void 0,r.texture=i):r.texture||(r.prevValue=void 0,r.texture=e.createTexture()),this.bindTexture(r.texture,s,r.name),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const a=!(i instanceof HTMLImageElement)||i.complete;!(i instanceof WebGLTexture)&&a&&r.prevValue!==i&&(r.prevValue=i,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i)),s++}else if(Array.isArray(i)&&i.length===6)this.setUniformMatrixValue(r.name,zC(this.tmpMat4_,i));else if(Array.isArray(i)&&i.length<=4)switch(i.length){case 2:e.uniform2f(this.getUniformLocation(r.name),i[0],i[1]);return;case 3:e.uniform3f(this.getUniformLocation(r.name),i[0],i[1],i[2]);return;case 4:e.uniform4f(this.getUniformLocation(r.name),i[0],i[1],i[2],i[3]);return;default:return}else typeof i=="number"&&e.uniform1f(this.getUniformLocation(r.name),i)})}useProgram(t,e){this.gl_.useProgram(t),this.currentProgram_=t,this.applyFrameState(e),this.applyUniforms(e)}compileShader(t,e){const i=this.gl_,s=i.createShader(e);return i.shaderSource(s,t),i.compileShader(s),s}getProgram(t,e){const i=this.gl_,s=this.compileShader(t,i.FRAGMENT_SHADER),r=this.compileShader(e,i.VERTEX_SHADER),a=i.createProgram();if(i.attachShader(a,s),i.attachShader(a,r),i.linkProgram(a),!i.getShaderParameter(s,i.COMPILE_STATUS)){const o=`Fragment shader compilation failed: ${i.getShaderInfoLog(s)}`;throw new Error(o)}if(i.deleteShader(s),!i.getShaderParameter(r,i.COMPILE_STATUS)){const o=`Vertex shader compilation failed: ${i.getShaderInfoLog(r)}`;throw new Error(o)}if(i.deleteShader(r),!i.getProgramParameter(a,i.LINK_STATUS)){const o=`GL program linking failed: ${i.getProgramInfoLog(a)}`;throw new Error(o)}return a}getUniformLocation(t){const e=$e(this.currentProgram_);return this.uniformLocationsByProgram_[e]===void 0&&(this.uniformLocationsByProgram_[e]={}),this.uniformLocationsByProgram_[e][t]===void 0&&(this.uniformLocationsByProgram_[e][t]=this.gl_.getUniformLocation(this.currentProgram_,t)),this.uniformLocationsByProgram_[e][t]}getAttributeLocation(t){const e=$e(this.currentProgram_);return this.attribLocationsByProgram_[e]===void 0&&(this.attribLocationsByProgram_[e]={}),this.attribLocationsByProgram_[e][t]===void 0&&(this.attribLocationsByProgram_[e][t]=this.gl_.getAttribLocation(this.currentProgram_,t)),this.attribLocationsByProgram_[e][t]}makeProjectionTransform(t,e){const i=t.size,s=t.viewState.rotation,r=t.viewState.resolution,a=t.viewState.center;return ka(e,0,0,2/(r*i[0]),2/(r*i[1]),-s,-a[0],-a[1]),e}setUniformFloatValue(t,e){this.gl_.uniform1f(this.getUniformLocation(t),e)}setUniformFloatVec2(t,e){this.gl_.uniform2fv(this.getUniformLocation(t),e)}setUniformFloatVec4(t,e){this.gl_.uniform4fv(this.getUniformLocation(t),e)}setUniformMatrixValue(t,e){this.gl_.uniformMatrix4fv(this.getUniformLocation(t),!1,e)}enableAttributeArray_(t,e,i,s,r){const a=this.getAttributeLocation(t);a<0||(this.gl_.enableVertexAttribArray(a),this.gl_.vertexAttribPointer(a,e,i,!1,s,r))}enableAttributes(t){const e=V9(t);let i=0;for(let s=0;s<t.length;s++){const r=t[s];this.enableAttributeArray_(r.name,r.size,r.type||LC,e,i),i+=r.size*BC(r.type)}}handleWebGLContextLost(t){yl(this.bufferCache_),this.currentProgram_=null,t.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(t,e,i){const s=this.gl_;i=i||s.createTexture();const r=0,a=s.RGBA,o=0,h=s.RGBA,l=s.UNSIGNED_BYTE;return s.bindTexture(s.TEXTURE_2D,i),e?s.texImage2D(s.TEXTURE_2D,r,a,h,l,e):s.texImage2D(s.TEXTURE_2D,r,a,t[0],t[1],o,h,l,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),i}}function V9(n){let t=0;for(let e=0;e<n.length;e++){const i=n[e];t+=i.size*BC(i.type)}return t}function BC(n){switch(n){case _d.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case _d.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case _d.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case _d.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class kv extends FC{constructor(t,e){super(t),e=e||{},this.inversePixelTransform_=Ts(),this.pixelContext_=null,this.postProcesses_=e.postProcesses,this.uniforms_=e.uniforms,this.helper,t.addChangeListener(vi.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(t,e){const i=this.getLayer();if(i.hasListener(Dn.PRECOMPOSE)){const s=new Td(Dn.PRECOMPOSE,void 0,e,t);i.dispatchEvent(s)}}dispatchPostComposeEvent(t,e){const i=this.getLayer();if(i.hasListener(Dn.POSTCOMPOSE)){const s=new Td(Dn.POSTCOMPOSE,void 0,e,t);i.dispatchEvent(s)}}reset(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(t){if(this.getLayer().getRenderSource()){let e=!0,i=-1,s;for(let a=0,o=t.layerStatesArray.length;a<o;a++){const h=t.layerStatesArray[a].layer,l=h.getRenderer();if(!(l instanceof kv)){e=!0;continue}const u=h.getClassName();if((e||u!==s)&&(i+=1,e=!1),s=u,l===this)break}const r="map/"+t.mapId+"/group/"+i;(!this.helper||!this.helper.canvasCacheKeyMatches(r)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new G9({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:r}),s&&(this.helper.getCanvas().className=s),this.afterHelperCreated())}return this.prepareFrameInternal(t)}afterHelperCreated(){}prepareFrameInternal(t){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(t,e,i){const s=this.getLayer();if(s.hasListener(t)){ka(this.inversePixelTransform_,0,0,i.pixelRatio,-i.pixelRatio,0,0,-i.size[1]);const r=new Td(t,this.inversePixelTransform_,i,e);s.dispatchEvent(r)}}preRender(t,e){this.dispatchRenderEvent_(Dn.PRERENDER,t,e)}postRender(t,e){this.dispatchRenderEvent_(Dn.POSTRENDER,t,e)}}const W9=kv,$9={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},Y9={};function SM(n){return 1/(n+2)}function H9(){return{tileIds:new Set,representationsByZ:{}}}function TM(n,t){return n.tileIds.has($e(t))}function CM(n,t,e){const i=n.representationsByZ;e in i||(i[e]=new Set),i[e].add(t),n.tileIds.add($e(t.tile))}function zy(n,t){const e=n.layerStatesArray[n.layerIndex];e.extent&&(t=_r(t,jh(e.extent,n.viewState.projection)));const i=e.layer.getRenderSource();if(!i.getWrapX()){const s=i.getTileGridForProjection(n.viewState.projection).getExtent();s&&(t=_r(t,s))}return t}function p_(n,t){return`${n.getKey()},${Ko(t)}`}class q9 extends W9{constructor(t,e){super(t,{uniforms:e.uniforms,postProcesses:e.postProcesses}),this.renderComplete=!1,this.tileTransform_=Ts(),this.tempMat4=DC(),this.tempTileRange_=new wT(0,0,0,0),this.tempTileCoord_=qp(0,0,0),this.tempSize_=[0,0];const i=e.cacheSize!==void 0?e.cacheSize:512;this.tileRepresentationCache=new yT(i),this.frameState=null,this.projection_=void 0}reset(t){super.reset({uniforms:t.uniforms})}isDrawableTile_(t){const e=this.getLayer(),i=t.getState(),s=e.getUseInterimTilesOnError();return i==le.LOADED||i==le.EMPTY||i==le.ERROR&&!s}prepareFrameInternal(t){this.projection_?t.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=t.viewState.projection):this.projection_=t.viewState.projection;const i=this.getLayer().getRenderSource();return!i||wf(zy(t,t.extent))?!1:i.getState()==="ready"}createTileRepresentation(t){return ke()}enqueueTiles(t,e,i,s,r){const a=t.viewState,o=this.getLayer(),h=o.getRenderSource(),l=h.getTileGridForProjection(a.projection),u=h.getGutterForProjection(a.projection),f=$e(h);f in t.wantedTiles||(t.wantedTiles[f]={});const m=t.wantedTiles[f],g=this.tileRepresentationCache,y=o.getMapInternal(),_=Math.max(i-r,l.getMinZoom(),l.getZForResolution(Math.min(o.getMaxResolution(),y?y.getView().getResolutionForZoom(Math.max(o.getMinZoom(),0)):l.getResolution(0)),h.zDirection));for(let w=i;w>=_;--w){const M=l.getTileRangeForExtentAndZ(e,w,this.tempTileRange_),T=l.getResolution(w);for(let A=M.minX;A<=M.maxX;++A)for(let R=M.minY;R<=M.maxY;++R){const I=qp(w,A,R,this.tempTileCoord_),L=p_(h,I);let k,Y;if(g.containsKey(L)&&(k=g.get(L),Y=k.tile),(!k||k.tile.key!==h.getKey())&&(Y=h.getTile(w,A,R,t.pixelRatio,a.projection)),TM(s,Y))continue;if(!k)k=this.createTileRepresentation({tile:Y,grid:l,helper:this.helper,gutter:u}),g.set(L,k);else if(this.isDrawableTile_(Y))k.setTile(Y);else{const rt=Y.getInterimTile();k.setTile(rt)}CM(s,k,w);const K=Y.getKey();m[K]=!0,Y.getState()===le.IDLE&&(t.tileQueue.isKeyQueued(K)||t.tileQueue.enqueue([Y,f,l.getTileCoordCenter(I),T]))}}}beforeTilesRender(t,e){this.helper.prepareDraw(this.frameState,!e,!0)}beforeTilesMaskRender(t){return!1}renderTile(t,e,i,s,r,a,o,h,l,u,f){}renderTileMask(t,e,i,s){}drawTile_(t,e,i,s,r,a,o){if(!e.ready)return;const l=e.tile.tileCoord,u=Ko(l),f=u in a?a[u]:1,m=o.getResolution(i),g=Tn(o.getTileSize(i),this.tempSize_),y=o.getOrigin(i),_=o.getTileCoordExtent(l),w=f<1?-1:SM(i);f<1&&(t.animate=!0);const M=t.viewState,T=M.center[0],A=M.center[1],R=g[0]+2*s,I=g[1]+2*s,L=R/I,k=(T-y[0])/(g[0]*m),Y=(y[1]-A)/(g[1]*m),K=M.resolution/m,rt=l[1],ut=l[2];S8(this.tileTransform_),Qb(this.tileTransform_,2/(t.size[0]*K/R),-2/(t.size[1]*K/R)),C8(this.tileTransform_,M.rotation),Qb(this.tileTransform_,1,1/L),A8(this.tileTransform_,(g[0]*(rt-k)-s)/R,(g[1]*(ut-Y)-s)/I),this.renderTile(e,this.tileTransform_,t,r,m,g,y,_,w,s,f)}renderFrame(t){this.frameState=t,this.renderComplete=!0;const e=this.helper.getGL();this.preRender(e,t);const i=t.viewState,s=this.getLayer(),r=s.getRenderSource(),a=r.getTileGridForProjection(i.projection),o=r.getGutterForProjection(i.projection),h=zy(t,t.extent),l=a.getZForResolution(i.resolution,r.zDirection),u=H9(),f=s.getPreload();if(t.nextExtent){const L=a.getZForResolution(i.nextResolution,r.zDirection),k=zy(t,t.nextExtent);this.enqueueTiles(t,k,L,u,f)}this.enqueueTiles(t,h,l,u,0),f>0&&setTimeout(()=>{this.enqueueTiles(t,h,l-1,u,f-1)},0);const m={},g=$e(this),y=t.time;let _=!1;for(const L of u.representationsByZ[l]){const k=L.tile;if((k instanceof og||k instanceof Mx)&&k.getState()===le.EMPTY)continue;const Y=k.tileCoord;if(L.ready){const ut=k.getAlpha(g,y);if(ut===1){k.endTransition(g);continue}_=!0;const Z=Ko(Y);m[Z]=ut}if(this.renderComplete=!1,this.findAltTiles_(a,Y,l+1,u))continue;const rt=a.getMinZoom();for(let ut=l-1;ut>=rt&&!this.findAltTiles_(a,Y,ut,u);--ut);}const w=u.representationsByZ,M=Object.keys(w).map(Number).sort(_D);if(this.beforeTilesMaskRender(t))for(let L=0,k=M.length;L<k;++L){const Y=M[L];for(const K of w[Y]){const rt=K.tile.tileCoord;if(Ko(rt)in m)continue;const Z=a.getTileCoordExtent(rt);this.renderTileMask(K,Y,Z,SM(Y))}}this.beforeTilesRender(t,_);for(let L=0,k=M.length;L<k;++L){const Y=M[L];for(const K of w[Y]){const rt=K.tile.tileCoord;Ko(rt)in m||this.drawTile_(t,K,Y,o,h,m,a)}}for(const L of w[l]){const k=L.tile.tileCoord;Ko(k)in m&&this.drawTile_(t,L,l,o,h,m,a)}this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const A=this.helper.getCanvas(),R=this.tileRepresentationCache;for(;R.canExpireCache();)R.pop().dispose();const I=function(L,k){r.updateCacheSize(.1,k.viewState.projection),r.expireCache(k.viewState.projection,Y9)};return t.postRenderFunctions.push(I),this.postRender(e,t),A}findAltTiles_(t,e,i,s){const r=t.getTileRangeForTileCoordAndZ(e,i,this.tempTileRange_);if(!r)return!1;let a=!0;const o=this.tileRepresentationCache,h=this.getLayer().getRenderSource();for(let l=r.minX;l<=r.maxX;++l)for(let u=r.minY;u<=r.maxY;++u){const f=p_(h,[i,l,u]);let m=!1;if(o.containsKey(f)){const g=o.get(f);g.ready&&!TM(s,g.tile)&&(CM(s,g,i),m=!0)}m||(a=!1)}return a}clearCache(){const t=this.tileRepresentationCache;t.forEach(e=>e.dispose()),t.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const X9=q9,Ve={...$9,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},wp={TEXTURE_COORD:"a_textureCoord"},j9=[{name:wp.TEXTURE_COORD,size:2,type:_d.FLOAT}];class Z9 extends X9{constructor(t,e){super(t,e),this.program_,this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.indices_=new OC(Iv,Nv),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=e.paletteTextures||[]}reset(t){if(super.reset(t),this.helper){const e=this.helper.getGL();for(const i of this.paletteTextures_)i.delete(e)}this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.paletteTextures_=t.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}removeHelper(){if(this.helper){const t=this.helper.getGL();for(const e of this.paletteTextures_)e.delete(t)}super.removeHelper()}createTileRepresentation(t){return new L9(t)}beforeTilesRender(t,e){super.beforeTilesRender(t,e),this.helper.useProgram(this.program_,t)}renderTile(t,e,i,s,r,a,o,h,l,u,f){const m=this.helper.getGL();this.helper.bindBuffer(t.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(j9);let g=0;for(;g<t.textures.length;){const L=`${Ve.TILE_TEXTURE_ARRAY}[${g}]`;this.helper.bindTexture(t.textures[g],g,L),++g}for(let L=0;L<this.paletteTextures_.length;++L){const k=this.paletteTextures_[L],Y=k.getTexture(m);this.helper.bindTexture(Y,g,k.name),++g}const y=i.viewState,_=a[0]+2*u,w=a[1]+2*u,T=t.tile.tileCoord,A=T[1],R=T[2];this.helper.setUniformMatrixValue(Ve.TILE_TRANSFORM,zC(this.tempMat4,e)),this.helper.setUniformFloatValue(Ve.TRANSITION_ALPHA,f),this.helper.setUniformFloatValue(Ve.DEPTH,l);let I=s;u>0&&(I=h,_r(I,s,I)),this.helper.setUniformFloatVec4(Ve.RENDER_EXTENT,I),this.helper.setUniformFloatValue(Ve.RESOLUTION,y.resolution),this.helper.setUniformFloatValue(Ve.ZOOM,y.zoom),this.helper.setUniformFloatValue(Ve.TEXTURE_PIXEL_WIDTH,_),this.helper.setUniformFloatValue(Ve.TEXTURE_PIXEL_HEIGHT,w),this.helper.setUniformFloatValue(Ve.TEXTURE_RESOLUTION,r),this.helper.setUniformFloatValue(Ve.TEXTURE_ORIGIN_X,o[0]+A*a[0]*r-u*r),this.helper.setUniformFloatValue(Ve.TEXTURE_ORIGIN_Y,o[1]-R*a[1]*r+u*r),this.helper.drawElements(0,this.indices_.getSize())}getData(t){if(!this.helper.getGL())return null;const i=this.frameState;if(!i)return null;const s=this.getLayer(),r=as(i.pixelToCoordinateTransform,t.slice()),a=i.viewState,o=s.getExtent();if(o&&!ol(jh(o,a.projection),r))return null;const h=s.getSources(Vp([r]),a.resolution);let l,u,f;for(l=h.length-1;l>=0;--l)if(u=h[l],u.getState()==="ready"){if(f=u.getTileGridForProjection(a.projection),u.getWrapX())break;const g=f.getExtent();if(!g||ol(g,r))break}if(l<0)return null;const m=this.tileRepresentationCache;for(let g=f.getZForResolution(a.resolution);g>=f.getMinZoom();--g){const y=f.getTileCoordForCoordAndZ(r,g),_=p_(u,y);if(!m.containsKey(_))continue;const w=m.get(_),M=w.tile;if((M instanceof og||M instanceof Mx)&&M.getState()===le.EMPTY)return null;if(!w.loaded)continue;const T=f.getOrigin(g),A=Tn(f.getTileSize(g)),R=f.getResolution(g),I=(r[0]-T[0])/R-y[1]*A[0],L=(T[1]-r[1])/R-y[2]*A[1];return w.getPixelData(I,L)}return null}disposeInternal(){const t=this.helper;if(t){const e=t.getGL();for(const i of this.paletteTextures_)i.delete(e);this.paletteTextures_.length=0,e.deleteProgram(this.program_),delete this.program_,t.deleteBuffer(this.indices_)}super.disposeInternal(),delete this.indices_}}const K9=Z9;class J9{constructor(t,e){this.name=t,this.data=e,this.texture_=null}getTexture(t){if(!this.texture_){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=e}return this.texture_}delete(t){this.texture_&&t.deleteTexture(this.texture_),this.texture_=null}}const Q9=J9;function tU(n,t){return`operator_${n}_${Object.keys(t.functions).length}`}function hg(n){const t=n.toString();return t.includes(".")?t:t+".0"}function Lv(n){if(n.length<2||n.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${n.length}(${n.map(hg).join(", ")})`}function eU(n){const t=gh(n),e=t.length>3?t[3]:1;return Lv([t[0]/255*e,t[1]/255*e,t[2]/255*e,e])}function iU(n){const t=Tn(n);return Lv(t)}const By={};let nU=0;function UC(n){return n in By||(By[n]=nU++),By[n]}function sU(n){return hg(UC(n))}function GC(n){return"u_var_"+n}function rU(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{}}}const Uy="getBandValue",VC="u_paletteTextures";function aU(n,t,e,i){const s=bi(n,e,t);if(Sf(s.type,bl))throw new Error("No matching type was found");if(!$r(t,s.type)){const r=An(t),a=An(s.type);throw new Error(`Expected expression to be of type ${r}, got ${a}`)}return Ov(s,t,i)}function gi(n){return(t,e,i)=>{const s=e.args.length,r=new Array(s);for(let a=0;a<s;++a)r[a]=Ov(e.args[a],i,t);return n(r,t)}}const oU={[wt.Get]:(n,t)=>{const i=t.args[0].value;return i in n.properties||(n.properties[i]={name:i,type:t.type}),(n.inFragmentShader?"v_prop_":"a_prop_")+i},[wt.GeometryType]:(n,t,e)=>{const i="geometryType";return i in n.properties||(n.properties[i]={name:i,type:Ms,evaluator:a=>vv(a.getGeometry())}),(n.inFragmentShader?"v_prop_":"a_prop_")+i},[wt.Var]:(n,t)=>{const i=t.args[0].value;return i in n.variables||(n.variables[i]={name:i,type:t.type}),GC(i)},[wt.Resolution]:()=>"u_resolution",[wt.Zoom]:()=>"u_zoom",[wt.Time]:()=>"u_time",[wt.Any]:gi(n=>`(${n.join(" || ")})`),[wt.All]:gi(n=>`(${n.join(" && ")})`),[wt.Not]:gi(([n])=>`(!${n})`),[wt.Equal]:gi(([n,t])=>`(${n} == ${t})`),[wt.NotEqual]:gi(([n,t])=>`(${n} != ${t})`),[wt.GreaterThan]:gi(([n,t])=>`(${n} > ${t})`),[wt.GreaterThanOrEqualTo]:gi(([n,t])=>`(${n} >= ${t})`),[wt.LessThan]:gi(([n,t])=>`(${n} < ${t})`),[wt.LessThanOrEqualTo]:gi(([n,t])=>`(${n} <= ${t})`),[wt.Multiply]:gi(n=>`(${n.join(" * ")})`),[wt.Divide]:gi(([n,t])=>`(${n} / ${t})`),[wt.Add]:gi(n=>`(${n.join(" + ")})`),[wt.Subtract]:gi(([n,t])=>`(${n} - ${t})`),[wt.Clamp]:gi(([n,t,e])=>`clamp(${n}, ${t}, ${e})`),[wt.Mod]:gi(([n,t])=>`mod(${n}, ${t})`),[wt.Pow]:gi(([n,t])=>`pow(${n}, ${t})`),[wt.Abs]:gi(([n])=>`abs(${n})`),[wt.Floor]:gi(([n])=>`floor(${n})`),[wt.Ceil]:gi(([n])=>`ceil(${n})`),[wt.Round]:gi(([n])=>`floor(${n} + 0.5)`),[wt.Sin]:gi(([n])=>`sin(${n})`),[wt.Cos]:gi(([n])=>`cos(${n})`),[wt.Atan]:gi(([n,t])=>t!==void 0?`atan(${n}, ${t})`:`atan(${n})`),[wt.Sqrt]:gi(([n])=>`sqrt(${n})`),[wt.Match]:gi(n=>{const t=n[0],e=n[n.length-1];let i=null;for(let s=n.length-3;s>=1;s-=2){const r=n[s],a=n[s+1];i=`(${t} == ${r} ? ${a} : ${i||e})`}return i}),[wt.Between]:gi(([n,t,e])=>`(${n} >= ${t} && ${n} <= ${e})`),[wt.Interpolate]:gi(([n,t,...e])=>{let i="";for(let s=0;s<e.length-2;s+=2){const r=e[s],a=i||e[s+1],o=e[s+2],h=e[s+3];let l;n===hg(1)?l=`(${t} - ${r}) / (${o} - ${r})`:l=`(pow(${n}, (${t} - ${r})) - 1.0) / (pow(${n}, (${o} - ${r})) - 1.0)`,i=`mix(${a}, ${h}, clamp(${l}, 0.0, 1.0))`}return i}),[wt.Case]:gi(n=>{const t=n[n.length-1];let e=null;for(let i=n.length-3;i>=0;i-=2){const s=n[i],r=n[i+1];e=`(${s} ? ${r} : ${e||t})`}return e}),[wt.In]:gi(([n,...t],e)=>{const i=tU("in",e),s=[];for(let r=0;r<t.length;r+=1)s.push(`  if (inputValue == ${t[r]}) { return true; }`);return e.functions[i]=`bool ${i}(float inputValue) {
${s.join(`
`)}
  return false;
}`,`${i}(${n})`}),[wt.Array]:gi(n=>`vec${n.length}(${n.join(", ")})`),[wt.Color]:gi(n=>{if(n.length===1)return`vec4(vec3(${n[0]} / 255.0), 1.0)`;if(n.length===2)return`(${n[1]} * vec4(vec3(${n[0]} / 255.0), 1.0))`;const t=n.slice(0,3).map(i=>`${i} / 255.0`);return n.length===3?`vec4(${t.join(", ")}, 1.0)`:`(${n[3]} * vec4(${t.join(", ")}, 1.0))`}),[wt.Band]:gi(([n,t,e],i)=>{if(!(Uy in i.functions)){let s="";const r=i.bandCount||1;for(let a=0;a<r;a++){const o=Math.floor(a/4);let h=a%4;a===r-1&&h===1&&(h=3);const l=`${Ve.TILE_TEXTURE_ARRAY}[${o}]`;s+=`  if (band == ${a+1}.0) {
    return texture2D(${l}, v_textureCoord + vec2(dx, dy))[${h}];
  }
`}i.functions[Uy]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${Ve.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${Ve.TEXTURE_PIXEL_HEIGHT};
${s}
}`}return`${Uy}(${n}, ${t!=null?t:"0.0"}, ${e!=null?e:"0.0"})`}),[wt.Palette]:(n,t)=>{const[e,...i]=t.args,s=i.length,r=new Uint8Array(s*4);for(let l=0;l<i.length;l++){const u=i[l].value,f=gh(u),m=l*4;r[m]=f[0],r[m+1]=f[1],r[m+2]=f[2],r[m+3]=f[3]*255}n.paletteTextures||(n.paletteTextures=[]);const a=`${VC}[${n.paletteTextures.length}]`,o=new Q9(a,r);n.paletteTextures.push(o);const h=Ov(e,xe,n);return`texture2D(${a}, vec2((${h} + 0.5) / ${s}.0, 0.5))`}};function Ov(n,t,e){if(n instanceof wC){const i=oU[n.operator];if(i===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(n.operator)}`);return i(e,n,t)}if((n.type&xe)>0)return hg(n.value);if((n.type&Zi)>0)return n.value.toString();if((n.type&Ms)>0)return sU(n.value.toString());if((n.type&fn)>0)return eU(n.value);if((n.type&Wr)>0)return Lv(n.value);if((n.type&Pc)>0)return iU(n.value);throw new Error(`Unexpected expression ${n.value} (expected type ${An(t)})`)}function Hl(n,t,e){const i=xv();return i.style=n.style,aU(t,e,i,n)}function AM(n,t){const e=`
    attribute vec2 ${wp.TEXTURE_COORD};
    uniform mat4 ${Ve.TILE_TRANSFORM};
    uniform float ${Ve.TEXTURE_PIXEL_WIDTH};
    uniform float ${Ve.TEXTURE_PIXEL_HEIGHT};
    uniform float ${Ve.TEXTURE_RESOLUTION};
    uniform float ${Ve.TEXTURE_ORIGIN_X};
    uniform float ${Ve.TEXTURE_ORIGIN_Y};
    uniform float ${Ve.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${wp.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${Ve.TEXTURE_ORIGIN_X} + ${Ve.TEXTURE_RESOLUTION} * ${Ve.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${Ve.TEXTURE_ORIGIN_Y} - ${Ve.TEXTURE_RESOLUTION} * ${Ve.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${Ve.TILE_TRANSFORM} * vec4(${wp.TEXTURE_COORD}, ${Ve.DEPTH}, 1.0);
    }
  `,i={...rU(),inFragmentShader:!0,bandCount:t,style:n},s=[];if(n.color!==void 0){const f=Hl(i,n.color,fn);s.push(`color = ${f};`)}if(n.contrast!==void 0){const f=Hl(i,n.contrast,xe);s.push(`color.rgb = clamp((${f} + 1.0) * color.rgb - (${f} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(n.exposure!==void 0){const f=Hl(i,n.exposure,xe);s.push(`color.rgb = clamp((${f} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(n.saturation!==void 0){const f=Hl(i,n.saturation,xe);s.push(`
      float saturation = ${f} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(n.gamma!==void 0){const f=Hl(i,n.gamma,xe);s.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${f}));`)}if(n.brightness!==void 0){const f=Hl(i,n.brightness,xe);s.push(`color.rgb = clamp(color.rgb + ${f}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const r={},a=Object.keys(i.variables).length;if(a>1&&!n.variables)throw new Error(`Missing variables in style (expected ${i.variables})`);for(let f=0;f<a;++f){const m=i.variables[Object.keys(i.variables)[f]];if(!(m.name in n.variables))throw new Error(`Missing '${m.name}' in style variables`);const g=GC(m.name);r[g]=function(){let y=n.variables[m.name];return typeof y=="string"&&(y=UC(y)),y!==void 0?y:-9999999}}const o=Object.keys(r).map(function(f){return`uniform float ${f};`}),h=Math.ceil(t/4);o.push(`uniform sampler2D ${Ve.TILE_TEXTURE_ARRAY}[${h}];`),i.paletteTextures&&o.push(`uniform sampler2D ${VC}[${i.paletteTextures.length}];`);const l=Object.keys(i.functions).map(function(f){return i.functions[f]}),u=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${Ve.RENDER_EXTENT};
    uniform float ${Ve.TRANSITION_ALPHA};
    uniform float ${Ve.TEXTURE_PIXEL_WIDTH};
    uniform float ${Ve.TEXTURE_PIXEL_HEIGHT};
    uniform float ${Ve.RESOLUTION};
    uniform float ${Ve.ZOOM};

    ${o.join(`
`)}

    ${l.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${Ve.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${Ve.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${Ve.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${Ve.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${Ve.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${s.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${Ve.TRANSITION_ALPHA};
    }`;return{vertexShader:e,fragmentShader:u,uniforms:r,paletteTextures:i.paletteTextures}}class WC extends g9{constructor(t){t=t?Object.assign({},t):{};const e=t.style||{};delete t.style;const i=t.cacheSize;delete t.cacheSize,super(t),this.sources_=t.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=e,this.cacheSize_=i,this.styleVariables_=this.style_.variables||{},this.addChangeListener(vi.SOURCE,this.handleSourceUpdate_)}getSources(t,e){const i=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(t,e):this.sources_:i?[i]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const t=this.getRenderSource();return t?t.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const t=Number.MAX_SAFE_INTEGER,e=this.getSources([-t,-t,t,t],t);return e&&e.length&&"bandCount"in e[0]?e[0].bandCount:4}createRenderer(){const t=AM(this.style_,this.getSourceBandCount_());return new K9(this,{vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,cacheSize:this.cacheSize_,paletteTextures:t.paletteTextures})}renderSources(t,e){const i=this.getRenderer();let s;for(let r=0,a=e.length;r<a;++r)this.renderedSource_=e[r],i.prepareFrame(t)&&(s=i.renderFrame(t));return s}render(t,e){this.rendered=!0;const i=t.viewState,s=this.getSources(t.extent,i.resolution);let r=!0;for(let o=0,h=s.length;o<h;++o){const l=s[o],u=l.getState();if(u=="loading"){const f=()=>{l.getState()=="ready"&&(l.removeEventListener("change",f),this.changed())};l.addEventListener("change",f)}r=r&&u=="ready"}const a=this.renderSources(t,s);if(this.getRenderer().renderComplete&&r)return this.renderedResolution_=i.resolution,a;if(this.renderedResolution_>.5*i.resolution){const o=this.getSources(t.extent,this.renderedResolution_).filter(h=>!s.includes(h));if(o.length>0)return this.renderSources(t,o)}return a}setStyle(t){this.styleVariables_=t.variables||{},this.style_=t;const e=AM(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,paletteTextures:e.paletteTextures}),this.changed()}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}}WC.prototype.dispose;const Cf=WC,Af={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},D0=[Af.FILL],ih=[Af.STROKE],Jh=[Af.BEGIN_PATH],RM=[Af.CLOSE_PATH],Oe=Af;class hU{drawCustom(t,e,i,s,r){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,i){}drawFeature(t,e,i){}drawGeometryCollection(t,e,i){}drawLineString(t,e,i){}drawMultiLineString(t,e,i){}drawMultiPoint(t,e,i){}drawMultiPolygon(t,e,i){}drawPoint(t,e,i){}drawPolygon(t,e,i){}drawText(t,e,i){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}const $C=hU;class lU extends $C{constructor(t,e,i,s){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(i){return i*e})}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,r=this.coordinates;let a=r.length;for(let o=0,h=t.length;o<h;o+=e)s[0]=t[o],s[1]=t[o+1],ol(i,s)&&(r[a++]=s[0],r[a++]=s[1]);return a}appendFlatLineCoordinates(t,e,i,s,r,a){const o=this.coordinates;let h=o.length;const l=this.getBufferedMaxExtent();a&&(e+=s);let u=t[e],f=t[e+1];const m=this.tmpCoordinate_;let g=!0,y,_,w;for(y=e+s;y<i;y+=s)m[0]=t[y],m[1]=t[y+1],w=q1(l,m),w!==_?(g&&(o[h++]=u,o[h++]=f,g=!1),o[h++]=m[0],o[h++]=m[1]):w===On.INTERSECTING?(o[h++]=m[0],o[h++]=m[1],g=!1):g=!0,u=m[0],f=m[1],_=w;return(r&&g||y===e+s)&&(o[h++]=u,o[h++]=f),h}drawCustomCoordinates_(t,e,i,s,r){for(let a=0,o=i.length;a<o;++a){const h=i[a],l=this.appendFlatLineCoordinates(t,e,h,s,!1,!1);r.push(l),e=h}return e}drawCustom(t,e,i,s,r){this.beginGeometry(t,e,r);const a=t.getType(),o=t.getStride(),h=this.coordinates.length;let l,u,f,m,g;switch(a){case"MultiPolygon":l=t.getOrientedFlatCoordinates(),m=[];const y=t.getEndss();g=0;for(let _=0,w=y.length;_<w;++_){const M=[];g=this.drawCustomCoordinates_(l,g,y[_],o,M),m.push(M)}this.instructions.push([Oe.CUSTOM,h,m,t,i,n_,r]),this.hitDetectionInstructions.push([Oe.CUSTOM,h,m,t,s||i,n_,r]);break;case"Polygon":case"MultiLineString":f=[],l=a=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),g=this.drawCustomCoordinates_(l,0,t.getEnds(),o,f),this.instructions.push([Oe.CUSTOM,h,f,t,i,qd,r]),this.hitDetectionInstructions.push([Oe.CUSTOM,h,f,t,s||i,qd,r]);break;case"LineString":case"Circle":l=t.getFlatCoordinates(),u=this.appendFlatLineCoordinates(l,0,l.length,o,!1,!1),this.instructions.push([Oe.CUSTOM,h,u,t,i,Qo,r]),this.hitDetectionInstructions.push([Oe.CUSTOM,h,u,t,s||i,Qo,r]);break;case"MultiPoint":l=t.getFlatCoordinates(),u=this.appendFlatPointCoordinates(l,o),u>h&&(this.instructions.push([Oe.CUSTOM,h,u,t,i,Qo,r]),this.hitDetectionInstructions.push([Oe.CUSTOM,h,u,t,s||i,Qo,r]));break;case"Point":l=t.getFlatCoordinates(),this.coordinates.push(l[0],l[1]),u=this.coordinates.length,this.instructions.push([Oe.CUSTOM,h,u,t,i,void 0,r]),this.hitDetectionInstructions.push([Oe.CUSTOM,h,u,t,s||i,void 0,r]);break}this.endGeometry(e)}beginGeometry(t,e,i){this.beginGeometryInstruction1_=[Oe.BEGIN_GEOMETRY,e,0,t,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Oe.BEGIN_GEOMETRY,e,0,t,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const i=t.length;let s,r,a=-1;for(e=0;e<i;++e)s=t[e],r=s[0],r==Oe.END_GEOMETRY?a=e:r==Oe.BEGIN_GEOMETRY&&(s[2]=e,xD(this.hitDetectionInstructions,a,e),a=-1)}setFillStrokeStyle(t,e){const i=this.state;if(t){const s=t.getColor();i.fillPatternScale=s&&typeof s=="object"&&"src"in s?this.pixelRatio:1,i.fillStyle=Ca(s||Us)}else i.fillStyle=void 0;if(e){const s=e.getColor();i.strokeStyle=Ca(s||Zd);const r=e.getLineCap();i.lineCap=r!==void 0?r:nu;const a=e.getLineDash();i.lineDash=a?a.slice():fo;const o=e.getLineDashOffset();i.lineDashOffset=o||po;const h=e.getLineJoin();i.lineJoin=h!==void 0?h:su;const l=e.getWidth();i.lineWidth=l!==void 0?l:Jd;const u=e.getMiterLimit();i.miterLimit=u!==void 0?u:jd,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){const e=t.fillStyle,i=[Oe.SET_FILL_STYLE,e];return typeof e!="string"&&i.push(t.fillPatternScale),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[Oe.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;(typeof i!="string"||t.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,s=t.lineCap,r=t.lineDash,a=t.lineDashOffset,o=t.lineJoin,h=t.lineWidth,l=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=s||r!=t.currentLineDash&&!Mh(t.currentLineDash,r)||t.currentLineDashOffset!=a||t.currentLineJoin!=o||t.currentLineWidth!=h||t.currentMiterLimit!=l)&&(i!==void 0&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=s,t.currentLineDash=r,t.currentLineDashOffset=a,t.currentLineJoin=o,t.currentLineWidth=h,t.currentMiterLimit=l)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[Oe.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=tT(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;ux(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}const Rf=lU;class cU extends Rf{constructor(t,e,i,s){super(t,e,i,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,i){if(!this.image_||this.maxExtent&&!ol(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,i);const s=t.getFlatCoordinates(),r=t.getStride(),a=this.coordinates.length,o=this.appendFlatPointCoordinates(s,r);this.instructions.push([Oe.DRAW_IMAGE,a,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Oe.DRAW_IMAGE,a,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,i){if(!this.image_)return;this.beginGeometry(t,e,i);const s=t.getFlatCoordinates(),r=[];for(let h=0,l=s.length;h<l;h+=t.getStride())(!this.maxExtent||ol(this.maxExtent,s.slice(h,h+2)))&&r.push(s[h],s[h+1]);const a=this.coordinates.length,o=this.appendFlatPointCoordinates(r,2);this.instructions.push([Oe.DRAW_IMAGE,a,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Oe.DRAW_IMAGE,a,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),s=t.getSize(),r=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=t.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=s[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const uU=cU;class dU extends Rf{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinates_(t,e,i,s){const r=this.coordinates.length,a=this.appendFlatLineCoordinates(t,e,i,s,!1,!1),o=[Oe.MOVE_TO_LINE_TO,r,a];return this.instructions.push(o),this.hitDetectionInstructions.push(o),i}drawLineString(t,e,i){const s=this.state,r=s.strokeStyle,a=s.lineWidth;if(r===void 0||a===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([Oe.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,fo,po],Jh);const o=t.getFlatCoordinates(),h=t.getStride();this.drawFlatCoordinates_(o,0,o.length,h),this.hitDetectionInstructions.push(ih),this.endGeometry(e)}drawMultiLineString(t,e,i){const s=this.state,r=s.strokeStyle,a=s.lineWidth;if(r===void 0||a===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([Oe.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,fo,po],Jh);const o=t.getEnds(),h=t.getFlatCoordinates(),l=t.getStride();let u=0;for(let f=0,m=o.length;f<m;++f)u=this.drawFlatCoordinates_(h,u,o[f],l);this.hitDetectionInstructions.push(ih),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(ih),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(ih),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Jh)}}const fU=dU;class pU extends Rf{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinatess_(t,e,i,s){const r=this.state,a=r.fillStyle!==void 0,o=r.strokeStyle!==void 0,h=i.length;this.instructions.push(Jh),this.hitDetectionInstructions.push(Jh);for(let l=0;l<h;++l){const u=i[l],f=this.coordinates.length,m=this.appendFlatLineCoordinates(t,e,u,s,!0,!o),g=[Oe.MOVE_TO_LINE_TO,f,m];this.instructions.push(g),this.hitDetectionInstructions.push(g),o&&(this.instructions.push(RM),this.hitDetectionInstructions.push(RM)),e=u}return a&&(this.instructions.push(D0),this.hitDetectionInstructions.push(D0)),o&&(this.instructions.push(ih),this.hitDetectionInstructions.push(ih)),e}drawCircle(t,e,i){const s=this.state,r=s.fillStyle,a=s.strokeStyle;if(r===void 0&&a===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([Oe.SET_FILL_STYLE,Us]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Oe.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,fo,po]);const o=t.getFlatCoordinates(),h=t.getStride(),l=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,h,!1,!1);const u=[Oe.CIRCLE,l];this.instructions.push(Jh,u),this.hitDetectionInstructions.push(Jh,u),s.fillStyle!==void 0&&(this.instructions.push(D0),this.hitDetectionInstructions.push(D0)),s.strokeStyle!==void 0&&(this.instructions.push(ih),this.hitDetectionInstructions.push(ih)),this.endGeometry(e)}drawPolygon(t,e,i){const s=this.state,r=s.fillStyle,a=s.strokeStyle;if(r===void 0&&a===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([Oe.SET_FILL_STYLE,Us]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Oe.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,fo,po]);const o=t.getEnds(),h=t.getOrientedFlatCoordinates(),l=t.getStride();this.drawFlatCoordinatess_(h,0,o,l),this.endGeometry(e)}drawMultiPolygon(t,e,i){const s=this.state,r=s.fillStyle,a=s.strokeStyle;if(r===void 0&&a===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([Oe.SET_FILL_STYLE,Us]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Oe.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,fo,po]);const o=t.getEndss(),h=t.getOrientedFlatCoordinates(),l=t.getStride();let u=0;for(let f=0,m=o.length;f<m;++f)u=this.drawFlatCoordinatess_(h,u,o[f],l);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let i=0,s=e.length;i<s;++i)e[i]=qh(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}const IM=pU;function mU(n,t,e,i,s){const r=[];let a=e,o=0,h=t.slice(e,2);for(;o<n&&a+s<i;){const[l,u]=h.slice(-2),f=t[a+s],m=t[a+s+1],g=Math.sqrt((f-l)*(f-l)+(m-u)*(m-u));if(o+=g,o>=n){const y=(n-o+g)/g,_=er(l,f,y),w=er(u,m,y);h.push(_,w),r.push(h),h=[_,w],o==n&&(a+=s),o=0}else if(o<n)h.push(t[a+s],t[a+s+1]),a+=s;else{const y=g-o,_=er(l,f,y/g),w=er(u,m,y/g);h.push(_,w),r.push(h),h=[_,w],o=0,a+=s}}return o>0&&r.push(h),r}function gU(n,t,e,i,s){let r=e,a=e,o=0,h=0,l=e,u,f,m,g,y,_,w,M,T,A;for(f=e;f<i;f+=s){const R=t[f],I=t[f+1];y!==void 0&&(T=R-y,A=I-_,g=Math.sqrt(T*T+A*A),w!==void 0&&(h+=m,u=Math.acos((w*T+M*A)/(m*g)),u>n&&(h>o&&(o=h,r=l,a=f),h=0,l=f-s)),m=g,w=T,M=A),y=R,_=I}return h+=g,h>o?[l,f]:[r,a]}const nm={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class yU extends Rf{constructor(t,e,i,s){super(t,e,i,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[Us]={fillStyle:Us},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,i){const s=this.textFillState_,r=this.textStrokeState_,a=this.textState_;if(this.text_===""||!a||!s&&!r)return;const o=this.coordinates;let h=o.length;const l=t.getType();let u=null,f=t.getStride();if(a.placement==="line"&&(l=="LineString"||l=="MultiLineString"||l=="Polygon"||l=="MultiPolygon")){if(!Gs(this.maxExtent,t.getExtent()))return;let m;if(u=t.getFlatCoordinates(),l=="LineString")m=[u.length];else if(l=="MultiLineString")m=t.getEnds();else if(l=="Polygon")m=t.getEnds().slice(0,1);else if(l=="MultiPolygon"){const w=t.getEndss();m=[];for(let M=0,T=w.length;M<T;++M)m.push(w[M][0])}this.beginGeometry(t,e,i);const g=a.repeat,y=g?void 0:a.textAlign;let _=0;for(let w=0,M=m.length;w<M;++w){let T;g?T=mU(g*this.resolution,u,_,m[w],f):T=[u.slice(_,m[w])];for(let A=0,R=T.length;A<R;++A){const I=T[A];let L=0,k=I.length;if(y==null){const K=gU(a.maxAngle,I,0,I.length,2);L=K[0],k=K[1]}for(let K=L;K<k;K+=f)o.push(I[K],I[K+1]);const Y=o.length;_=m[w],this.drawChars_(h,Y),h=Y}}this.endGeometry(e)}else{let m=a.overflow?null:[];switch(l){case"Point":case"MultiPoint":u=t.getFlatCoordinates();break;case"LineString":u=t.getFlatMidpoint();break;case"Circle":u=t.getCenter();break;case"MultiLineString":u=t.getFlatMidpoints(),f=2;break;case"Polygon":u=t.getFlatInteriorPoint(),a.overflow||m.push(u[2]/this.resolution),f=3;break;case"MultiPolygon":const T=t.getFlatInteriorPoints();u=[];for(let A=0,R=T.length;A<R;A+=3)a.overflow||m.push(T[A+2]/this.resolution),u.push(T[A],T[A+1]);if(u.length===0)return;f=2;break}const g=this.appendFlatPointCoordinates(u,f);if(g===h)return;if(m&&(g-h)/2!==u.length/f){let T=h/2;m=m.filter((A,R)=>{const I=o[(T+R)*2]===u[R*f]&&o[(T+R)*2+1]===u[R*f+1];return I||--T,I})}this.saveTextStates_(),(a.backgroundFill||a.backgroundStroke)&&(this.setFillStrokeStyle(a.backgroundFill,a.backgroundStroke),a.backgroundFill&&this.updateFillStyle(this.state,this.createFill),a.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e,i);let y=a.padding;if(y!=Kh&&(a.scale[0]<0||a.scale[1]<0)){let T=a.padding[0],A=a.padding[1],R=a.padding[2],I=a.padding[3];a.scale[0]<0&&(A=-A,I=-I),a.scale[1]<0&&(T=-T,R=-R),y=[T,A,R,I]}const _=this.pixelRatio;this.instructions.push([Oe.DRAW_IMAGE,h,g,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,y==Kh?Kh:y.map(function(T){return T*_}),!!a.backgroundFill,!!a.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,m]);const w=1/_,M=this.state.fillStyle;a.backgroundFill&&(this.state.fillStyle=Us,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([Oe.DRAW_IMAGE,h,g,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[w,w],NaN,this.declutterMode_,this.declutterImageWithText_,y,!!a.backgroundFill,!!a.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?Us:this.fillKey_,this.textOffsetX_,this.textOffsetY_,m]),a.backgroundFill&&(this.state.fillStyle=M,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,s=this.strokeKey_;t&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:e.font,textAlign:e.textAlign||Kd,justify:e.justify,textBaseline:e.textBaseline||Kp,scale:e.scale});const a=this.fillKey_;i&&(a in this.fillStates||(this.fillStates[a]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,s=this.textState_,r=this.strokeKey_,a=this.textKey_,o=this.fillKey_;this.saveTextStates_();const h=this.pixelRatio,l=nm[s.textBaseline],u=this.textOffsetY_*h,f=this.text_,m=i?i.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([Oe.DRAW_CHARS,t,e,l,s.overflow,o,s.maxAngle,h,u,r,m*h,f,a,1,this.declutterMode_]),this.hitDetectionInstructions.push([Oe.DRAW_CHARS,t,e,l,s.overflow,o&&Us,s.maxAngle,h,u,r,m*h,f,a,1/h,this.declutterMode_])}setTextStyle(t,e){let i,s,r;if(!t)this.text_="";else{const a=t.getFill();a?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=Ca(a.getColor()||Us)):(s=null,this.textFillState_=s);const o=t.getStroke();if(!o)r=null,this.textStrokeState_=r;else{r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const y=o.getLineDash(),_=o.getLineDashOffset(),w=o.getWidth(),M=o.getMiterLimit();r.lineCap=o.getLineCap()||nu,r.lineDash=y?y.slice():fo,r.lineDashOffset=_===void 0?po:_,r.lineJoin=o.getLineJoin()||su,r.lineWidth=w===void 0?Jd:w,r.miterLimit=M===void 0?jd:M,r.strokeStyle=Ca(o.getColor()||Zd)}i=this.textState_;const h=t.getFont()||mC;gz(h);const l=t.getScaleArray();i.overflow=t.getOverflow(),i.font=h,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.repeat=t.getRepeat(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||Kp,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||Kh,i.scale=l===void 0?[1,1]:l;const u=t.getOffsetX(),f=t.getOffsetY(),m=t.getRotateWithView(),g=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=u===void 0?0:u,this.textOffsetY_=f===void 0?0:f,this.textRotateWithView_=m===void 0?!1:m,this.textRotation_=g===void 0?0:g,this.strokeKey_=r?(typeof r.strokeStyle=="string"?r.strokeStyle:$e(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=s&&s.fillStyle?typeof s.fillStyle=="string"?s.fillStyle:"|"+$e(s.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const _U={Circle:IM,Default:Rf,Image:uU,LineString:fU,Polygon:IM,Text:yU};class xU{constructor(t,e,i,s){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=s,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const s in i){const r=i[s].finish();t[e][s]=r}}return t}getBuilder(t,e){const i=t!==void 0?t.toString():"0";let s=this.buildersByZIndex_[i];s===void 0&&(s={},this.buildersByZIndex_[i]=s);let r=s[e];if(r===void 0){const a=_U[e];r=new a(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[e]=r}return r}}const vU=xU;class wU{constructor(){Tb(this,"pushMethodArgs_",(...t)=>(this.instructions_[this.zIndex+this.offset_].push(t),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(Bp(),{get:(t,e)=>{if(typeof Bp()[e]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e),this.pushMethodArgs_},set:(t,e,i)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e,i),!0)})}pushFunction(t){this.instructions_[this.zIndex+this.offset_].push(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let i=0,s=e.length;i<s;++i){const r=e[i];if(typeof r=="function"){r(t);continue}const a=e[++i];if(typeof t[r]=="function")t[r](...a);else{if(typeof a=="function"){t[r]=a(t);continue}t[r]=a}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const YC=wU,NM=[];let pc=null;function bU(){pc=yn(1,1,void 0,{willReadFrequently:!0})}class MU extends FC{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=Ts(),this.pixelTransform=Ts(),this.inversePixelTransform=Ts(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,i){pc||bU(),pc.clearRect(0,0,1,1);let s;try{pc.drawImage(t,e,i,1,1,0,0,1,1),s=pc.getImageData(0,0,1,1).data}catch{return pc=null,null}return s}getBackground(t){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(t.viewState.resolution)),i||void 0}useContainer(t,e,i){const s=this.getLayer().getClassName();let r,a;if(t&&t.className===s&&(!i||t&&t.style.backgroundColor&&Mh(gh(t.style.backgroundColor),gh(i)))){const o=t.firstElementChild;o instanceof HTMLCanvasElement&&(a=o.getContext("2d"))}if(a&&a.canvas.style.transform===e?(this.container=t,this.context=a,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){r=document.createElement("div"),r.className=s;let o=r.style;o.position="absolute",o.width="100%",o.height="100%",a=yn();const h=a.canvas;r.appendChild(h),o=h.style,o.position="absolute",o.left="0",o.transformOrigin="top left",this.container=r,this.context=a}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){const s=pu(i),r=Ym(i),a=$m(i),o=Wm(i);as(e.coordinateToPixelTransform,s),as(e.coordinateToPixelTransform,r),as(e.coordinateToPixelTransform,a),as(e.coordinateToPixelTransform,o);const h=this.inversePixelTransform;as(h,s),as(h,r),as(h,a),as(h,o),t.save(),t.beginPath(),t.moveTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.clip()}prepareContainer(t,e){const i=t.extent,s=t.viewState.resolution,r=t.viewState.rotation,a=t.pixelRatio,o=Math.round(fi(i)/s*a),h=Math.round(cs(i)/s*a);ka(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/a,1/a,r,-o/2,-h/2),tC(this.inversePixelTransform,this.pixelTransform);const l=I8(this.pixelTransform);if(this.useContainer(e,l,this.getBackground(t)),!this.containerReused){const u=this.context.canvas;u.width!=o||u.height!=h?(u.width=o,u.height=h):this.context.clearRect(0,0,o,h),l!==u.style.transform&&(u.style.transform=l)}}dispatchRenderEvent_(t,e,i){const s=this.getLayer();if(s.hasListener(t)){const r=new Td(t,this.inversePixelTransform,i,e);s.dispatchEvent(r)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(Dn.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(Dn.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new YC),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){!t.declutter||(this.dispatchRenderEvent_(Dn.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(Dn.POSTRENDER,this.context,t))}getRenderTransform(t,e,i,s,r,a,o){const h=r/2,l=a/2,u=s/e,f=-u,m=-t[0]+o,g=-t[1];return ka(this.tempTransform,h,l,u,f,-i,m,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}}const EU=MU;function SU(n,t,e,i,s,r,a,o,h,l,u,f){let m=n[t],g=n[t+1],y=0,_=0,w=0,M=0;function T(){y=m,_=g,t+=i,m=n[t],g=n[t+1],M+=w,w=Math.sqrt((m-y)*(m-y)+(g-_)*(g-_))}do T();while(t<e-i&&M+w<r);let A=w===0?0:(r-M)/w;const R=er(y,m,A),I=er(_,g,A),L=t-i,k=M,Y=r+o*h(l,s,u);for(;t<e-i&&M+w<Y;)T();A=w===0?0:(Y-M)/w;const K=er(y,m,A),rt=er(_,g,A);let ut;if(f){const Gt=[R,I,K,rt];jx(Gt,0,4,2,f,Gt,Gt),ut=Gt[0]>Gt[2]}else ut=R>K;const Z=Math.PI,ht=[],O=L+i===t;t=L,w=0,M=k,m=n[t],g=n[t+1];let pt;if(O){T(),pt=Math.atan2(g-_,m-y),ut&&(pt+=pt>0?-Z:Z);const Gt=(K+R)/2,Ft=(rt+I)/2;return ht[0]=[Gt,Ft,(Y-r)/2,pt,s],ht}s=s.replace(/\n/g," ");for(let Gt=0,Ft=s.length;Gt<Ft;){T();let oe=Math.atan2(g-_,m-y);if(ut&&(oe+=oe>0?-Z:Z),pt!==void 0){let Et=oe-pt;if(Et+=Et>Z?-2*Z:Et<-Z?2*Z:0,Math.abs(Et)>a)return null}pt=oe;const Dt=Gt;let re=0;for(;Gt<Ft;++Gt){const Et=ut?Ft-Gt-1:Gt,Kt=o*h(l,s[Et],u);if(t+i<e&&M+w<r+re+Kt/2)break;re+=Kt}if(Gt===Dt)continue;const yt=ut?s.substring(Ft-Dt,Ft-Gt):s.substring(Dt,Gt);A=w===0?0:(r+re/2-M)/w;const gt=er(y,m,A),ge=er(_,g,A);ht.push([gt,ge,re/2,oe,yt]),r+=re}return ht}function HC(n,t,e,i){let s=n[t],r=n[t+1],a=0;for(let o=t+i;o<e;o+=i){const h=n[o],l=n[o+1];a+=Math.sqrt((h-s)*(h-s)+(l-r)*(l-r)),s=h,r=l}return a}const ql=Jr(),Uo=[],Ya=[],Ha=[],Go=[];function kM(n){return n[3].declutterBox}const LM=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function Gy(n,t){return t==="start"?t=LM.test(n)?"right":"left":t==="end"&&(t=LM.test(n)?"left":"right"),nm[t]}function TU(n,t,e){return e>0&&n.push(`
`,""),n.push(t,""),n}class CU{constructor(t,e,i,s,r){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=Ts(),this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=r?new YC:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,i,s){const r=t+e+i+s;if(this.labels_[r])return this.labels_[r];const a=s?this.strokeStates[s]:null,o=i?this.fillStates[i]:null,h=this.textStates[e],l=this.pixelRatio,u=[h.scale[0]*l,h.scale[1]*l],f=Array.isArray(t),m=h.justify?nm[h.justify]:Gy(Array.isArray(t)?t[0]:t,h.textAlign||Kd),g=s&&a.lineWidth?a.lineWidth:0,y=f?t:t.split(`
`).reduce(TU,[]),{width:_,height:w,widths:M,heights:T,lineWidths:A}=_z(h,y),R=_+g,I=[],L=(R+2)*u[0],k=(w+g)*u[1],Y={width:L<0?Math.floor(L):Math.ceil(L),height:k<0?Math.floor(k):Math.ceil(k),contextInstructions:I};(u[0]!=1||u[1]!=1)&&I.push("scale",u),s&&(I.push("strokeStyle",a.strokeStyle),I.push("lineWidth",g),I.push("lineCap",a.lineCap),I.push("lineJoin",a.lineJoin),I.push("miterLimit",a.miterLimit),I.push("setLineDash",[a.lineDash]),I.push("lineDashOffset",a.lineDashOffset)),i&&I.push("fillStyle",o.fillStyle),I.push("textBaseline","middle"),I.push("textAlign","center");const K=.5-m;let rt=m*R+K*g;const ut=[],Z=[];let ht=0,O=0,pt=0,Gt=0,Ft;for(let oe=0,Dt=y.length;oe<Dt;oe+=2){const re=y[oe];if(re===`
`){O+=ht,ht=0,rt=m*R+K*g,++Gt;continue}const yt=y[oe+1]||h.font;yt!==Ft&&(s&&ut.push("font",yt),i&&Z.push("font",yt),Ft=yt),ht=Math.max(ht,T[pt]);const gt=[re,rt+K*M[pt]+m*(M[pt]-A[Gt]),.5*(g+ht)+O];rt+=M[pt],s&&ut.push("strokeText",gt),i&&Z.push("fillText",gt),++pt}return Array.prototype.push.apply(I,ut),Array.prototype.push.apply(I,Z),this.labels_[r]=Y,Y}replayTextBackground_(t,e,i,s,r,a,o){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,s),t.lineTo.apply(t,r),t.lineTo.apply(t,e),a&&(this.alignAndScaleFill_=a[2],this.fill_(t)),o&&(this.setStrokeStyle_(t,o),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,s,r,a,o,h,l,u,f,m,g,y,_,w){o*=m[0],h*=m[1];let M=i-o,T=s-h;const A=r+l>t?t-l:r,R=a+u>e?e-u:a,I=y[3]+A*m[0]+y[1],L=y[0]+R*m[1]+y[2],k=M-y[3],Y=T-y[0];(_||f!==0)&&(Uo[0]=k,Go[0]=k,Uo[1]=Y,Ya[1]=Y,Ya[0]=k+I,Ha[0]=Ya[0],Ha[1]=Y+L,Go[1]=Ha[1]);let K;return f!==0?(K=ka(Ts(),i,s,1,1,f,-i,-s),as(K,Uo),as(K,Ya),as(K,Ha),as(K,Go),vo(Math.min(Uo[0],Ya[0],Ha[0],Go[0]),Math.min(Uo[1],Ya[1],Ha[1],Go[1]),Math.max(Uo[0],Ya[0],Ha[0],Go[0]),Math.max(Uo[1],Ya[1],Ha[1],Go[1]),ql)):vo(Math.min(k,k+I),Math.min(Y,Y+L),Math.max(k,k+I),Math.max(Y,Y+L),ql),g&&(M=Math.round(M),T=Math.round(T)),{drawImageX:M,drawImageY:T,drawImageW:A,drawImageH:R,originX:l,originY:u,declutterBox:{minX:ql[0],minY:ql[1],maxX:ql[2],maxY:ql[3],value:w},canvasTransform:K,scale:m}}replayImageOrLabel_(t,e,i,s,r,a,o){const h=!!(a||o),l=s.declutterBox,u=o?o[2]*s.scale[0]/2:0;return l.minX-u<=e[0]&&l.maxX+u>=0&&l.minY-u<=e[1]&&l.maxY+u>=0&&(h&&this.replayTextBackground_(t,Uo,Ya,Ha,Go,a,o),xz(t,s.canvasTransform,r,i,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const i=as(this.renderedTransform_,[0,0]),s=512*this.pixelRatio;t.save(),t.translate(i[0]%s,i[1]%s),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,s){const r=this.textStates[e],a=this.createLabel(t,e,s,i),o=this.strokeStates[i],h=this.pixelRatio,l=Gy(Array.isArray(t)?t[0]:t,r.textAlign||Kd),u=nm[r.textBaseline||Kp],f=o&&o.lineWidth?o.lineWidth:0,m=a.width/h-2*r.scale[0],g=l*m+2*(.5-l)*f,y=u*a.height/h+2*(.5-u)*f;return{label:a,anchorX:g,anchorY:y}}execute_(t,e,i,s,r,a,o,h){const l=this.zIndexContext_;let u;this.pixelCoordinates_&&Mh(i,this.renderedTransform_)?u=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),u=lh(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),T8(this.renderedTransform_,i));let f=0;const m=s.length;let g=0,y,_,w,M,T,A,R,I,L,k,Y,K,rt,ut=0,Z=0,ht=null,O=null;const pt=this.coordinateCache_,Gt=this.viewRotation_,Ft=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,oe={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:Gt},Dt=this.instructions!=s||this.overlaps?0:200;let re,yt,gt,ge;for(;f<m;){const Et=s[f];switch(Et[0]){case Oe.BEGIN_GEOMETRY:re=Et[1],ge=Et[3],re.getGeometry()?o!==void 0&&!Gs(o,ge.getExtent())?f=Et[2]+1:++f:f=Et[2],l&&(l.zIndex=Et[4]);break;case Oe.BEGIN_PATH:ut>Dt&&(this.fill_(t),ut=0),Z>Dt&&(t.stroke(),Z=0),!ut&&!Z&&(t.beginPath(),T=NaN,A=NaN),++f;break;case Oe.CIRCLE:g=Et[1];const Je=u[g],Qe=u[g+1],Te=u[g+2],Xe=u[g+3],ti=Te-Je,je=Xe-Qe,ms=Math.sqrt(ti*ti+je*je);t.moveTo(Je+ms,Qe),t.arc(Je,Qe,ms,0,2*Math.PI,!0),++f;break;case Oe.CLOSE_PATH:t.closePath(),++f;break;case Oe.CUSTOM:g=Et[1],y=Et[2];const gs=Et[3],P=Et[4],Ut=Et[5];oe.geometry=gs,oe.feature=re,f in pt||(pt[f]=[]);const Ct=pt[f];Ut?Ut(u,g,y,2,Ct):(Ct[0]=u[g],Ct[1]=u[g+1],Ct.length=2),l&&(l.zIndex=Et[6]),P(Ct,oe),++f;break;case Oe.DRAW_IMAGE:g=Et[1],y=Et[2],L=Et[3],_=Et[4],w=Et[5];let nt=Et[6];const tt=Et[7],mt=Et[8],Ht=Et[9],Xt=Et[10];let _t=Et[11];const Qt=Et[12];let At=Et[13];M=Et[14]||"declutter";const jt=Et[15];if(!L&&Et.length>=20){k=Et[19],Y=Et[20],K=Et[21],rt=Et[22];const Rs=this.drawLabelWithPointPlacement_(k,Y,K,rt);L=Rs.label,Et[3]=L;const Fi=Et[23];_=(Rs.anchorX-Fi)*this.pixelRatio,Et[4]=_;const Is=Et[24];w=(Rs.anchorY-Is)*this.pixelRatio,Et[5]=w,nt=L.height,Et[6]=nt,At=L.width,Et[13]=At}let ve;Et.length>25&&(ve=Et[25]);let pi,Ye,wn;Et.length>17?(pi=Et[16],Ye=Et[17],wn=Et[18]):(pi=Kh,Ye=!1,wn=!1),Xt&&Ft?_t+=Gt:!Xt&&!Ft&&(_t-=Gt);let Ga=0;for(;g<y;g+=2){if(ve&&ve[Ga++]<At/this.pixelRatio)continue;const Rs=this.calculateImageOrLabelDimensions_(L.width,L.height,u[g],u[g+1],At,nt,_,w,mt,Ht,_t,Qt,r,pi,Ye||wn,re),Fi=[t,e,L,Rs,tt,Ye?ht:null,wn?O:null];if(h){let Is,Zs,Ns;if(jt){const Ii=y-g;if(!jt[Ii]){jt[Ii]={args:Fi,declutterMode:M};continue}const Gn=jt[Ii];Is=Gn.args,Zs=Gn.declutterMode,delete jt[Ii],Ns=kM(Is)}let Ar,Rr;if(Is&&(Zs!=="declutter"||!h.collides(Ns))&&(Ar=!0),(M!=="declutter"||!h.collides(Rs.declutterBox))&&(Rr=!0),Zs==="declutter"&&M==="declutter"){const Ii=Ar&&Rr;Ar=Ii,Rr=Ii}Ar&&(Zs!=="none"&&h.insert(Ns),this.replayImageOrLabel_.apply(this,Is)),Rr&&(M!=="none"&&h.insert(Rs.declutterBox),this.replayImageOrLabel_.apply(this,Fi))}else this.replayImageOrLabel_.apply(this,Fi)}++f;break;case Oe.DRAW_CHARS:const ys=Et[1],ha=Et[2],Ni=Et[3],ko=Et[4];rt=Et[5];const Ih=Et[6],As=Et[7],la=Et[8];K=Et[9];const ca=Et[10];k=Et[11],Y=Et[12];const Nh=[Et[13],Et[13]];M=Et[14]||"declutter";const kh=this.textStates[Y],ua=kh.font,js=[kh.scale[0]*As,kh.scale[1]*As];let Ee;ua in this.widths_?Ee=this.widths_[ua]:(Ee={},this.widths_[ua]=Ee);const n0=HC(u,ys,ha,2),s0=Math.abs(js[0])*uM(ua,k,Ee);if(ko||s0<=n0){const Rs=this.textStates[Y].textAlign,Fi=(n0-s0)*Gy(k,Rs),Is=SU(u,ys,ha,2,k,Fi,Ih,Math.abs(js[0]),uM,ua,Ee,Ft?0:this.viewRotation_);t:if(Is){const Zs=[];let Ns,Ar,Rr,Ii,Gn;if(K)for(Ns=0,Ar=Is.length;Ns<Ar;++Ns){Gn=Is[Ns],Rr=Gn[4],Ii=this.createLabel(Rr,Y,"",K),_=Gn[2]+(js[0]<0?-ca:ca),w=Ni*Ii.height+(.5-Ni)*2*ca*js[1]/js[0]-la;const Ir=this.calculateImageOrLabelDimensions_(Ii.width,Ii.height,Gn[0],Gn[1],Ii.width,Ii.height,_,w,0,0,Gn[3],Nh,!1,Kh,!1,re);if(h&&M==="declutter"&&h.collides(Ir.declutterBox))break t;Zs.push([t,e,Ii,Ir,1,null,null])}if(rt)for(Ns=0,Ar=Is.length;Ns<Ar;++Ns){Gn=Is[Ns],Rr=Gn[4],Ii=this.createLabel(Rr,Y,rt,""),_=Gn[2],w=Ni*Ii.height-la;const Ir=this.calculateImageOrLabelDimensions_(Ii.width,Ii.height,Gn[0],Gn[1],Ii.width,Ii.height,_,w,0,0,Gn[3],Nh,!1,Kh,!1,re);if(h&&M==="declutter"&&h.collides(Ir.declutterBox))break t;Zs.push([t,e,Ii,Ir,1,null,null])}h&&M!=="none"&&h.load(Zs.map(kM));for(let Ir=0,Ou=Zs.length;Ir<Ou;++Ir)this.replayImageOrLabel_.apply(this,Zs[Ir])}}++f;break;case Oe.END_GEOMETRY:if(a!==void 0){re=Et[1];const Rs=a(re,ge,M);if(Rs)return Rs}++f;break;case Oe.FILL:Dt?ut++:this.fill_(t),++f;break;case Oe.MOVE_TO_LINE_TO:for(g=Et[1],y=Et[2],yt=u[g],gt=u[g+1],t.moveTo(yt,gt),T=yt+.5|0,A=gt+.5|0,g+=2;g<y;g+=2)yt=u[g],gt=u[g+1],R=yt+.5|0,I=gt+.5|0,(g==y-2||R!==T||I!==A)&&(t.lineTo(yt,gt),T=R,A=I);++f;break;case Oe.SET_FILL_STYLE:ht=Et,this.alignAndScaleFill_=Et[2],ut&&(this.fill_(t),ut=0,Z&&(t.stroke(),Z=0)),t.fillStyle=Et[1],++f;break;case Oe.SET_STROKE_STYLE:O=Et,Z&&(t.stroke(),Z=0),this.setStrokeStyle_(t,Et),++f;break;case Oe.STROKE:Dt?Z++:t.stroke(),++f;break;default:++f;break}}ut&&this.fill_(t),Z&&t.stroke()}execute(t,e,i,s,r,a){this.viewRotation_=s,this.execute_(t,e,i,this.instructions,r,void 0,void 0,a)}executeHitDetection(t,e,i,s,r){return this.viewRotation_=i,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,s,r)}}const AU=CU,_c=["Polygon","Circle","LineString","Image","Text","Default"],qC=["Image","Text"],RU=_c.filter(n=>!qC.includes(n));class IU{constructor(t,e,i,s,r,a,o){this.maxExtent_=t,this.overlaps_=s,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=a,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Ts(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(r,o)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t,e){for(const i in t){let s=this.executorsByZIndex_[i];s===void 0&&(s={},this.executorsByZIndex_[i]=s);const r=t[i];for(const a in r){const o=r[a];s[a]=new AU(this.resolution_,this.pixelRatio_,this.overlaps_,o,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let s=0,r=t.length;s<r;++s)if(t[s]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,s,r,a){s=Math.round(s);const o=s*2+1,h=ka(this.hitDetectionTransform_,s+.5,s+.5,1/e,-1/e,-i,-t[0],-t[1]),l=!this.hitDetectionContext_;l&&(this.hitDetectionContext_=yn(o,o,void 0,{willReadFrequently:!0}));const u=this.hitDetectionContext_;u.canvas.width!==o||u.canvas.height!==o?(u.canvas.width=o,u.canvas.height=o):l||u.clearRect(0,0,o,o);let f;this.renderBuffer_!==void 0&&(f=Jr(),Md(f,t),ux(f,e*(this.renderBuffer_+s),f));const m=NU(s);let g;function y(I,L,k){const Y=u.getImageData(0,0,o,o).data;for(let K=0,rt=m.length;K<rt;K++)if(Y[m[K]]>0){if(!a||k==="none"||g!=="Image"&&g!=="Text"||a.includes(I)){const ut=(m[K]-3)/4,Z=s-ut%o,ht=s-(ut/o|0),O=r(I,L,Z*Z+ht*ht);if(O)return O}u.clearRect(0,0,o,o);break}}const _=Object.keys(this.executorsByZIndex_).map(Number);_.sort(oh);let w,M,T,A,R;for(w=_.length-1;w>=0;--w){const I=_[w].toString();for(T=this.executorsByZIndex_[I],M=_c.length-1;M>=0;--M)if(g=_c[M],A=T[g],A!==void 0&&(R=A.executeHitDetection(u,h,i,y,f),R))return R}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],s=e[1],r=e[2],a=e[3],o=[i,s,i,a,r,a,r,s];return lh(o,0,8,2,t,o),o}isEmpty(){return al(this.executorsByZIndex_)}execute(t,e,i,s,r,a,o){const h=Object.keys(this.executorsByZIndex_).map(Number);h.sort(oh),a=a||_c;const l=_c.length;let u,f,m,g,y;for(o&&h.reverse(),u=0,f=h.length;u<f;++u){const _=h[u].toString();for(y=this.executorsByZIndex_[_],m=0,g=a.length;m<g;++m){const w=a[m],M=y[w];if(M!==void 0){const T=o===null?void 0:M.getZIndexContext(),A=T?T.getContext():t,R=this.maxExtent_&&w!=="Image"&&w!=="Text";if(R&&(A.save(),this.clip(A,i)),!T||w==="Text"||w==="Image"?M.execute(A,e,i,s,r,o):T.pushFunction(I=>M.execute(I,e,i,s,r,o)),R&&A.restore(),T){T.offset();const I=h[u]*l+m;this.deferredZIndexContexts_[I]||(this.deferredZIndexContexts_[I]=[]),this.deferredZIndexContexts_[I].push(T)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(oh);for(let i=0,s=e.length;i<s;++i)t[e[i]].forEach(r=>{r.draw(this.renderedContext_),r.clear()}),t[e[i]].length=0}}const Vy={};function NU(n){if(Vy[n]!==void 0)return Vy[n];const t=n*2+1,e=n*n,i=new Array(e+1);for(let r=0;r<=n;++r)for(let a=0;a<=n;++a){const o=r*r+a*a;if(o>e)break;let h=i[o];h||(h=[],i[o]=h),h.push(((n+r)*t+(n+a))*4+3),r>0&&h.push(((n-r)*t+(n+a))*4+3),a>0&&(h.push(((n+r)*t+(n-a))*4+3),r>0&&h.push(((n-r)*t+(n-a))*4+3))}const s=[];for(let r=0,a=i.length;r<a;++r)i[r]&&s.push(...i[r]);return Vy[n]=s,s}const kU=IU;class LU extends $C{constructor(t,e,i,s,r,a,o){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=s,this.transformRotation_=s?Hm(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=a,this.userTransform_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Ts()}drawImages_(t,e,i,s){if(!this.image_)return;const r=lh(t,e,i,s,this.transform_,this.pixelCoordinates_),a=this.context_,o=this.tmpLocalTransform_,h=a.globalAlpha;this.imageOpacity_!=1&&(a.globalAlpha=h*this.imageOpacity_);let l=this.imageRotation_;this.transformRotation_===0&&(l-=this.viewRotation_),this.imageRotateWithView_&&(l+=this.viewRotation_);for(let u=0,f=r.length;u<f;u+=2){const m=r[u]-this.imageAnchorX_,g=r[u+1]-this.imageAnchorY_;if(l!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const y=m+this.imageAnchorX_,_=g+this.imageAnchorY_;ka(o,y,_,1,1,l,-y,-_),a.save(),a.transform.apply(a,o),a.translate(y,_),a.scale(this.imageScale_[0],this.imageScale_[1]),a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),a.restore()}else a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,m,g,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(a.globalAlpha=h)}drawText_(t,e,i,s){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=lh(t,e,i,s,this.transform_,this.pixelCoordinates_),a=this.context_;let o=this.textRotation_;for(this.transformRotation_===0&&(o-=this.viewRotation_),this.textRotateWithView_&&(o+=this.viewRotation_);e<i;e+=s){const h=r[e]+this.textOffsetX_,l=r[e+1]+this.textOffsetY_;o!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(a.save(),a.translate(h-this.textOffsetX_,l-this.textOffsetY_),a.rotate(o),a.translate(this.textOffsetX_,this.textOffsetY_),a.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&a.strokeText(this.text_,0,0),this.textFillState_&&a.fillText(this.text_,0,0),a.restore()):(this.textStrokeState_&&a.strokeText(this.text_,h,l),this.textFillState_&&a.fillText(this.text_,h,l))}}moveToLineTo_(t,e,i,s,r){const a=this.context_,o=lh(t,e,i,s,this.transform_,this.pixelCoordinates_);a.moveTo(o[0],o[1]);let h=o.length;r&&(h-=2);for(let l=2;l<h;l+=2)a.lineTo(o[l],o[l+1]);return r&&a.closePath(),i}drawRings_(t,e,i,s){for(let r=0,a=i.length;r<a;++r)e=this.moveToLineTo_(t,e,i[r],s,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Gs(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=O8(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],s=e[3]-e[1],r=Math.sqrt(i*i+s*s),a=this.context_;a.beginPath(),a.arc(e[0],e[1],r,0,2*Math.PI),this.fillState_&&a.fill(),this.strokeState_&&a.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const i=e.getGeometryFunction()(t);!i||(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,s=e.length;i<s;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Gs(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(!!Gs(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,s=t.getFlatCoordinates();let r=0;const a=t.getEnds(),o=t.getStride();i.beginPath();for(let h=0,l=a.length;h<l;++h)r=this.moveToLineTo_(s,r,a[h],o,!1);i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Gs(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Gs(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let s=0;const r=t.getEndss(),a=t.getStride();e.beginPath();for(let o=0,h=r.length;o<h;++o){const l=r[o];s=this.drawRings_(i,s,l,a)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),Mh(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,s=t.textAlign?t.textAlign:Kd;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=s&&(i.textAlign=s,e.textAlign=s),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=s,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:s,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const i=t.getColor();this.fillState_={fillStyle:Ca(i||Us)}}if(!e)this.strokeState_=null;else{const i=e.getColor(),s=e.getLineCap(),r=e.getLineDash(),a=e.getLineDashOffset(),o=e.getLineJoin(),h=e.getWidth(),l=e.getMiterLimit(),u=r||fo;this.strokeState_={lineCap:s!==void 0?s:nu,lineDash:this.pixelRatio_===1?u:u.map(f=>f*this.pixelRatio_),lineDashOffset:(a||po)*this.pixelRatio_,lineJoin:o!==void 0?o:su,lineWidth:(h!==void 0?h:Jd)*this.pixelRatio_,miterLimit:l!==void 0?l:jd,strokeStyle:Ca(i||Zd)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const i=t.getPixelRatio(this.pixelRatio_),s=t.getAnchor(),r=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*i,this.imageAnchorY_=s[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const a=t.getScaleArray();this.imageScale_=[a[0]*this.pixelRatio_/i,a[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const g=e.getColor();this.textFillState_={fillStyle:Ca(g||Us)}}const i=t.getStroke();if(!i)this.textStrokeState_=null;else{const g=i.getColor(),y=i.getLineCap(),_=i.getLineDash(),w=i.getLineDashOffset(),M=i.getLineJoin(),T=i.getWidth(),A=i.getMiterLimit();this.textStrokeState_={lineCap:y!==void 0?y:nu,lineDash:_||fo,lineDashOffset:w||po,lineJoin:M!==void 0?M:su,lineWidth:T!==void 0?T:Jd,miterLimit:A!==void 0?A:jd,strokeStyle:Ca(g||Zd)}}const s=t.getFont(),r=t.getOffsetX(),a=t.getOffsetY(),o=t.getRotateWithView(),h=t.getRotation(),l=t.getScaleArray(),u=t.getText(),f=t.getTextAlign(),m=t.getTextBaseline();this.textState_={font:s!==void 0?s:mC,textAlign:f!==void 0?f:Kd,textBaseline:m!==void 0?m:Kp},this.text_=u!==void 0?Array.isArray(u)?u.reduce((g,y,_)=>g+=_%2?" ":y,""):u:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=a!==void 0?this.pixelRatio_*a:0,this.textRotateWithView_=o!==void 0?o:!1,this.textRotation_=h!==void 0?h:0,this.textScale_=[this.pixelRatio_*l[0],this.pixelRatio_*l[1]]}}}const OU=LU,Ma=.5;function PU(n,t,e,i,s,r,a,o,h){const l=h?Xm(s):s,u=n[0]*Ma,f=n[1]*Ma,m=yn(u,f);m.imageSmoothingEnabled=!1;const g=m.canvas,y=new OU(m,Ma,s,null,a,o,h?qm(a4(),h):null),_=e.length,w=Math.floor((256*256*256-1)/_),M={};for(let A=1;A<=_;++A){const R=e[A-1],I=R.getStyleFunction()||i;if(!I)continue;let L=I(R,r);if(!L)continue;Array.isArray(L)||(L=[L]);const Y=(A*w).toString(16).padStart(7,"#00000");for(let K=0,rt=L.length;K<rt;++K){const ut=L[K],Z=ut.getGeometryFunction()(R);if(!Z||!Gs(l,Z.getExtent()))continue;const ht=ut.clone(),O=ht.getFill();O&&O.setColor(Y);const pt=ht.getStroke();pt&&(pt.setColor(Y),pt.setLineDash(null)),ht.setText(void 0);const Gt=ut.getImage();if(Gt){const re=Gt.getImageSize();if(!re)continue;const yt=yn(re[0],re[1],void 0,{alpha:!1}),gt=yt.canvas;yt.fillStyle=Y,yt.fillRect(0,0,gt.width,gt.height),ht.setImage(new vl({img:gt,anchor:Gt.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:Gt.getOrigin(),opacity:1,size:Gt.getSize(),scale:Gt.getScale(),rotation:Gt.getRotation(),rotateWithView:Gt.getRotateWithView()}))}const Ft=ht.getZIndex()||0;let oe=M[Ft];oe||(oe={},M[Ft]=oe,oe.Polygon=[],oe.Circle=[],oe.LineString=[],oe.Point=[]);const Dt=Z.getType();if(Dt==="GeometryCollection"){const re=Z.getGeometriesArrayRecursive();for(let yt=0,gt=re.length;yt<gt;++yt){const ge=re[yt];oe[ge.getType().replace("Multi","")].push(ge,ht)}}else oe[Dt.replace("Multi","")].push(Z,ht)}}const T=Object.keys(M).map(Number).sort(oh);for(let A=0,R=T.length;A<R;++A){const I=M[T[A]];for(const L in I){const k=I[L];for(let Y=0,K=k.length;Y<K;Y+=2){y.setStyle(k[Y+1]);for(let rt=0,ut=t.length;rt<ut;++rt)y.setTransform(t[rt]),y.drawGeometry(k[Y])}}}return m.getImageData(0,0,g.width,g.height)}function FU(n,t,e){const i=[];if(e){const s=Math.floor(Math.round(n[0])*Ma),r=Math.floor(Math.round(n[1])*Ma),a=(Ui(s,0,e.width-1)+Ui(r,0,e.height-1)*e.width)*4,o=e.data[a],h=e.data[a+1],u=e.data[a+2]+256*(h+256*o),f=Math.floor((256*256*256-1)/t.length);u&&u%f===0&&i.push(t[u/f-1])}return i}const DU=.5,XC={Point:YU,LineString:VU,Polygon:qU,MultiPoint:HU,MultiLineString:WU,MultiPolygon:$U,GeometryCollection:GU,Circle:BU};function zU(n,t){return parseInt($e(n),10)-parseInt($e(t),10)}function OM(n,t){const e=jC(n,t);return e*e}function jC(n,t){return DU*n/t}function BU(n,t,e,i,s){const r=e.getFill(),a=e.getStroke();if(r||a){const h=n.getBuilder(e.getZIndex(),"Circle");h.setFillStrokeStyle(r,a),h.drawCircle(t,i,s)}const o=e.getText();if(o&&o.getText()){const h=n.getBuilder(e.getZIndex(),"Text");h.setTextStyle(o),h.drawText(t,i)}}function PM(n,t,e,i,s,r,a,o){const h=[],l=e.getImage();if(l){let m=!0;const g=l.getImageState();g==Ge.LOADED||g==Ge.ERROR?m=!1:g==Ge.IDLE&&l.load(),m&&h.push(l.ready())}const u=e.getFill();u&&u.loading()&&h.push(u.ready());const f=h.length>0;return f&&Promise.all(h).then(()=>s(null)),UU(n,t,e,i,r,a,o),f}function UU(n,t,e,i,s,r,a){const o=e.getGeometryFunction()(t);if(!o)return;const h=o.simplifyTransformed(i,s);if(e.getRenderer())ZC(n,h,e,t,a);else{const u=XC[h.getType()];u(n,h,e,t,a,r)}}function ZC(n,t,e,i,s){if(t.getType()=="GeometryCollection"){const a=t.getGeometries();for(let o=0,h=a.length;o<h;++o)ZC(n,a[o],e,i,s);return}n.getBuilder(e.getZIndex(),"Default").drawCustom(t,i,e.getRenderer(),e.getHitDetectionRenderer(),s)}function GU(n,t,e,i,s,r){const a=t.getGeometriesArray();let o,h;for(o=0,h=a.length;o<h;++o){const l=XC[a[o].getType()];l(n,a[o],e,i,s,r)}}function VU(n,t,e,i,s){const r=e.getStroke();if(r){const o=n.getBuilder(e.getZIndex(),"LineString");o.setFillStrokeStyle(null,r),o.drawLineString(t,i,s)}const a=e.getText();if(a&&a.getText()){const o=n.getBuilder(e.getZIndex(),"Text");o.setTextStyle(a),o.drawText(t,i,s)}}function WU(n,t,e,i,s){const r=e.getStroke();if(r){const o=n.getBuilder(e.getZIndex(),"LineString");o.setFillStrokeStyle(null,r),o.drawMultiLineString(t,i,s)}const a=e.getText();if(a&&a.getText()){const o=n.getBuilder(e.getZIndex(),"Text");o.setTextStyle(a),o.drawText(t,i,s)}}function $U(n,t,e,i,s){const r=e.getFill(),a=e.getStroke();if(a||r){const h=n.getBuilder(e.getZIndex(),"Polygon");h.setFillStrokeStyle(r,a),h.drawMultiPolygon(t,i,s)}const o=e.getText();if(o&&o.getText()){const h=n.getBuilder(e.getZIndex(),"Text");h.setTextStyle(o),h.drawText(t,i,s)}}function YU(n,t,e,i,s,r){const a=e.getImage(),o=e.getText(),h=o&&o.getText(),l=r&&a&&h?{}:void 0;if(a){if(a.getImageState()!=Ge.LOADED)return;const u=n.getBuilder(e.getZIndex(),"Image");u.setImageStyle(a,l),u.drawPoint(t,i,s)}if(h){const u=n.getBuilder(e.getZIndex(),"Text");u.setTextStyle(o,l),u.drawText(t,i,s)}}function HU(n,t,e,i,s,r){const a=e.getImage(),o=a&&a.getOpacity()!==0,h=e.getText(),l=h&&h.getText(),u=r&&o&&l?{}:void 0;if(o){if(a.getImageState()!=Ge.LOADED)return;const f=n.getBuilder(e.getZIndex(),"Image");f.setImageStyle(a,u),f.drawMultiPoint(t,i,s)}if(l){const f=n.getBuilder(e.getZIndex(),"Text");f.setTextStyle(h,u),f.drawText(t,i,s)}}function qU(n,t,e,i,s){const r=e.getFill(),a=e.getStroke();if(r||a){const h=n.getBuilder(e.getZIndex(),"Polygon");h.setFillStrokeStyle(r,a),h.drawPolygon(t,i,s)}const o=e.getText();if(o&&o.getText()){const h=n.getBuilder(e.getZIndex(),"Text");h.setTextStyle(o),h.drawText(t,i,s)}}class XU extends EU{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Jr(),this.wrappedRenderedExtent_=Jr(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,i){const s=e.extent,r=e.viewState,a=r.center,o=r.resolution,h=r.projection,l=r.rotation,u=h.getExtent(),f=this.getLayer().getSource(),m=this.getLayer().getDeclutter(),g=e.pixelRatio,y=e.viewHints,_=!(y[rs.ANIMATING]||y[rs.INTERACTING]),w=this.context,M=Math.round(fi(s)/o*g),T=Math.round(cs(s)/o*g),A=f.getWrapX()&&h.canWrapX(),R=A?fi(u):null,I=A?Math.ceil((s[2]-u[2])/R)+1:1;let L=A?Math.floor((s[0]-u[0])/R):0;do{let k=this.getRenderTransform(a,o,0,g,M,T,L*R);e.declutter&&(k=k.slice(0)),t.execute(w,[w.canvas.width,w.canvas.height],k,l,_,i===void 0?_c:i?qC:RU,i?m&&e.declutter[m]:void 0)}while(++L<I)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=yn(this.context.canvas.width,this.context.canvas.height,NM))}resetDrawContext_(){if(this.opacity_!==1){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,Kc(this.context),NM.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){!this.replayGroup_||(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex];this.opacity_=i.opacity;const s=t.viewState;this.prepareContainer(t,e);const r=this.context,a=this.replayGroup_;let o=a&&!a.isEmpty();if(!o&&!(this.getLayer().hasListener(Dn.PRERENDER)||this.getLayer().hasListener(Dn.POSTRENDER)))return null;if(this.setDrawContext_(),this.preRender(r,t),s.projection,this.clipped_=!1,o&&i.extent&&this.clipping){const h=jh(i.extent);o=Gs(h,t.extent),this.clipped_=o&&!Xh(h,t.extent),this.clipped_&&this.clipUnrotated(r,t,h)}return o&&this.renderWorlds(a,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&r.restore(),this.postRender(r,t),this.renderedRotation_!==s.rotation&&(this.renderedRotation_=s.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=this.frameState.size.slice(),s=this.renderedCenter_,r=this.renderedResolution_,a=this.renderedRotation_,o=this.renderedProjection_,h=this.wrappedRenderedExtent_,l=this.getLayer(),u=[],f=i[0]*Ma,m=i[1]*Ma;u.push(this.getRenderTransform(s,r,a,Ma,f,m,0).slice());const g=l.getSource(),y=o.getExtent();if(g.getWrapX()&&o.canWrapX()&&!Xh(y,h)){let _=h[0];const w=fi(y);let M=0,T;for(;_<y[0];)--M,T=w*M,u.push(this.getRenderTransform(s,r,a,Ma,f,m,T).slice()),_+=w;for(M=0,_=h[2];_>y[2];)++M,T=w*M,u.push(this.getRenderTransform(s,r,a,Ma,f,m,T).slice()),_-=w}this.hitDetectionImageData_=PU(i,u,this.renderedFeatures_,l.getStyleFunction(),h,r,a,OM(r,this.renderedPixelRatio_),null)}e(FU(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,i,s,r){if(!this.replayGroup_)return;const a=e.viewState.resolution,o=e.viewState.rotation,h=this.getLayer(),l={},u=function(y,_,w){const M=$e(y),T=l[M];if(T){if(T!==!0&&w<T.distanceSq){if(w===0)return l[M]=!0,r.splice(r.lastIndexOf(T),1),s(y,h,_);T.geometry=_,T.distanceSq=w}}else{if(w===0)return l[M]=!0,s(y,h,_);r.push(l[M]={feature:y,layer:h,geometry:_,distanceSq:w,callback:s})}};let f;const m=[this.replayGroup_],g=this.getLayer().getDeclutter();return m.some(y=>f=y.forEachFeatureAtCoordinate(t,a,o,i,u,g&&e.declutter[g]?e.declutter[g].all().map(_=>_.value):null)),f}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const s=t.viewHints[rs.ANIMATING],r=t.viewHints[rs.INTERACTING],a=e.getUpdateWhileAnimating(),o=e.getUpdateWhileInteracting();if(this.ready&&!a&&s||!o&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const h=t.extent,l=t.viewState,u=l.projection,f=l.resolution,m=t.pixelRatio,g=e.getRevision(),y=e.getRenderBuffer();let _=e.getRenderOrder();_===void 0&&(_=zU);const w=l.center.slice(),M=ux(h,y*f),T=M.slice(),A=[M.slice()],R=u.getExtent();if(i.getWrapX()&&u.canWrapX()&&!Xh(R,t.extent)){const O=fi(R),pt=Math.max(fi(M)/2,O);M[0]=R[0]-pt,M[2]=R[2]+pt,hT(w,u);const Gt=sT(A[0],u);Gt[0]<R[0]&&Gt[2]<R[2]?A.push([Gt[0]+O,Gt[1],Gt[2]+O,Gt[3]]):Gt[0]>R[0]&&Gt[2]>R[2]&&A.push([Gt[0]-O,Gt[1],Gt[2]-O,Gt[3]])}if(this.ready&&this.renderedResolution_==f&&this.renderedRevision_==g&&this.renderedRenderOrder_==_&&this.renderedFrameDeclutter_===!!t.declutter&&Xh(this.wrappedRenderedExtent_,M))return Mh(this.renderedExtent_,T)||(this.hitDetectionImageData_=null,this.renderedExtent_=T),this.renderedCenter_=w,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const I=new vU(jC(f,m),M,f,m);let L;for(let O=0,pt=A.length;O<pt;++O)i.loadFeatures(A[O],f,u);const k=OM(f,m);let Y=!0;const K=(O,pt)=>{let Gt;const Ft=O.getStyleFunction()||e.getStyleFunction();if(Ft&&(Gt=Ft(O,f)),Gt){const oe=this.renderFeature(O,k,Gt,I,L,this.getLayer().getDeclutter(),pt);Y=Y&&!oe}},rt=Xm(M),ut=i.getFeaturesInExtent(rt);_&&ut.sort(_);for(let O=0,pt=ut.length;O<pt;++O)K(ut[O],O);this.renderedFeatures_=ut,this.ready=Y;const Z=I.finish(),ht=new kU(M,f,m,i.getOverlaps(),Z,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=f,this.renderedRevision_=g,this.renderedRenderOrder_=_,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=T,this.wrappedRenderedExtent_=M,this.renderedCenter_=w,this.renderedProjection_=u,this.renderedPixelRatio_=m,this.replayGroup_=ht,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,s,r,a,o){if(!i)return!1;let h=!1;if(Array.isArray(i))for(let l=0,u=i.length;l<u;++l)h=PM(s,t,i[l],e,this.boundHandleStyleImageChange_,r,a,o)||h;else h=PM(s,t,i,e,this.boundHandleStyleImageChange_,r,a,o);return h}}const jU=XU;class ZU extends CC{constructor(t){super(t)}createRenderer(){return new jU(this)}}const vu=ZU;function KU(n,t){const e=/\{z\}/g,i=/\{x\}/g,s=/\{y\}/g,r=/\{-y\}/g;return function(a,o,h){if(!!a)return n.replace(e,a[0].toString()).replace(i,a[1].toString()).replace(s,a[2].toString()).replace(r,function(){const l=a[0],u=t.getFullTileRange(l);if(!u)throw new Error("The {-y} placeholder requires a tile grid with extent");return(u.getHeight()-a[2]-1).toString()})}}function JU(n,t){const e=n.length,i=new Array(e);for(let s=0;s<e;++s)i[s]=KU(n[s],t);return QU(i)}function QU(n){return n.length===1?n[0]:function(t,e,i){if(!t)return;const s=p4(t),r=kc(s,n.length);return n[r](t,e,i)}}function t7(n){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(n);if(e){const i=e[1].charCodeAt(0),s=e[2].charCodeAt(0);let r;for(r=i;r<=s;++r)t.push(n.replace(e[0],String.fromCharCode(r)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(n),e){const i=parseInt(e[2],10);for(let s=parseInt(e[1],10);s<=i;s++)t.push(n.replace(e[0],s.toString()));return t}return t.push(n),t}class Pv extends AT{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Pv.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=$e(e),s=e.getState();let r;s==le.LOADING?(this.tileLoadingKeys_[i]=!0,r=Lc.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],r=s==le.ERROR?Lc.TILELOADERROR:s==le.LOADED?Lc.TILELOADEND:void 0),r!=null&&this.dispatchEvent(new CT(r,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=t7(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(JU(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}useTile(t,e,i){const s=Qc(t,e,i);this.tileCache.containsKey(s)&&this.tileCache.get(s)}}const e7=Pv;class i7 extends e7{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:n7,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:Av,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(const s in this.tileCacheForProjection){const r=this.tileCacheForProjection[s];r.expireCache(r==i?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!zr(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return this.getProjection()&&t&&!zr(this.getProjection(),t)?!1:super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||zr(e,t)))return this.tileGrid;const i=$e(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=Ax(t)),this.tileGridForProjection[i]}getTileCacheForProjection(t){const e=this.getProjection();if(!e||zr(e,t))return this.tileCache;const i=$e(t);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new Ex(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(t,e,i,s,r,a){const o=[t,e,i],h=this.getTileCoordForTileUrlFunction(o,r),l=h?this.tileUrlFunction(h,s,r):void 0,u=new this.tileClass(o,l!==void 0?le.IDLE:le.EMPTY,l!==void 0?l:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return u.key=a,u.addEventListener(Ne.CHANGE,this.handleTileChange.bind(this)),u}getTile(t,e,i,s,r){const a=this.getProjection();if(!a||!r||zr(a,r))return this.getTileInternal(t,e,i,s,a||r);const o=this.getTileCacheForProjection(r),h=[t,e,i];let l;const u=Ko(h);o.containsKey(u)&&(l=o.get(u));const f=this.getKey();if(l&&l.key==f)return l;const m=this.getTileGridForProjection(a),g=this.getTileGridForProjection(r),y=this.getTileCoordForTileUrlFunction(h,r),_=new og(a,m,r,g,h,y,this.getTilePixelRatio(s),this.getGutter(),(w,M,T,A)=>this.getTileInternal(w,M,T,A,a),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return _.key=f,l?(_.interimTile=l,_.refreshInterimChain(),o.replace(u,_)):o.set(u,_),_}getTileInternal(t,e,i,s,r){let a=null;const o=Qc(t,e,i),h=this.getKey();if(!this.tileCache.containsKey(o))a=this.createTile_(t,e,i,s,r,h),this.tileCache.set(o,a);else if(a=this.tileCache.get(o),a.key!=h){const l=a;a=this.createTile_(t,e,i,s,r,h),l.getState()==le.IDLE?a.interimTile=l.interimTile:a.interimTile=l,a.refreshInterimChain(),this.tileCache.replace(o,a)}return a}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){const i=Ri(t);if(i){const s=$e(i);s in this.tileGridForProjection||(this.tileGridForProjection[s]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}}function n7(n,t){n.getImage().src=t}const s7=i7;class r7 extends s7{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",i=t.tileGrid!==void 0?t.tileGrid:ST({extent:Km(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}const lg=r7,a7='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class o7 extends lg{constructor(t){t=t||{};let e;t.attributions!==void 0?e=t.attributions:e=[a7];const i=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",s=t.url!==void 0?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:i,interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:19,opaque:t.opaque!==void 0?t.opaque:!0,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:s,wrapX:t.wrapX,zDirection:t.zDirection})}}const h7=o7,ts={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class l7 extends sa{constructor(t){super(),this.on,this.once,this.un,this.options=t,this.id=t.id,this.insertFirst=t.insertFirst!==void 0?t.insertFirst:!0,this.stopEvent=t.stopEvent!==void 0?t.stopEvent:!0,this.element=document.createElement("div"),this.element.className=t.className!==void 0?t.className:"ol-overlay-container "+pz,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=t.autoPan===!0?{}:t.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(ts.ELEMENT,this.handleElementChanged),this.addChangeListener(ts.MAP,this.handleMapChanged),this.addChangeListener(ts.OFFSET,this.handleOffsetChanged),this.addChangeListener(ts.POSITION,this.handlePositionChanged),this.addChangeListener(ts.POSITIONING,this.handlePositioningChanged),t.element!==void 0&&this.setElement(t.element),this.setOffset(t.offset!==void 0?t.offset:[0,0]),this.setPositioning(t.positioning||"top-left"),t.position!==void 0&&this.setPosition(t.position)}getElement(){return this.get(ts.ELEMENT)}getId(){return this.id}getMap(){return this.get(ts.MAP)||null}getOffset(){return this.get(ts.OFFSET)}getPosition(){return this.get(ts.POSITION)}getPositioning(){return this.get(ts.POSITIONING)}handleElementChanged(){JS(this.element);const t=this.getElement();t&&this.element.appendChild(t)}handleMapChanged(){this.mapPostrenderListenerKey&&(Up(this.element),Li(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const t=this.getMap();if(t){this.mapPostrenderListenerKey=ai(t,io.POSTRENDER,this.render,this),this.updatePixelPosition();const e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(t){this.set(ts.ELEMENT,t)}setMap(t){this.set(ts.MAP,t)}setOffset(t){this.set(ts.OFFSET,t)}setPosition(t){this.set(ts.POSITION,t)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(t){const e=this.getMap();if(!e||!e.getTargetElement()||!this.get(ts.POSITION))return;const i=this.getRect(e.getTargetElement(),e.getSize()),s=this.getElement(),r=this.getRect(s,[ID(s),ND(s)]);t=t||{};const a=t.margin===void 0?20:t.margin;if(!Xh(i,r)){const o=r[0]-i[0],h=i[2]-r[2],l=r[1]-i[1],u=i[3]-r[3],f=[0,0];if(o<0?f[0]=o-a:h<0&&(f[0]=Math.abs(h)+a),l<0?f[1]=l-a:u<0&&(f[1]=Math.abs(u)+a),f[0]!==0||f[1]!==0){const m=e.getView().getCenterInternal(),g=e.getPixelFromCoordinateInternal(m);if(!g)return;const y=[g[0]+f[0],g[1]+f[1]],_=t.animation||{};e.getView().animateInternal({center:e.getCoordinateFromPixelInternal(y),duration:_.duration,easing:_.easing})}}}getRect(t,e){const i=t.getBoundingClientRect(),s=i.left+window.pageXOffset,r=i.top+window.pageYOffset;return[s,r,s+e[0],r+e[1]]}setPositioning(t){this.set(ts.POSITIONING,t)}setVisible(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)}updatePixelPosition(){const t=this.getMap(),e=this.getPosition();if(!t||!t.isRendered()||!e){this.setVisible(!1);return}const i=t.getPixelFromCoordinate(e),s=t.getSize();this.updateRenderedPosition(i,s)}updateRenderedPosition(t,e){const i=this.element.style,s=this.getOffset(),r=this.getPositioning();this.setVisible(!0);const a=Math.round(t[0]+s[0])+"px",o=Math.round(t[1]+s[1])+"px";let h="0%",l="0%";r=="bottom-right"||r=="center-right"||r=="top-right"?h="-100%":(r=="bottom-center"||r=="center-center"||r=="top-center")&&(h="-50%"),r=="bottom-left"||r=="bottom-center"||r=="bottom-right"?l="-100%":(r=="center-left"||r=="center-center"||r=="center-right")&&(l="-50%");const u=`translate(${h}, ${l}) translate(${a}, ${o})`;this.rendered.transform_!=u&&(this.rendered.transform_=u,i.transform=u)}getOptions(){return this.options}}const Fv=l7;class cg extends Th{constructor(t,e,i){super(),i!==void 0&&e===void 0?this.setFlatCoordinates(i,t):(e=e||0,this.setCenterAndRadius(t,e,i))}clone(){const t=new cg(this.flatCoordinates.slice(),void 0,this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){const r=this.flatCoordinates,a=t-r[0],o=e-r[1],h=a*a+o*o;if(h<s){if(h===0)for(let l=0;l<this.stride;++l)i[l]=r[l];else{const l=this.getRadius()/Math.sqrt(h);i[0]=r[0]+l*a,i[1]=r[1]+l*o;for(let u=2;u<this.stride;++u)i[u]=r[u]}return i.length=this.stride,h}return s}containsXY(t,e){const i=this.flatCoordinates,s=t-i[0],r=e-i[1];return s*s+r*r<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(t){const e=this.flatCoordinates,i=e[this.stride]-e[0];return vo(e[0]-i,e[1]-i,e[0]+i,e[1]+i,t)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e}getType(){return"Circle"}intersectsExtent(t){const e=this.getExtent();if(Gs(t,e)){const i=this.getCenter();return t[0]<=i[0]&&t[2]>=i[0]||t[1]<=i[1]&&t[3]>=i[1]?!0:px(t,this.intersectsCoordinate.bind(this))}return!1}setCenter(t){const e=this.stride,i=this.flatCoordinates[e]-this.flatCoordinates[0],s=t.slice();s[e]=s[0]+i;for(let r=1;r<e;++r)s[e+r]=t[r];this.setFlatCoordinates(this.layout,s),this.changed()}setCenterAndRadius(t,e,i){this.setLayout(i,t,0),this.flatCoordinates||(this.flatCoordinates=[]);const s=this.flatCoordinates;let r=iC(s,0,t,this.stride);s[r++]=s[0]+e;for(let a=1,o=this.stride;a<o;++a)s[r++]=s[a];s.length=r,this.changed()}getCoordinates(){return null}setCoordinates(t,e){}setRadius(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()}rotate(t,e){const i=this.getCenter(),s=this.getStride();this.setCenter(jx(i,0,i.length,s,t,e,i)),this.changed()}}cg.prototype.transform;const c7=cg;class Dv extends sa{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new Dv(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Li(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=ai(t,Ne.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?u7(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function u7(n){if(typeof n=="function")return n;let t;return Array.isArray(n)?t=n:(ci(typeof n.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[n]),function(){return t}}const mr=Dv;class sm extends eC{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(Li),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,i=t.length;e<i;++e)this.changeEventsKeys_.push(ai(t[e],Ne.CHANGE,this.changed,this))}clone(){const t=new sm(Wy(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,i,s){if(s<_l(this.getExtent(),t,e))return s;const r=this.geometries_;for(let a=0,o=r.length;a<o;++a)s=r[a].closestPointXY(t,e,i,s);return s}containsXY(t,e){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)if(i[s].containsXY(t,e))return!0;return!1}computeExtent(t){vf(t);const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)iT(t,e[i].getExtent());return t}getGeometries(){return Wy(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],i=this.geometries_;let s=!1;for(let r=0,a=i.length;r<a;++r){const o=i[r],h=o.getSimplifiedGeometry(t);e.push(h),h!==o&&(s=!0)}return s?new sm(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)if(e[i].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)i[s].rotate(t,e);this.changed()}scale(t,e,i){i||(i=wo(this.getExtent()));const s=this.geometries_;for(let r=0,a=s.length;r<a;++r)s[r].scale(t,e,i);this.changed()}setGeometries(t){this.setGeometriesArray(Wy(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)e[i].applyTransform(t);this.changed()}translate(t,e){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)i[s].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function Wy(n){return n.map(t=>t.clone())}const mo=sm;function rm(n,t,e,i,s,r,a){let o,h;const l=(e-t)/i;if(l===1)o=t;else if(l===2)o=t,h=s;else if(l!==0){let u=n[t],f=n[t+1],m=0;const g=[0];for(let w=t+i;w<e;w+=i){const M=n[w],T=n[w+1];m+=Math.sqrt((M-u)*(M-u)+(T-f)*(T-f)),g.push(m),u=M,f=T}const y=s*m,_=yD(g,y);_<0?(h=(y-g[-_-2])/(g[-_-1]-g[-_-2]),o=t+(-_-2)*i):o=t+_*i}a=a>1?a:2,r=r||new Array(a);for(let u=0;u<a;++u)r[u]=o===void 0?NaN:h===void 0?n[o+u]:er(n[o+u],n[o+i+u],h);return r}function m_(n,t,e,i,s,r){if(e==t)return null;let a;if(s<n[t+i-1])return r?(a=n.slice(t,t+i),a[i-1]=s,a):null;if(n[e-1]<s)return r?(a=n.slice(e-i,e),a[i-1]=s,a):null;if(s==n[t+i-1])return n.slice(t,t+i);let o=t/i,h=e/i;for(;o<h;){const m=o+h>>1;s<n[(m+1)*i-1]?h=m:o=m+1}const l=n[o*i-1];if(s==l)return n.slice((o-1)*i,(o-1)*i+i);const u=n[(o+1)*i-1],f=(s-l)/(u-l);a=[];for(let m=0;m<i-1;++m)a.push(er(n[(o-1)*i+m],n[o*i+m],f));return a.push(s),a}function d7(n,t,e,i,s,r,a){if(a)return m_(n,t,e[e.length-1],i,s,r);let o;if(s<n[i-1])return r?(o=n.slice(0,i),o[i-1]=s,o):null;if(n[n.length-1]<s)return r?(o=n.slice(n.length-i),o[i-1]=s,o):null;for(let h=0,l=e.length;h<l;++h){const u=e[h];if(t!=u){if(s<n[t+i-1])return null;if(s<=n[u-1])return m_(n,t,u,i,s,!1);t=u}}return null}class am extends Th{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){yi(this.flatCoordinates,t),this.changed()}clone(){const t=new am(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<_l(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Zx(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Jx(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,s))}forEachSegment(t){return bT(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,m_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return Qo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return rm(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return HC(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){var t;return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,(t=this.flatMidpoint_)!=null?t:void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=eg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new am(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return Zm(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=tg(this.flatCoordinates,0,t,this.stride),this.changed()}}const Ia=am;class om extends Th{constructor(t,e,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&i)this.setFlatCoordinates(e,t),this.ends_=i;else{const s=t,r=[],a=[];for(let h=0,l=s.length;h<l;++h){const u=s[h];yi(r,u.getFlatCoordinates()),a.push(r.length)}const o=s.length===0?this.getLayout():s[0].getLayout();this.setFlatCoordinates(o,r),this.ends_=a}}appendLineString(t){yi(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new om(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<_l(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Kx(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Qx(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,s))}getCoordinateAtM(t,e,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,i=i!==void 0?i:!1,d7(this.flatCoordinates,0,this.ends_,this.stride,t,e,i))}getCoordinates(){return qd(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new Ia(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,i=this.layout,s=[];let r=0;for(let a=0,o=e.length;a<o;++a){const h=e[a],l=new Ia(t.slice(r,h),i);s.push(l),r=h}return s}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let i=0;const s=this.ends_,r=this.stride;for(let a=0,o=s.length;a<o;++a){const h=s[a],l=rm(e,i,h,r,.5);yi(t,l),i=h}return t}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=sC(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new om(e,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(t){return M4(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Ef(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}const If=om;class zv extends Th{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){yi(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new zv(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){if(s<_l(this.getExtent(),t,e))return s;const r=this.flatCoordinates,a=this.stride;for(let o=0,h=r.length;o<h;o+=a){const l=co(t,e,r[o],r[o+1]);if(l<s){s=l;for(let u=0;u<a;++u)i[u]=r[o+u];i.length=a}}return s}getCoordinates(){return Qo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new Ra(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,i=this.stride,s=[];for(let r=0,a=t.length;r<a;r+=i){const o=new Ra(t.slice(r,r+i),e);s.push(o)}return s}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,i=this.stride;for(let s=0,r=e.length;s<r;s+=i){const a=e[s],o=e[s+1];if(dx(t,a,o))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=tg(this.flatCoordinates,0,t,this.stride),this.changed()}}const ug=zv;function KC(n,t,e,i){const s=[];let r=Jr();for(let a=0,o=e.length;a<o;++a){const h=e[a];r=fx(n,t,h[0],i),s.push((r[0]+r[2])/2,(r[1]+r[3])/2),t=h[h.length-1]}return s}class hm extends Th{constructor(t,e,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){const s=t,r=[],a=[];for(let o=0,h=s.length;o<h;++o){const l=s[o],u=r.length,f=l.getEnds();for(let m=0,g=f.length;m<g;++m)f[m]+=u;yi(r,l.getFlatCoordinates()),a.push(f)}e=s.length===0?this.getLayout():s[0].getLayout(),t=r,i=a}e!==void 0&&i?(this.setFlatCoordinates(e,t),this.endss_=i):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;yi(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let s=0,r=e.length;s<r;++s)e[s]+=i}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let s=0;s<t;++s)e[s]=this.endss_[s].slice();const i=new hm(this.flatCoordinates.slice(),this.layout,e);return i.applyProperties(this),i}closestPointXY(t,e,i,s){return s<_l(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(P8(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),F8(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,s))}containsXY(t,e){return b4(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return B8(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),s_(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,n_(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=KC(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=oC(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new ug(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;hC(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=s_(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=z8(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new hm(e,"XY",i)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const r=this.endss_[t-1];e=r[r.length-1]}const i=this.endss_[t].slice(),s=i[i.length-1];if(e!==0)for(let r=0,a=i.length;r<a;++r)i[r]-=e;return new ir(this.flatCoordinates.slice(e,s),this.layout,i)}getPolygons(){const t=this.layout,e=this.flatCoordinates,i=this.endss_,s=[];let r=0;for(let a=0,o=i.length;a<o;++a){const h=i[a].slice(),l=h[h.length-1];if(r!==0)for(let f=0,m=h.length;f<m;++f)h[f]-=r;const u=new ir(e.slice(r,l),t,h);s.push(u),r=l}return s}getType(){return"MultiPolygon"}intersectsExtent(t){return E4(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=nC(this.flatCoordinates,0,t,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const s=i[i.length-1];this.flatCoordinates.length=s.length===0?0:s[s.length-1]}this.changed()}}const dg=hm;class f7{constructor(t){this.rbush_=new cC(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[$e(e)]=i}load(t,e){const i=new Array(e.length);for(let s=0,r=e.length;s<r;s++){const a=t[s],o=e[s],h={minX:a[0],minY:a[1],maxX:a[2],maxY:a[3],value:o};i[s]=h,this.items_[$e(o)]=h}this.rbush_.load(i)}remove(t){const e=$e(t),i=this.items_[e];return delete this.items_[e],this.rbush_.remove(i)!==null}update(t,e){const i=this.items_[$e(e)],s=[i.minX,i.minY,i.maxX,i.maxY];Wp(s,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(s){return s.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let s=0,r=t.length;s<r;s++)if(i=e(t[s]),i)return i;return i}isEmpty(){return al(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return vo(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}const FM=f7,DM=Ts();class ru{constructor(t,e,i,s,r,a){this.styleFunction,this.extent_,this.id_=a,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=r,this.squaredTolerance_,this.stride_=s,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?eT(this.flatCoordinates_):fx(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=wo(this.getExtent());this.flatInteriorPoints_=iv(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=G8(this.flatCoordinates_,this.ends_),e=KC(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=oC(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=rm(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const i=this.ends_;for(let s=0,r=i.length;s<r;++s){const a=i[s],o=rm(t,e,a,2,.5);yi(this.flatMidpoints_,o),e=a}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=Ri(t);const e=t.getExtent(),i=t.getWorldExtent();if(e&&i){const s=cs(i)/cs(e);ka(DM,i[0],i[3],s,-s,0,0,0),lh(this.flatCoordinates_,0,this.flatCoordinates_.length,2,DM,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var t;return new ru(this.type_,this.flatCoordinates_.slice(),(t=this.ends_)==null?void 0:t.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=$S((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const i=this.simplifiedGeometry_.getFlatCoordinates();let s;switch(this.type_){case"LineString":i.length=eg(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,i,0),s=[i.length];break;case"MultiLineString":s=[],i.length=sC(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,i,0,s);break;case"Polygon":s=[],i.length=tv(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),i,0,s);break}return s&&(this.simplifiedGeometry_=new ru(this.type_,i,s,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}ru.prototype.getFlatCoordinates=ru.prototype.getOrientedFlatCoordinates;const no=ru,hr={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function p7(n,t){return[[-1/0,-1/0,1/0,1/0]]}let m7=!1;function g7(n,t,e,i,s,r,a){const o=new XMLHttpRequest;o.open("GET",typeof n=="function"?n(e,i,s):n,!0),t.getType()=="arraybuffer"&&(o.responseType="arraybuffer"),o.withCredentials=m7,o.onload=function(h){if(!o.status||o.status>=200&&o.status<300){const l=t.getType();try{let u;l=="text"||l=="json"?u=o.responseText:l=="xml"?u=o.responseXML||o.responseText:l=="arraybuffer"&&(u=o.response),u?r(t.readFeatures(u,{extent:e,featureProjection:s}),t.readProjection(u)):a()}catch{a()}}else a()},o.onerror=a,o.send()}function zM(n,t){return function(e,i,s,r,a){const o=this;g7(n,t,e,i,s,function(h,l){o.addFeatures(h),r!==void 0&&r(h)},a||Zc)}}class Vo extends na{constructor(t,e,i){super(t),this.feature=e,this.features=i}}class y7 extends xT{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=Zc,this.format_=t.format,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(ci(this.format_,"`format` must be set when `url` is set"),this.loader_=zM(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:p7;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new FM:null,this.loadedExtentsRtree_=new FM,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,s;Array.isArray(t.features)?s=t.features:t.features&&(i=t.features,s=i.getArray()),!e&&i===void 0&&(i=new Ur(s)),s!==void 0&&this.addFeaturesInternal(s),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=$e(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const s=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(s,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Vo(hr.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof no||(this.featureChangeKeys_[t]=[ai(e,Ne.CHANGE,this.handleFeatureChange_,this),ai(e,tu.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let i=!0;if(e.getId()!==void 0){const s=String(e.getId());if(!(s in this.idIndex_))this.idIndex_[s]=e;else if(e instanceof no){const r=this.idIndex_[s];r instanceof no?Array.isArray(r)?r.push(e):this.idIndex_[s]=[r,e]:i=!1}else i=!1}return i&&(ci(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],s=[];for(let r=0,a=t.length;r<a;r++){const o=t[r],h=$e(o);this.addToIndex_(h,o)&&i.push(o)}for(let r=0,a=i.length;r<a;r++){const o=i[r],h=$e(o);this.setupChangeEvents_(h,o);const l=o.getGeometry();if(l){const u=l.getExtent();e.push(u),s.push(o)}else this.nullGeometryFeatures_[h]=o}if(this.featuresRtree_&&this.featuresRtree_.load(e,s),this.hasListener(hr.ADDFEATURE))for(let r=0,a=i.length;r<a;r++)this.dispatchEvent(new Vo(hr.ADDFEATURE,i[r]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(hr.ADDFEATURE,function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener(hr.REMOVEFEATURE,function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener(Fn.ADD,i=>{e||(e=!0,this.addFeature(i.element),e=!1)}),t.addEventListener(Fn.REMOVE,i=>{e||(e=!0,this.removeFeature(i.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(Li);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const i=s=>{this.removeFeatureInternal(s)};this.featuresRtree_.forEach(i);for(const s in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[s])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new Vo(hr.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const i=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(i,function(s){const r=s.getGeometry();if(r instanceof no||r.intersectsCoordinate(t))return e(s)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(i){const s=i.getGeometry();if(s instanceof no||s.intersectsExtent(t)){const r=e(i);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),al(this.nullGeometryFeatures_)||yi(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(i){e.push(i)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const s=mx(t,e);return[].concat(...s.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],s=t[1];let r=null;const a=[NaN,NaN];let o=1/0;const h=[-1/0,-1/0,1/0,1/0];return e=e||ph,this.featuresRtree_.forEachInExtent(h,function(l){if(e(l)){const u=l.getGeometry(),f=o;if(o=u instanceof no?0:u.closestPointXY(i,s,a,o),o<f){r=l;const m=Math.sqrt(o);h[0]=i-m,h[1]=s-m,h[2]=i+m,h[3]=s+m}}}),r}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=$e(e),s=e.getGeometry();if(!s)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);else{const a=s.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(a,e)):this.featuresRtree_&&this.featuresRtree_.update(a,e)}const r=e.getId();if(r!==void 0){const a=r.toString();this.idIndex_[a]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[a]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new Vo(hr.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:$e(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&al(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,i){const s=this.loadedExtentsRtree_,r=this.strategy_(t,e,i);for(let a=0,o=r.length;a<o;++a){const h=r[a];s.forEachInExtent(h,function(u){return Xh(u.extent,h)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Vo(hr.FEATURESLOADSTART)),this.loader_.call(this,h,e,i,u=>{--this.loadingExtentsCount_,this.dispatchEvent(new Vo(hr.FEATURESLOADEND,void 0,u))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Vo(hr.FEATURESLOADERROR))}),s.insert(h,{extent:h.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let i;e.forEachInExtent(t,function(s){if(Wp(s.extent,t))return i=s,!0}),i&&e.remove(i)}removeFeatures(t){const e=[];for(let i=0,s=t.length;i<s;++i){const r=t[i],a=this.removeFeatureInternal(r);a&&e.push(a)}e.length>0&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=$e(t);if(!(e in this.uidIndex_))return;e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t);const i=this.featureChangeKeys_[e];i==null||i.forEach(Li),delete this.featureChangeKeys_[e];const s=t.getId();if(s!==void 0){const r=s.toString(),a=this.idIndex_[r];a===t?delete this.idIndex_[r]:Array.isArray(a)&&(a.splice(a.indexOf(t),1),a.length===1&&(this.idIndex_[r]=a[0]))}return delete this.uidIndex_[e],this.hasListener(hr.REMOVEFEATURE)&&this.dispatchEvent(new Vo(hr.REMOVEFEATURE,t)),t}removeFromIdIndex_(t){let e=!1;for(const i in this.idIndex_){const s=this.idIndex_[i];if(t instanceof no&&Array.isArray(s)&&s.includes(t))s.splice(s.indexOf(t),1);else if(this.idIndex_[i]===t){delete this.idIndex_[i],e=!0;break}}return e}setLoader(t){this.loader_=t}setUrl(t){ci(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(zM(t,this.format_))}}const Nf=y7,z0={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class B0 extends na{constructor(t,e){super(t),this.feature=e}}function _7(n,t){const e=[];for(let i=0;i<t.length;++i){const r=t[i].getGeometry();JC(n,r,e)}return e}function U0(n,t){return co(n[0],n[1],t[0],t[1])}function xc(n,t){const e=n.length;return t<0?n[t+e]:t>=e?n[t-e]:n[t]}function G0(n,t,e){let i,s;t<e?(i=t,s=e):(i=e,s=t);const r=Math.ceil(i),a=Math.floor(s);if(r>a){const h=vc(n,i),l=vc(n,s);return U0(h,l)}let o=0;if(i<r){const h=vc(n,i),l=xc(n,r);o+=U0(h,l)}if(a<s){const h=xc(n,a),l=vc(n,s);o+=U0(h,l)}for(let h=r;h<a-1;++h){const l=xc(n,h),u=xc(n,h+1);o+=U0(l,u)}return o}function JC(n,t,e){if(t instanceof Ia){V0(n,t.getCoordinates(),!1,e);return}if(t instanceof If){const i=t.getCoordinates();for(let s=0,r=i.length;s<r;++s)V0(n,i[s],!1,e);return}if(t instanceof ir){const i=t.getCoordinates();for(let s=0,r=i.length;s<r;++s)V0(n,i[s],!0,e);return}if(t instanceof dg){const i=t.getCoordinates();for(let s=0,r=i.length;s<r;++s){const a=i[s];for(let o=0,h=a.length;o<h;++o)V0(n,a[o],!0,e)}return}if(t instanceof mo){const i=t.getGeometries();for(let s=0;s<i.length;++s)JC(n,i[s],e);return}}const $y={index:-1,endIndex:NaN};function x7(n,t,e,i){const s=n[0],r=n[1];let a=1/0,o=-1,h=NaN;for(let f=0;f<t.targets.length;++f){const m=t.targets[f],g=m.coordinates;let y=1/0,_;for(let w=0;w<g.length-1;++w){const M=g[w],T=g[w+1],A=QC(s,r,M,T);A.squaredDistance<y&&(y=A.squaredDistance,_=w+A.along)}y<a&&(a=y,m.ring&&t.targetIndex===f&&(m.endIndex>m.startIndex?_<m.startIndex&&(_+=g.length):m.endIndex<m.startIndex&&_>m.startIndex&&(_-=g.length)),h=_,o=f)}const l=t.targets[o];let u=l.ring;if(t.targetIndex===o&&u){const f=vc(l.coordinates,h),m=e.getPixelFromCoordinate(f);oT(m,t.startPx)>i&&(u=!1)}if(u){const f=l.coordinates,m=f.length,g=l.startIndex,y=h;if(g<y){const _=G0(f,g,y);G0(f,g,y-m)<_&&(h-=m)}else{const _=G0(f,g,y);G0(f,g,y+m)<_&&(h+=m)}}return $y.index=o,$y.endIndex=h,$y}function V0(n,t,e,i){const s=n[0],r=n[1];for(let a=0,o=t.length-1;a<o;++a){const h=t[a],l=t[a+1],u=QC(s,r,h,l);if(u.squaredDistance===0){const f=a+u.along;i.push({coordinates:t,ring:e,startIndex:f,endIndex:f});return}}}const Yy={along:0,squaredDistance:0};function QC(n,t,e,i){const s=e[0],r=e[1],a=i[0],o=i[1],h=a-s,l=o-r;let u=0,f=s,m=r;return(h!==0||l!==0)&&(u=Ui(((n-s)*h+(t-r)*l)/(h*h+l*l),0,1),f+=h*u,m+=l*u),Yy.along=u,Yy.squaredDistance=Hm(co(n,t,f,m),10),Yy}function vc(n,t){const e=n.length;let i=Math.floor(t);const s=t-i;i>=e?i-=e:i<0&&(i+=e);let r=i+1;r>=e&&(r-=e);const a=n[i],o=a[0],h=a[1],l=n[r],u=l[0]-o,f=l[1]-h;return[o+u*s,h+f*s]}class v7 extends xu{constructor(t){const e=t;e.stopDown||(e.stopDown=du),super(e),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=t.source?t.source:null,this.features_=t.features?t.features:null,this.snapTolerance_=t.snapTolerance?t.snapTolerance:12,this.type_=t.type,this.mode_=b7(this.type_),this.stopClick_=!!t.stopClick,this.minPoints_=t.minPoints?t.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:t.maxPoints?t.maxPoints:1/0,this.finishCondition_=t.finishCondition?t.finishCondition:ph,this.geometryLayout_=t.geometryLayout?t.geometryLayout:"XY";let i=t.geometryFunction;if(!i){const s=this.mode_;if(s==="Circle")i=function(r,a,o){const h=a||new c7([NaN,NaN]),l=Fr(r[0]),u=aT(l,Fr(r[r.length-1]));return h.setCenterAndRadius(l,Math.sqrt(u),this.geometryLayout_),h};else{let r;s==="Point"?r=Ra:s==="LineString"?r=Ia:s==="Polygon"&&(r=ir),i=function(a,o,h){return o?s==="Polygon"?a[0].length?o.setCoordinates([a[0].concat([a[0][0]])],this.geometryLayout_):o.setCoordinates([],this.geometryLayout_):o.setCoordinates(a,this.geometryLayout_):o=new r(a,this.geometryLayout_),o}}}this.geometryFunction_=i,this.dragVertexDelay_=t.dragVertexDelay!==void 0?t.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=t.clickTolerance?t.clickTolerance*t.clickTolerance:36,this.overlay_=new vu({source:new Nf({useSpatialIndex:!1,wrapX:t.wrapX?t.wrapX:!1}),style:t.style?t.style:w7(),updateWhileInteracting:!0}),this.geometryName_=t.geometryName,this.condition_=t.condition?t.condition:Tv,this.freehandCondition_,t.freehand?this.freehandCondition_=d_:this.freehandCondition_=t.freehandCondition?t.freehandCondition:Cv,this.traceCondition_,this.setTrace(t.trace||!1),this.traceState_={active:!1},this.traceSource_=t.traceSource||t.source||null,this.addChangeListener(c_.ACTIVE,this.updateState_)}setTrace(t){let e;t?t===!0?e=d_:e=t:e=f_,this.traceCondition_=e}setMap(t){super.setMap(t),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(t){t.originalEvent.type===Ne.CONTEXTMENU&&t.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(t);let e=t.type===wi.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&t.type===wi.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=t.pixel,this.shouldHandle_=!this.freehand_,e=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&t.type===wi.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(t.coordinate),i=!1):this.freehand_&&t.type===wi.POINTERDOWN?i=!1:e&&this.getPointerCount()<2?(i=t.type===wi.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(t),this.shouldHandle_&&t.originalEvent.preventDefault()):(t.originalEvent.pointerType==="mouse"||t.type===wi.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(t)):t.type===wi.DBLCLICK&&(i=!1),super.handleEvent(t)&&i}handleDownEvent(t){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=t.pixel,this.finishCoordinate_||this.startDrawing_(t.coordinate),!0):this.condition_(t)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new eo(wi.POINTERMOVE,t.map,t.originalEvent,!1,t.frameState))},this.dragVertexDelay_),this.downPx_=t.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(t){if(!this.traceSource_||!this.traceCondition_(t))return;if(this.traceState_.active){this.deactivateTrace_();return}const e=this.getMap(),i=e.getCoordinateFromPixel([t.pixel[0]-this.snapTolerance_,t.pixel[1]+this.snapTolerance_]),s=e.getCoordinateFromPixel([t.pixel[0]+this.snapTolerance_,t.pixel[1]-this.snapTolerance_]),r=Vp([i,s]),a=this.traceSource_.getFeaturesInExtent(r);if(a.length===0)return;const o=_7(t.coordinate,a);o.length&&(this.traceState_={active:!0,startPx:t.pixel.slice(),targets:o,targetIndex:-1})}addOrRemoveTracedCoordinates_(t,e){const i=t.startIndex<=t.endIndex,s=t.startIndex<=e;i===s?i&&e>t.endIndex||!i&&e<t.endIndex?this.addTracedCoordinates_(t,t.endIndex,e):(i&&e<t.endIndex||!i&&e>t.endIndex)&&this.removeTracedCoordinates_(e,t.endIndex):(this.removeTracedCoordinates_(t.startIndex,t.endIndex),this.addTracedCoordinates_(t,t.startIndex,e))}removeTracedCoordinates_(t,e){if(t===e)return;let i=0;if(t<e){const s=Math.ceil(t);let r=Math.floor(e);r===e&&(r-=1),i=r-s+1}else{const s=Math.floor(t);let r=Math.ceil(e);r===e&&(r+=1),i=s-r+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(t,e,i){if(e===i)return;const s=[];if(e<i){const r=Math.ceil(e);let a=Math.floor(i);a===i&&(a-=1);for(let o=r;o<=a;++o)s.push(xc(t.coordinates,o))}else{const r=Math.floor(e);let a=Math.ceil(i);a===i&&(a+=1);for(let o=r;o>=a;--o)s.push(xc(t.coordinates,o))}s.length&&this.appendCoordinates(s)}updateTrace_(t){const e=this.traceState_;if(!e.active||e.targetIndex===-1&&oT(e.startPx,t.pixel)<this.snapTolerance_)return;const i=x7(t.coordinate,e,this.getMap(),this.snapTolerance_);if(e.targetIndex!==i.index){if(e.targetIndex!==-1){const h=e.targets[e.targetIndex];this.removeTracedCoordinates_(h.startIndex,h.endIndex)}const o=e.targets[i.index];this.addTracedCoordinates_(o,o.startIndex,i.endIndex)}else{const o=e.targets[e.targetIndex];this.addOrRemoveTracedCoordinates_(o,i.endIndex)}e.targetIndex=i.index;const s=e.targets[e.targetIndex];s.endIndex=i.endIndex;const r=vc(s.coordinates,s.endIndex),a=this.getMap().getPixelFromCoordinate(r);t.coordinate=r,t.pixel=[Math.round(a[0]),Math.round(a[1])]}handleUpEvent(t){let e=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(t);const i=this.traceState_.active;if(this.toggleTraceState_(t),this.shouldHandle_){const s=!this.finishCoordinate_;s&&this.startDrawing_(t.coordinate),!s&&this.freehand_?this.finishDrawing():!this.freehand_&&(!s||this.mode_==="Point")&&(this.atFinish_(t.pixel,i)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t.coordinate)),e=!1}else this.freehand_&&this.abortDrawing()}return!e&&this.stopClick_&&t.preventDefault(),e}handlePointerMove_(t){if(this.pointerType_=t.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const e=this.downPx_,i=t.pixel,s=e[0]-i[0],r=e[1]-i[1],a=s*s+r*r;if(this.shouldHandle_=this.freehand_?a>this.squaredClickTolerance_:a<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(t.coordinate.slice());return}this.updateTrace_(t),this.modifyDrawing_(t.coordinate)}atFinish_(t,e){let i=!1;if(this.sketchFeature_){let s=!1,r=[this.finishCoordinate_];const a=this.mode_;if(a==="Point")i=!0;else if(a==="Circle")i=this.sketchCoords_.length===2;else if(a==="LineString")s=!e&&this.sketchCoords_.length>this.minPoints_;else if(a==="Polygon"){const o=this.sketchCoords_;s=o[0].length>this.minPoints_,r=[o[0][0],o[0][o[0].length-2]],e?r=[o[0][0]]:r=[o[0][0],o[0][o[0].length-2]]}if(s){const o=this.getMap();for(let h=0,l=r.length;h<l;h++){const u=r[h],f=o.getPixelFromCoordinate(u),m=t[0]-f[0],g=t[1]-f[1],y=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(m*m+g*g)<=y,i){this.finishCoordinate_=u;break}}}}return i}createOrUpdateSketchPoint_(t){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(t):(this.sketchPoint_=new mr(new Ra(t)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(t){this.sketchLine_||(this.sketchLine_=new mr);const e=t.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(e.getLayout(),e.getFlatCoordinates()),i.changed()):(i=new Ia(e.getFlatCoordinates(),e.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(t){const e=this.getMap().getView().getProjection(),i=Xp(this.geometryLayout_);for(;t.length<i;)t.push(0);this.finishCoordinate_=t,this.mode_==="Point"?this.sketchCoords_=t.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[t.slice(),t.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[t.slice(),t.slice()],this.sketchLineCoords_&&(this.sketchLine_=new mr(new Ia(this.sketchLineCoords_)));const s=this.geometryFunction_(this.sketchCoords_,void 0,e);this.sketchFeature_=new mr,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(s),this.updateSketchFeatures_(),this.dispatchEvent(new B0(z0.DRAWSTART,this.sketchFeature_))}modifyDrawing_(t){const e=this.getMap(),i=this.sketchFeature_.getGeometry(),s=e.getView().getProjection(),r=Xp(this.geometryLayout_);let a,o;for(;t.length<r;)t.push(0);this.mode_==="Point"?o=this.sketchCoords_:this.mode_==="Polygon"?(a=this.sketchCoords_[0],o=a[a.length-1],this.atFinish_(e.getPixelFromCoordinate(t))&&(t=this.finishCoordinate_.slice())):(a=this.sketchCoords_,o=a[a.length-1]),o[0]=t[0],o[1]=t[1],this.geometryFunction_(this.sketchCoords_,i,s),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(t),i.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(t){const e=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let s,r;const a=this.mode_;return a==="LineString"||a==="Circle"?(this.finishCoordinate_=t.slice(),r=this.sketchCoords_,r.length>=this.maxPoints_&&(this.freehand_?r.pop():s=!0),r.push(t.slice()),this.geometryFunction_(r,e,i)):a==="Polygon"&&(r=this.sketchCoords_[0],r.length>=this.maxPoints_&&(this.freehand_?r.pop():s=!0),r.push(t.slice()),s&&(this.finishCoordinate_=r[0]),this.geometryFunction_(this.sketchCoords_,e,i)),this.createOrUpdateSketchPoint_(t.slice()),this.updateSketchFeatures_(),s?this.finishDrawing():this.sketchFeature_}removeLastPoints_(t){if(!this.sketchFeature_)return;const e=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),s=this.mode_;for(let r=0;r<t;++r){let a;if(s==="LineString"||s==="Circle"){if(a=this.sketchCoords_,a.splice(-2,1),a.length>=2){this.finishCoordinate_=a[a.length-2].slice();const o=this.finishCoordinate_.slice();a[a.length-1]=o,this.createOrUpdateSketchPoint_(o)}this.geometryFunction_(a,e,i),e.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(e)}else if(s==="Polygon"){a=this.sketchCoords_[0],a.splice(-2,1);const o=this.sketchLine_.getGeometry();if(a.length>=2){const h=a[a.length-2].slice();a[a.length-1]=h,this.createOrUpdateSketchPoint_(h)}o.setCoordinates(a),this.geometryFunction_(this.sketchCoords_,e,i)}if(a.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const t=this.abortDrawing_();if(!t)return null;let e=this.sketchCoords_;const i=t.getGeometry(),s=this.getMap().getView().getProjection();return this.mode_==="LineString"?(e.pop(),this.geometryFunction_(e,i,s)):this.mode_==="Polygon"&&(e[0].pop(),this.geometryFunction_(e,i,s),e=i.getCoordinates()),this.type_==="MultiPoint"?t.setGeometry(new ug([e])):this.type_==="MultiLineString"?t.setGeometry(new If([e])):this.type_==="MultiPolygon"&&t.setGeometry(new dg([e])),this.dispatchEvent(new B0(z0.DRAWEND,t)),this.features_&&this.features_.push(t),this.source_&&this.source_.addFeature(t),t}abortDrawing_(){this.finishCoordinate_=null;const t=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),t}abortDrawing(){const t=this.abortDrawing_();t&&this.dispatchEvent(new B0(z0.DRAWABORT,t))}appendCoordinates(t){const e=this.mode_,i=!this.sketchFeature_;i&&this.startDrawing_(t[0]);let s;if(e==="LineString"||e==="Circle")s=this.sketchCoords_;else if(e==="Polygon")s=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;i&&s.shift(),s.pop();for(let a=0;a<t.length;a++)this.addToDrawing_(t[a]);const r=t[t.length-1];this.sketchFeature_=this.addToDrawing_(r),this.modifyDrawing_(r)}extend(t){const i=t.getGeometry();this.sketchFeature_=t,this.sketchCoords_=i.getCoordinates();const s=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=s.slice(),this.sketchCoords_.push(s.slice()),this.sketchPoint_=new mr(new Ra(s)),this.updateSketchFeatures_(),this.dispatchEvent(new B0(z0.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const t=[];this.sketchFeature_&&t.push(this.sketchFeature_),this.sketchLine_&&t.push(this.sketchLine_),this.sketchPoint_&&t.push(this.sketchPoint_);const e=this.overlay_.getSource();e.clear(!0),e.addFeatures(t)}updateState_(){const t=this.getMap(),e=this.getActive();(!t||!e)&&this.abortDrawing(),this.overlay_.setMap(e?t:null)}}function w7(){const n=xC();return function(t,e){return n[t.getGeometry().getType()]}}function b7(n){switch(n){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+n)}}const tA=v7,M7={SELECT:"select"};class E7 extends na{constructor(t,e,i,s){super(t),this.selected=e,this.deselected=i,this.mapBrowserEvent=s}}const W0={};class Bv extends Ml{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=t.condition?t.condition:UB,this.addCondition_=t.addCondition?t.addCondition:f_,this.removeCondition_=t.removeCondition?t.removeCondition:f_,this.toggleCondition_=t.toggleCondition?t.toggleCondition:Cv,this.multi_=t.multi?t.multi:!1,this.filter_=t.filter?t.filter:ph,this.hitTolerance_=t.hitTolerance?t.hitTolerance:0,this.style_=t.style!==void 0?t.style:S7(),this.features_=t.features||new Ur;let e;if(t.layers)if(typeof t.layers=="function")e=t.layers;else{const i=t.layers;e=function(s){return i.includes(s)}}else e=ph;this.layerFilter_=e,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(t,e){this.featureLayerAssociation_[$e(t)]=e}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(t){return this.featureLayerAssociation_[$e(t)]}setHitTolerance(t){this.hitTolerance_=t}setMap(t){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(t),t?(this.features_.addEventListener(Fn.ADD,this.boundAddFeature_),this.features_.addEventListener(Fn.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(Fn.ADD,this.boundAddFeature_),this.features_.removeEventListener(Fn.REMOVE,this.boundRemoveFeature_))}addFeature_(t){const e=t.element;if(this.style_&&this.applySelectedStyle_(e),!this.getLayer(e)){const i=this.getMap().getAllLayers().find(function(s){if(s instanceof vu&&s.getSource()&&s.getSource().hasFeature(e))return s});i&&this.addFeatureLayerAssociation_(e,i)}}removeFeature_(t){this.style_&&this.restorePreviousStyle_(t.element)}getStyle(){return this.style_}applySelectedStyle_(t){const e=$e(t);e in W0||(W0[e]=t.getStyle()),t.setStyle(this.style_)}restorePreviousStyle_(t){const e=this.getMap().getInteractions().getArray();for(let s=e.length-1;s>=0;--s){const r=e[s];if(r!==this&&r instanceof Bv&&r.getStyle()&&r.getFeatures().getArray().lastIndexOf(t)!==-1){t.setStyle(r.getStyle());return}}const i=$e(t);t.setStyle(W0[i]),delete W0[i]}removeFeatureLayerAssociation_(t){delete this.featureLayerAssociation_[$e(t)]}handleEvent(t){if(!this.condition_(t))return!0;const e=this.addCondition_(t),i=this.removeCondition_(t),s=this.toggleCondition_(t),r=!e&&!i&&!s,a=t.map,o=this.getFeatures(),h=[],l=[];if(r){yl(this.featureLayerAssociation_),a.forEachFeatureAtPixel(t.pixel,(u,f)=>{if(!(!(u instanceof mr)||!this.filter_(u,f)))return this.addFeatureLayerAssociation_(u,f),l.push(u),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=o.getLength()-1;u>=0;--u){const f=o.item(u),m=l.indexOf(f);m>-1?l.splice(m,1):(o.remove(f),h.push(f))}l.length!==0&&o.extend(l)}else{a.forEachFeatureAtPixel(t.pixel,(u,f)=>{if(!(!(u instanceof mr)||!this.filter_(u,f)))return(e||s)&&!o.getArray().includes(u)?(this.addFeatureLayerAssociation_(u,f),l.push(u)):(i||s)&&o.getArray().includes(u)&&(h.push(u),this.removeFeatureLayerAssociation_(u)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=h.length-1;u>=0;--u)o.remove(h[u]);o.extend(l)}return(l.length>0||h.length>0)&&this.dispatchEvent(new E7(M7.SELECT,l,h,t)),!0}}function S7(){const n=xC();return yi(n.Polygon,n.LineString),yi(n.GeometryCollection,n.LineString),function(t){return t.getGeometry()?n[t.getGeometry().getType()]:null}}const T7=Bv;function C7(n){n("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),n("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),n("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),n.WGS84=n["EPSG:4326"],n["EPSG:3785"]=n["EPSG:3857"],n.GOOGLE=n["EPSG:3857"],n["EPSG:900913"]=n["EPSG:3857"],n["EPSG:102113"]=n["EPSG:3857"]}var hl=1,ll=2,Fc=3,A7=4,g_=5,BM=6378137,R7=6356752314e-3,UM=.0066943799901413165,Cd=484813681109536e-20,ee=Math.PI/2,I7=.16666666666666666,N7=.04722222222222222,k7=.022156084656084655,de=1e-10,Vn=.017453292519943295,Aa=57.29577951308232,Ti=Math.PI/4,nf=Math.PI*2,on=3.14159265359,Xs={};Xs.greenwich=0;Xs.lisbon=-9.131906111111;Xs.paris=2.337229166667;Xs.bogota=-74.080916666667;Xs.madrid=-3.687938888889;Xs.rome=12.452333333333;Xs.bern=7.439583333333;Xs.jakarta=106.807719444444;Xs.ferro=-17.666666666667;Xs.brussels=4.367975;Xs.stockholm=18.058277777778;Xs.athens=23.7163375;Xs.oslo=10.722916666667;const L7={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var GM=/[\s_\-\/\(\)]/g;function yh(n,t){if(n[t])return n[t];for(var e=Object.keys(n),i=t.toLowerCase().replace(GM,""),s=-1,r,a;++s<e.length;)if(r=e[s],a=r.toLowerCase().replace(GM,""),a===i)return n[r]}function y_(n){var t={},e=n.split("+").map(function(o){return o.trim()}).filter(function(o){return o}).reduce(function(o,h){var l=h.split("=");return l.push(!0),o[l[0].toLowerCase()]=l[1],o},{}),i,s,r,a={proj:"projName",datum:"datumCode",rf:function(o){t.rf=parseFloat(o)},lat_0:function(o){t.lat0=o*Vn},lat_1:function(o){t.lat1=o*Vn},lat_2:function(o){t.lat2=o*Vn},lat_ts:function(o){t.lat_ts=o*Vn},lon_0:function(o){t.long0=o*Vn},lon_1:function(o){t.long1=o*Vn},lon_2:function(o){t.long2=o*Vn},alpha:function(o){t.alpha=parseFloat(o)*Vn},gamma:function(o){t.rectified_grid_angle=parseFloat(o)},lonc:function(o){t.longc=o*Vn},x_0:function(o){t.x0=parseFloat(o)},y_0:function(o){t.y0=parseFloat(o)},k_0:function(o){t.k0=parseFloat(o)},k:function(o){t.k0=parseFloat(o)},a:function(o){t.a=parseFloat(o)},b:function(o){t.b=parseFloat(o)},r:function(o){t.a=t.b=parseFloat(o)},r_a:function(){t.R_A=!0},zone:function(o){t.zone=parseInt(o,10)},south:function(){t.utmSouth=!0},towgs84:function(o){t.datum_params=o.split(",").map(function(h){return parseFloat(h)})},to_meter:function(o){t.to_meter=parseFloat(o)},units:function(o){t.units=o;var h=yh(L7,o);h&&(t.to_meter=h.to_meter)},from_greenwich:function(o){t.from_greenwich=o*Vn},pm:function(o){var h=yh(Xs,o);t.from_greenwich=(h||parseFloat(o))*Vn},nadgrids:function(o){o==="@null"?t.datumCode="none":t.nadgrids=o},axis:function(o){var h="ewnsud";o.length===3&&h.indexOf(o.substr(0,1))!==-1&&h.indexOf(o.substr(1,1))!==-1&&h.indexOf(o.substr(2,1))!==-1&&(t.axis=o)},approx:function(){t.approx=!0}};for(i in e)s=e[i],i in a?(r=a[i],typeof r=="function"?r(s):t[r]=s):t[i]=s;return typeof t.datumCode=="string"&&t.datumCode!=="WGS84"&&(t.datumCode=t.datumCode.toLowerCase()),t}var sf=1,eA=2,iA=3,lm=4,nA=5,Uv=-1,O7=/\s/,P7=/[A-Za-z]/,F7=/[A-Za-z84_]/,fg=/[,\]]/,sA=/[\d\.E\-\+]/;function So(n){if(typeof n!="string")throw new Error("not a string");this.text=n.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=sf}So.prototype.readCharicter=function(){var n=this.text[this.place++];if(this.state!==lm)for(;O7.test(n);){if(this.place>=this.text.length)return;n=this.text[this.place++]}switch(this.state){case sf:return this.neutral(n);case eA:return this.keyword(n);case lm:return this.quoted(n);case nA:return this.afterquote(n);case iA:return this.number(n);case Uv:return}};So.prototype.afterquote=function(n){if(n==='"'){this.word+='"',this.state=lm;return}if(fg.test(n)){this.word=this.word.trim(),this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in afterquote yet, index '+this.place)};So.prototype.afterItem=function(n){if(n===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=sf;return}if(n==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=sf,this.currentObject=this.stack.pop(),this.currentObject||(this.state=Uv);return}};So.prototype.number=function(n){if(sA.test(n)){this.word+=n;return}if(fg.test(n)){this.word=parseFloat(this.word),this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in number yet, index '+this.place)};So.prototype.quoted=function(n){if(n==='"'){this.state=nA;return}this.word+=n};So.prototype.keyword=function(n){if(F7.test(n)){this.word+=n;return}if(n==="["){var t=[];t.push(this.word),this.level++,this.root===null?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,this.state=sf;return}if(fg.test(n)){this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in keyword yet, index '+this.place)};So.prototype.neutral=function(n){if(P7.test(n)){this.word=n,this.state=eA;return}if(n==='"'){this.word="",this.state=lm;return}if(sA.test(n)){this.word=n,this.state=iA;return}if(fg.test(n)){this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in neutral yet, index '+this.place)};So.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===Uv)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function D7(n){var t=new So(n);return t.output()}function VM(n,t,e){Array.isArray(t)&&(e.unshift(t),t=null);var i=t?{}:n,s=e.reduce(function(r,a){return wc(a,r),r},i);t&&(n[t]=s)}function wc(n,t){if(!Array.isArray(n)){t[n]=!0;return}var e=n.shift();if(e==="PARAMETER"&&(e=n.shift()),n.length===1){if(Array.isArray(n[0])){t[e]={},wc(n[0],t[e]);return}t[e]=n[0];return}if(!n.length){t[e]=!0;return}if(e==="TOWGS84"){t[e]=n;return}if(e==="AXIS"){e in t||(t[e]=[]),t[e].push(n);return}Array.isArray(e)||(t[e]={});var i;switch(e){case"UNIT":case"PRIMEM":case"VERT_DATUM":t[e]={name:n[0].toLowerCase(),convert:n[1]},n.length===3&&wc(n[2],t[e]);return;case"SPHEROID":case"ELLIPSOID":t[e]={name:n[0],a:n[1],rf:n[2]},n.length===4&&wc(n[3],t[e]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":n[0]=["name",n[0]],VM(t,e,n);return;default:for(i=-1;++i<n.length;)if(!Array.isArray(n[i]))return wc(n,t[e]);return VM(t,e,n)}}var z7=.017453292519943295;function B7(n,t){var e=t[0],i=t[1];!(e in n)&&i in n&&(n[e]=n[i],t.length===3&&(n[e]=t[2](n[e])))}function _a(n){return n*z7}function U7(n){if(n.type==="GEOGCS"?n.projName="longlat":n.type==="LOCAL_CS"?(n.projName="identity",n.local=!0):typeof n.PROJECTION=="object"?n.projName=Object.keys(n.PROJECTION)[0]:n.projName=n.PROJECTION,n.AXIS){for(var t="",e=0,i=n.AXIS.length;e<i;++e){var s=[n.AXIS[e][0].toLowerCase(),n.AXIS[e][1].toLowerCase()];s[0].indexOf("north")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="north"?t+="n":s[0].indexOf("south")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="south"?t+="s":s[0].indexOf("east")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="east"?t+="e":(s[0].indexOf("west")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="west")&&(t+="w")}t.length===2&&(t+="u"),t.length===3&&(n.axis=t)}n.UNIT&&(n.units=n.UNIT.name.toLowerCase(),n.units==="metre"&&(n.units="meter"),n.UNIT.convert&&(n.type==="GEOGCS"?n.DATUM&&n.DATUM.SPHEROID&&(n.to_meter=n.UNIT.convert*n.DATUM.SPHEROID.a):n.to_meter=n.UNIT.convert));var r=n.GEOGCS;n.type==="GEOGCS"&&(r=n),r&&(r.DATUM?n.datumCode=r.DATUM.name.toLowerCase():n.datumCode=r.name.toLowerCase(),n.datumCode.slice(0,2)==="d_"&&(n.datumCode=n.datumCode.slice(2)),(n.datumCode==="new_zealand_geodetic_datum_1949"||n.datumCode==="new_zealand_1949")&&(n.datumCode="nzgd49"),(n.datumCode==="wgs_1984"||n.datumCode==="world_geodetic_system_1984")&&(n.PROJECTION==="Mercator_Auxiliary_Sphere"&&(n.sphere=!0),n.datumCode="wgs84"),n.datumCode.slice(-6)==="_ferro"&&(n.datumCode=n.datumCode.slice(0,-6)),n.datumCode.slice(-8)==="_jakarta"&&(n.datumCode=n.datumCode.slice(0,-8)),~n.datumCode.indexOf("belge")&&(n.datumCode="rnb72"),r.DATUM&&r.DATUM.SPHEROID&&(n.ellps=r.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),n.ellps.toLowerCase().slice(0,13)==="international"&&(n.ellps="intl"),n.a=r.DATUM.SPHEROID.a,n.rf=parseFloat(r.DATUM.SPHEROID.rf,10)),r.DATUM&&r.DATUM.TOWGS84&&(n.datum_params=r.DATUM.TOWGS84),~n.datumCode.indexOf("osgb_1936")&&(n.datumCode="osgb36"),~n.datumCode.indexOf("osni_1952")&&(n.datumCode="osni52"),(~n.datumCode.indexOf("tm65")||~n.datumCode.indexOf("geodetic_datum_of_1965"))&&(n.datumCode="ire65"),n.datumCode==="ch1903+"&&(n.datumCode="ch1903"),~n.datumCode.indexOf("israel")&&(n.datumCode="isr93")),n.b&&!isFinite(n.b)&&(n.b=n.a);function a(l){var u=n.to_meter||1;return l*u}var o=function(l){return B7(n,l)},h=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",_a],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",_a],["x0","false_easting",a],["y0","false_northing",a],["long0","central_meridian",_a],["lat0","latitude_of_origin",_a],["lat0","standard_parallel_1",_a],["lat1","standard_parallel_1",_a],["lat2","standard_parallel_2",_a],["azimuth","Azimuth"],["alpha","azimuth",_a],["srsCode","name"]];h.forEach(o),!n.long0&&n.longc&&(n.projName==="Albers_Conic_Equal_Area"||n.projName==="Lambert_Azimuthal_Equal_Area")&&(n.long0=n.longc),!n.lat_ts&&n.lat1&&(n.projName==="Stereographic_South_Pole"||n.projName==="Polar Stereographic (variant B)")?(n.lat0=_a(n.lat1>0?90:-90),n.lat_ts=n.lat1):!n.lat_ts&&n.lat0&&n.projName==="Polar_Stereographic"&&(n.lat_ts=n.lat0,n.lat0=_a(n.lat0>0?90:-90))}function rA(n){var t=D7(n),e=t.shift(),i=t.shift();t.unshift(["name",i]),t.unshift(["type",e]);var s={};return wc(t,s),U7(s),s}function bs(n){var t=this;if(arguments.length===2){var e=arguments[1];typeof e=="string"?e.charAt(0)==="+"?bs[n]=y_(arguments[1]):bs[n]=rA(arguments[1]):bs[n]=e}else if(arguments.length===1){if(Array.isArray(n))return n.map(function(i){Array.isArray(i)?bs.apply(t,i):bs(i)});if(typeof n=="string"){if(n in bs)return bs[n]}else"EPSG"in n?bs["EPSG:"+n.EPSG]=n:"ESRI"in n?bs["ESRI:"+n.ESRI]=n:"IAU2000"in n?bs["IAU2000:"+n.IAU2000]=n:console.log(n);return}}C7(bs);function G7(n){return typeof n=="string"}function V7(n){return n in bs}var W7=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function $7(n){return W7.some(function(t){return n.indexOf(t)>-1})}var Y7=["3857","900913","3785","102113"];function H7(n){var t=yh(n,"authority");if(!!t){var e=yh(t,"epsg");return e&&Y7.indexOf(e)>-1}}function q7(n){var t=yh(n,"extension");if(!!t)return yh(t,"proj4")}function X7(n){return n[0]==="+"}function j7(n){if(G7(n)){if(V7(n))return bs[n];if($7(n)){var t=rA(n);if(H7(t))return bs["EPSG:3857"];var e=q7(t);return e?y_(e):t}if(X7(n))return y_(n)}else return n}function WM(n,t){n=n||{};var e,i;if(!t)return n;for(i in t)e=t[i],e!==void 0&&(n[i]=e);return n}function La(n,t,e){var i=n*t;return e/Math.sqrt(1-i*i)}function kf(n){return n<0?-1:1}function pe(n){return Math.abs(n)<=on?n:n-kf(n)*nf}function Yr(n,t,e){var i=n*e,s=.5*n;return i=Math.pow((1-i)/(1+i),s),Math.tan(.5*(ee-t))/i}function rf(n,t){for(var e=.5*n,i,s,r=ee-2*Math.atan(t),a=0;a<=15;a++)if(i=n*Math.sin(r),s=ee-2*Math.atan(t*Math.pow((1-i)/(1+i),e))-r,r+=s,Math.abs(s)<=1e-10)return r;return-9999}function Z7(){var n=this.b/this.a;this.es=1-n*n,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=La(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function K7(n){var t=n.x,e=n.y;if(e*Aa>90&&e*Aa<-90&&t*Aa>180&&t*Aa<-180)return null;var i,s;if(Math.abs(Math.abs(e)-ee)<=de)return null;if(this.sphere)i=this.x0+this.a*this.k0*pe(t-this.long0),s=this.y0+this.a*this.k0*Math.log(Math.tan(Ti+.5*e));else{var r=Math.sin(e),a=Yr(this.e,e,r);i=this.x0+this.a*this.k0*pe(t-this.long0),s=this.y0-this.a*this.k0*Math.log(a)}return n.x=i,n.y=s,n}function J7(n){var t=n.x-this.x0,e=n.y-this.y0,i,s;if(this.sphere)s=ee-2*Math.atan(Math.exp(-e/(this.a*this.k0)));else{var r=Math.exp(-e/(this.a*this.k0));if(s=rf(this.e,r),s===-9999)return null}return i=pe(this.long0+t/(this.a*this.k0)),n.x=i,n.y=s,n}var Q7=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const tG={init:Z7,forward:K7,inverse:J7,names:Q7};function eG(){}function $M(n){return n}var iG=["longlat","identity"];const nG={init:eG,forward:$M,inverse:$M,names:iG};var sG=[tG,nG],bp={},cm=[];function aA(n,t){var e=cm.length;return n.names?(cm[e]=n,n.names.forEach(function(i){bp[i.toLowerCase()]=e}),this):(console.log(t),!0)}function rG(n){if(!n)return!1;var t=n.toLowerCase();if(typeof bp[t]<"u"&&cm[bp[t]])return cm[bp[t]]}function aG(){sG.forEach(aA)}const oG={start:aG,add:aA,get:rG};var Be={};Be.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};Be.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};Be.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};Be.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};Be.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};Be.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};Be.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};Be.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};Be.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};Be.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};Be.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};Be.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};Be.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};Be.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};Be.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};Be.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};Be.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};Be.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};Be.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};Be.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};Be.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};Be.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};Be.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};Be.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};Be.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};Be.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};Be.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};Be.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};Be.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};Be.hough={a:6378270,rf:297,ellipseName:"Hough"};Be.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};Be.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};Be.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};Be.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};Be.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};Be.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};Be.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};Be.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};Be.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};Be.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};Be.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};Be.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var hG=Be.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};Be.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function lG(n,t,e,i){var s=n*n,r=t*t,a=(s-r)/s,o=0;i?(n*=1-a*(I7+a*(N7+a*k7)),s=n*n,a=0):o=Math.sqrt(a);var h=(s-r)/r;return{es:a,e:o,ep2:h}}function cG(n,t,e,i,s){if(!n){var r=yh(Be,i);r||(r=hG),n=r.a,t=r.b,e=r.rf}return e&&!t&&(t=(1-1/e)*n),(e===0||Math.abs(n-t)<de)&&(s=!0,t=n),{a:n,b:t,rf:e,sphere:s}}var In={};In.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};In.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};In.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};In.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};In.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};In.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};In.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};In.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};In.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"};In.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};In.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};In.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};In.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};In.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};In.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};In.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};In.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};In.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function uG(n,t,e,i,s,r,a){var o={};return n===void 0||n==="none"?o.datum_type=g_:o.datum_type=A7,t&&(o.datum_params=t.map(parseFloat),(o.datum_params[0]!==0||o.datum_params[1]!==0||o.datum_params[2]!==0)&&(o.datum_type=hl),o.datum_params.length>3&&(o.datum_params[3]!==0||o.datum_params[4]!==0||o.datum_params[5]!==0||o.datum_params[6]!==0)&&(o.datum_type=ll,o.datum_params[3]*=Cd,o.datum_params[4]*=Cd,o.datum_params[5]*=Cd,o.datum_params[6]=o.datum_params[6]/1e6+1)),a&&(o.datum_type=Fc,o.grids=a),o.a=e,o.b=i,o.es=s,o.ep2=r,o}var oA={};function dG(n,t){var e=new DataView(t),i=mG(e),s=gG(e,i),r=yG(e,s,i),a={header:s,subgrids:r};return oA[n]=a,a}function fG(n){if(n===void 0)return null;var t=n.split(",");return t.map(pG)}function pG(n){if(n.length===0)return null;var t=n[0]==="@";return t&&(n=n.slice(1)),n==="null"?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:n,mandatory:!t,grid:oA[n]||null,isNull:!1}}function bc(n){return n/3600*Math.PI/180}function mG(n){var t=n.getInt32(8,!1);return t===11?!1:(t=n.getInt32(8,!0),t!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function gG(n,t){return{nFields:n.getInt32(8,t),nSubgridFields:n.getInt32(24,t),nSubgrids:n.getInt32(40,t),shiftType:__(n,56,56+8).trim(),fromSemiMajorAxis:n.getFloat64(120,t),fromSemiMinorAxis:n.getFloat64(136,t),toSemiMajorAxis:n.getFloat64(152,t),toSemiMinorAxis:n.getFloat64(168,t)}}function __(n,t,e){return String.fromCharCode.apply(null,new Uint8Array(n.buffer.slice(t,e)))}function yG(n,t,e){for(var i=176,s=[],r=0;r<t.nSubgrids;r++){var a=xG(n,i,e),o=vG(n,i,a,e),h=Math.round(1+(a.upperLongitude-a.lowerLongitude)/a.longitudeInterval),l=Math.round(1+(a.upperLatitude-a.lowerLatitude)/a.latitudeInterval);s.push({ll:[bc(a.lowerLongitude),bc(a.lowerLatitude)],del:[bc(a.longitudeInterval),bc(a.latitudeInterval)],lim:[h,l],count:a.gridNodeCount,cvs:_G(o)}),i+=176+a.gridNodeCount*16}return s}function _G(n){return n.map(function(t){return[bc(t.longitudeShift),bc(t.latitudeShift)]})}function xG(n,t,e){return{name:__(n,t+8,t+16).trim(),parent:__(n,t+24,t+24+8).trim(),lowerLatitude:n.getFloat64(t+72,e),upperLatitude:n.getFloat64(t+88,e),lowerLongitude:n.getFloat64(t+104,e),upperLongitude:n.getFloat64(t+120,e),latitudeInterval:n.getFloat64(t+136,e),longitudeInterval:n.getFloat64(t+152,e),gridNodeCount:n.getInt32(t+168,e)}}function vG(n,t,e,i){for(var s=t+176,r=16,a=[],o=0;o<e.gridNodeCount;o++){var h={latitudeShift:n.getFloat32(s+o*r,i),longitudeShift:n.getFloat32(s+o*r+4,i),latitudeAccuracy:n.getFloat32(s+o*r+8,i),longitudeAccuracy:n.getFloat32(s+o*r+12,i)};a.push(h)}return a}function Na(n,t){if(!(this instanceof Na))return new Na(n);t=t||function(l){if(l)throw l};var e=j7(n);if(typeof e!="object"){t(n);return}var i=Na.projections.get(e.projName);if(!i){t(n);return}if(e.datumCode&&e.datumCode!=="none"){var s=yh(In,e.datumCode);s&&(e.datum_params=e.datum_params||(s.towgs84?s.towgs84.split(","):null),e.ellps=s.ellipse,e.datumName=s.datumName?s.datumName:e.datumCode)}e.k0=e.k0||1,e.axis=e.axis||"enu",e.ellps=e.ellps||"wgs84",e.lat1=e.lat1||e.lat0;var r=cG(e.a,e.b,e.rf,e.ellps,e.sphere),a=lG(r.a,r.b,r.rf,e.R_A),o=fG(e.nadgrids),h=e.datum||uG(e.datumCode,e.datum_params,r.a,r.b,a.es,a.ep2,o);WM(this,e),WM(this,i),this.a=r.a,this.b=r.b,this.rf=r.rf,this.sphere=r.sphere,this.es=a.es,this.e=a.e,this.ep2=a.ep2,this.datum=h,this.init(),t(null,this)}Na.projections=oG;Na.projections.start();function wG(n,t){return n.datum_type!==t.datum_type||n.a!==t.a||Math.abs(n.es-t.es)>5e-11?!1:n.datum_type===hl?n.datum_params[0]===t.datum_params[0]&&n.datum_params[1]===t.datum_params[1]&&n.datum_params[2]===t.datum_params[2]:n.datum_type===ll?n.datum_params[0]===t.datum_params[0]&&n.datum_params[1]===t.datum_params[1]&&n.datum_params[2]===t.datum_params[2]&&n.datum_params[3]===t.datum_params[3]&&n.datum_params[4]===t.datum_params[4]&&n.datum_params[5]===t.datum_params[5]&&n.datum_params[6]===t.datum_params[6]:!0}function hA(n,t,e){var i=n.x,s=n.y,r=n.z?n.z:0,a,o,h,l;if(s<-ee&&s>-1.001*ee)s=-ee;else if(s>ee&&s<1.001*ee)s=ee;else{if(s<-ee)return{x:-1/0,y:-1/0,z:n.z};if(s>ee)return{x:1/0,y:1/0,z:n.z}}return i>Math.PI&&(i-=2*Math.PI),o=Math.sin(s),l=Math.cos(s),h=o*o,a=e/Math.sqrt(1-t*h),{x:(a+r)*l*Math.cos(i),y:(a+r)*l*Math.sin(i),z:(a*(1-t)+r)*o}}function lA(n,t,e,i){var s=1e-12,r=s*s,a=30,o,h,l,u,f,m,g,y,_,w,M,T,A,R=n.x,I=n.y,L=n.z?n.z:0,k,Y,K;if(o=Math.sqrt(R*R+I*I),h=Math.sqrt(R*R+I*I+L*L),o/e<s){if(k=0,h/e<s)return Y=ee,K=-i,{x:n.x,y:n.y,z:n.z}}else k=Math.atan2(I,R);l=L/h,u=o/h,f=1/Math.sqrt(1-t*(2-t)*u*u),y=u*(1-t)*f,_=l*f,A=0;do A++,g=e/Math.sqrt(1-t*_*_),K=o*y+L*_-g*(1-t*_*_),m=t*g/(g+K),f=1/Math.sqrt(1-m*(2-m)*u*u),w=u*(1-m)*f,M=l*f,T=M*y-w*_,y=w,_=M;while(T*T>r&&A<a);return Y=Math.atan(M/Math.abs(w)),{x:k,y:Y,z:K}}function bG(n,t,e){if(t===hl)return{x:n.x+e[0],y:n.y+e[1],z:n.z+e[2]};if(t===ll){var i=e[0],s=e[1],r=e[2],a=e[3],o=e[4],h=e[5],l=e[6];return{x:l*(n.x-h*n.y+o*n.z)+i,y:l*(h*n.x+n.y-a*n.z)+s,z:l*(-o*n.x+a*n.y+n.z)+r}}}function MG(n,t,e){if(t===hl)return{x:n.x-e[0],y:n.y-e[1],z:n.z-e[2]};if(t===ll){var i=e[0],s=e[1],r=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=(n.x-i)/l,f=(n.y-s)/l,m=(n.z-r)/l;return{x:u+h*f-o*m,y:-h*u+f+a*m,z:o*u-a*f+m}}}function $0(n){return n===hl||n===ll}function EG(n,t,e){if(wG(n,t)||n.datum_type===g_||t.datum_type===g_)return e;var i=n.a,s=n.es;if(n.datum_type===Fc){var r=YM(n,!1,e);if(r!==0)return;i=BM,s=UM}var a=t.a,o=t.b,h=t.es;if(t.datum_type===Fc&&(a=BM,o=R7,h=UM),s===h&&i===a&&!$0(n.datum_type)&&!$0(t.datum_type))return e;if(e=hA(e,s,i),$0(n.datum_type)&&(e=bG(e,n.datum_type,n.datum_params)),$0(t.datum_type)&&(e=MG(e,t.datum_type,t.datum_params)),e=lA(e,h,a,o),t.datum_type===Fc){var l=YM(t,!0,e);if(l!==0)return}return e}function YM(n,t,e){if(n.grids===null||n.grids.length===0)return console.log("Grid shift grids not found"),-1;var i={x:-e.x,y:e.y},s={x:Number.NaN,y:Number.NaN},r=[];t:for(var a=0;a<n.grids.length;a++){var o=n.grids[a];if(r.push(o.name),o.isNull){s=i;break}if(o.mandatory,o.grid===null){if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1;continue}for(var h=o.grid.subgrids,l=0,u=h.length;l<u;l++){var f=h[l],m=(Math.abs(f.del[1])+Math.abs(f.del[0]))/1e4,g=f.ll[0]-m,y=f.ll[1]-m,_=f.ll[0]+(f.lim[0]-1)*f.del[0]+m,w=f.ll[1]+(f.lim[1]-1)*f.del[1]+m;if(!(y>i.y||g>i.x||w<i.y||_<i.x)&&(s=SG(i,t,f),!isNaN(s.x)))break t}}return isNaN(s.x)?(console.log("Failed to find a grid shift table for location '"+-i.x*Aa+" "+i.y*Aa+" tried: '"+r+"'"),-1):(e.x=-s.x,e.y=s.y,0)}function SG(n,t,e){var i={x:Number.NaN,y:Number.NaN};if(isNaN(n.x))return i;var s={x:n.x,y:n.y};s.x-=e.ll[0],s.y-=e.ll[1],s.x=pe(s.x-Math.PI)+Math.PI;var r=HM(s,e);if(t){if(isNaN(r.x))return i;r.x=s.x-r.x,r.y=s.y-r.y;var a=9,o=1e-12,h,l;do{if(l=HM(r,e),isNaN(l.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}h={x:s.x-(l.x+r.x),y:s.y-(l.y+r.y)},r.x+=h.x,r.y+=h.y}while(a--&&Math.abs(h.x)>o&&Math.abs(h.y)>o);if(a<0)return console.log("Inverse grid shift iterator failed to converge."),i;i.x=pe(r.x+e.ll[0]),i.y=r.y+e.ll[1]}else isNaN(r.x)||(i.x=n.x+r.x,i.y=n.y+r.y);return i}function HM(n,t){var e={x:n.x/t.del[0],y:n.y/t.del[1]},i={x:Math.floor(e.x),y:Math.floor(e.y)},s={x:e.x-1*i.x,y:e.y-1*i.y},r={x:Number.NaN,y:Number.NaN},a;if(i.x<0||i.x>=t.lim[0]||i.y<0||i.y>=t.lim[1])return r;a=i.y*t.lim[0]+i.x;var o={x:t.cvs[a][0],y:t.cvs[a][1]};a++;var h={x:t.cvs[a][0],y:t.cvs[a][1]};a+=t.lim[0];var l={x:t.cvs[a][0],y:t.cvs[a][1]};a--;var u={x:t.cvs[a][0],y:t.cvs[a][1]},f=s.x*s.y,m=s.x*(1-s.y),g=(1-s.x)*(1-s.y),y=(1-s.x)*s.y;return r.x=g*o.x+m*h.x+y*u.x+f*l.x,r.y=g*o.y+m*h.y+y*u.y+f*l.y,r}function qM(n,t,e){var i=e.x,s=e.y,r=e.z||0,a,o,h,l={};for(h=0;h<3;h++)if(!(t&&h===2&&e.z===void 0))switch(h===0?(a=i,"ew".indexOf(n.axis[h])!==-1?o="x":o="y"):h===1?(a=s,"ns".indexOf(n.axis[h])!==-1?o="y":o="x"):(a=r,o="z"),n.axis[h]){case"e":l[o]=a;break;case"w":l[o]=-a;break;case"n":l[o]=a;break;case"s":l[o]=-a;break;case"u":e[o]!==void 0&&(l.z=a);break;case"d":e[o]!==void 0&&(l.z=-a);break;default:return null}return l}function cA(n){var t={x:n[0],y:n[1]};return n.length>2&&(t.z=n[2]),n.length>3&&(t.m=n[3]),t}function TG(n){XM(n.x),XM(n.y)}function XM(n){if(typeof Number.isFinite=="function"){if(Number.isFinite(n))return;throw new TypeError("coordinates must be finite numbers")}if(typeof n!="number"||n!==n||!isFinite(n))throw new TypeError("coordinates must be finite numbers")}function CG(n,t){return(n.datum.datum_type===hl||n.datum.datum_type===ll||n.datum.datum_type===Fc)&&t.datumCode!=="WGS84"||(t.datum.datum_type===hl||t.datum.datum_type===ll||t.datum.datum_type===Fc)&&n.datumCode!=="WGS84"}function um(n,t,e,i){var s;Array.isArray(e)?e=cA(e):e={x:e.x,y:e.y,z:e.z,m:e.m};var r=e.z!==void 0;if(TG(e),n.datum&&t.datum&&CG(n,t)&&(s=new Na("WGS84"),e=um(n,s,e,i),n=s),i&&n.axis!=="enu"&&(e=qM(n,!1,e)),n.projName==="longlat")e={x:e.x*Vn,y:e.y*Vn,z:e.z||0};else if(n.to_meter&&(e={x:e.x*n.to_meter,y:e.y*n.to_meter,z:e.z||0}),e=n.inverse(e),!e)return;if(n.from_greenwich&&(e.x+=n.from_greenwich),e=EG(n.datum,t.datum,e),!!e)return t.from_greenwich&&(e={x:e.x-t.from_greenwich,y:e.y,z:e.z||0}),t.projName==="longlat"?e={x:e.x*Aa,y:e.y*Aa,z:e.z||0}:(e=t.forward(e),t.to_meter&&(e={x:e.x/t.to_meter,y:e.y/t.to_meter,z:e.z||0})),i&&t.axis!=="enu"?qM(t,!0,e):(e&&!r&&delete e.z,e)}var jM=Na("WGS84");function Hy(n,t,e,i){var s,r,a;return Array.isArray(e)?(s=um(n,t,e,i)||{x:NaN,y:NaN},e.length>2?typeof n.name<"u"&&n.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"?typeof s.z=="number"?[s.x,s.y,s.z].concat(e.splice(3)):[s.x,s.y,e[2]].concat(e.splice(3)):[s.x,s.y].concat(e.splice(2)):[s.x,s.y]):(r=um(n,t,e,i),a=Object.keys(e),a.length===2||a.forEach(function(o){if(typeof n.name<"u"&&n.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"){if(o==="x"||o==="y"||o==="z")return}else if(o==="x"||o==="y")return;r[o]=e[o]}),r)}function ZM(n){return n instanceof Na?n:n.oProj?n.oProj:Na(n)}function Hs(n,t,e){n=ZM(n);var i=!1,s;return typeof t>"u"?(t=n,n=jM,i=!0):(typeof t.x<"u"||Array.isArray(t))&&(e=t,t=n,n=jM,i=!0),t=ZM(t),e?Hy(n,t,e):(s={forward:function(r,a){return Hy(n,t,r,a)},inverse:function(r,a){return Hy(t,n,r,a)}},i&&(s.oProj=t),s)}var KM=6,uA="AJSAJS",dA="AFAFAF",Mc=65,Fs=73,cr=79,xd=86,vd=90;const AG={forward:fA,inverse:RG,toPoint:pA};function fA(n,t){return t=t||5,kG(IG({lat:n[1],lon:n[0]}),t)}function RG(n){var t=Gv(gA(n.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]}function pA(n){var t=Gv(gA(n.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function qy(n){return n*(Math.PI/180)}function JM(n){return 180*(n/Math.PI)}function IG(n){var t=n.lat,e=n.lon,i=6378137,s=.00669438,r=.9996,a,o,h,l,u,f,m,g=qy(t),y=qy(e),_,w;w=Math.floor((e+180)/6)+1,e===180&&(w=60),t>=56&&t<64&&e>=3&&e<12&&(w=32),t>=72&&t<84&&(e>=0&&e<9?w=31:e>=9&&e<21?w=33:e>=21&&e<33?w=35:e>=33&&e<42&&(w=37)),a=(w-1)*6-180+3,_=qy(a),o=s/(1-s),h=i/Math.sqrt(1-s*Math.sin(g)*Math.sin(g)),l=Math.tan(g)*Math.tan(g),u=o*Math.cos(g)*Math.cos(g),f=Math.cos(g)*(y-_),m=i*((1-s/4-3*s*s/64-5*s*s*s/256)*g-(3*s/8+3*s*s/32+45*s*s*s/1024)*Math.sin(2*g)+(15*s*s/256+45*s*s*s/1024)*Math.sin(4*g)-35*s*s*s/3072*Math.sin(6*g));var M=r*h*(f+(1-l+u)*f*f*f/6+(5-18*l+l*l+72*u-58*o)*f*f*f*f*f/120)+5e5,T=r*(m+h*Math.tan(g)*(f*f/2+(5-l+9*u+4*u*u)*f*f*f*f/24+(61-58*l+l*l+600*u-330*o)*f*f*f*f*f*f/720));return t<0&&(T+=1e7),{northing:Math.round(T),easting:Math.round(M),zoneNumber:w,zoneLetter:NG(t)}}function Gv(n){var t=n.northing,e=n.easting,i=n.zoneLetter,s=n.zoneNumber;if(s<0||s>60)return null;var r=.9996,a=6378137,o=.00669438,h,l=(1-Math.sqrt(1-o))/(1+Math.sqrt(1-o)),u,f,m,g,y,_,w,M,T,A=e-5e5,R=t;i<"N"&&(R-=1e7),w=(s-1)*6-180+3,h=o/(1-o),_=R/r,M=_/(a*(1-o/4-3*o*o/64-5*o*o*o/256)),T=M+(3*l/2-27*l*l*l/32)*Math.sin(2*M)+(21*l*l/16-55*l*l*l*l/32)*Math.sin(4*M)+151*l*l*l/96*Math.sin(6*M),u=a/Math.sqrt(1-o*Math.sin(T)*Math.sin(T)),f=Math.tan(T)*Math.tan(T),m=h*Math.cos(T)*Math.cos(T),g=a*(1-o)/Math.pow(1-o*Math.sin(T)*Math.sin(T),1.5),y=A/(u*r);var I=T-u*Math.tan(T)/g*(y*y/2-(5+3*f+10*m-4*m*m-9*h)*y*y*y*y/24+(61+90*f+298*m+45*f*f-252*h-3*m*m)*y*y*y*y*y*y/720);I=JM(I);var L=(y-(1+2*f+m)*y*y*y/6+(5-2*m+28*f-3*m*m+8*h+24*f*f)*y*y*y*y*y/120)/Math.cos(T);L=w+JM(L);var k;if(n.accuracy){var Y=Gv({northing:n.northing+n.accuracy,easting:n.easting+n.accuracy,zoneLetter:n.zoneLetter,zoneNumber:n.zoneNumber});k={top:Y.lat,right:Y.lon,bottom:I,left:L}}else k={lat:I,lon:L};return k}function NG(n){var t="Z";return 84>=n&&n>=72?t="X":72>n&&n>=64?t="W":64>n&&n>=56?t="V":56>n&&n>=48?t="U":48>n&&n>=40?t="T":40>n&&n>=32?t="S":32>n&&n>=24?t="R":24>n&&n>=16?t="Q":16>n&&n>=8?t="P":8>n&&n>=0?t="N":0>n&&n>=-8?t="M":-8>n&&n>=-16?t="L":-16>n&&n>=-24?t="K":-24>n&&n>=-32?t="J":-32>n&&n>=-40?t="H":-40>n&&n>=-48?t="G":-48>n&&n>=-56?t="F":-56>n&&n>=-64?t="E":-64>n&&n>=-72?t="D":-72>n&&n>=-80&&(t="C"),t}function kG(n,t){var e="00000"+n.easting,i="00000"+n.northing;return n.zoneNumber+n.zoneLetter+LG(n.easting,n.northing,n.zoneNumber)+e.substr(e.length-5,t)+i.substr(i.length-5,t)}function LG(n,t,e){var i=mA(e),s=Math.floor(n/1e5),r=Math.floor(t/1e5)%20;return OG(s,r,i)}function mA(n){var t=n%KM;return t===0&&(t=KM),t}function OG(n,t,e){var i=e-1,s=uA.charCodeAt(i),r=dA.charCodeAt(i),a=s+n-1,o=r+t,h=!1;a>vd&&(a=a-vd+Mc-1,h=!0),(a===Fs||s<Fs&&a>Fs||(a>Fs||s<Fs)&&h)&&a++,(a===cr||s<cr&&a>cr||(a>cr||s<cr)&&h)&&(a++,a===Fs&&a++),a>vd&&(a=a-vd+Mc-1),o>xd?(o=o-xd+Mc-1,h=!0):h=!1,(o===Fs||r<Fs&&o>Fs||(o>Fs||r<Fs)&&h)&&o++,(o===cr||r<cr&&o>cr||(o>cr||r<cr)&&h)&&(o++,o===Fs&&o++),o>xd&&(o=o-xd+Mc-1);var l=String.fromCharCode(a)+String.fromCharCode(o);return l}function gA(n){if(n&&n.length===0)throw"MGRSPoint coverting from nothing";for(var t=n.length,e=null,i="",s,r=0;!/[A-Z]/.test(s=n.charAt(r));){if(r>=2)throw"MGRSPoint bad conversion from: "+n;i+=s,r++}var a=parseInt(i,10);if(r===0||r+3>t)throw"MGRSPoint bad conversion from: "+n;var o=n.charAt(r++);if(o<="A"||o==="B"||o==="Y"||o>="Z"||o==="I"||o==="O")throw"MGRSPoint zone letter "+o+" not handled: "+n;e=n.substring(r,r+=2);for(var h=mA(a),l=PG(e.charAt(0),h),u=FG(e.charAt(1),h);u<DG(o);)u+=2e6;var f=t-r;if(f%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+n;var m=f/2,g=0,y=0,_,w,M,T,A;return m>0&&(_=1e5/Math.pow(10,m),w=n.substring(r,r+m),g=parseFloat(w)*_,M=n.substring(r+m),y=parseFloat(M)*_),T=g+l,A=y+u,{easting:T,northing:A,zoneLetter:o,zoneNumber:a,accuracy:_}}function PG(n,t){for(var e=uA.charCodeAt(t-1),i=1e5,s=!1;e!==n.charCodeAt(0);){if(e++,e===Fs&&e++,e===cr&&e++,e>vd){if(s)throw"Bad character: "+n;e=Mc,s=!0}i+=1e5}return i}function FG(n,t){if(n>"V")throw"MGRSPoint given invalid Northing "+n;for(var e=dA.charCodeAt(t-1),i=0,s=!1;e!==n.charCodeAt(0);){if(e++,e===Fs&&e++,e===cr&&e++,e>xd){if(s)throw"Bad character: "+n;e=Mc,s=!0}i+=1e5}return i}function DG(n){var t;switch(n){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+n}function au(n,t,e){if(!(this instanceof au))return new au(n,t,e);if(Array.isArray(n))this.x=n[0],this.y=n[1],this.z=n[2]||0;else if(typeof n=="object")this.x=n.x,this.y=n.y,this.z=n.z||0;else if(typeof n=="string"&&typeof t>"u"){var i=n.split(",");this.x=parseFloat(i[0],10),this.y=parseFloat(i[1],10),this.z=parseFloat(i[2],10)||0}else this.x=n,this.y=t,this.z=e||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}au.fromMGRS=function(n){return new au(pA(n))};au.prototype.toMGRS=function(n){return fA([this.x,this.y],n)};var zG=1,BG=.25,QM=.046875,tE=.01953125,eE=.01068115234375,UG=.75,GG=.46875,VG=.013020833333333334,WG=.007120768229166667,$G=.3645833333333333,YG=.005696614583333333,HG=.3076171875;function yA(n){var t=[];t[0]=zG-n*(BG+n*(QM+n*(tE+n*eE))),t[1]=n*(UG-n*(QM+n*(tE+n*eE)));var e=n*n;return t[2]=e*(GG-n*(VG+n*WG)),e*=n,t[3]=e*($G-n*YG),t[4]=e*n*HG,t}function pg(n,t,e,i){return e*=t,t*=t,i[0]*n-e*(i[1]+t*(i[2]+t*(i[3]+t*i[4])))}var qG=20;function _A(n,t,e){for(var i=1/(1-t),s=n,r=qG;r;--r){var a=Math.sin(s),o=1-t*a*a;if(o=(pg(s,a,Math.cos(s),e)-n)*(o*Math.sqrt(o))*i,s-=o,Math.abs(o)<de)return s}return s}function XG(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=yA(this.es),this.ml0=pg(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function jG(n){var t=n.x,e=n.y,i=pe(t-this.long0),s,r,a,o=Math.sin(e),h=Math.cos(e);if(this.es){var u=h*i,f=Math.pow(u,2),m=this.ep2*Math.pow(h,2),g=Math.pow(m,2),y=Math.abs(h)>de?Math.tan(e):0,_=Math.pow(y,2),w=Math.pow(_,2);s=1-this.es*Math.pow(o,2),u=u/Math.sqrt(s);var M=pg(e,o,h,this.en);r=this.a*(this.k0*u*(1+f/6*(1-_+m+f/20*(5-18*_+w+14*m-58*_*m+f/42*(61+179*w-w*_-479*_)))))+this.x0,a=this.a*(this.k0*(M-this.ml0+o*i*u/2*(1+f/12*(5-_+9*m+4*g+f/30*(61+w-58*_+270*m-330*_*m+f/56*(1385+543*w-w*_-3111*_))))))+this.y0}else{var l=h*Math.sin(i);if(Math.abs(Math.abs(l)-1)<de)return 93;if(r=.5*this.a*this.k0*Math.log((1+l)/(1-l))+this.x0,a=h*Math.cos(i)/Math.sqrt(1-Math.pow(l,2)),l=Math.abs(a),l>=1){if(l-1>de)return 93;a=0}else a=Math.acos(a);e<0&&(a=-a),a=this.a*this.k0*(a-this.lat0)+this.y0}return n.x=r,n.y=a,n}function ZG(n){var t,e,i,s,r=(n.x-this.x0)*(1/this.a),a=(n.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+a/this.k0,e=_A(t,this.es,this.en),Math.abs(e)<ee){var f=Math.sin(e),m=Math.cos(e),g=Math.abs(m)>de?Math.tan(e):0,y=this.ep2*Math.pow(m,2),_=Math.pow(y,2),w=Math.pow(g,2),M=Math.pow(w,2);t=1-this.es*Math.pow(f,2);var T=r*Math.sqrt(t)/this.k0,A=Math.pow(T,2);t=t*g,i=e-t*A/(1-this.es)*.5*(1-A/12*(5+3*w-9*y*w+y-4*_-A/30*(61+90*w-252*y*w+45*M+46*y-A/56*(1385+3633*w+4095*M+1574*M*w)))),s=pe(this.long0+T*(1-A/6*(1+2*w+y-A/20*(5+28*w+24*M+8*y*w+6*y-A/42*(61+662*w+1320*M+720*M*w))))/m)}else i=ee*kf(a),s=0;else{var o=Math.exp(r/this.k0),h=.5*(o-1/o),l=this.lat0+a/this.k0,u=Math.cos(l);t=Math.sqrt((1-Math.pow(u,2))/(1+Math.pow(h,2))),i=Math.asin(t),a<0&&(i=-i),h===0&&u===0?s=0:s=pe(Math.atan2(h,u)+this.long0)}return n.x=s,n.y=i,n}var KG=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const Mp={init:XG,forward:jG,inverse:ZG,names:KG};function xA(n){var t=Math.exp(n);return t=(t-1/t)/2,t}function gr(n,t){n=Math.abs(n),t=Math.abs(t);var e=Math.max(n,t),i=Math.min(n,t)/(e||1);return e*Math.sqrt(1+Math.pow(i,2))}function JG(n){var t=1+n,e=t-1;return e===0?n:n*Math.log(t)/e}function QG(n){var t=Math.abs(n);return t=JG(t*(1+t/(gr(1,t)+1))),n<0?-t:t}function Vv(n,t){for(var e=2*Math.cos(2*t),i=n.length-1,s=n[i],r=0,a;--i>=0;)a=-r+e*s+n[i],r=s,s=a;return t+a*Math.sin(2*t)}function tV(n,t){for(var e=2*Math.cos(t),i=n.length-1,s=n[i],r=0,a;--i>=0;)a=-r+e*s+n[i],r=s,s=a;return Math.sin(t)*a}function eV(n){var t=Math.exp(n);return t=(t+1/t)/2,t}function vA(n,t,e){for(var i=Math.sin(t),s=Math.cos(t),r=xA(e),a=eV(e),o=2*s*a,h=-2*i*r,l=n.length-1,u=n[l],f=0,m=0,g=0,y,_;--l>=0;)y=m,_=f,m=u,f=g,u=-y+o*m-h*f+n[l],g=-_+h*m+o*f;return o=i*a,h=s*r,[o*u-h*g,o*g+h*u]}function iV(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Mp.init.apply(this),this.forward=Mp.forward,this.inverse=Mp.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var n=this.es/(1+Math.sqrt(1-this.es)),t=n/(2-n),e=t;this.cgb[0]=t*(2+t*(-2/3+t*(-2+t*(116/45+t*(26/45+t*(-2854/675)))))),this.cbg[0]=t*(-2+t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))),e=e*t,this.cgb[1]=e*(7/3+t*(-8/5+t*(-227/45+t*(2704/315+t*(2323/945))))),this.cbg[1]=e*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),e=e*t,this.cgb[2]=e*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=e*(-26/15+t*(34/21+t*(8/5+t*(-12686/2835)))),e=e*t,this.cgb[3]=e*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=e*(1237/630+t*(-12/5+t*(-24832/14175))),e=e*t,this.cgb[4]=e*(4174/315+t*(-144838/6237)),this.cbg[4]=e*(-734/315+t*(109598/31185)),e=e*t,this.cgb[5]=e*(601676/22275),this.cbg[5]=e*(444337/155925),e=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+e*(1/4+e*(1/64+e/256))),this.utg[0]=t*(-.5+t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=e*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=e*(13/48+t*(-3/5+t*(557/1440+t*(281/630+t*(-1983433/1935360))))),e=e*t,this.utg[2]=e*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=e*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),e=e*t,this.utg[3]=e*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=e*(49561/161280+t*(-179/168+t*(6601661/7257600))),e=e*t,this.utg[4]=e*(-4583/161280+t*(108847/3991680)),this.gtu[4]=e*(34729/80640+t*(-3418889/1995840)),e=e*t,this.utg[5]=e*(-20648693/638668800),this.gtu[5]=e*(212378941/319334400);var i=Vv(this.cbg,this.lat0);this.Zb=-this.Qn*(i+tV(this.gtu,2*i))}function nV(n){var t=pe(n.x-this.long0),e=n.y;e=Vv(this.cbg,e);var i=Math.sin(e),s=Math.cos(e),r=Math.sin(t),a=Math.cos(t);e=Math.atan2(i,a*s),t=Math.atan2(r*s,gr(i,s*a)),t=QG(Math.tan(t));var o=vA(this.gtu,2*e,2*t);e=e+o[0],t=t+o[1];var h,l;return Math.abs(t)<=2.623395162778?(h=this.a*(this.Qn*t)+this.x0,l=this.a*(this.Qn*e+this.Zb)+this.y0):(h=1/0,l=1/0),n.x=h,n.y=l,n}function sV(n){var t=(n.x-this.x0)*(1/this.a),e=(n.y-this.y0)*(1/this.a);e=(e-this.Zb)/this.Qn,t=t/this.Qn;var i,s;if(Math.abs(t)<=2.623395162778){var r=vA(this.utg,2*e,2*t);e=e+r[0],t=t+r[1],t=Math.atan(xA(t));var a=Math.sin(e),o=Math.cos(e),h=Math.sin(t),l=Math.cos(t);e=Math.atan2(a*l,gr(h,l*o)),t=Math.atan2(h,l*o),i=pe(t+this.long0),s=Vv(this.cgb,e)}else i=1/0,s=1/0;return n.x=i,n.y=s,n}var rV=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const Ep={init:iV,forward:nV,inverse:sV,names:rV};function aV(n,t){if(n===void 0){if(n=Math.floor((pe(t)+Math.PI)*30/Math.PI)+1,n<0)return 0;if(n>60)return 60}return n}var oV="etmerc";function hV(){var n=aV(this.zone,this.long0);if(n===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(n)-183)*Vn,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Ep.init.apply(this),this.forward=Ep.forward,this.inverse=Ep.inverse}var lV=["Universal Transverse Mercator System","utm"];const cV={init:hV,names:lV,dependsOn:oV};function Wv(n,t){return Math.pow((1-n)/(1+n),t)}var uV=20;function dV(){var n=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*n*n),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(n/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Ti)/(Math.pow(Math.tan(.5*this.lat0+Ti),this.C)*Wv(this.e*n,this.ratexp))}function fV(n){var t=n.x,e=n.y;return n.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*e+Ti),this.C)*Wv(this.e*Math.sin(e),this.ratexp))-ee,n.x=this.C*t,n}function pV(n){for(var t=1e-14,e=n.x/this.C,i=n.y,s=Math.pow(Math.tan(.5*i+Ti)/this.K,1/this.C),r=uV;r>0&&(i=2*Math.atan(s*Wv(this.e*Math.sin(n.y),-.5*this.e))-ee,!(Math.abs(i-n.y)<t));--r)n.y=i;return r?(n.x=e,n.y=i,n):null}var mV=["gauss"];const $v={init:dV,forward:fV,inverse:pV,names:mV};function gV(){$v.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function yV(n){var t,e,i,s;return n.x=pe(n.x-this.long0),$v.forward.apply(this,[n]),t=Math.sin(n.y),e=Math.cos(n.y),i=Math.cos(n.x),s=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*e*i),n.x=s*e*Math.sin(n.x),n.y=s*(this.cosc0*t-this.sinc0*e*i),n.x=this.a*n.x+this.x0,n.y=this.a*n.y+this.y0,n}function _V(n){var t,e,i,s,r;if(n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,n.x/=this.k0,n.y/=this.k0,r=gr(n.x,n.y)){var a=2*Math.atan2(r,this.R2);t=Math.sin(a),e=Math.cos(a),s=Math.asin(e*this.sinc0+n.y*t*this.cosc0/r),i=Math.atan2(n.x*t,r*this.cosc0*e-n.y*this.sinc0*t)}else s=this.phic0,i=0;return n.x=i,n.y=s,$v.inverse.apply(this,[n]),n.x=pe(n.x+this.long0),n}var xV=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const vV={init:gV,forward:yV,inverse:_V,names:xV};function wV(n,t,e){return t*=e,Math.tan(.5*(ee+n))*Math.pow((1-t)/(1+t),.5*e)}function bV(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=de&&(this.k0=.5*(1+kf(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=de&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=de&&Math.abs(Math.cos(this.lat_ts))>de&&(this.k0=.5*this.cons*La(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Yr(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=La(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-ee,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function MV(n){var t=n.x,e=n.y,i=Math.sin(e),s=Math.cos(e),r,a,o,h,l,u,f=pe(t-this.long0);return Math.abs(Math.abs(t-this.long0)-Math.PI)<=de&&Math.abs(e+this.lat0)<=de?(n.x=NaN,n.y=NaN,n):this.sphere?(r=2*this.k0/(1+this.sinlat0*i+this.coslat0*s*Math.cos(f)),n.x=this.a*r*s*Math.sin(f)+this.x0,n.y=this.a*r*(this.coslat0*i-this.sinlat0*s*Math.cos(f))+this.y0,n):(a=2*Math.atan(this.ssfn_(e,i,this.e))-ee,h=Math.cos(a),o=Math.sin(a),Math.abs(this.coslat0)<=de?(l=Yr(this.e,e*this.con,this.con*i),u=2*this.a*this.k0*l/this.cons,n.x=this.x0+u*Math.sin(t-this.long0),n.y=this.y0-this.con*u*Math.cos(t-this.long0),n):(Math.abs(this.sinlat0)<de?(r=2*this.a*this.k0/(1+h*Math.cos(f)),n.y=r*o):(r=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*o+this.cosX0*h*Math.cos(f))),n.y=r*(this.cosX0*o-this.sinX0*h*Math.cos(f))+this.y0),n.x=r*h*Math.sin(f)+this.x0,n))}function EV(n){n.x-=this.x0,n.y-=this.y0;var t,e,i,s,r,a=Math.sqrt(n.x*n.x+n.y*n.y);if(this.sphere){var o=2*Math.atan(a/(2*this.a*this.k0));return t=this.long0,e=this.lat0,a<=de?(n.x=t,n.y=e,n):(e=Math.asin(Math.cos(o)*this.sinlat0+n.y*Math.sin(o)*this.coslat0/a),Math.abs(this.coslat0)<de?this.lat0>0?t=pe(this.long0+Math.atan2(n.x,-1*n.y)):t=pe(this.long0+Math.atan2(n.x,n.y)):t=pe(this.long0+Math.atan2(n.x*Math.sin(o),a*this.coslat0*Math.cos(o)-n.y*this.sinlat0*Math.sin(o))),n.x=t,n.y=e,n)}else if(Math.abs(this.coslat0)<=de){if(a<=de)return e=this.lat0,t=this.long0,n.x=t,n.y=e,n;n.x*=this.con,n.y*=this.con,i=a*this.cons/(2*this.a*this.k0),e=this.con*rf(this.e,i),t=this.con*pe(this.con*this.long0+Math.atan2(n.x,-1*n.y))}else s=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,a<=de?r=this.X0:(r=Math.asin(Math.cos(s)*this.sinX0+n.y*Math.sin(s)*this.cosX0/a),t=pe(this.long0+Math.atan2(n.x*Math.sin(s),a*this.cosX0*Math.cos(s)-n.y*this.sinX0*Math.sin(s)))),e=-1*rf(this.e,Math.tan(.5*(ee+r)));return n.x=t,n.y=e,n}var SV=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const TV={init:bV,forward:MV,inverse:EV,names:SV,ssfn_:wV};function CV(){var n=this.lat0;this.lambda0=this.long0;var t=Math.sin(n),e=this.a,i=this.rf,s=1/i,r=2*s-Math.pow(s,2),a=this.e=Math.sqrt(r);this.R=this.k0*e*Math.sqrt(1-r)/(1-r*Math.pow(t,2)),this.alpha=Math.sqrt(1+r/(1-r)*Math.pow(Math.cos(n),4)),this.b0=Math.asin(t/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),h=Math.log(Math.tan(Math.PI/4+n/2)),l=Math.log((1+a*t)/(1-a*t));this.K=o-this.alpha*h+this.alpha*a/2*l}function AV(n){var t=Math.log(Math.tan(Math.PI/4-n.y/2)),e=this.e/2*Math.log((1+this.e*Math.sin(n.y))/(1-this.e*Math.sin(n.y))),i=-this.alpha*(t+e)+this.K,s=2*(Math.atan(Math.exp(i))-Math.PI/4),r=this.alpha*(n.x-this.lambda0),a=Math.atan(Math.sin(r)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(r))),o=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(r));return n.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,n.x=this.R*a+this.x0,n}function RV(n){for(var t=n.x-this.x0,e=n.y-this.y0,i=t/this.R,s=2*(Math.atan(Math.exp(e/this.R))-Math.PI/4),r=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(i)),a=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(s))),o=this.lambda0+a/this.alpha,h=0,l=r,u=-1e3,f=0;Math.abs(l-u)>1e-7;){if(++f>20)return;h=1/this.alpha*(Math.log(Math.tan(Math.PI/4+r/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(l))/2)),u=l,l=2*Math.atan(Math.exp(h))-Math.PI/2}return n.x=o,n.y=l,n}var IV=["somerc"];const NV={init:CV,forward:AV,inverse:RV,names:IV};var mc=1e-7;function kV(n){var t=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],e=typeof n.PROJECTION=="object"?Object.keys(n.PROJECTION)[0]:n.PROJECTION;return"no_uoff"in n||"no_off"in n||t.indexOf(e)!==-1}function LV(){var n,t,e,i,s,r,a,o,h,l,u=0,f,m=0,g=0,y=0,_=0,w=0,M=0;this.no_off=kV(this),this.no_rot="no_rot"in this;var T=!1;"alpha"in this&&(T=!0);var A=!1;if("rectified_grid_angle"in this&&(A=!0),T&&(M=this.alpha),A&&(u=this.rectified_grid_angle*Vn),T||A)m=this.longc;else if(g=this.long1,_=this.lat1,y=this.long2,w=this.lat2,Math.abs(_-w)<=mc||(n=Math.abs(_))<=mc||Math.abs(n-ee)<=mc||Math.abs(Math.abs(this.lat0)-ee)<=mc||Math.abs(Math.abs(w)-ee)<=mc)throw new Error;var R=1-this.es;t=Math.sqrt(R),Math.abs(this.lat0)>de?(o=Math.sin(this.lat0),e=Math.cos(this.lat0),n=1-this.es*o*o,this.B=e*e,this.B=Math.sqrt(1+this.es*this.B*this.B/R),this.A=this.B*this.k0*t/n,i=this.B*t/(e*Math.sqrt(n)),s=i*i-1,s<=0?s=0:(s=Math.sqrt(s),this.lat0<0&&(s=-s)),this.E=s+=i,this.E*=Math.pow(Yr(this.e,this.lat0,o),this.B)):(this.B=1/t,this.A=this.k0,this.E=i=s=1),T||A?(T?(f=Math.asin(Math.sin(M)/i),A||(u=M)):(f=u,M=Math.asin(i*Math.sin(f))),this.lam0=m-Math.asin(.5*(s-1/s)*Math.tan(f))/this.B):(r=Math.pow(Yr(this.e,_,Math.sin(_)),this.B),a=Math.pow(Yr(this.e,w,Math.sin(w)),this.B),s=this.E/r,h=(a-r)/(a+r),l=this.E*this.E,l=(l-a*r)/(l+a*r),n=g-y,n<-Math.pi?y-=nf:n>Math.pi&&(y+=nf),this.lam0=pe(.5*(g+y)-Math.atan(l*Math.tan(.5*this.B*(g-y))/h)/this.B),f=Math.atan(2*Math.sin(this.B*pe(g-this.lam0))/(s-1/s)),u=M=Math.asin(i*Math.sin(f))),this.singam=Math.sin(f),this.cosgam=Math.cos(f),this.sinrot=Math.sin(u),this.cosrot=Math.cos(u),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(i*i-1)/Math.cos(M))),this.lat0<0&&(this.u_0=-this.u_0)),s=.5*f,this.v_pole_n=this.ArB*Math.log(Math.tan(Ti-s)),this.v_pole_s=this.ArB*Math.log(Math.tan(Ti+s))}function OV(n){var t={},e,i,s,r,a,o,h,l;if(n.x=n.x-this.lam0,Math.abs(Math.abs(n.y)-ee)>de){if(a=this.E/Math.pow(Yr(this.e,n.y,Math.sin(n.y)),this.B),o=1/a,e=.5*(a-o),i=.5*(a+o),r=Math.sin(this.B*n.x),s=(e*this.singam-r*this.cosgam)/i,Math.abs(Math.abs(s)-1)<de)throw new Error;l=.5*this.ArB*Math.log((1-s)/(1+s)),o=Math.cos(this.B*n.x),Math.abs(o)<mc?h=this.A*n.x:h=this.ArB*Math.atan2(e*this.cosgam+r*this.singam,o)}else l=n.y>0?this.v_pole_n:this.v_pole_s,h=this.ArB*n.y;return this.no_rot?(t.x=h,t.y=l):(h-=this.u_0,t.x=l*this.cosrot+h*this.sinrot,t.y=h*this.cosrot-l*this.sinrot),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function PV(n){var t,e,i,s,r,a,o,h={};if(n.x=(n.x-this.x0)*(1/this.a),n.y=(n.y-this.y0)*(1/this.a),this.no_rot?(e=n.y,t=n.x):(e=n.x*this.cosrot-n.y*this.sinrot,t=n.y*this.cosrot+n.x*this.sinrot+this.u_0),i=Math.exp(-this.BrA*e),s=.5*(i-1/i),r=.5*(i+1/i),a=Math.sin(this.BrA*t),o=(a*this.cosgam+s*this.singam)/r,Math.abs(Math.abs(o)-1)<de)h.x=0,h.y=o<0?-ee:ee;else{if(h.y=this.E/Math.sqrt((1+o)/(1-o)),h.y=rf(this.e,Math.pow(h.y,1/this.B)),h.y===1/0)throw new Error;h.x=-this.rB*Math.atan2(s*this.cosgam-a*this.singam,Math.cos(this.BrA*t))}return h.x+=this.lam0,h}var FV=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const DV={init:LV,forward:OV,inverse:PV,names:FV};function zV(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<de)){var n=this.b/this.a;this.e=Math.sqrt(1-n*n);var t=Math.sin(this.lat1),e=Math.cos(this.lat1),i=La(this.e,t,e),s=Yr(this.e,this.lat1,t),r=Math.sin(this.lat2),a=Math.cos(this.lat2),o=La(this.e,r,a),h=Yr(this.e,this.lat2,r),l=Yr(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>de?this.ns=Math.log(i/o)/Math.log(s/h):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=i/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(l,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function BV(n){var t=n.x,e=n.y;Math.abs(2*Math.abs(e)-Math.PI)<=de&&(e=kf(e)*(ee-2*de));var i=Math.abs(Math.abs(e)-ee),s,r;if(i>de)s=Yr(this.e,e,Math.sin(e)),r=this.a*this.f0*Math.pow(s,this.ns);else{if(i=e*this.ns,i<=0)return null;r=0}var a=this.ns*pe(t-this.long0);return n.x=this.k0*(r*Math.sin(a))+this.x0,n.y=this.k0*(this.rh-r*Math.cos(a))+this.y0,n}function UV(n){var t,e,i,s,r,a=(n.x-this.x0)/this.k0,o=this.rh-(n.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(a*a+o*o),e=1):(t=-Math.sqrt(a*a+o*o),e=-1);var h=0;if(t!==0&&(h=Math.atan2(e*a,e*o)),t!==0||this.ns>0){if(e=1/this.ns,i=Math.pow(t/(this.a*this.f0),e),s=rf(this.e,i),s===-9999)return null}else s=-ee;return r=pe(h/this.ns+this.long0),n.x=r,n.y=s,n}var GV=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const VV={init:zV,forward:BV,inverse:UV,names:GV};function WV(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function $V(n){var t,e,i,s,r,a,o,h=n.x,l=n.y,u=pe(h-this.long0);return t=Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.alfa*this.e/2),e=2*(Math.atan(this.k*Math.pow(Math.tan(l/2+this.s45),this.alfa)/t)-this.s45),i=-u*this.alfa,s=Math.asin(Math.cos(this.ad)*Math.sin(e)+Math.sin(this.ad)*Math.cos(e)*Math.cos(i)),r=Math.asin(Math.cos(e)*Math.sin(i)/Math.cos(s)),a=this.n*r,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n),n.y=o*Math.cos(a)/1,n.x=o*Math.sin(a)/1,this.czech||(n.y*=-1,n.x*=-1),n}function YV(n){var t,e,i,s,r,a,o,h,l=n.x;n.x=n.y,n.y=l,this.czech||(n.y*=-1,n.x*=-1),a=Math.sqrt(n.x*n.x+n.y*n.y),r=Math.atan2(n.y,n.x),s=r/Math.sin(this.s0),i=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(i)-Math.sin(this.ad)*Math.cos(i)*Math.cos(s)),e=Math.asin(Math.cos(i)*Math.sin(s)/Math.cos(t)),n.x=this.long0-e/this.alfa,o=t,h=0;var u=0;do n.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-n.y)<1e-10&&(h=1),o=n.y,u+=1;while(h===0&&u<15);return u>=15?null:n}var HV=["Krovak","krovak"];const qV={init:WV,forward:$V,inverse:YV,names:HV};function Ss(n,t,e,i,s){return n*s-t*Math.sin(2*s)+e*Math.sin(4*s)-i*Math.sin(6*s)}function Lf(n){return 1-.25*n*(1+n/16*(3+1.25*n))}function Of(n){return .375*n*(1+.25*n*(1+.46875*n))}function Pf(n){return .05859375*n*n*(1+.75*n)}function Ff(n){return n*n*n*(35/3072)}function ou(n,t,e){var i=t*e;return n/Math.sqrt(1-i*i)}function wu(n){return Math.abs(n)<ee?n:n-kf(n)*Math.PI}function dm(n,t,e,i,s){var r,a;r=n/t;for(var o=0;o<15;o++)if(a=(n-(t*r-e*Math.sin(2*r)+i*Math.sin(4*r)-s*Math.sin(6*r)))/(t-2*e*Math.cos(2*r)+4*i*Math.cos(4*r)-6*s*Math.cos(6*r)),r+=a,Math.abs(a)<=1e-10)return r;return NaN}function XV(){this.sphere||(this.e0=Lf(this.es),this.e1=Of(this.es),this.e2=Pf(this.es),this.e3=Ff(this.es),this.ml0=this.a*Ss(this.e0,this.e1,this.e2,this.e3,this.lat0))}function jV(n){var t,e,i=n.x,s=n.y;if(i=pe(i-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(s)*Math.sin(i)),e=this.a*(Math.atan2(Math.tan(s),Math.cos(i))-this.lat0);else{var r=Math.sin(s),a=Math.cos(s),o=ou(this.a,this.e,r),h=Math.tan(s)*Math.tan(s),l=i*Math.cos(s),u=l*l,f=this.es*a*a/(1-this.es),m=this.a*Ss(this.e0,this.e1,this.e2,this.e3,s);t=o*l*(1-u*h*(1/6-(8-h+8*f)*u/120)),e=m-this.ml0+o*r/a*u*(.5+(5-h+6*f)*u/24)}return n.x=t+this.x0,n.y=e+this.y0,n}function ZV(n){n.x-=this.x0,n.y-=this.y0;var t=n.x/this.a,e=n.y/this.a,i,s;if(this.sphere){var r=e+this.lat0;i=Math.asin(Math.sin(r)*Math.cos(t)),s=Math.atan2(Math.tan(t),Math.cos(r))}else{var a=this.ml0/this.a+e,o=dm(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-ee)<=de)return n.x=this.long0,n.y=ee,e<0&&(n.y*=-1),n;var h=ou(this.a,this.e,Math.sin(o)),l=h*h*h/this.a/this.a*(1-this.es),u=Math.pow(Math.tan(o),2),f=t*this.a/h,m=f*f;i=o-h*Math.tan(o)/l*f*f*(.5-(1+3*u)*f*f/24),s=f*(1-m*(u/3+(1+3*u)*u*m/15))/Math.cos(o)}return n.x=pe(s+this.long0),n.y=wu(i),n}var KV=["Cassini","Cassini_Soldner","cass"];const JV={init:XV,forward:jV,inverse:ZV,names:KV};function ch(n,t){var e;return n>1e-7?(e=n*t,(1-n*n)*(t/(1-e*e)-.5/n*Math.log((1-e)/(1+e)))):2*t}var QV=1,tW=2,eW=3,iW=4;function nW(){var n=Math.abs(this.lat0);if(Math.abs(n-ee)<de?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(n)<de?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var t;switch(this.qp=ch(this.e,1),this.mmf=.5/(1-this.es),this.apa=dW(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=ch(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function sW(n){var t,e,i,s,r,a,o,h,l,u,f=n.x,m=n.y;if(f=pe(f-this.long0),this.sphere){if(r=Math.sin(m),u=Math.cos(m),i=Math.cos(f),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e=this.mode===this.EQUIT?1+u*i:1+this.sinph0*r+this.cosph0*u*i,e<=de)return null;e=Math.sqrt(2/e),t=e*u*Math.sin(f),e*=this.mode===this.EQUIT?r:this.cosph0*r-this.sinph0*u*i}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),Math.abs(m+this.lat0)<de)return null;e=Ti-m*.5,e=2*(this.mode===this.S_POLE?Math.cos(e):Math.sin(e)),t=e*Math.sin(f),e*=i}}else{switch(o=0,h=0,l=0,i=Math.cos(f),s=Math.sin(f),r=Math.sin(m),a=ch(this.e,r),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(o=a/this.qp,h=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:l=1+this.sinb1*o+this.cosb1*h*i;break;case this.EQUIT:l=1+h*i;break;case this.N_POLE:l=ee+m,a=this.qp-a;break;case this.S_POLE:l=m-ee,a=this.qp+a;break}if(Math.abs(l)<de)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:l=Math.sqrt(2/l),this.mode===this.OBLIQ?e=this.ymf*l*(this.cosb1*o-this.sinb1*h*i):e=(l=Math.sqrt(2/(1+h*i)))*o*this.ymf,t=this.xmf*l*h*s;break;case this.N_POLE:case this.S_POLE:a>=0?(t=(l=Math.sqrt(a))*s,e=i*(this.mode===this.S_POLE?l:-l)):t=e=0;break}}return n.x=this.a*t+this.x0,n.y=this.a*e+this.y0,n}function rW(n){n.x-=this.x0,n.y-=this.y0;var t=n.x/this.a,e=n.y/this.a,i,s,r,a,o,h,l;if(this.sphere){var u=0,f,m=0;if(f=Math.sqrt(t*t+e*e),s=f*.5,s>1)return null;switch(s=2*Math.asin(s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(m=Math.sin(s),u=Math.cos(s)),this.mode){case this.EQUIT:s=Math.abs(f)<=de?0:Math.asin(e*m/f),t*=m,e=u*f;break;case this.OBLIQ:s=Math.abs(f)<=de?this.lat0:Math.asin(u*this.sinph0+e*m*this.cosph0/f),t*=m*this.cosph0,e=(u-Math.sin(s)*this.sinph0)*f;break;case this.N_POLE:e=-e,s=ee-s;break;case this.S_POLE:s-=ee;break}i=e===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(t,e)}else{if(l=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t/=this.dd,e*=this.dd,h=Math.sqrt(t*t+e*e),h<de)return n.x=this.long0,n.y=this.lat0,n;a=2*Math.asin(.5*h/this.rq),r=Math.cos(a),t*=a=Math.sin(a),this.mode===this.OBLIQ?(l=r*this.sinb1+e*a*this.cosb1/h,o=this.qp*l,e=h*this.cosb1*r-e*this.sinb1*a):(l=e*a/h,o=this.qp*l,e=h*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(e=-e),o=t*t+e*e,!o)return n.x=this.long0,n.y=this.lat0,n;l=1-o/this.qp,this.mode===this.S_POLE&&(l=-l)}i=Math.atan2(t,e),s=fW(Math.asin(l),this.apa)}return n.x=pe(this.long0+i),n.y=s,n}var aW=.3333333333333333,oW=.17222222222222222,hW=.10257936507936508,lW=.06388888888888888,cW=.0664021164021164,uW=.016415012942191543;function dW(n){var t,e=[];return e[0]=n*aW,t=n*n,e[0]+=t*oW,e[1]=t*lW,t*=n,e[0]+=t*hW,e[1]+=t*cW,e[2]=t*uW,e}function fW(n,t){var e=n+n;return n+t[0]*Math.sin(e)+t[1]*Math.sin(e+e)+t[2]*Math.sin(e+e+e)}var pW=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const mW={init:nW,forward:sW,inverse:rW,names:pW,S_POLE:QV,N_POLE:tW,EQUIT:eW,OBLIQ:iW};function _h(n){return Math.abs(n)>1&&(n=n>1?1:-1),Math.asin(n)}function gW(){Math.abs(this.lat1+this.lat2)<de||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=La(this.e3,this.sin_po,this.cos_po),this.qs1=ch(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=La(this.e3,this.sin_po,this.cos_po),this.qs2=ch(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=ch(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>de?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function yW(n){var t=n.x,e=n.y;this.sin_phi=Math.sin(e),this.cos_phi=Math.cos(e);var i=ch(this.e3,this.sin_phi),s=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,r=this.ns0*pe(t-this.long0),a=s*Math.sin(r)+this.x0,o=this.rh-s*Math.cos(r)+this.y0;return n.x=a,n.y=o,n}function _W(n){var t,e,i,s,r,a;return n.x-=this.x0,n.y=this.rh-n.y+this.y0,this.ns0>=0?(t=Math.sqrt(n.x*n.x+n.y*n.y),i=1):(t=-Math.sqrt(n.x*n.x+n.y*n.y),i=-1),s=0,t!==0&&(s=Math.atan2(i*n.x,i*n.y)),i=t*this.ns0/this.a,this.sphere?a=Math.asin((this.c-i*i)/(2*this.ns0)):(e=(this.c-i*i)/this.ns0,a=this.phi1z(this.e3,e)),r=pe(s/this.ns0+this.long0),n.x=r,n.y=a,n}function xW(n,t){var e,i,s,r,a,o=_h(.5*t);if(n<de)return o;for(var h=n*n,l=1;l<=25;l++)if(e=Math.sin(o),i=Math.cos(o),s=n*e,r=1-s*s,a=.5*r*r/i*(t/(1-h)-e/r+.5/n*Math.log((1-s)/(1+s))),o=o+a,Math.abs(a)<=1e-7)return o;return null}var vW=["Albers_Conic_Equal_Area","Albers","aea"];const wW={init:gW,forward:yW,inverse:_W,names:vW,phi1z:xW};function bW(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function MW(n){var t,e,i,s,r,a,o,h,l=n.x,u=n.y;return i=pe(l-this.long0),t=Math.sin(u),e=Math.cos(u),s=Math.cos(i),a=this.sin_p14*t+this.cos_p14*e*s,r=1,a>0||Math.abs(a)<=de?(o=this.x0+this.a*r*e*Math.sin(i)/a,h=this.y0+this.a*r*(this.cos_p14*t-this.sin_p14*e*s)/a):(o=this.x0+this.infinity_dist*e*Math.sin(i),h=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*e*s)),n.x=o,n.y=h,n}function EW(n){var t,e,i,s,r,a;return n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,n.x/=this.k0,n.y/=this.k0,(t=Math.sqrt(n.x*n.x+n.y*n.y))?(s=Math.atan2(t,this.rc),e=Math.sin(s),i=Math.cos(s),a=_h(i*this.sin_p14+n.y*e*this.cos_p14/t),r=Math.atan2(n.x*e,t*this.cos_p14*i-n.y*this.sin_p14*e),r=pe(this.long0+r)):(a=this.phic0,r=0),n.x=r,n.y=a,n}var SW=["gnom"];const TW={init:bW,forward:MW,inverse:EW,names:SW};function CW(n,t){var e=1-(1-n*n)/(2*n)*Math.log((1-n)/(1+n));if(Math.abs(Math.abs(t)-e)<1e-6)return t<0?-1*ee:ee;for(var i=Math.asin(.5*t),s,r,a,o,h=0;h<30;h++)if(r=Math.sin(i),a=Math.cos(i),o=n*r,s=Math.pow(1-o*o,2)/(2*a)*(t/(1-n*n)-r/(1-o*o)+.5/n*Math.log((1-o)/(1+o))),i+=s,Math.abs(s)<=1e-10)return i;return NaN}function AW(){this.sphere||(this.k0=La(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function RW(n){var t=n.x,e=n.y,i,s,r=pe(t-this.long0);if(this.sphere)i=this.x0+this.a*r*Math.cos(this.lat_ts),s=this.y0+this.a*Math.sin(e)/Math.cos(this.lat_ts);else{var a=ch(this.e,Math.sin(e));i=this.x0+this.a*this.k0*r,s=this.y0+this.a*a*.5/this.k0}return n.x=i,n.y=s,n}function IW(n){n.x-=this.x0,n.y-=this.y0;var t,e;return this.sphere?(t=pe(this.long0+n.x/this.a/Math.cos(this.lat_ts)),e=Math.asin(n.y/this.a*Math.cos(this.lat_ts))):(e=CW(this.e,2*n.y*this.k0/this.a),t=pe(this.long0+n.x/(this.a*this.k0))),n.x=t,n.y=e,n}var NW=["cea"];const kW={init:AW,forward:RW,inverse:IW,names:NW};function LW(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function OW(n){var t=n.x,e=n.y,i=pe(t-this.long0),s=wu(e-this.lat0);return n.x=this.x0+this.a*i*this.rc,n.y=this.y0+this.a*s,n}function PW(n){var t=n.x,e=n.y;return n.x=pe(this.long0+(t-this.x0)/(this.a*this.rc)),n.y=wu(this.lat0+(e-this.y0)/this.a),n}var FW=["Equirectangular","Equidistant_Cylindrical","eqc"];const DW={init:LW,forward:OW,inverse:PW,names:FW};var iE=20;function zW(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Lf(this.es),this.e1=Of(this.es),this.e2=Pf(this.es),this.e3=Ff(this.es),this.ml0=this.a*Ss(this.e0,this.e1,this.e2,this.e3,this.lat0)}function BW(n){var t=n.x,e=n.y,i,s,r,a=pe(t-this.long0);if(r=a*Math.sin(e),this.sphere)Math.abs(e)<=de?(i=this.a*a,s=-1*this.a*this.lat0):(i=this.a*Math.sin(r)/Math.tan(e),s=this.a*(wu(e-this.lat0)+(1-Math.cos(r))/Math.tan(e)));else if(Math.abs(e)<=de)i=this.a*a,s=-1*this.ml0;else{var o=ou(this.a,this.e,Math.sin(e))/Math.tan(e);i=o*Math.sin(r),s=this.a*Ss(this.e0,this.e1,this.e2,this.e3,e)-this.ml0+o*(1-Math.cos(r))}return n.x=i+this.x0,n.y=s+this.y0,n}function UW(n){var t,e,i,s,r,a,o,h,l;if(i=n.x-this.x0,s=n.y-this.y0,this.sphere)if(Math.abs(s+this.a*this.lat0)<=de)t=pe(i/this.a+this.long0),e=0;else{a=this.lat0+s/this.a,o=i*i/this.a/this.a+a*a,h=a;var u;for(r=iE;r;--r)if(u=Math.tan(h),l=-1*(a*(h*u+1)-h-.5*(h*h+o)*u)/((h-a)/u-1),h+=l,Math.abs(l)<=de){e=h;break}t=pe(this.long0+Math.asin(i*Math.tan(h)/this.a)/Math.sin(e))}else if(Math.abs(s+this.ml0)<=de)e=0,t=pe(this.long0+i/this.a);else{a=(this.ml0+s)/this.a,o=i*i/this.a/this.a+a*a,h=a;var f,m,g,y,_;for(r=iE;r;--r)if(_=this.e*Math.sin(h),f=Math.sqrt(1-_*_)*Math.tan(h),m=this.a*Ss(this.e0,this.e1,this.e2,this.e3,h),g=this.e0-2*this.e1*Math.cos(2*h)+4*this.e2*Math.cos(4*h)-6*this.e3*Math.cos(6*h),y=m/this.a,l=(a*(f*y+1)-y-.5*f*(y*y+o))/(this.es*Math.sin(2*h)*(y*y+o-2*a*y)/(4*f)+(a-y)*(f*g-2/Math.sin(2*h))-g),h-=l,Math.abs(l)<=de){e=h;break}f=Math.sqrt(1-this.es*Math.pow(Math.sin(e),2))*Math.tan(e),t=pe(this.long0+Math.asin(i*f/this.a)/Math.sin(e))}return n.x=t,n.y=e,n}var GW=["Polyconic","poly"];const VW={init:zW,forward:BW,inverse:UW,names:GW};function WW(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function $W(n){var t,e=n.x,i=n.y,s=i-this.lat0,r=e-this.long0,a=s/Cd*1e-5,o=r,h=1,l=0;for(t=1;t<=10;t++)h=h*a,l=l+this.A[t]*h;var u=l,f=o,m=1,g=0,y,_,w=0,M=0;for(t=1;t<=6;t++)y=m*u-g*f,_=g*u+m*f,m=y,g=_,w=w+this.B_re[t]*m-this.B_im[t]*g,M=M+this.B_im[t]*m+this.B_re[t]*g;return n.x=M*this.a+this.x0,n.y=w*this.a+this.y0,n}function YW(n){var t,e=n.x,i=n.y,s=e-this.x0,r=i-this.y0,a=r/this.a,o=s/this.a,h=1,l=0,u,f,m=0,g=0;for(t=1;t<=6;t++)u=h*a-l*o,f=l*a+h*o,h=u,l=f,m=m+this.C_re[t]*h-this.C_im[t]*l,g=g+this.C_im[t]*h+this.C_re[t]*l;for(var y=0;y<this.iterations;y++){var _=m,w=g,M,T,A=a,R=o;for(t=2;t<=6;t++)M=_*m-w*g,T=w*m+_*g,_=M,w=T,A=A+(t-1)*(this.B_re[t]*_-this.B_im[t]*w),R=R+(t-1)*(this.B_im[t]*_+this.B_re[t]*w);_=1,w=0;var I=this.B_re[1],L=this.B_im[1];for(t=2;t<=6;t++)M=_*m-w*g,T=w*m+_*g,_=M,w=T,I=I+t*(this.B_re[t]*_-this.B_im[t]*w),L=L+t*(this.B_im[t]*_+this.B_re[t]*w);var k=I*I+L*L;m=(A*I+R*L)/k,g=(R*I-A*L)/k}var Y=m,K=g,rt=1,ut=0;for(t=1;t<=9;t++)rt=rt*Y,ut=ut+this.D[t]*rt;var Z=this.lat0+ut*Cd*1e5,ht=this.long0+K;return n.x=ht,n.y=Z,n}var HW=["New_Zealand_Map_Grid","nzmg"];const qW={init:WW,forward:$W,inverse:YW,names:HW};function XW(){}function jW(n){var t=n.x,e=n.y,i=pe(t-this.long0),s=this.x0+this.a*i,r=this.y0+this.a*Math.log(Math.tan(Math.PI/4+e/2.5))*1.25;return n.x=s,n.y=r,n}function ZW(n){n.x-=this.x0,n.y-=this.y0;var t=pe(this.long0+n.x/this.a),e=2.5*(Math.atan(Math.exp(.8*n.y/this.a))-Math.PI/4);return n.x=t,n.y=e,n}var KW=["Miller_Cylindrical","mill"];const JW={init:XW,forward:jW,inverse:ZW,names:KW};var QW=20;function t$(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=yA(this.es)}function e$(n){var t,e,i=n.x,s=n.y;if(i=pe(i-this.long0),this.sphere){if(!this.m)s=this.n!==1?Math.asin(this.n*Math.sin(s)):s;else for(var r=this.n*Math.sin(s),a=QW;a;--a){var o=(this.m*s+Math.sin(s)-r)/(this.m+Math.cos(s));if(s-=o,Math.abs(o)<de)break}t=this.a*this.C_x*i*(this.m+Math.cos(s)),e=this.a*this.C_y*s}else{var h=Math.sin(s),l=Math.cos(s);e=this.a*pg(s,h,l,this.en),t=this.a*i*l/Math.sqrt(1-this.es*h*h)}return n.x=t,n.y=e,n}function i$(n){var t,e,i,s;return n.x-=this.x0,i=n.x/this.a,n.y-=this.y0,t=n.y/this.a,this.sphere?(t/=this.C_y,i=i/(this.C_x*(this.m+Math.cos(t))),this.m?t=_h((this.m*t+Math.sin(t))/this.n):this.n!==1&&(t=_h(Math.sin(t)/this.n)),i=pe(i+this.long0),t=wu(t)):(t=_A(n.y/this.a,this.es,this.en),s=Math.abs(t),s<ee?(s=Math.sin(t),e=this.long0+n.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(t)),i=pe(e)):s-de<ee&&(i=this.long0)),n.x=i,n.y=t,n}var n$=["Sinusoidal","sinu"];const s$={init:t$,forward:e$,inverse:i$,names:n$};function r$(){}function a$(n){for(var t=n.x,e=n.y,i=pe(t-this.long0),s=e,r=Math.PI*Math.sin(e);;){var a=-(s+Math.sin(s)-r)/(1+Math.cos(s));if(s+=a,Math.abs(a)<de)break}s/=2,Math.PI/2-Math.abs(e)<de&&(i=0);var o=.900316316158*this.a*i*Math.cos(s)+this.x0,h=1.4142135623731*this.a*Math.sin(s)+this.y0;return n.x=o,n.y=h,n}function o$(n){var t,e;n.x-=this.x0,n.y-=this.y0,e=n.y/(1.4142135623731*this.a),Math.abs(e)>.999999999999&&(e=.999999999999),t=Math.asin(e);var i=pe(this.long0+n.x/(.900316316158*this.a*Math.cos(t)));i<-Math.PI&&(i=-Math.PI),i>Math.PI&&(i=Math.PI),e=(2*t+Math.sin(2*t))/Math.PI,Math.abs(e)>1&&(e=1);var s=Math.asin(e);return n.x=i,n.y=s,n}var h$=["Mollweide","moll"];const l$={init:r$,forward:a$,inverse:o$,names:h$};function c$(){Math.abs(this.lat1+this.lat2)<de||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Lf(this.es),this.e1=Of(this.es),this.e2=Pf(this.es),this.e3=Ff(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=La(this.e,this.sinphi,this.cosphi),this.ml1=Ss(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<de?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=La(this.e,this.sinphi,this.cosphi),this.ml2=Ss(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Ss(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function u$(n){var t=n.x,e=n.y,i;if(this.sphere)i=this.a*(this.g-e);else{var s=Ss(this.e0,this.e1,this.e2,this.e3,e);i=this.a*(this.g-s)}var r=this.ns*pe(t-this.long0),a=this.x0+i*Math.sin(r),o=this.y0+this.rh-i*Math.cos(r);return n.x=a,n.y=o,n}function d$(n){n.x-=this.x0,n.y=this.rh-n.y+this.y0;var t,e,i,s;this.ns>=0?(e=Math.sqrt(n.x*n.x+n.y*n.y),t=1):(e=-Math.sqrt(n.x*n.x+n.y*n.y),t=-1);var r=0;if(e!==0&&(r=Math.atan2(t*n.x,t*n.y)),this.sphere)return s=pe(this.long0+r/this.ns),i=wu(this.g-e/this.a),n.x=s,n.y=i,n;var a=this.g-e/this.a;return i=dm(a,this.e0,this.e1,this.e2,this.e3),s=pe(this.long0+r/this.ns),n.x=s,n.y=i,n}var f$=["Equidistant_Conic","eqdc"];const p$={init:c$,forward:u$,inverse:d$,names:f$};function m$(){this.R=this.a}function g$(n){var t=n.x,e=n.y,i=pe(t-this.long0),s,r;Math.abs(e)<=de&&(s=this.x0+this.R*i,r=this.y0);var a=_h(2*Math.abs(e/Math.PI));(Math.abs(i)<=de||Math.abs(Math.abs(e)-ee)<=de)&&(s=this.x0,e>=0?r=this.y0+Math.PI*this.R*Math.tan(.5*a):r=this.y0+Math.PI*this.R*-Math.tan(.5*a));var o=.5*Math.abs(Math.PI/i-i/Math.PI),h=o*o,l=Math.sin(a),u=Math.cos(a),f=u/(l+u-1),m=f*f,g=f*(2/l-1),y=g*g,_=Math.PI*this.R*(o*(f-y)+Math.sqrt(h*(f-y)*(f-y)-(y+h)*(m-y)))/(y+h);i<0&&(_=-_),s=this.x0+_;var w=h+f;return _=Math.PI*this.R*(g*w-o*Math.sqrt((y+h)*(h+1)-w*w))/(y+h),e>=0?r=this.y0+_:r=this.y0-_,n.x=s,n.y=r,n}function y$(n){var t,e,i,s,r,a,o,h,l,u,f,m,g;return n.x-=this.x0,n.y-=this.y0,f=Math.PI*this.R,i=n.x/f,s=n.y/f,r=i*i+s*s,a=-Math.abs(s)*(1+r),o=a-2*s*s+i*i,h=-2*a+1+2*s*s+r*r,g=s*s/h+(2*o*o*o/h/h/h-9*a*o/h/h)/27,l=(a-o*o/3/h)/h,u=2*Math.sqrt(-l/3),f=3*g/l/u,Math.abs(f)>1&&(f>=0?f=1:f=-1),m=Math.acos(f)/3,n.y>=0?e=(-u*Math.cos(m+Math.PI/3)-o/3/h)*Math.PI:e=-(-u*Math.cos(m+Math.PI/3)-o/3/h)*Math.PI,Math.abs(i)<de?t=this.long0:t=pe(this.long0+Math.PI*(r-1+Math.sqrt(1+2*(i*i-s*s)+r*r))/2/i),n.x=t,n.y=e,n}var _$=["Van_der_Grinten_I","VanDerGrinten","vandg"];const x$={init:m$,forward:g$,inverse:y$,names:_$};function v$(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function w$(n){var t=n.x,e=n.y,i=Math.sin(n.y),s=Math.cos(n.y),r=pe(t-this.long0),a,o,h,l,u,f,m,g,y,_,w,M,T,A,R,I,L,k,Y,K,rt,ut,Z;return this.sphere?Math.abs(this.sin_p12-1)<=de?(n.x=this.x0+this.a*(ee-e)*Math.sin(r),n.y=this.y0-this.a*(ee-e)*Math.cos(r),n):Math.abs(this.sin_p12+1)<=de?(n.x=this.x0+this.a*(ee+e)*Math.sin(r),n.y=this.y0+this.a*(ee+e)*Math.cos(r),n):(k=this.sin_p12*i+this.cos_p12*s*Math.cos(r),I=Math.acos(k),L=I?I/Math.sin(I):1,n.x=this.x0+this.a*L*s*Math.sin(r),n.y=this.y0+this.a*L*(this.cos_p12*i-this.sin_p12*s*Math.cos(r)),n):(a=Lf(this.es),o=Of(this.es),h=Pf(this.es),l=Ff(this.es),Math.abs(this.sin_p12-1)<=de?(u=this.a*Ss(a,o,h,l,ee),f=this.a*Ss(a,o,h,l,e),n.x=this.x0+(u-f)*Math.sin(r),n.y=this.y0-(u-f)*Math.cos(r),n):Math.abs(this.sin_p12+1)<=de?(u=this.a*Ss(a,o,h,l,ee),f=this.a*Ss(a,o,h,l,e),n.x=this.x0+(u+f)*Math.sin(r),n.y=this.y0+(u+f)*Math.cos(r),n):(m=i/s,g=ou(this.a,this.e,this.sin_p12),y=ou(this.a,this.e,i),_=Math.atan((1-this.es)*m+this.es*g*this.sin_p12/(y*s)),w=Math.atan2(Math.sin(r),this.cos_p12*Math.tan(_)-this.sin_p12*Math.cos(r)),w===0?Y=Math.asin(this.cos_p12*Math.sin(_)-this.sin_p12*Math.cos(_)):Math.abs(Math.abs(w)-Math.PI)<=de?Y=-Math.asin(this.cos_p12*Math.sin(_)-this.sin_p12*Math.cos(_)):Y=Math.asin(Math.sin(r)*Math.cos(_)/Math.sin(w)),M=this.e*this.sin_p12/Math.sqrt(1-this.es),T=this.e*this.cos_p12*Math.cos(w)/Math.sqrt(1-this.es),A=M*T,R=T*T,K=Y*Y,rt=K*Y,ut=rt*Y,Z=ut*Y,I=g*Y*(1-K*R*(1-R)/6+rt/8*A*(1-2*R)+ut/120*(R*(4-7*R)-3*M*M*(1-7*R))-Z/48*A),n.x=this.x0+I*Math.sin(w),n.y=this.y0+I*Math.cos(w),n))}function b$(n){n.x-=this.x0,n.y-=this.y0;var t,e,i,s,r,a,o,h,l,u,f,m,g,y,_,w,M,T,A,R,I,L,k,Y;return this.sphere?(t=Math.sqrt(n.x*n.x+n.y*n.y),t>2*ee*this.a?void 0:(e=t/this.a,i=Math.sin(e),s=Math.cos(e),r=this.long0,Math.abs(t)<=de?a=this.lat0:(a=_h(s*this.sin_p12+n.y*i*this.cos_p12/t),o=Math.abs(this.lat0)-ee,Math.abs(o)<=de?this.lat0>=0?r=pe(this.long0+Math.atan2(n.x,-n.y)):r=pe(this.long0-Math.atan2(-n.x,n.y)):r=pe(this.long0+Math.atan2(n.x*i,t*this.cos_p12*s-n.y*this.sin_p12*i))),n.x=r,n.y=a,n)):(h=Lf(this.es),l=Of(this.es),u=Pf(this.es),f=Ff(this.es),Math.abs(this.sin_p12-1)<=de?(m=this.a*Ss(h,l,u,f,ee),t=Math.sqrt(n.x*n.x+n.y*n.y),g=m-t,a=dm(g/this.a,h,l,u,f),r=pe(this.long0+Math.atan2(n.x,-1*n.y)),n.x=r,n.y=a,n):Math.abs(this.sin_p12+1)<=de?(m=this.a*Ss(h,l,u,f,ee),t=Math.sqrt(n.x*n.x+n.y*n.y),g=t-m,a=dm(g/this.a,h,l,u,f),r=pe(this.long0+Math.atan2(n.x,n.y)),n.x=r,n.y=a,n):(t=Math.sqrt(n.x*n.x+n.y*n.y),w=Math.atan2(n.x,n.y),y=ou(this.a,this.e,this.sin_p12),M=Math.cos(w),T=this.e*this.cos_p12*M,A=-T*T/(1-this.es),R=3*this.es*(1-A)*this.sin_p12*this.cos_p12*M/(1-this.es),I=t/y,L=I-A*(1+A)*Math.pow(I,3)/6-R*(1+3*A)*Math.pow(I,4)/24,k=1-A*L*L/2-I*L*L*L/6,_=Math.asin(this.sin_p12*Math.cos(L)+this.cos_p12*Math.sin(L)*M),r=pe(this.long0+Math.asin(Math.sin(w)*Math.sin(L)/Math.cos(_))),Y=Math.sin(_),a=Math.atan2((Y-this.es*k*this.sin_p12)*Math.tan(_),Y*(1-this.es)),n.x=r,n.y=a,n))}var M$=["Azimuthal_Equidistant","aeqd"];const E$={init:v$,forward:w$,inverse:b$,names:M$};function S$(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function T$(n){var t,e,i,s,r,a,o,h,l=n.x,u=n.y;return i=pe(l-this.long0),t=Math.sin(u),e=Math.cos(u),s=Math.cos(i),a=this.sin_p14*t+this.cos_p14*e*s,r=1,(a>0||Math.abs(a)<=de)&&(o=this.a*r*e*Math.sin(i),h=this.y0+this.a*r*(this.cos_p14*t-this.sin_p14*e*s)),n.x=o,n.y=h,n}function C$(n){var t,e,i,s,r,a,o;return n.x-=this.x0,n.y-=this.y0,t=Math.sqrt(n.x*n.x+n.y*n.y),e=_h(t/this.a),i=Math.sin(e),s=Math.cos(e),a=this.long0,Math.abs(t)<=de?(o=this.lat0,n.x=a,n.y=o,n):(o=_h(s*this.sin_p14+n.y*i*this.cos_p14/t),r=Math.abs(this.lat0)-ee,Math.abs(r)<=de?(this.lat0>=0?a=pe(this.long0+Math.atan2(n.x,-n.y)):a=pe(this.long0-Math.atan2(-n.x,n.y)),n.x=a,n.y=o,n):(a=pe(this.long0+Math.atan2(n.x*i,t*this.cos_p14*s-n.y*this.sin_p14*i)),n.x=a,n.y=o,n))}var A$=["ortho"];const R$={init:S$,forward:T$,inverse:C$,names:A$};var Ki={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},Ci={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function I$(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=ee-Ti/2?this.face=Ki.TOP:this.lat0<=-(ee-Ti/2)?this.face=Ki.BOTTOM:Math.abs(this.long0)<=Ti?this.face=Ki.FRONT:Math.abs(this.long0)<=ee+Ti?this.face=this.long0>0?Ki.RIGHT:Ki.LEFT:this.face=Ki.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function N$(n){var t={x:0,y:0},e,i,s,r,a,o,h={value:0};if(n.x-=this.long0,this.es!==0?e=Math.atan(this.one_minus_f_squared*Math.tan(n.y)):e=n.y,i=n.x,this.face===Ki.TOP)r=ee-e,i>=Ti&&i<=ee+Ti?(h.value=Ci.AREA_0,s=i-ee):i>ee+Ti||i<=-(ee+Ti)?(h.value=Ci.AREA_1,s=i>0?i-on:i+on):i>-(ee+Ti)&&i<=-Ti?(h.value=Ci.AREA_2,s=i+ee):(h.value=Ci.AREA_3,s=i);else if(this.face===Ki.BOTTOM)r=ee+e,i>=Ti&&i<=ee+Ti?(h.value=Ci.AREA_0,s=-i+ee):i<Ti&&i>=-Ti?(h.value=Ci.AREA_1,s=-i):i<-Ti&&i>=-(ee+Ti)?(h.value=Ci.AREA_2,s=-i-ee):(h.value=Ci.AREA_3,s=i>0?-i+on:-i-on);else{var l,u,f,m,g,y,_;this.face===Ki.RIGHT?i=Dc(i,+ee):this.face===Ki.BACK?i=Dc(i,+on):this.face===Ki.LEFT&&(i=Dc(i,-ee)),m=Math.sin(e),g=Math.cos(e),y=Math.sin(i),_=Math.cos(i),l=g*_,u=g*y,f=m,this.face===Ki.FRONT?(r=Math.acos(l),s=Y0(r,f,u,h)):this.face===Ki.RIGHT?(r=Math.acos(u),s=Y0(r,f,-l,h)):this.face===Ki.BACK?(r=Math.acos(-l),s=Y0(r,f,-u,h)):this.face===Ki.LEFT?(r=Math.acos(-u),s=Y0(r,f,l,h)):(r=s=0,h.value=Ci.AREA_0)}return o=Math.atan(12/on*(s+Math.acos(Math.sin(s)*Math.cos(Ti))-ee)),a=Math.sqrt((1-Math.cos(r))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(s))))),h.value===Ci.AREA_1?o+=ee:h.value===Ci.AREA_2?o+=on:h.value===Ci.AREA_3&&(o+=1.5*on),t.x=a*Math.cos(o),t.y=a*Math.sin(o),t.x=t.x*this.a+this.x0,t.y=t.y*this.a+this.y0,n.x=t.x,n.y=t.y,n}function k$(n){var t={lam:0,phi:0},e,i,s,r,a,o,h,l,u,f={value:0};if(n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,i=Math.atan(Math.sqrt(n.x*n.x+n.y*n.y)),e=Math.atan2(n.y,n.x),n.x>=0&&n.x>=Math.abs(n.y)?f.value=Ci.AREA_0:n.y>=0&&n.y>=Math.abs(n.x)?(f.value=Ci.AREA_1,e-=ee):n.x<0&&-n.x>=Math.abs(n.y)?(f.value=Ci.AREA_2,e=e<0?e+on:e-on):(f.value=Ci.AREA_3,e+=ee),u=on/12*Math.tan(e),a=Math.sin(u)/(Math.cos(u)-1/Math.sqrt(2)),o=Math.atan(a),s=Math.cos(e),r=Math.tan(i),h=1-s*s*r*r*(1-Math.cos(Math.atan(1/Math.cos(o)))),h<-1?h=-1:h>1&&(h=1),this.face===Ki.TOP)l=Math.acos(h),t.phi=ee-l,f.value===Ci.AREA_0?t.lam=o+ee:f.value===Ci.AREA_1?t.lam=o<0?o+on:o-on:f.value===Ci.AREA_2?t.lam=o-ee:t.lam=o;else if(this.face===Ki.BOTTOM)l=Math.acos(h),t.phi=l-ee,f.value===Ci.AREA_0?t.lam=-o+ee:f.value===Ci.AREA_1?t.lam=-o:f.value===Ci.AREA_2?t.lam=-o-ee:t.lam=o<0?-o-on:-o+on;else{var m,g,y;m=h,u=m*m,u>=1?y=0:y=Math.sqrt(1-u)*Math.sin(o),u+=y*y,u>=1?g=0:g=Math.sqrt(1-u),f.value===Ci.AREA_1?(u=g,g=-y,y=u):f.value===Ci.AREA_2?(g=-g,y=-y):f.value===Ci.AREA_3&&(u=g,g=y,y=-u),this.face===Ki.RIGHT?(u=m,m=-g,g=u):this.face===Ki.BACK?(m=-m,g=-g):this.face===Ki.LEFT&&(u=m,m=g,g=-u),t.phi=Math.acos(-y)-ee,t.lam=Math.atan2(g,m),this.face===Ki.RIGHT?t.lam=Dc(t.lam,-ee):this.face===Ki.BACK?t.lam=Dc(t.lam,-on):this.face===Ki.LEFT&&(t.lam=Dc(t.lam,+ee))}if(this.es!==0){var _,w,M;_=t.phi<0?1:0,w=Math.tan(t.phi),M=this.b/Math.sqrt(w*w+this.one_minus_f_squared),t.phi=Math.atan(Math.sqrt(this.a*this.a-M*M)/(this.one_minus_f*M)),_&&(t.phi=-t.phi)}return t.lam+=this.long0,n.x=t.lam,n.y=t.phi,n}function Y0(n,t,e,i){var s;return n<de?(i.value=Ci.AREA_0,s=0):(s=Math.atan2(t,e),Math.abs(s)<=Ti?i.value=Ci.AREA_0:s>Ti&&s<=ee+Ti?(i.value=Ci.AREA_1,s-=ee):s>ee+Ti||s<=-(ee+Ti)?(i.value=Ci.AREA_2,s=s>=0?s-on:s+on):(i.value=Ci.AREA_3,s+=ee)),s}function Dc(n,t){var e=n+t;return e<-on?e+=nf:e>+on&&(e-=nf),e}var L$=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const O$={init:I$,forward:N$,inverse:k$,names:L$};var x_=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],wd=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],wA=.8487,bA=1.3523,MA=Aa/5,P$=1/MA,Ec=18,fm=function(n,t){return n[0]+t*(n[1]+t*(n[2]+t*n[3]))},F$=function(n,t){return n[1]+t*(2*n[2]+t*3*n[3])};function D$(n,t,e,i){for(var s=t;i;--i){var r=n(s);if(s-=r,Math.abs(r)<e)break}return s}function z$(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function B$(n){var t=pe(n.x-this.long0),e=Math.abs(n.y),i=Math.floor(e*MA);i<0?i=0:i>=Ec&&(i=Ec-1),e=Aa*(e-P$*i);var s={x:fm(x_[i],e)*t,y:fm(wd[i],e)};return n.y<0&&(s.y=-s.y),s.x=s.x*this.a*wA+this.x0,s.y=s.y*this.a*bA+this.y0,s}function U$(n){var t={x:(n.x-this.x0)/(this.a*wA),y:Math.abs(n.y-this.y0)/(this.a*bA)};if(t.y>=1)t.x/=x_[Ec][0],t.y=n.y<0?-ee:ee;else{var e=Math.floor(t.y*Ec);for(e<0?e=0:e>=Ec&&(e=Ec-1);;)if(wd[e][0]>t.y)--e;else if(wd[e+1][0]<=t.y)++e;else break;var i=wd[e],s=5*(t.y-i[0])/(wd[e+1][0]-i[0]);s=D$(function(r){return(fm(i,r)-t.y)/F$(i,r)},s,de,100),t.x/=fm(x_[e],s),t.y=(5*e+s)*Vn,n.y<0&&(t.y=-t.y)}return t.x=pe(t.x+this.long0),t}var G$=["Robinson","robin"];const V$={init:z$,forward:B$,inverse:U$,names:G$};function W$(){this.name="geocent"}function $$(n){var t=hA(n,this.es,this.a);return t}function Y$(n){var t=lA(n,this.es,this.a,this.b);return t}var H$=["Geocentric","geocentric","geocent","Geocent"];const q$={init:W$,forward:$$,inverse:Y$,names:H$};var os={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},td={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function X$(){if(Object.keys(td).forEach(function(e){if(typeof this[e]>"u")this[e]=td[e].def;else{if(td[e].num&&isNaN(this[e]))throw new Error("Invalid parameter value, must be numeric "+e+" = "+this[e]);td[e].num&&(this[e]=parseFloat(this[e]))}td[e].degrees&&(this[e]=this[e]*Vn)}.bind(this)),Math.abs(Math.abs(this.lat0)-ee)<de?this.mode=this.lat0<0?os.S_POLE:os.N_POLE:Math.abs(this.lat0)<de?this.mode=os.EQUIT:(this.mode=os.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var n=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(n),this.sw=Math.sin(n)}function j$(n){n.x-=this.long0;var t=Math.sin(n.y),e=Math.cos(n.y),i=Math.cos(n.x),s,r;switch(this.mode){case os.OBLIQ:r=this.sinph0*t+this.cosph0*e*i;break;case os.EQUIT:r=e*i;break;case os.S_POLE:r=-t;break;case os.N_POLE:r=t;break}switch(r=this.pn1/(this.p-r),s=r*e*Math.sin(n.x),this.mode){case os.OBLIQ:r*=this.cosph0*t-this.sinph0*e*i;break;case os.EQUIT:r*=t;break;case os.N_POLE:r*=-(e*i);break;case os.S_POLE:r*=e*i;break}var a,o;return a=r*this.cg+s*this.sg,o=1/(a*this.sw*this.h1+this.cw),s=(s*this.cg-r*this.sg)*this.cw*o,r=a*o,n.x=s*this.a,n.y=r*this.a,n}function Z$(n){n.x/=this.a,n.y/=this.a;var t={x:n.x,y:n.y},e,i,s;s=1/(this.pn1-n.y*this.sw),e=this.pn1*n.x*s,i=this.pn1*n.y*this.cw*s,n.x=e*this.cg+i*this.sg,n.y=i*this.cg-e*this.sg;var r=gr(n.x,n.y);if(Math.abs(r)<de)t.x=0,t.y=n.y;else{var a,o;switch(o=1-r*r*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/r+r/this.pn1),a=Math.sqrt(1-o*o),this.mode){case os.OBLIQ:t.y=Math.asin(a*this.sinph0+n.y*o*this.cosph0/r),n.y=(a-this.sinph0*Math.sin(t.y))*r,n.x*=o*this.cosph0;break;case os.EQUIT:t.y=Math.asin(n.y*o/r),n.y=a*r,n.x*=o;break;case os.N_POLE:t.y=Math.asin(a),n.y=-n.y;break;case os.S_POLE:t.y=-Math.asin(a);break}t.x=Math.atan2(n.x,n.y)}return n.x=t.x+this.long0,n.y=t.y,n}var K$=["Tilted_Perspective","tpers"];const J$={init:X$,forward:j$,inverse:Z$,names:K$};function Q$(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var n=1-this.es,t=1/n;this.radius_p=Math.sqrt(n),this.radius_p2=n,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function tY(n){var t=n.x,e=n.y,i,s,r,a;if(t=t-this.long0,this.shape==="ellipse"){e=Math.atan(this.radius_p2*Math.tan(e));var o=this.radius_p/gr(this.radius_p*Math.cos(e),Math.sin(e));if(s=o*Math.cos(t)*Math.cos(e),r=o*Math.sin(t)*Math.cos(e),a=o*Math.sin(e),(this.radius_g-s)*s-r*r-a*a*this.radius_p_inv2<0)return n.x=Number.NaN,n.y=Number.NaN,n;i=this.radius_g-s,this.flip_axis?(n.x=this.radius_g_1*Math.atan(r/gr(a,i)),n.y=this.radius_g_1*Math.atan(a/i)):(n.x=this.radius_g_1*Math.atan(r/i),n.y=this.radius_g_1*Math.atan(a/gr(r,i)))}else this.shape==="sphere"&&(i=Math.cos(e),s=Math.cos(t)*i,r=Math.sin(t)*i,a=Math.sin(e),i=this.radius_g-s,this.flip_axis?(n.x=this.radius_g_1*Math.atan(r/gr(a,i)),n.y=this.radius_g_1*Math.atan(a/i)):(n.x=this.radius_g_1*Math.atan(r/i),n.y=this.radius_g_1*Math.atan(a/gr(r,i))));return n.x=n.x*this.a,n.y=n.y*this.a,n}function eY(n){var t=-1,e=0,i=0,s,r,a,o;if(n.x=n.x/this.a,n.y=n.y/this.a,this.shape==="ellipse"){this.flip_axis?(i=Math.tan(n.y/this.radius_g_1),e=Math.tan(n.x/this.radius_g_1)*gr(1,i)):(e=Math.tan(n.x/this.radius_g_1),i=Math.tan(n.y/this.radius_g_1)*gr(1,e));var h=i/this.radius_p;if(s=e*e+h*h+t*t,r=2*this.radius_g*t,a=r*r-4*s*this.C,a<0)return n.x=Number.NaN,n.y=Number.NaN,n;o=(-r-Math.sqrt(a))/(2*s),t=this.radius_g+o*t,e*=o,i*=o,n.x=Math.atan2(e,t),n.y=Math.atan(i*Math.cos(n.x)/t),n.y=Math.atan(this.radius_p_inv2*Math.tan(n.y))}else if(this.shape==="sphere"){if(this.flip_axis?(i=Math.tan(n.y/this.radius_g_1),e=Math.tan(n.x/this.radius_g_1)*Math.sqrt(1+i*i)):(e=Math.tan(n.x/this.radius_g_1),i=Math.tan(n.y/this.radius_g_1)*Math.sqrt(1+e*e)),s=e*e+i*i+t*t,r=2*this.radius_g*t,a=r*r-4*s*this.C,a<0)return n.x=Number.NaN,n.y=Number.NaN,n;o=(-r-Math.sqrt(a))/(2*s),t=this.radius_g+o*t,e*=o,i*=o,n.x=Math.atan2(e,t),n.y=Math.atan(i*Math.cos(n.x)/t)}return n.x=n.x+this.long0,n}var iY=["Geostationary Satellite View","Geostationary_Satellite","geos"];const nY={init:Q$,forward:tY,inverse:eY,names:iY};var Ad=1.340264,Rd=-.081106,Id=893e-6,Nd=.003796,pm=Math.sqrt(3)/2;function sY(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function rY(n){var t=pe(n.x-this.long0),e=n.y,i=Math.asin(pm*Math.sin(e)),s=i*i,r=s*s*s;return n.x=t*Math.cos(i)/(pm*(Ad+3*Rd*s+r*(7*Id+9*Nd*s))),n.y=i*(Ad+Rd*s+r*(Id+Nd*s)),n.x=this.a*n.x+this.x0,n.y=this.a*n.y+this.y0,n}function aY(n){n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a;var t=1e-9,e=12,i=n.y,s,r,a,o,h,l;for(l=0;l<e&&(s=i*i,r=s*s*s,a=i*(Ad+Rd*s+r*(Id+Nd*s))-n.y,o=Ad+3*Rd*s+r*(7*Id+9*Nd*s),i-=h=a/o,!(Math.abs(h)<t));++l);return s=i*i,r=s*s*s,n.x=pm*n.x*(Ad+3*Rd*s+r*(7*Id+9*Nd*s))/Math.cos(i),n.y=Math.asin(Math.sin(i)/pm),n.x=pe(n.x+this.long0),n}var oY=["eqearth","Equal Earth","Equal_Earth"];const hY={init:sY,forward:rY,inverse:aY,names:oY};function lY(n){n.Proj.projections.add(Mp),n.Proj.projections.add(Ep),n.Proj.projections.add(cV),n.Proj.projections.add(vV),n.Proj.projections.add(TV),n.Proj.projections.add(NV),n.Proj.projections.add(DV),n.Proj.projections.add(VV),n.Proj.projections.add(qV),n.Proj.projections.add(JV),n.Proj.projections.add(mW),n.Proj.projections.add(wW),n.Proj.projections.add(TW),n.Proj.projections.add(kW),n.Proj.projections.add(DW),n.Proj.projections.add(VW),n.Proj.projections.add(qW),n.Proj.projections.add(JW),n.Proj.projections.add(s$),n.Proj.projections.add(l$),n.Proj.projections.add(p$),n.Proj.projections.add(x$),n.Proj.projections.add(E$),n.Proj.projections.add(R$),n.Proj.projections.add(O$),n.Proj.projections.add(V$),n.Proj.projections.add(q$),n.Proj.projections.add(J$),n.Proj.projections.add(nY),n.Proj.projections.add(hY)}Hs.defaultDatum="WGS84";Hs.Proj=Na;Hs.WGS84=new Hs.Proj("WGS84");Hs.Point=au;Hs.toPoint=cA;Hs.defs=bs;Hs.nadgrid=dG;Hs.transform=um;Hs.mgrs=AG;Hs.version="__VERSION__";lY(Hs);let cY=null;function uY(n){cY=n;const t=Object.keys(n.defs),e=t.length;let i,s;for(i=0;i<e;++i){const r=t[i];if(!Ri(r)){const a=n.defs(r);let o=a.units;!o&&a.projName==="longlat"&&(o="degrees"),fT(new $d({code:r,axisOrientation:a.axis,metersPerUnit:a.to_meter,units:o}))}}for(i=0;i<e;++i){const r=t[i],a=Ri(r);for(s=0;s<e;++s){const o=t[s],h=Ri(o);if(!rT(r,o))if(n.defs[r]===n.defs[o])J1([a,h]);else{const l=n(r,o);s4(a,h,Pb(a,h,l.forward),Pb(h,a,l.inverse))}}}}function Sc(n,t){const e=_x(n);let i;if(!e)return i="";switch(t){case"meters":i=e.toFixed(6)+" m";break;case"kilometers":i=(e/1e3).toFixed(6)+" km";break;case"miles":i=(e/1609.34).toFixed(6)+" miles";break;case"feet":i=(e/.3048).toFixed(6)+" ft";break;default:i="Unit not supported"}return i}function H0(n,t){const e=n;let i;if(!e)return i="";switch(t){case"meters":i=e.toFixed(6)+" m";break;case"kilometers":i=(e/1e3).toFixed(6)+" km";break;case"miles":i=(e/1609.34).toFixed(6)+" miles";break;case"feet":i=(e/.3048).toFixed(6)+" ft";break;default:i="Unit not supported"}return i}function Tc(n,t){const e=xx(n);let i;if(!e)return i="";switch(t){case"meters":i=e.toFixed(6)+" m\xB2";break;case"kilometers":i=(e/1e6).toFixed(6)+" km\xB2";break;case"miles":i=(e/2589990).toFixed(6)+" mi\xB2";break;case"feet":i=(e*10.7639).toFixed(6)+" ft\xB2";break;case"acres":i=(e/4046.86).toFixed(6)+" acres";break;case"hectares":i=(e/1e4).toFixed(6)+" hectares";break;default:i="Unit not supported"}return i}function q0(n,t){const e=n;let i;if(!e)return i="";switch(t){case"meters":i=e.toFixed(6)+" m\xB2";break;case"kilometers":i=(e/1e6).toFixed(6)+" km\xB2";break;case"miles":i=(e/2589990).toFixed(6)+" mi\xB2";break;case"feet":i=(e*10.7639).toFixed(6)+" ft\xB2";break;case"acres":i=(e/4046.86).toFixed(6)+" acres";break;case"hectares":i=(e/1e4).toFixed(6)+" hectares";break;default:i="Unit not supported"}return i}function Wn(n,t,e){const a=(e?{meters:" m\xB2",kilometers:" km\xB2",feet:" ft\xB2",miles:" mi\xB2",acres:" acres",hectares:" hectares"}:{meters:" m",kilometers:" km",feet:" ft",miles:" mi",acres:" acres",hectares:" hectares"})[t];return a?parseFloat(n)+a:n}function dY(n){document.querySelectorAll("#measurements li").forEach((o,h)=>{o.classList.toggle("active",h===n)});const e=document.getElementById("edit-options");e.innerHTML="";const i=source.getFeatures()[n];if(!i)return;const s=Xy("text",i.get("label")||"Unnamed",o=>i.set("label",o)),r=Xy("color",i.getStyle().getStroke().getColor(),a);if(e.appendChild(jy("Label:",s)),e.appendChild(jy("Stroke Color:",r)),i.getGeometry().getType()==="Polygon"){const o=Xy("color",i.getStyle().getFill().getColor(),a);e.appendChild(jy("Fill:",o))}e.style.display="block";function a(){const o=new Style({stroke:new Stroke({color:r.value,width:2}),fill:i.getGeometry().getType()==="Polygon"?new Fill({color:fillColorInput.value}):void 0});i.setStyle(o)}}function Xy(n,t,e){const i=document.createElement("input");return i.type=n,i.value=t,i.addEventListener("input",()=>e(i.value)),i}function jy(n,t){const e=document.createElement("div");return e.appendChild(document.createTextNode(n)),e.appendChild(t),e}function X0(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var EA={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(n,t){(function(e){n.exports=e()})(function(){return function e(i,s,r){function a(l,u){if(!s[l]){if(!i[l]){var f=typeof X0=="function"&&X0;if(!u&&f)return f(l,!0);if(o)return o(l,!0);var m=new Error("Cannot find module '"+l+"'");throw m.code="MODULE_NOT_FOUND",m}var g=s[l]={exports:{}};i[l][0].call(g.exports,function(y){var _=i[l][1][y];return a(_||y)},g,g.exports,e,i,s,r)}return s[l].exports}for(var o=typeof X0=="function"&&X0,h=0;h<r.length;h++)a(r[h]);return a}({1:[function(e,i,s){var r=e("./utils"),a=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(h){for(var l,u,f,m,g,y,_,w=[],M=0,T=h.length,A=T,R=r.getTypeOf(h)!=="string";M<h.length;)A=T-M,f=R?(l=h[M++],u=M<T?h[M++]:0,M<T?h[M++]:0):(l=h.charCodeAt(M++),u=M<T?h.charCodeAt(M++):0,M<T?h.charCodeAt(M++):0),m=l>>2,g=(3&l)<<4|u>>4,y=1<A?(15&u)<<2|f>>6:64,_=2<A?63&f:64,w.push(o.charAt(m)+o.charAt(g)+o.charAt(y)+o.charAt(_));return w.join("")},s.decode=function(h){var l,u,f,m,g,y,_=0,w=0,M="data:";if(h.substr(0,M.length)===M)throw new Error("Invalid base64 input, it looks like a data url.");var T,A=3*(h=h.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(h.charAt(h.length-1)===o.charAt(64)&&A--,h.charAt(h.length-2)===o.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=a.uint8array?new Uint8Array(0|A):new Array(0|A);_<h.length;)l=o.indexOf(h.charAt(_++))<<2|(m=o.indexOf(h.charAt(_++)))>>4,u=(15&m)<<4|(g=o.indexOf(h.charAt(_++)))>>2,f=(3&g)<<6|(y=o.indexOf(h.charAt(_++))),T[w++]=l,g!==64&&(T[w++]=u),y!==64&&(T[w++]=f);return T}},{"./support":30,"./utils":32}],2:[function(e,i,s){var r=e("./external"),a=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),h=e("./stream/DataLengthProbe");function l(u,f,m,g,y){this.compressedSize=u,this.uncompressedSize=f,this.crc32=m,this.compression=g,this.compressedContent=y}l.prototype={getContentWorker:function(){var u=new a(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new h("data_length")),f=this;return u.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new a(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,f,m){return u.pipe(new o).pipe(new h("uncompressedSize")).pipe(f.compressWorker(m)).pipe(new h("compressedSize")).withStreamInfo("compression",f)},i.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,i,s){var r=e("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},s.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,i,s){var r=e("./utils"),a=function(){for(var o,h=[],l=0;l<256;l++){o=l;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;h[l]=o}return h}();i.exports=function(o,h){return o!==void 0&&o.length?r.getTypeOf(o)!=="string"?function(l,u,f,m){var g=a,y=m+f;l^=-1;for(var _=m;_<y;_++)l=l>>>8^g[255&(l^u[_])];return-1^l}(0|h,o,o.length,0):function(l,u,f,m){var g=a,y=m+f;l^=-1;for(var _=m;_<y;_++)l=l>>>8^g[255&(l^u.charCodeAt(_))];return-1^l}(0|h,o,o.length,0):0}},{"./utils":32}],5:[function(e,i,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(e,i,s){var r=null;r=typeof Promise<"u"?Promise:e("lie"),i.exports={Promise:r}},{lie:37}],7:[function(e,i,s){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=e("pako"),o=e("./utils"),h=e("./stream/GenericWorker"),l=r?"uint8array":"array";function u(f,m){h.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=m,this.meta={}}s.magic="\b\0",o.inherits(u,h),u.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(l,f.data),!1)},u.prototype.flush=function(){h.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(m){f.push({data:m,meta:f.meta})}},s.compressWorker=function(f){return new u("Deflate",f)},s.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,i,s){function r(g,y){var _,w="";for(_=0;_<y;_++)w+=String.fromCharCode(255&g),g>>>=8;return w}function a(g,y,_,w,M,T){var A,R,I=g.file,L=g.compression,k=T!==l.utf8encode,Y=o.transformTo("string",T(I.name)),K=o.transformTo("string",l.utf8encode(I.name)),rt=I.comment,ut=o.transformTo("string",T(rt)),Z=o.transformTo("string",l.utf8encode(rt)),ht=K.length!==I.name.length,O=Z.length!==rt.length,pt="",Gt="",Ft="",oe=I.dir,Dt=I.date,re={crc32:0,compressedSize:0,uncompressedSize:0};y&&!_||(re.crc32=g.crc32,re.compressedSize=g.compressedSize,re.uncompressedSize=g.uncompressedSize);var yt=0;y&&(yt|=8),k||!ht&&!O||(yt|=2048);var gt=0,ge=0;oe&&(gt|=16),M==="UNIX"?(ge=798,gt|=function(Kt,Je){var Qe=Kt;return Kt||(Qe=Je?16893:33204),(65535&Qe)<<16}(I.unixPermissions,oe)):(ge=20,gt|=function(Kt){return 63&(Kt||0)}(I.dosPermissions)),A=Dt.getUTCHours(),A<<=6,A|=Dt.getUTCMinutes(),A<<=5,A|=Dt.getUTCSeconds()/2,R=Dt.getUTCFullYear()-1980,R<<=4,R|=Dt.getUTCMonth()+1,R<<=5,R|=Dt.getUTCDate(),ht&&(Gt=r(1,1)+r(u(Y),4)+K,pt+="up"+r(Gt.length,2)+Gt),O&&(Ft=r(1,1)+r(u(ut),4)+Z,pt+="uc"+r(Ft.length,2)+Ft);var Et="";return Et+=`
\0`,Et+=r(yt,2),Et+=L.magic,Et+=r(A,2),Et+=r(R,2),Et+=r(re.crc32,4),Et+=r(re.compressedSize,4),Et+=r(re.uncompressedSize,4),Et+=r(Y.length,2),Et+=r(pt.length,2),{fileRecord:f.LOCAL_FILE_HEADER+Et+Y+pt,dirRecord:f.CENTRAL_FILE_HEADER+r(ge,2)+Et+r(ut.length,2)+"\0\0\0\0"+r(gt,4)+r(w,4)+Y+pt+ut}}var o=e("../utils"),h=e("../stream/GenericWorker"),l=e("../utf8"),u=e("../crc32"),f=e("../signature");function m(g,y,_,w){h.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=y,this.zipPlatform=_,this.encodeFileName=w,this.streamFiles=g,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(m,h),m.prototype.push=function(g){var y=g.meta.percent||0,_=this.entriesCount,w=this._sources.length;this.accumulate?this.contentBuffer.push(g):(this.bytesWritten+=g.data.length,h.prototype.push.call(this,{data:g.data,meta:{currentFile:this.currentFile,percent:_?(y+100*(_-w-1))/_:100}}))},m.prototype.openedSource=function(g){this.currentSourceOffset=this.bytesWritten,this.currentFile=g.file.name;var y=this.streamFiles&&!g.file.dir;if(y){var _=a(g,y,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:_.fileRecord,meta:{percent:0}})}else this.accumulate=!0},m.prototype.closedSource=function(g){this.accumulate=!1;var y=this.streamFiles&&!g.file.dir,_=a(g,y,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(_.dirRecord),y)this.push({data:function(w){return f.DATA_DESCRIPTOR+r(w.crc32,4)+r(w.compressedSize,4)+r(w.uncompressedSize,4)}(g),meta:{percent:100}});else for(this.push({data:_.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},m.prototype.flush=function(){for(var g=this.bytesWritten,y=0;y<this.dirRecords.length;y++)this.push({data:this.dirRecords[y],meta:{percent:100}});var _=this.bytesWritten-g,w=function(M,T,A,R,I){var L=o.transformTo("string",I(R));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(M,2)+r(M,2)+r(T,4)+r(A,4)+r(L.length,2)+L}(this.dirRecords.length,_,g,this.zipComment,this.encodeFileName);this.push({data:w,meta:{percent:100}})},m.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},m.prototype.registerPrevious=function(g){this._sources.push(g);var y=this;return g.on("data",function(_){y.processChunk(_)}),g.on("end",function(){y.closedSource(y.previous.streamInfo),y._sources.length?y.prepareNextSource():y.end()}),g.on("error",function(_){y.error(_)}),this},m.prototype.resume=function(){return!!h.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},m.prototype.error=function(g){var y=this._sources;if(!h.prototype.error.call(this,g))return!1;for(var _=0;_<y.length;_++)try{y[_].error(g)}catch{}return!0},m.prototype.lock=function(){h.prototype.lock.call(this);for(var g=this._sources,y=0;y<g.length;y++)g[y].lock()},i.exports=m},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,i,s){var r=e("../compressions"),a=e("./ZipFileWorker");s.generateWorker=function(o,h,l){var u=new a(h.streamFiles,l,h.platform,h.encodeFileName),f=0;try{o.forEach(function(m,g){f++;var y=function(T,A){var R=T||A,I=r[R];if(!I)throw new Error(R+" is not a valid compression method !");return I}(g.options.compression,h.compression),_=g.options.compressionOptions||h.compressionOptions||{},w=g.dir,M=g.date;g._compressWorker(y,_).withStreamInfo("file",{name:m,dir:w,date:M,comment:g.comment||"",unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions}).pipe(u)}),u.entriesCount=f}catch(m){u.error(m)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,i,s){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new r;for(var o in this)typeof this[o]!="function"&&(a[o]=this[o]);return a}}(r.prototype=e("./object")).loadAsync=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.version="3.10.1",r.loadAsync=function(a,o){return new r().loadAsync(a,o)},r.external=e("./external"),i.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,i,s){var r=e("./utils"),a=e("./external"),o=e("./utf8"),h=e("./zipEntries"),l=e("./stream/Crc32Probe"),u=e("./nodejsUtils");function f(m){return new a.Promise(function(g,y){var _=m.decompressed.getContentWorker().pipe(new l);_.on("error",function(w){y(w)}).on("end",function(){_.streamInfo.crc32!==m.decompressed.crc32?y(new Error("Corrupted zip : CRC32 mismatch")):g()}).resume()})}i.exports=function(m,g){var y=this;return g=r.extend(g||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),u.isNode&&u.isStream(m)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",m,!0,g.optimizedBinaryString,g.base64).then(function(_){var w=new h(g);return w.load(_),w}).then(function(_){var w=[a.Promise.resolve(_)],M=_.files;if(g.checkCRC32)for(var T=0;T<M.length;T++)w.push(f(M[T]));return a.Promise.all(w)}).then(function(_){for(var w=_.shift(),M=w.files,T=0;T<M.length;T++){var A=M[T],R=A.fileNameStr,I=r.resolve(A.fileNameStr);y.file(I,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:g.createFolders}),A.dir||(y.file(I).unsafeOriginalName=R)}return w.zipComment.length&&(y.comment=w.zipComment),y})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,i,s){var r=e("../utils"),a=e("../stream/GenericWorker");function o(h,l){a.call(this,"Nodejs stream input adapter for "+h),this._upstreamEnded=!1,this._bindStream(l)}r.inherits(o,a),o.prototype._bindStream=function(h){var l=this;(this._stream=h).pause(),h.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},o.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,i,s){var r=e("readable-stream").Readable;function a(o,h,l){r.call(this,h),this._helper=o;var u=this;o.on("data",function(f,m){u.push(f)||u._helper.pause(),l&&l(m)}).on("error",function(f){u.emit("error",f)}).on("end",function(){u.push(null)})}e("../utils").inherits(a,r),a.prototype._read=function(){this._helper.resume()},i.exports=a},{"../utils":32,"readable-stream":16}],14:[function(e,i,s){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,a);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,a)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var a=new Buffer(r);return a.fill(0),a},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(e,i,s){function r(I,L,k){var Y,K=o.getTypeOf(L),rt=o.extend(k||{},u);rt.date=rt.date||new Date,rt.compression!==null&&(rt.compression=rt.compression.toUpperCase()),typeof rt.unixPermissions=="string"&&(rt.unixPermissions=parseInt(rt.unixPermissions,8)),rt.unixPermissions&&16384&rt.unixPermissions&&(rt.dir=!0),rt.dosPermissions&&16&rt.dosPermissions&&(rt.dir=!0),rt.dir&&(I=M(I)),rt.createFolders&&(Y=w(I))&&T.call(this,Y,!0);var ut=K==="string"&&rt.binary===!1&&rt.base64===!1;k&&k.binary!==void 0||(rt.binary=!ut),(L instanceof f&&L.uncompressedSize===0||rt.dir||!L||L.length===0)&&(rt.base64=!1,rt.binary=!0,L="",rt.compression="STORE",K="string");var Z=null;Z=L instanceof f||L instanceof h?L:y.isNode&&y.isStream(L)?new _(I,L):o.prepareContent(I,L,rt.binary,rt.optimizedBinaryString,rt.base64);var ht=new m(I,Z,rt);this.files[I]=ht}var a=e("./utf8"),o=e("./utils"),h=e("./stream/GenericWorker"),l=e("./stream/StreamHelper"),u=e("./defaults"),f=e("./compressedObject"),m=e("./zipObject"),g=e("./generate"),y=e("./nodejsUtils"),_=e("./nodejs/NodejsStreamInputAdapter"),w=function(I){I.slice(-1)==="/"&&(I=I.substring(0,I.length-1));var L=I.lastIndexOf("/");return 0<L?I.substring(0,L):""},M=function(I){return I.slice(-1)!=="/"&&(I+="/"),I},T=function(I,L){return L=L!==void 0?L:u.createFolders,I=M(I),this.files[I]||r.call(this,I,null,{dir:!0,createFolders:L}),this.files[I]};function A(I){return Object.prototype.toString.call(I)==="[object RegExp]"}var R={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(I){var L,k,Y;for(L in this.files)Y=this.files[L],(k=L.slice(this.root.length,L.length))&&L.slice(0,this.root.length)===this.root&&I(k,Y)},filter:function(I){var L=[];return this.forEach(function(k,Y){I(k,Y)&&L.push(Y)}),L},file:function(I,L,k){if(arguments.length!==1)return I=this.root+I,r.call(this,I,L,k),this;if(A(I)){var Y=I;return this.filter(function(rt,ut){return!ut.dir&&Y.test(rt)})}var K=this.files[this.root+I];return K&&!K.dir?K:null},folder:function(I){if(!I)return this;if(A(I))return this.filter(function(K,rt){return rt.dir&&I.test(K)});var L=this.root+I,k=T.call(this,L),Y=this.clone();return Y.root=k.name,Y},remove:function(I){I=this.root+I;var L=this.files[I];if(L||(I.slice(-1)!=="/"&&(I+="/"),L=this.files[I]),L&&!L.dir)delete this.files[I];else for(var k=this.filter(function(K,rt){return rt.name.slice(0,I.length)===I}),Y=0;Y<k.length;Y++)delete this.files[k[Y].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(I){var L,k={};try{if((k=o.extend(I||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=k.type.toLowerCase(),k.compression=k.compression.toUpperCase(),k.type==="binarystring"&&(k.type="string"),!k.type)throw new Error("No output type specified.");o.checkSupport(k.type),k.platform!=="darwin"&&k.platform!=="freebsd"&&k.platform!=="linux"&&k.platform!=="sunos"||(k.platform="UNIX"),k.platform==="win32"&&(k.platform="DOS");var Y=k.comment||this.comment||"";L=g.generateWorker(this,k,Y)}catch(K){(L=new h("error")).error(K)}return new l(L,k.type||"string",k.mimeType)},generateAsync:function(I,L){return this.generateInternalStream(I).accumulate(L)},generateNodeStream:function(I,L){return(I=I||{}).type||(I.type="nodebuffer"),this.generateInternalStream(I).toNodejsStream(L)}};i.exports=R},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,i,s){i.exports=e("stream")},{stream:void 0}],17:[function(e,i,s){var r=e("./DataReader");function a(o){r.call(this,o);for(var h=0;h<this.data.length;h++)o[h]=255&o[h]}e("../utils").inherits(a,r),a.prototype.byteAt=function(o){return this.data[this.zero+o]},a.prototype.lastIndexOfSignature=function(o){for(var h=o.charCodeAt(0),l=o.charCodeAt(1),u=o.charCodeAt(2),f=o.charCodeAt(3),m=this.length-4;0<=m;--m)if(this.data[m]===h&&this.data[m+1]===l&&this.data[m+2]===u&&this.data[m+3]===f)return m-this.zero;return-1},a.prototype.readAndCheckSignature=function(o){var h=o.charCodeAt(0),l=o.charCodeAt(1),u=o.charCodeAt(2),f=o.charCodeAt(3),m=this.readData(4);return h===m[0]&&l===m[1]&&u===m[2]&&f===m[3]},a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var h=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,h},i.exports=a},{"../utils":32,"./DataReader":18}],18:[function(e,i,s){var r=e("../utils");function a(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var h,l=0;for(this.checkOffset(o),h=this.index+o-1;h>=this.index;h--)l=(l<<8)+this.byteAt(h);return this.index+=o,l},readString:function(o){return r.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},i.exports=a},{"../utils":32}],19:[function(e,i,s){var r=e("./Uint8ArrayReader");function a(o){r.call(this,o)}e("../utils").inherits(a,r),a.prototype.readData=function(o){this.checkOffset(o);var h=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,h},i.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,i,s){var r=e("./DataReader");function a(o){r.call(this,o)}e("../utils").inherits(a,r),a.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},a.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},a.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},a.prototype.readData=function(o){this.checkOffset(o);var h=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,h},i.exports=a},{"../utils":32,"./DataReader":18}],21:[function(e,i,s){var r=e("./ArrayReader");function a(o){r.call(this,o)}e("../utils").inherits(a,r),a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var h=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,h},i.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(e,i,s){var r=e("../utils"),a=e("../support"),o=e("./ArrayReader"),h=e("./StringReader"),l=e("./NodeBufferReader"),u=e("./Uint8ArrayReader");i.exports=function(f){var m=r.getTypeOf(f);return r.checkSupport(m),m!=="string"||a.uint8array?m==="nodebuffer"?new l(f):a.uint8array?new u(r.transformTo("uint8array",f)):new o(r.transformTo("array",f)):new h(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,i,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,i,s){var r=e("./GenericWorker"),a=e("../utils");function o(h){r.call(this,"ConvertWorker to "+h),this.destType=h}a.inherits(o,r),o.prototype.processChunk=function(h){this.push({data:a.transformTo(this.destType,h.data),meta:h.meta})},i.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,i,s){var r=e("./GenericWorker"),a=e("../crc32");function o(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,r),o.prototype.processChunk=function(h){this.streamInfo.crc32=a(h.data,this.streamInfo.crc32||0),this.push(h)},i.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,i,s){var r=e("../utils"),a=e("./GenericWorker");function o(h){a.call(this,"DataLengthProbe for "+h),this.propName=h,this.withStreamInfo(h,0)}r.inherits(o,a),o.prototype.processChunk=function(h){if(h){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+h.data.length}a.prototype.processChunk.call(this,h)},i.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,i,s){var r=e("../utils"),a=e("./GenericWorker");function o(h){a.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,h.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=r.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}r.inherits(o,a),o.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var h=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":h=this.data.substring(this.index,l);break;case"uint8array":h=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":h=this.data.slice(this.index,l)}return this.index=l,this.push({data:h,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,i,s){function r(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,o){return this._listeners[a].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,o){if(this._listeners[a])for(var h=0;h<this._listeners[a].length;h++)this._listeners[a][h].call(this,o)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var o=this;return a.on("data",function(h){o.processChunk(h)}),a.on("end",function(){o.end()}),a.on("error",function(h){o.error(h)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,o){return this.extraStreamInfo[a]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},i.exports=r},{}],29:[function(e,i,s){var r=e("../utils"),a=e("./ConvertWorker"),o=e("./GenericWorker"),h=e("../base64"),l=e("../support"),u=e("../external"),f=null;if(l.nodestream)try{f=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function m(y,_){return new u.Promise(function(w,M){var T=[],A=y._internalType,R=y._outputType,I=y._mimeType;y.on("data",function(L,k){T.push(L),_&&_(k)}).on("error",function(L){T=[],M(L)}).on("end",function(){try{var L=function(k,Y,K){switch(k){case"blob":return r.newBlob(r.transformTo("arraybuffer",Y),K);case"base64":return h.encode(Y);default:return r.transformTo(k,Y)}}(R,function(k,Y){var K,rt=0,ut=null,Z=0;for(K=0;K<Y.length;K++)Z+=Y[K].length;switch(k){case"string":return Y.join("");case"array":return Array.prototype.concat.apply([],Y);case"uint8array":for(ut=new Uint8Array(Z),K=0;K<Y.length;K++)ut.set(Y[K],rt),rt+=Y[K].length;return ut;case"nodebuffer":return Buffer.concat(Y);default:throw new Error("concat : unsupported type '"+k+"'")}}(A,T),I);w(L)}catch(k){M(k)}T=[]}).resume()})}function g(y,_,w){var M=_;switch(_){case"blob":case"arraybuffer":M="uint8array";break;case"base64":M="string"}try{this._internalType=M,this._outputType=_,this._mimeType=w,r.checkSupport(M),this._worker=y.pipe(new a(M)),y.lock()}catch(T){this._worker=new o("error"),this._worker.error(T)}}g.prototype={accumulate:function(y){return m(this,y)},on:function(y,_){var w=this;return y==="data"?this._worker.on(y,function(M){_.call(w,M.data,M.meta)}):this._worker.on(y,function(){r.delay(_,arguments,w)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(y){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},y)}},i.exports=g},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,i,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",s.nodebuffer=typeof Buffer<"u",s.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")s.blob=!1;else{var r=new ArrayBuffer(0);try{s.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(r),s.blob=a.getBlob("application/zip").size===0}catch{s.blob=!1}}}try{s.nodestream=!!e("readable-stream").Readable}catch{s.nodestream=!1}},{"readable-stream":16}],31:[function(e,i,s){for(var r=e("./utils"),a=e("./support"),o=e("./nodejsUtils"),h=e("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function f(){h.call(this,"utf-8 decode"),this.leftOver=null}function m(){h.call(this,"utf-8 encode")}s.utf8encode=function(g){return a.nodebuffer?o.newBufferFrom(g,"utf-8"):function(y){var _,w,M,T,A,R=y.length,I=0;for(T=0;T<R;T++)(64512&(w=y.charCodeAt(T)))==55296&&T+1<R&&(64512&(M=y.charCodeAt(T+1)))==56320&&(w=65536+(w-55296<<10)+(M-56320),T++),I+=w<128?1:w<2048?2:w<65536?3:4;for(_=a.uint8array?new Uint8Array(I):new Array(I),T=A=0;A<I;T++)(64512&(w=y.charCodeAt(T)))==55296&&T+1<R&&(64512&(M=y.charCodeAt(T+1)))==56320&&(w=65536+(w-55296<<10)+(M-56320),T++),w<128?_[A++]=w:(w<2048?_[A++]=192|w>>>6:(w<65536?_[A++]=224|w>>>12:(_[A++]=240|w>>>18,_[A++]=128|w>>>12&63),_[A++]=128|w>>>6&63),_[A++]=128|63&w);return _}(g)},s.utf8decode=function(g){return a.nodebuffer?r.transformTo("nodebuffer",g).toString("utf-8"):function(y){var _,w,M,T,A=y.length,R=new Array(2*A);for(_=w=0;_<A;)if((M=y[_++])<128)R[w++]=M;else if(4<(T=l[M]))R[w++]=65533,_+=T-1;else{for(M&=T===2?31:T===3?15:7;1<T&&_<A;)M=M<<6|63&y[_++],T--;1<T?R[w++]=65533:M<65536?R[w++]=M:(M-=65536,R[w++]=55296|M>>10&1023,R[w++]=56320|1023&M)}return R.length!==w&&(R.subarray?R=R.subarray(0,w):R.length=w),r.applyFromCharCode(R)}(g=r.transformTo(a.uint8array?"uint8array":"array",g))},r.inherits(f,h),f.prototype.processChunk=function(g){var y=r.transformTo(a.uint8array?"uint8array":"array",g.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var _=y;(y=new Uint8Array(_.length+this.leftOver.length)).set(this.leftOver,0),y.set(_,this.leftOver.length)}else y=this.leftOver.concat(y);this.leftOver=null}var w=function(T,A){var R;for((A=A||T.length)>T.length&&(A=T.length),R=A-1;0<=R&&(192&T[R])==128;)R--;return R<0||R===0?A:R+l[T[R]]>A?R:A}(y),M=y;w!==y.length&&(a.uint8array?(M=y.subarray(0,w),this.leftOver=y.subarray(w,y.length)):(M=y.slice(0,w),this.leftOver=y.slice(w,y.length))),this.push({data:s.utf8decode(M),meta:g.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=f,r.inherits(m,h),m.prototype.processChunk=function(g){this.push({data:s.utf8encode(g.data),meta:g.meta})},s.Utf8EncodeWorker=m},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,i,s){var r=e("./support"),a=e("./base64"),o=e("./nodejsUtils"),h=e("./external");function l(_){return _}function u(_,w){for(var M=0;M<_.length;++M)w[M]=255&_.charCodeAt(M);return w}e("setimmediate"),s.newBlob=function(_,w){s.checkSupport("blob");try{return new Blob([_],{type:w})}catch{try{var M=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return M.append(_),M.getBlob(w)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(_,w,M){var T=[],A=0,R=_.length;if(R<=M)return String.fromCharCode.apply(null,_);for(;A<R;)w==="array"||w==="nodebuffer"?T.push(String.fromCharCode.apply(null,_.slice(A,Math.min(A+M,R)))):T.push(String.fromCharCode.apply(null,_.subarray(A,Math.min(A+M,R)))),A+=M;return T.join("")},stringifyByChar:function(_){for(var w="",M=0;M<_.length;M++)w+=String.fromCharCode(_[M]);return w},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function m(_){var w=65536,M=s.getTypeOf(_),T=!0;if(M==="uint8array"?T=f.applyCanBeUsed.uint8array:M==="nodebuffer"&&(T=f.applyCanBeUsed.nodebuffer),T)for(;1<w;)try{return f.stringifyByChunk(_,M,w)}catch{w=Math.floor(w/2)}return f.stringifyByChar(_)}function g(_,w){for(var M=0;M<_.length;M++)w[M]=_[M];return w}s.applyFromCharCode=m;var y={};y.string={string:l,array:function(_){return u(_,new Array(_.length))},arraybuffer:function(_){return y.string.uint8array(_).buffer},uint8array:function(_){return u(_,new Uint8Array(_.length))},nodebuffer:function(_){return u(_,o.allocBuffer(_.length))}},y.array={string:m,array:l,arraybuffer:function(_){return new Uint8Array(_).buffer},uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return o.newBufferFrom(_)}},y.arraybuffer={string:function(_){return m(new Uint8Array(_))},array:function(_){return g(new Uint8Array(_),new Array(_.byteLength))},arraybuffer:l,uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return o.newBufferFrom(new Uint8Array(_))}},y.uint8array={string:m,array:function(_){return g(_,new Array(_.length))},arraybuffer:function(_){return _.buffer},uint8array:l,nodebuffer:function(_){return o.newBufferFrom(_)}},y.nodebuffer={string:m,array:function(_){return g(_,new Array(_.length))},arraybuffer:function(_){return y.nodebuffer.uint8array(_).buffer},uint8array:function(_){return g(_,new Uint8Array(_.length))},nodebuffer:l},s.transformTo=function(_,w){if(w=w||"",!_)return w;s.checkSupport(_);var M=s.getTypeOf(w);return y[M][_](w)},s.resolve=function(_){for(var w=_.split("/"),M=[],T=0;T<w.length;T++){var A=w[T];A==="."||A===""&&T!==0&&T!==w.length-1||(A===".."?M.pop():M.push(A))}return M.join("/")},s.getTypeOf=function(_){return typeof _=="string"?"string":Object.prototype.toString.call(_)==="[object Array]"?"array":r.nodebuffer&&o.isBuffer(_)?"nodebuffer":r.uint8array&&_ instanceof Uint8Array?"uint8array":r.arraybuffer&&_ instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(_){if(!r[_.toLowerCase()])throw new Error(_+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(_){var w,M,T="";for(M=0;M<(_||"").length;M++)T+="\\x"+((w=_.charCodeAt(M))<16?"0":"")+w.toString(16).toUpperCase();return T},s.delay=function(_,w,M){setImmediate(function(){_.apply(M||null,w||[])})},s.inherits=function(_,w){function M(){}M.prototype=w.prototype,_.prototype=new M},s.extend=function(){var _,w,M={};for(_=0;_<arguments.length;_++)for(w in arguments[_])Object.prototype.hasOwnProperty.call(arguments[_],w)&&M[w]===void 0&&(M[w]=arguments[_][w]);return M},s.prepareContent=function(_,w,M,T,A){return h.Promise.resolve(w).then(function(R){return r.blob&&(R instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(R))!==-1)&&typeof FileReader<"u"?new h.Promise(function(I,L){var k=new FileReader;k.onload=function(Y){I(Y.target.result)},k.onerror=function(Y){L(Y.target.error)},k.readAsArrayBuffer(R)}):R}).then(function(R){var I=s.getTypeOf(R);return I?(I==="arraybuffer"?R=s.transformTo("uint8array",R):I==="string"&&(A?R=a.decode(R):M&&T!==!0&&(R=function(L){return u(L,r.uint8array?new Uint8Array(L.length):new Array(L.length))}(R))),R):h.Promise.reject(new Error("Can't read the data of '"+_+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,i,s){var r=e("./reader/readerFor"),a=e("./utils"),o=e("./signature"),h=e("./zipEntry"),l=e("./support");function u(f){this.files=[],this.loadOptions=f}u.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var m=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(m)+", expected "+a.pretty(f)+")")}},isSignature:function(f,m){var g=this.reader.index;this.reader.setIndex(f);var y=this.reader.readString(4)===m;return this.reader.setIndex(g),y},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),m=l.uint8array?"uint8array":"array",g=a.transformTo(m,f);this.zipComment=this.loadOptions.decodeFileName(g)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,m,g,y=this.zip64EndOfCentralSize-44;0<y;)f=this.reader.readInt(2),m=this.reader.readInt(4),g=this.reader.readData(m),this.zip64ExtensibleData[f]={id:f,length:m,value:g}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,m;for(f=0;f<this.files.length;f++)m=this.files[f],this.reader.setIndex(m.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),m.readLocalPart(this.reader),m.handleUTF8(),m.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(f=new h({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var m=f;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var g=this.centralDirOffset+this.centralDirSize;this.zip64&&(g+=20,g+=12+this.zip64EndOfCentralSize);var y=m-g;if(0<y)this.isSignature(m,o.CENTRAL_FILE_HEADER)||(this.reader.zero=y);else if(y<0)throw new Error("Corrupted zip: missing "+Math.abs(y)+" bytes.")},prepareReader:function(f){this.reader=r(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,i,s){var r=e("./reader/readerFor"),a=e("./utils"),o=e("./compressedObject"),h=e("./crc32"),l=e("./utf8"),u=e("./compressions"),f=e("./support");function m(g,y){this.options=g,this.loadOptions=y}m.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(g){var y,_;if(g.skip(22),this.fileNameLength=g.readInt(2),_=g.readInt(2),this.fileName=g.readData(this.fileNameLength),g.skip(_),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((y=function(w){for(var M in u)if(Object.prototype.hasOwnProperty.call(u,M)&&u[M].magic===w)return u[M];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,y,g.readData(this.compressedSize))},readCentralPart:function(g){this.versionMadeBy=g.readInt(2),g.skip(2),this.bitFlag=g.readInt(2),this.compressionMethod=g.readString(2),this.date=g.readDate(),this.crc32=g.readInt(4),this.compressedSize=g.readInt(4),this.uncompressedSize=g.readInt(4);var y=g.readInt(2);if(this.extraFieldsLength=g.readInt(2),this.fileCommentLength=g.readInt(2),this.diskNumberStart=g.readInt(2),this.internalFileAttributes=g.readInt(2),this.externalFileAttributes=g.readInt(4),this.localHeaderOffset=g.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");g.skip(y),this.readExtraFields(g),this.parseZIP64ExtraField(g),this.fileComment=g.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var g=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),g==0&&(this.dosPermissions=63&this.externalFileAttributes),g==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var g=r(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=g.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=g.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=g.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=g.readInt(4))}},readExtraFields:function(g){var y,_,w,M=g.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});g.index+4<M;)y=g.readInt(2),_=g.readInt(2),w=g.readData(_),this.extraFields[y]={id:y,length:_,value:w};g.setIndex(M)},handleUTF8:function(){var g=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var y=this.findExtraFieldUnicodePath();if(y!==null)this.fileNameStr=y;else{var _=a.transformTo(g,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(_)}var w=this.findExtraFieldUnicodeComment();if(w!==null)this.fileCommentStr=w;else{var M=a.transformTo(g,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(M)}}},findExtraFieldUnicodePath:function(){var g=this.extraFields[28789];if(g){var y=r(g.value);return y.readInt(1)!==1||h(this.fileName)!==y.readInt(4)?null:l.utf8decode(y.readData(g.length-5))}return null},findExtraFieldUnicodeComment:function(){var g=this.extraFields[25461];if(g){var y=r(g.value);return y.readInt(1)!==1||h(this.fileComment)!==y.readInt(4)?null:l.utf8decode(y.readData(g.length-5))}return null}},i.exports=m},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,i,s){function r(y,_,w){this.name=y,this.dir=w.dir,this.date=w.date,this.comment=w.comment,this.unixPermissions=w.unixPermissions,this.dosPermissions=w.dosPermissions,this._data=_,this._dataBinary=w.binary,this.options={compression:w.compression,compressionOptions:w.compressionOptions}}var a=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),h=e("./utf8"),l=e("./compressedObject"),u=e("./stream/GenericWorker");r.prototype={internalStream:function(y){var _=null,w="string";try{if(!y)throw new Error("No output type specified.");var M=(w=y.toLowerCase())==="string"||w==="text";w!=="binarystring"&&w!=="text"||(w="string"),_=this._decompressWorker();var T=!this._dataBinary;T&&!M&&(_=_.pipe(new h.Utf8EncodeWorker)),!T&&M&&(_=_.pipe(new h.Utf8DecodeWorker))}catch(A){(_=new u("error")).error(A)}return new a(_,w,"")},async:function(y,_){return this.internalStream(y).accumulate(_)},nodeStream:function(y,_){return this.internalStream(y||"nodebuffer").toNodejsStream(_)},_compressWorker:function(y,_){if(this._data instanceof l&&this._data.compression.magic===y.magic)return this._data.getCompressedWorker();var w=this._decompressWorker();return this._dataBinary||(w=w.pipe(new h.Utf8EncodeWorker)),l.createWorkerFrom(w,y,_)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new o(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],m=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},g=0;g<f.length;g++)r.prototype[f[g]]=m;i.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,i,s){(function(r){var a,o,h=r.MutationObserver||r.WebKitMutationObserver;if(h){var l=0,u=new h(y),f=r.document.createTextNode("");u.observe(f,{characterData:!0}),a=function(){f.data=l=++l%2}}else if(r.setImmediate||r.MessageChannel===void 0)a="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var _=r.document.createElement("script");_.onreadystatechange=function(){y(),_.onreadystatechange=null,_.parentNode.removeChild(_),_=null},r.document.documentElement.appendChild(_)}:function(){setTimeout(y,0)};else{var m=new r.MessageChannel;m.port1.onmessage=y,a=function(){m.port2.postMessage(0)}}var g=[];function y(){var _,w;o=!0;for(var M=g.length;M;){for(w=g,g=[],_=-1;++_<M;)w[_]();M=g.length}o=!1}i.exports=function(_){g.push(_)!==1||o||a()}}).call(this,typeof wa<"u"?wa:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,i,s){var r=e("immediate");function a(){}var o={},h=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function f(M){if(typeof M!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,M!==a&&_(this,M)}function m(M,T,A){this.promise=M,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function g(M,T,A){r(function(){var R;try{R=T(A)}catch(I){return o.reject(M,I)}R===M?o.reject(M,new TypeError("Cannot resolve promise with itself")):o.resolve(M,R)})}function y(M){var T=M&&M.then;if(M&&(typeof M=="object"||typeof M=="function")&&typeof T=="function")return function(){T.apply(M,arguments)}}function _(M,T){var A=!1;function R(k){A||(A=!0,o.reject(M,k))}function I(k){A||(A=!0,o.resolve(M,k))}var L=w(function(){T(I,R)});L.status==="error"&&R(L.value)}function w(M,T){var A={};try{A.value=M(T),A.status="success"}catch(R){A.status="error",A.value=R}return A}(i.exports=f).prototype.finally=function(M){if(typeof M!="function")return this;var T=this.constructor;return this.then(function(A){return T.resolve(M()).then(function(){return A})},function(A){return T.resolve(M()).then(function(){throw A})})},f.prototype.catch=function(M){return this.then(null,M)},f.prototype.then=function(M,T){if(typeof M!="function"&&this.state===l||typeof T!="function"&&this.state===h)return this;var A=new this.constructor(a);return this.state!==u?g(A,this.state===l?M:T,this.outcome):this.queue.push(new m(A,M,T)),A},m.prototype.callFulfilled=function(M){o.resolve(this.promise,M)},m.prototype.otherCallFulfilled=function(M){g(this.promise,this.onFulfilled,M)},m.prototype.callRejected=function(M){o.reject(this.promise,M)},m.prototype.otherCallRejected=function(M){g(this.promise,this.onRejected,M)},o.resolve=function(M,T){var A=w(y,T);if(A.status==="error")return o.reject(M,A.value);var R=A.value;if(R)_(M,R);else{M.state=l,M.outcome=T;for(var I=-1,L=M.queue.length;++I<L;)M.queue[I].callFulfilled(T)}return M},o.reject=function(M,T){M.state=h,M.outcome=T;for(var A=-1,R=M.queue.length;++A<R;)M.queue[A].callRejected(T);return M},f.resolve=function(M){return M instanceof this?M:o.resolve(new this(a),M)},f.reject=function(M){var T=new this(a);return o.reject(T,M)},f.all=function(M){var T=this;if(Object.prototype.toString.call(M)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=M.length,R=!1;if(!A)return this.resolve([]);for(var I=new Array(A),L=0,k=-1,Y=new this(a);++k<A;)K(M[k],k);return Y;function K(rt,ut){T.resolve(rt).then(function(Z){I[ut]=Z,++L!==A||R||(R=!0,o.resolve(Y,I))},function(Z){R||(R=!0,o.reject(Y,Z))})}},f.race=function(M){var T=this;if(Object.prototype.toString.call(M)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=M.length,R=!1;if(!A)return this.resolve([]);for(var I=-1,L=new this(a);++I<A;)k=M[I],T.resolve(k).then(function(Y){R||(R=!0,o.resolve(L,Y))},function(Y){R||(R=!0,o.reject(L,Y))});var k;return L}},{immediate:36}],38:[function(e,i,s){var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),i.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,i,s){var r=e("./zlib/deflate"),a=e("./utils/common"),o=e("./utils/strings"),h=e("./zlib/messages"),l=e("./zlib/zstream"),u=Object.prototype.toString,f=0,m=-1,g=0,y=8;function _(M){if(!(this instanceof _))return new _(M);this.options=a.assign({level:m,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:g,to:""},M||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var A=r.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(A!==f)throw new Error(h[A]);if(T.header&&r.deflateSetHeader(this.strm,T.header),T.dictionary){var R;if(R=typeof T.dictionary=="string"?o.string2buf(T.dictionary):u.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(A=r.deflateSetDictionary(this.strm,R))!==f)throw new Error(h[A]);this._dict_set=!0}}function w(M,T){var A=new _(T);if(A.push(M,!0),A.err)throw A.msg||h[A.err];return A.result}_.prototype.push=function(M,T){var A,R,I=this.strm,L=this.options.chunkSize;if(this.ended)return!1;R=T===~~T?T:T===!0?4:0,typeof M=="string"?I.input=o.string2buf(M):u.call(M)==="[object ArrayBuffer]"?I.input=new Uint8Array(M):I.input=M,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new a.Buf8(L),I.next_out=0,I.avail_out=L),(A=r.deflate(I,R))!==1&&A!==f)return this.onEnd(A),!(this.ended=!0);I.avail_out!==0&&(I.avail_in!==0||R!==4&&R!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(a.shrinkBuf(I.output,I.next_out))):this.onData(a.shrinkBuf(I.output,I.next_out)))}while((0<I.avail_in||I.avail_out===0)&&A!==1);return R===4?(A=r.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===f):R!==2||(this.onEnd(f),!(I.avail_out=0))},_.prototype.onData=function(M){this.chunks.push(M)},_.prototype.onEnd=function(M){M===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=M,this.msg=this.strm.msg},s.Deflate=_,s.deflate=w,s.deflateRaw=function(M,T){return(T=T||{}).raw=!0,w(M,T)},s.gzip=function(M,T){return(T=T||{}).gzip=!0,w(M,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,i,s){var r=e("./zlib/inflate"),a=e("./utils/common"),o=e("./utils/strings"),h=e("./zlib/constants"),l=e("./zlib/messages"),u=e("./zlib/zstream"),f=e("./zlib/gzheader"),m=Object.prototype.toString;function g(_){if(!(this instanceof g))return new g(_);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},_||{});var w=this.options;w.raw&&0<=w.windowBits&&w.windowBits<16&&(w.windowBits=-w.windowBits,w.windowBits===0&&(w.windowBits=-15)),!(0<=w.windowBits&&w.windowBits<16)||_&&_.windowBits||(w.windowBits+=32),15<w.windowBits&&w.windowBits<48&&(15&w.windowBits)==0&&(w.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var M=r.inflateInit2(this.strm,w.windowBits);if(M!==h.Z_OK)throw new Error(l[M]);this.header=new f,r.inflateGetHeader(this.strm,this.header)}function y(_,w){var M=new g(w);if(M.push(_,!0),M.err)throw M.msg||l[M.err];return M.result}g.prototype.push=function(_,w){var M,T,A,R,I,L,k=this.strm,Y=this.options.chunkSize,K=this.options.dictionary,rt=!1;if(this.ended)return!1;T=w===~~w?w:w===!0?h.Z_FINISH:h.Z_NO_FLUSH,typeof _=="string"?k.input=o.binstring2buf(_):m.call(_)==="[object ArrayBuffer]"?k.input=new Uint8Array(_):k.input=_,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new a.Buf8(Y),k.next_out=0,k.avail_out=Y),(M=r.inflate(k,h.Z_NO_FLUSH))===h.Z_NEED_DICT&&K&&(L=typeof K=="string"?o.string2buf(K):m.call(K)==="[object ArrayBuffer]"?new Uint8Array(K):K,M=r.inflateSetDictionary(this.strm,L)),M===h.Z_BUF_ERROR&&rt===!0&&(M=h.Z_OK,rt=!1),M!==h.Z_STREAM_END&&M!==h.Z_OK)return this.onEnd(M),!(this.ended=!0);k.next_out&&(k.avail_out!==0&&M!==h.Z_STREAM_END&&(k.avail_in!==0||T!==h.Z_FINISH&&T!==h.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=o.utf8border(k.output,k.next_out),R=k.next_out-A,I=o.buf2string(k.output,A),k.next_out=R,k.avail_out=Y-R,R&&a.arraySet(k.output,k.output,A,R,0),this.onData(I)):this.onData(a.shrinkBuf(k.output,k.next_out)))),k.avail_in===0&&k.avail_out===0&&(rt=!0)}while((0<k.avail_in||k.avail_out===0)&&M!==h.Z_STREAM_END);return M===h.Z_STREAM_END&&(T=h.Z_FINISH),T===h.Z_FINISH?(M=r.inflateEnd(this.strm),this.onEnd(M),this.ended=!0,M===h.Z_OK):T!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),!(k.avail_out=0))},g.prototype.onData=function(_){this.chunks.push(_)},g.prototype.onEnd=function(_){_===h.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},s.Inflate=g,s.inflate=y,s.inflateRaw=function(_,w){return(w=w||{}).raw=!0,y(_,w)},s.ungzip=y},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,i,s){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(h){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var f in u)u.hasOwnProperty(f)&&(h[f]=u[f])}}return h},s.shrinkBuf=function(h,l){return h.length===l?h:h.subarray?h.subarray(0,l):(h.length=l,h)};var a={arraySet:function(h,l,u,f,m){if(l.subarray&&h.subarray)h.set(l.subarray(u,u+f),m);else for(var g=0;g<f;g++)h[m+g]=l[u+g]},flattenChunks:function(h){var l,u,f,m,g,y;for(l=f=0,u=h.length;l<u;l++)f+=h[l].length;for(y=new Uint8Array(f),l=m=0,u=h.length;l<u;l++)g=h[l],y.set(g,m),m+=g.length;return y}},o={arraySet:function(h,l,u,f,m){for(var g=0;g<f;g++)h[m+g]=l[u+g]},flattenChunks:function(h){return[].concat.apply([],h)}};s.setTyped=function(h){h?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,a)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,o))},s.setTyped(r)},{}],42:[function(e,i,s){var r=e("./common"),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var h=new r.Buf8(256),l=0;l<256;l++)h[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(f,m){if(m<65537&&(f.subarray&&o||!f.subarray&&a))return String.fromCharCode.apply(null,r.shrinkBuf(f,m));for(var g="",y=0;y<m;y++)g+=String.fromCharCode(f[y]);return g}h[254]=h[254]=1,s.string2buf=function(f){var m,g,y,_,w,M=f.length,T=0;for(_=0;_<M;_++)(64512&(g=f.charCodeAt(_)))==55296&&_+1<M&&(64512&(y=f.charCodeAt(_+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),_++),T+=g<128?1:g<2048?2:g<65536?3:4;for(m=new r.Buf8(T),_=w=0;w<T;_++)(64512&(g=f.charCodeAt(_)))==55296&&_+1<M&&(64512&(y=f.charCodeAt(_+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),_++),g<128?m[w++]=g:(g<2048?m[w++]=192|g>>>6:(g<65536?m[w++]=224|g>>>12:(m[w++]=240|g>>>18,m[w++]=128|g>>>12&63),m[w++]=128|g>>>6&63),m[w++]=128|63&g);return m},s.buf2binstring=function(f){return u(f,f.length)},s.binstring2buf=function(f){for(var m=new r.Buf8(f.length),g=0,y=m.length;g<y;g++)m[g]=f.charCodeAt(g);return m},s.buf2string=function(f,m){var g,y,_,w,M=m||f.length,T=new Array(2*M);for(g=y=0;g<M;)if((_=f[g++])<128)T[y++]=_;else if(4<(w=h[_]))T[y++]=65533,g+=w-1;else{for(_&=w===2?31:w===3?15:7;1<w&&g<M;)_=_<<6|63&f[g++],w--;1<w?T[y++]=65533:_<65536?T[y++]=_:(_-=65536,T[y++]=55296|_>>10&1023,T[y++]=56320|1023&_)}return u(T,y)},s.utf8border=function(f,m){var g;for((m=m||f.length)>f.length&&(m=f.length),g=m-1;0<=g&&(192&f[g])==128;)g--;return g<0||g===0?m:g+h[f[g]]>m?g:m}},{"./common":41}],43:[function(e,i,s){i.exports=function(r,a,o,h){for(var l=65535&r|0,u=r>>>16&65535|0,f=0;o!==0;){for(o-=f=2e3<o?2e3:o;u=u+(l=l+a[h++]|0)|0,--f;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(e,i,s){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,i,s){var r=function(){for(var a,o=[],h=0;h<256;h++){a=h;for(var l=0;l<8;l++)a=1&a?3988292384^a>>>1:a>>>1;o[h]=a}return o}();i.exports=function(a,o,h,l){var u=r,f=l+h;a^=-1;for(var m=l;m<f;m++)a=a>>>8^u[255&(a^o[m])];return-1^a}},{}],46:[function(e,i,s){var r,a=e("../utils/common"),o=e("./trees"),h=e("./adler32"),l=e("./crc32"),u=e("./messages"),f=0,m=4,g=0,y=-2,_=-1,w=4,M=2,T=8,A=9,R=286,I=30,L=19,k=2*R+1,Y=15,K=3,rt=258,ut=rt+K+1,Z=42,ht=113,O=1,pt=2,Gt=3,Ft=4;function oe(P,Ut){return P.msg=u[Ut],Ut}function Dt(P){return(P<<1)-(4<P?9:0)}function re(P){for(var Ut=P.length;0<=--Ut;)P[Ut]=0}function yt(P){var Ut=P.state,Ct=Ut.pending;Ct>P.avail_out&&(Ct=P.avail_out),Ct!==0&&(a.arraySet(P.output,Ut.pending_buf,Ut.pending_out,Ct,P.next_out),P.next_out+=Ct,Ut.pending_out+=Ct,P.total_out+=Ct,P.avail_out-=Ct,Ut.pending-=Ct,Ut.pending===0&&(Ut.pending_out=0))}function gt(P,Ut){o._tr_flush_block(P,0<=P.block_start?P.block_start:-1,P.strstart-P.block_start,Ut),P.block_start=P.strstart,yt(P.strm)}function ge(P,Ut){P.pending_buf[P.pending++]=Ut}function Et(P,Ut){P.pending_buf[P.pending++]=Ut>>>8&255,P.pending_buf[P.pending++]=255&Ut}function Kt(P,Ut){var Ct,nt,tt=P.max_chain_length,mt=P.strstart,Ht=P.prev_length,Xt=P.nice_match,_t=P.strstart>P.w_size-ut?P.strstart-(P.w_size-ut):0,Qt=P.window,At=P.w_mask,jt=P.prev,ve=P.strstart+rt,pi=Qt[mt+Ht-1],Ye=Qt[mt+Ht];P.prev_length>=P.good_match&&(tt>>=2),Xt>P.lookahead&&(Xt=P.lookahead);do if(Qt[(Ct=Ut)+Ht]===Ye&&Qt[Ct+Ht-1]===pi&&Qt[Ct]===Qt[mt]&&Qt[++Ct]===Qt[mt+1]){mt+=2,Ct++;do;while(Qt[++mt]===Qt[++Ct]&&Qt[++mt]===Qt[++Ct]&&Qt[++mt]===Qt[++Ct]&&Qt[++mt]===Qt[++Ct]&&Qt[++mt]===Qt[++Ct]&&Qt[++mt]===Qt[++Ct]&&Qt[++mt]===Qt[++Ct]&&Qt[++mt]===Qt[++Ct]&&mt<ve);if(nt=rt-(ve-mt),mt=ve-rt,Ht<nt){if(P.match_start=Ut,Xt<=(Ht=nt))break;pi=Qt[mt+Ht-1],Ye=Qt[mt+Ht]}}while((Ut=jt[Ut&At])>_t&&--tt!=0);return Ht<=P.lookahead?Ht:P.lookahead}function Je(P){var Ut,Ct,nt,tt,mt,Ht,Xt,_t,Qt,At,jt=P.w_size;do{if(tt=P.window_size-P.lookahead-P.strstart,P.strstart>=jt+(jt-ut)){for(a.arraySet(P.window,P.window,jt,jt,0),P.match_start-=jt,P.strstart-=jt,P.block_start-=jt,Ut=Ct=P.hash_size;nt=P.head[--Ut],P.head[Ut]=jt<=nt?nt-jt:0,--Ct;);for(Ut=Ct=jt;nt=P.prev[--Ut],P.prev[Ut]=jt<=nt?nt-jt:0,--Ct;);tt+=jt}if(P.strm.avail_in===0)break;if(Ht=P.strm,Xt=P.window,_t=P.strstart+P.lookahead,Qt=tt,At=void 0,At=Ht.avail_in,Qt<At&&(At=Qt),Ct=At===0?0:(Ht.avail_in-=At,a.arraySet(Xt,Ht.input,Ht.next_in,At,_t),Ht.state.wrap===1?Ht.adler=h(Ht.adler,Xt,At,_t):Ht.state.wrap===2&&(Ht.adler=l(Ht.adler,Xt,At,_t)),Ht.next_in+=At,Ht.total_in+=At,At),P.lookahead+=Ct,P.lookahead+P.insert>=K)for(mt=P.strstart-P.insert,P.ins_h=P.window[mt],P.ins_h=(P.ins_h<<P.hash_shift^P.window[mt+1])&P.hash_mask;P.insert&&(P.ins_h=(P.ins_h<<P.hash_shift^P.window[mt+K-1])&P.hash_mask,P.prev[mt&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=mt,mt++,P.insert--,!(P.lookahead+P.insert<K)););}while(P.lookahead<ut&&P.strm.avail_in!==0)}function Qe(P,Ut){for(var Ct,nt;;){if(P.lookahead<ut){if(Je(P),P.lookahead<ut&&Ut===f)return O;if(P.lookahead===0)break}if(Ct=0,P.lookahead>=K&&(P.ins_h=(P.ins_h<<P.hash_shift^P.window[P.strstart+K-1])&P.hash_mask,Ct=P.prev[P.strstart&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=P.strstart),Ct!==0&&P.strstart-Ct<=P.w_size-ut&&(P.match_length=Kt(P,Ct)),P.match_length>=K)if(nt=o._tr_tally(P,P.strstart-P.match_start,P.match_length-K),P.lookahead-=P.match_length,P.match_length<=P.max_lazy_match&&P.lookahead>=K){for(P.match_length--;P.strstart++,P.ins_h=(P.ins_h<<P.hash_shift^P.window[P.strstart+K-1])&P.hash_mask,Ct=P.prev[P.strstart&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=P.strstart,--P.match_length!=0;);P.strstart++}else P.strstart+=P.match_length,P.match_length=0,P.ins_h=P.window[P.strstart],P.ins_h=(P.ins_h<<P.hash_shift^P.window[P.strstart+1])&P.hash_mask;else nt=o._tr_tally(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++;if(nt&&(gt(P,!1),P.strm.avail_out===0))return O}return P.insert=P.strstart<K-1?P.strstart:K-1,Ut===m?(gt(P,!0),P.strm.avail_out===0?Gt:Ft):P.last_lit&&(gt(P,!1),P.strm.avail_out===0)?O:pt}function Te(P,Ut){for(var Ct,nt,tt;;){if(P.lookahead<ut){if(Je(P),P.lookahead<ut&&Ut===f)return O;if(P.lookahead===0)break}if(Ct=0,P.lookahead>=K&&(P.ins_h=(P.ins_h<<P.hash_shift^P.window[P.strstart+K-1])&P.hash_mask,Ct=P.prev[P.strstart&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=P.strstart),P.prev_length=P.match_length,P.prev_match=P.match_start,P.match_length=K-1,Ct!==0&&P.prev_length<P.max_lazy_match&&P.strstart-Ct<=P.w_size-ut&&(P.match_length=Kt(P,Ct),P.match_length<=5&&(P.strategy===1||P.match_length===K&&4096<P.strstart-P.match_start)&&(P.match_length=K-1)),P.prev_length>=K&&P.match_length<=P.prev_length){for(tt=P.strstart+P.lookahead-K,nt=o._tr_tally(P,P.strstart-1-P.prev_match,P.prev_length-K),P.lookahead-=P.prev_length-1,P.prev_length-=2;++P.strstart<=tt&&(P.ins_h=(P.ins_h<<P.hash_shift^P.window[P.strstart+K-1])&P.hash_mask,Ct=P.prev[P.strstart&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=P.strstart),--P.prev_length!=0;);if(P.match_available=0,P.match_length=K-1,P.strstart++,nt&&(gt(P,!1),P.strm.avail_out===0))return O}else if(P.match_available){if((nt=o._tr_tally(P,0,P.window[P.strstart-1]))&&gt(P,!1),P.strstart++,P.lookahead--,P.strm.avail_out===0)return O}else P.match_available=1,P.strstart++,P.lookahead--}return P.match_available&&(nt=o._tr_tally(P,0,P.window[P.strstart-1]),P.match_available=0),P.insert=P.strstart<K-1?P.strstart:K-1,Ut===m?(gt(P,!0),P.strm.avail_out===0?Gt:Ft):P.last_lit&&(gt(P,!1),P.strm.avail_out===0)?O:pt}function Xe(P,Ut,Ct,nt,tt){this.good_length=P,this.max_lazy=Ut,this.nice_length=Ct,this.max_chain=nt,this.func=tt}function ti(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*k),this.dyn_dtree=new a.Buf16(2*(2*I+1)),this.bl_tree=new a.Buf16(2*(2*L+1)),re(this.dyn_ltree),re(this.dyn_dtree),re(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(Y+1),this.heap=new a.Buf16(2*R+1),re(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*R+1),re(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function je(P){var Ut;return P&&P.state?(P.total_in=P.total_out=0,P.data_type=M,(Ut=P.state).pending=0,Ut.pending_out=0,Ut.wrap<0&&(Ut.wrap=-Ut.wrap),Ut.status=Ut.wrap?Z:ht,P.adler=Ut.wrap===2?0:1,Ut.last_flush=f,o._tr_init(Ut),g):oe(P,y)}function ms(P){var Ut=je(P);return Ut===g&&function(Ct){Ct.window_size=2*Ct.w_size,re(Ct.head),Ct.max_lazy_match=r[Ct.level].max_lazy,Ct.good_match=r[Ct.level].good_length,Ct.nice_match=r[Ct.level].nice_length,Ct.max_chain_length=r[Ct.level].max_chain,Ct.strstart=0,Ct.block_start=0,Ct.lookahead=0,Ct.insert=0,Ct.match_length=Ct.prev_length=K-1,Ct.match_available=0,Ct.ins_h=0}(P.state),Ut}function gs(P,Ut,Ct,nt,tt,mt){if(!P)return y;var Ht=1;if(Ut===_&&(Ut=6),nt<0?(Ht=0,nt=-nt):15<nt&&(Ht=2,nt-=16),tt<1||A<tt||Ct!==T||nt<8||15<nt||Ut<0||9<Ut||mt<0||w<mt)return oe(P,y);nt===8&&(nt=9);var Xt=new ti;return(P.state=Xt).strm=P,Xt.wrap=Ht,Xt.gzhead=null,Xt.w_bits=nt,Xt.w_size=1<<Xt.w_bits,Xt.w_mask=Xt.w_size-1,Xt.hash_bits=tt+7,Xt.hash_size=1<<Xt.hash_bits,Xt.hash_mask=Xt.hash_size-1,Xt.hash_shift=~~((Xt.hash_bits+K-1)/K),Xt.window=new a.Buf8(2*Xt.w_size),Xt.head=new a.Buf16(Xt.hash_size),Xt.prev=new a.Buf16(Xt.w_size),Xt.lit_bufsize=1<<tt+6,Xt.pending_buf_size=4*Xt.lit_bufsize,Xt.pending_buf=new a.Buf8(Xt.pending_buf_size),Xt.d_buf=1*Xt.lit_bufsize,Xt.l_buf=3*Xt.lit_bufsize,Xt.level=Ut,Xt.strategy=mt,Xt.method=Ct,ms(P)}r=[new Xe(0,0,0,0,function(P,Ut){var Ct=65535;for(Ct>P.pending_buf_size-5&&(Ct=P.pending_buf_size-5);;){if(P.lookahead<=1){if(Je(P),P.lookahead===0&&Ut===f)return O;if(P.lookahead===0)break}P.strstart+=P.lookahead,P.lookahead=0;var nt=P.block_start+Ct;if((P.strstart===0||P.strstart>=nt)&&(P.lookahead=P.strstart-nt,P.strstart=nt,gt(P,!1),P.strm.avail_out===0)||P.strstart-P.block_start>=P.w_size-ut&&(gt(P,!1),P.strm.avail_out===0))return O}return P.insert=0,Ut===m?(gt(P,!0),P.strm.avail_out===0?Gt:Ft):(P.strstart>P.block_start&&(gt(P,!1),P.strm.avail_out),O)}),new Xe(4,4,8,4,Qe),new Xe(4,5,16,8,Qe),new Xe(4,6,32,32,Qe),new Xe(4,4,16,16,Te),new Xe(8,16,32,32,Te),new Xe(8,16,128,128,Te),new Xe(8,32,128,256,Te),new Xe(32,128,258,1024,Te),new Xe(32,258,258,4096,Te)],s.deflateInit=function(P,Ut){return gs(P,Ut,T,15,8,0)},s.deflateInit2=gs,s.deflateReset=ms,s.deflateResetKeep=je,s.deflateSetHeader=function(P,Ut){return P&&P.state?P.state.wrap!==2?y:(P.state.gzhead=Ut,g):y},s.deflate=function(P,Ut){var Ct,nt,tt,mt;if(!P||!P.state||5<Ut||Ut<0)return P?oe(P,y):y;if(nt=P.state,!P.output||!P.input&&P.avail_in!==0||nt.status===666&&Ut!==m)return oe(P,P.avail_out===0?-5:y);if(nt.strm=P,Ct=nt.last_flush,nt.last_flush=Ut,nt.status===Z)if(nt.wrap===2)P.adler=0,ge(nt,31),ge(nt,139),ge(nt,8),nt.gzhead?(ge(nt,(nt.gzhead.text?1:0)+(nt.gzhead.hcrc?2:0)+(nt.gzhead.extra?4:0)+(nt.gzhead.name?8:0)+(nt.gzhead.comment?16:0)),ge(nt,255&nt.gzhead.time),ge(nt,nt.gzhead.time>>8&255),ge(nt,nt.gzhead.time>>16&255),ge(nt,nt.gzhead.time>>24&255),ge(nt,nt.level===9?2:2<=nt.strategy||nt.level<2?4:0),ge(nt,255&nt.gzhead.os),nt.gzhead.extra&&nt.gzhead.extra.length&&(ge(nt,255&nt.gzhead.extra.length),ge(nt,nt.gzhead.extra.length>>8&255)),nt.gzhead.hcrc&&(P.adler=l(P.adler,nt.pending_buf,nt.pending,0)),nt.gzindex=0,nt.status=69):(ge(nt,0),ge(nt,0),ge(nt,0),ge(nt,0),ge(nt,0),ge(nt,nt.level===9?2:2<=nt.strategy||nt.level<2?4:0),ge(nt,3),nt.status=ht);else{var Ht=T+(nt.w_bits-8<<4)<<8;Ht|=(2<=nt.strategy||nt.level<2?0:nt.level<6?1:nt.level===6?2:3)<<6,nt.strstart!==0&&(Ht|=32),Ht+=31-Ht%31,nt.status=ht,Et(nt,Ht),nt.strstart!==0&&(Et(nt,P.adler>>>16),Et(nt,65535&P.adler)),P.adler=1}if(nt.status===69)if(nt.gzhead.extra){for(tt=nt.pending;nt.gzindex<(65535&nt.gzhead.extra.length)&&(nt.pending!==nt.pending_buf_size||(nt.gzhead.hcrc&&nt.pending>tt&&(P.adler=l(P.adler,nt.pending_buf,nt.pending-tt,tt)),yt(P),tt=nt.pending,nt.pending!==nt.pending_buf_size));)ge(nt,255&nt.gzhead.extra[nt.gzindex]),nt.gzindex++;nt.gzhead.hcrc&&nt.pending>tt&&(P.adler=l(P.adler,nt.pending_buf,nt.pending-tt,tt)),nt.gzindex===nt.gzhead.extra.length&&(nt.gzindex=0,nt.status=73)}else nt.status=73;if(nt.status===73)if(nt.gzhead.name){tt=nt.pending;do{if(nt.pending===nt.pending_buf_size&&(nt.gzhead.hcrc&&nt.pending>tt&&(P.adler=l(P.adler,nt.pending_buf,nt.pending-tt,tt)),yt(P),tt=nt.pending,nt.pending===nt.pending_buf_size)){mt=1;break}mt=nt.gzindex<nt.gzhead.name.length?255&nt.gzhead.name.charCodeAt(nt.gzindex++):0,ge(nt,mt)}while(mt!==0);nt.gzhead.hcrc&&nt.pending>tt&&(P.adler=l(P.adler,nt.pending_buf,nt.pending-tt,tt)),mt===0&&(nt.gzindex=0,nt.status=91)}else nt.status=91;if(nt.status===91)if(nt.gzhead.comment){tt=nt.pending;do{if(nt.pending===nt.pending_buf_size&&(nt.gzhead.hcrc&&nt.pending>tt&&(P.adler=l(P.adler,nt.pending_buf,nt.pending-tt,tt)),yt(P),tt=nt.pending,nt.pending===nt.pending_buf_size)){mt=1;break}mt=nt.gzindex<nt.gzhead.comment.length?255&nt.gzhead.comment.charCodeAt(nt.gzindex++):0,ge(nt,mt)}while(mt!==0);nt.gzhead.hcrc&&nt.pending>tt&&(P.adler=l(P.adler,nt.pending_buf,nt.pending-tt,tt)),mt===0&&(nt.status=103)}else nt.status=103;if(nt.status===103&&(nt.gzhead.hcrc?(nt.pending+2>nt.pending_buf_size&&yt(P),nt.pending+2<=nt.pending_buf_size&&(ge(nt,255&P.adler),ge(nt,P.adler>>8&255),P.adler=0,nt.status=ht)):nt.status=ht),nt.pending!==0){if(yt(P),P.avail_out===0)return nt.last_flush=-1,g}else if(P.avail_in===0&&Dt(Ut)<=Dt(Ct)&&Ut!==m)return oe(P,-5);if(nt.status===666&&P.avail_in!==0)return oe(P,-5);if(P.avail_in!==0||nt.lookahead!==0||Ut!==f&&nt.status!==666){var Xt=nt.strategy===2?function(_t,Qt){for(var At;;){if(_t.lookahead===0&&(Je(_t),_t.lookahead===0)){if(Qt===f)return O;break}if(_t.match_length=0,At=o._tr_tally(_t,0,_t.window[_t.strstart]),_t.lookahead--,_t.strstart++,At&&(gt(_t,!1),_t.strm.avail_out===0))return O}return _t.insert=0,Qt===m?(gt(_t,!0),_t.strm.avail_out===0?Gt:Ft):_t.last_lit&&(gt(_t,!1),_t.strm.avail_out===0)?O:pt}(nt,Ut):nt.strategy===3?function(_t,Qt){for(var At,jt,ve,pi,Ye=_t.window;;){if(_t.lookahead<=rt){if(Je(_t),_t.lookahead<=rt&&Qt===f)return O;if(_t.lookahead===0)break}if(_t.match_length=0,_t.lookahead>=K&&0<_t.strstart&&(jt=Ye[ve=_t.strstart-1])===Ye[++ve]&&jt===Ye[++ve]&&jt===Ye[++ve]){pi=_t.strstart+rt;do;while(jt===Ye[++ve]&&jt===Ye[++ve]&&jt===Ye[++ve]&&jt===Ye[++ve]&&jt===Ye[++ve]&&jt===Ye[++ve]&&jt===Ye[++ve]&&jt===Ye[++ve]&&ve<pi);_t.match_length=rt-(pi-ve),_t.match_length>_t.lookahead&&(_t.match_length=_t.lookahead)}if(_t.match_length>=K?(At=o._tr_tally(_t,1,_t.match_length-K),_t.lookahead-=_t.match_length,_t.strstart+=_t.match_length,_t.match_length=0):(At=o._tr_tally(_t,0,_t.window[_t.strstart]),_t.lookahead--,_t.strstart++),At&&(gt(_t,!1),_t.strm.avail_out===0))return O}return _t.insert=0,Qt===m?(gt(_t,!0),_t.strm.avail_out===0?Gt:Ft):_t.last_lit&&(gt(_t,!1),_t.strm.avail_out===0)?O:pt}(nt,Ut):r[nt.level].func(nt,Ut);if(Xt!==Gt&&Xt!==Ft||(nt.status=666),Xt===O||Xt===Gt)return P.avail_out===0&&(nt.last_flush=-1),g;if(Xt===pt&&(Ut===1?o._tr_align(nt):Ut!==5&&(o._tr_stored_block(nt,0,0,!1),Ut===3&&(re(nt.head),nt.lookahead===0&&(nt.strstart=0,nt.block_start=0,nt.insert=0))),yt(P),P.avail_out===0))return nt.last_flush=-1,g}return Ut!==m?g:nt.wrap<=0?1:(nt.wrap===2?(ge(nt,255&P.adler),ge(nt,P.adler>>8&255),ge(nt,P.adler>>16&255),ge(nt,P.adler>>24&255),ge(nt,255&P.total_in),ge(nt,P.total_in>>8&255),ge(nt,P.total_in>>16&255),ge(nt,P.total_in>>24&255)):(Et(nt,P.adler>>>16),Et(nt,65535&P.adler)),yt(P),0<nt.wrap&&(nt.wrap=-nt.wrap),nt.pending!==0?g:1)},s.deflateEnd=function(P){var Ut;return P&&P.state?(Ut=P.state.status)!==Z&&Ut!==69&&Ut!==73&&Ut!==91&&Ut!==103&&Ut!==ht&&Ut!==666?oe(P,y):(P.state=null,Ut===ht?oe(P,-3):g):y},s.deflateSetDictionary=function(P,Ut){var Ct,nt,tt,mt,Ht,Xt,_t,Qt,At=Ut.length;if(!P||!P.state||(mt=(Ct=P.state).wrap)===2||mt===1&&Ct.status!==Z||Ct.lookahead)return y;for(mt===1&&(P.adler=h(P.adler,Ut,At,0)),Ct.wrap=0,At>=Ct.w_size&&(mt===0&&(re(Ct.head),Ct.strstart=0,Ct.block_start=0,Ct.insert=0),Qt=new a.Buf8(Ct.w_size),a.arraySet(Qt,Ut,At-Ct.w_size,Ct.w_size,0),Ut=Qt,At=Ct.w_size),Ht=P.avail_in,Xt=P.next_in,_t=P.input,P.avail_in=At,P.next_in=0,P.input=Ut,Je(Ct);Ct.lookahead>=K;){for(nt=Ct.strstart,tt=Ct.lookahead-(K-1);Ct.ins_h=(Ct.ins_h<<Ct.hash_shift^Ct.window[nt+K-1])&Ct.hash_mask,Ct.prev[nt&Ct.w_mask]=Ct.head[Ct.ins_h],Ct.head[Ct.ins_h]=nt,nt++,--tt;);Ct.strstart=nt,Ct.lookahead=K-1,Je(Ct)}return Ct.strstart+=Ct.lookahead,Ct.block_start=Ct.strstart,Ct.insert=Ct.lookahead,Ct.lookahead=0,Ct.match_length=Ct.prev_length=K-1,Ct.match_available=0,P.next_in=Xt,P.input=_t,P.avail_in=Ht,Ct.wrap=mt,g},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,i,s){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,i,s){i.exports=function(r,a){var o,h,l,u,f,m,g,y,_,w,M,T,A,R,I,L,k,Y,K,rt,ut,Z,ht,O,pt;o=r.state,h=r.next_in,O=r.input,l=h+(r.avail_in-5),u=r.next_out,pt=r.output,f=u-(a-r.avail_out),m=u+(r.avail_out-257),g=o.dmax,y=o.wsize,_=o.whave,w=o.wnext,M=o.window,T=o.hold,A=o.bits,R=o.lencode,I=o.distcode,L=(1<<o.lenbits)-1,k=(1<<o.distbits)-1;t:do{A<15&&(T+=O[h++]<<A,A+=8,T+=O[h++]<<A,A+=8),Y=R[T&L];e:for(;;){if(T>>>=K=Y>>>24,A-=K,(K=Y>>>16&255)===0)pt[u++]=65535&Y;else{if(!(16&K)){if((64&K)==0){Y=R[(65535&Y)+(T&(1<<K)-1)];continue e}if(32&K){o.mode=12;break t}r.msg="invalid literal/length code",o.mode=30;break t}rt=65535&Y,(K&=15)&&(A<K&&(T+=O[h++]<<A,A+=8),rt+=T&(1<<K)-1,T>>>=K,A-=K),A<15&&(T+=O[h++]<<A,A+=8,T+=O[h++]<<A,A+=8),Y=I[T&k];i:for(;;){if(T>>>=K=Y>>>24,A-=K,!(16&(K=Y>>>16&255))){if((64&K)==0){Y=I[(65535&Y)+(T&(1<<K)-1)];continue i}r.msg="invalid distance code",o.mode=30;break t}if(ut=65535&Y,A<(K&=15)&&(T+=O[h++]<<A,(A+=8)<K&&(T+=O[h++]<<A,A+=8)),g<(ut+=T&(1<<K)-1)){r.msg="invalid distance too far back",o.mode=30;break t}if(T>>>=K,A-=K,(K=u-f)<ut){if(_<(K=ut-K)&&o.sane){r.msg="invalid distance too far back",o.mode=30;break t}if(ht=M,(Z=0)===w){if(Z+=y-K,K<rt){for(rt-=K;pt[u++]=M[Z++],--K;);Z=u-ut,ht=pt}}else if(w<K){if(Z+=y+w-K,(K-=w)<rt){for(rt-=K;pt[u++]=M[Z++],--K;);if(Z=0,w<rt){for(rt-=K=w;pt[u++]=M[Z++],--K;);Z=u-ut,ht=pt}}}else if(Z+=w-K,K<rt){for(rt-=K;pt[u++]=M[Z++],--K;);Z=u-ut,ht=pt}for(;2<rt;)pt[u++]=ht[Z++],pt[u++]=ht[Z++],pt[u++]=ht[Z++],rt-=3;rt&&(pt[u++]=ht[Z++],1<rt&&(pt[u++]=ht[Z++]))}else{for(Z=u-ut;pt[u++]=pt[Z++],pt[u++]=pt[Z++],pt[u++]=pt[Z++],2<(rt-=3););rt&&(pt[u++]=pt[Z++],1<rt&&(pt[u++]=pt[Z++]))}break}}break}}while(h<l&&u<m);h-=rt=A>>3,T&=(1<<(A-=rt<<3))-1,r.next_in=h,r.next_out=u,r.avail_in=h<l?l-h+5:5-(h-l),r.avail_out=u<m?m-u+257:257-(u-m),o.hold=T,o.bits=A}},{}],49:[function(e,i,s){var r=e("../utils/common"),a=e("./adler32"),o=e("./crc32"),h=e("./inffast"),l=e("./inftrees"),u=1,f=2,m=0,g=-2,y=1,_=852,w=592;function M(Z){return(Z>>>24&255)+(Z>>>8&65280)+((65280&Z)<<8)+((255&Z)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(Z){var ht;return Z&&Z.state?(ht=Z.state,Z.total_in=Z.total_out=ht.total=0,Z.msg="",ht.wrap&&(Z.adler=1&ht.wrap),ht.mode=y,ht.last=0,ht.havedict=0,ht.dmax=32768,ht.head=null,ht.hold=0,ht.bits=0,ht.lencode=ht.lendyn=new r.Buf32(_),ht.distcode=ht.distdyn=new r.Buf32(w),ht.sane=1,ht.back=-1,m):g}function R(Z){var ht;return Z&&Z.state?((ht=Z.state).wsize=0,ht.whave=0,ht.wnext=0,A(Z)):g}function I(Z,ht){var O,pt;return Z&&Z.state?(pt=Z.state,ht<0?(O=0,ht=-ht):(O=1+(ht>>4),ht<48&&(ht&=15)),ht&&(ht<8||15<ht)?g:(pt.window!==null&&pt.wbits!==ht&&(pt.window=null),pt.wrap=O,pt.wbits=ht,R(Z))):g}function L(Z,ht){var O,pt;return Z?(pt=new T,(Z.state=pt).window=null,(O=I(Z,ht))!==m&&(Z.state=null),O):g}var k,Y,K=!0;function rt(Z){if(K){var ht;for(k=new r.Buf32(512),Y=new r.Buf32(32),ht=0;ht<144;)Z.lens[ht++]=8;for(;ht<256;)Z.lens[ht++]=9;for(;ht<280;)Z.lens[ht++]=7;for(;ht<288;)Z.lens[ht++]=8;for(l(u,Z.lens,0,288,k,0,Z.work,{bits:9}),ht=0;ht<32;)Z.lens[ht++]=5;l(f,Z.lens,0,32,Y,0,Z.work,{bits:5}),K=!1}Z.lencode=k,Z.lenbits=9,Z.distcode=Y,Z.distbits=5}function ut(Z,ht,O,pt){var Gt,Ft=Z.state;return Ft.window===null&&(Ft.wsize=1<<Ft.wbits,Ft.wnext=0,Ft.whave=0,Ft.window=new r.Buf8(Ft.wsize)),pt>=Ft.wsize?(r.arraySet(Ft.window,ht,O-Ft.wsize,Ft.wsize,0),Ft.wnext=0,Ft.whave=Ft.wsize):(pt<(Gt=Ft.wsize-Ft.wnext)&&(Gt=pt),r.arraySet(Ft.window,ht,O-pt,Gt,Ft.wnext),(pt-=Gt)?(r.arraySet(Ft.window,ht,O-pt,pt,0),Ft.wnext=pt,Ft.whave=Ft.wsize):(Ft.wnext+=Gt,Ft.wnext===Ft.wsize&&(Ft.wnext=0),Ft.whave<Ft.wsize&&(Ft.whave+=Gt))),0}s.inflateReset=R,s.inflateReset2=I,s.inflateResetKeep=A,s.inflateInit=function(Z){return L(Z,15)},s.inflateInit2=L,s.inflate=function(Z,ht){var O,pt,Gt,Ft,oe,Dt,re,yt,gt,ge,Et,Kt,Je,Qe,Te,Xe,ti,je,ms,gs,P,Ut,Ct,nt,tt=0,mt=new r.Buf8(4),Ht=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!Z||!Z.state||!Z.output||!Z.input&&Z.avail_in!==0)return g;(O=Z.state).mode===12&&(O.mode=13),oe=Z.next_out,Gt=Z.output,re=Z.avail_out,Ft=Z.next_in,pt=Z.input,Dt=Z.avail_in,yt=O.hold,gt=O.bits,ge=Dt,Et=re,Ut=m;t:for(;;)switch(O.mode){case y:if(O.wrap===0){O.mode=13;break}for(;gt<16;){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}if(2&O.wrap&&yt===35615){mt[O.check=0]=255&yt,mt[1]=yt>>>8&255,O.check=o(O.check,mt,2,0),gt=yt=0,O.mode=2;break}if(O.flags=0,O.head&&(O.head.done=!1),!(1&O.wrap)||(((255&yt)<<8)+(yt>>8))%31){Z.msg="incorrect header check",O.mode=30;break}if((15&yt)!=8){Z.msg="unknown compression method",O.mode=30;break}if(gt-=4,P=8+(15&(yt>>>=4)),O.wbits===0)O.wbits=P;else if(P>O.wbits){Z.msg="invalid window size",O.mode=30;break}O.dmax=1<<P,Z.adler=O.check=1,O.mode=512&yt?10:12,gt=yt=0;break;case 2:for(;gt<16;){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}if(O.flags=yt,(255&O.flags)!=8){Z.msg="unknown compression method",O.mode=30;break}if(57344&O.flags){Z.msg="unknown header flags set",O.mode=30;break}O.head&&(O.head.text=yt>>8&1),512&O.flags&&(mt[0]=255&yt,mt[1]=yt>>>8&255,O.check=o(O.check,mt,2,0)),gt=yt=0,O.mode=3;case 3:for(;gt<32;){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}O.head&&(O.head.time=yt),512&O.flags&&(mt[0]=255&yt,mt[1]=yt>>>8&255,mt[2]=yt>>>16&255,mt[3]=yt>>>24&255,O.check=o(O.check,mt,4,0)),gt=yt=0,O.mode=4;case 4:for(;gt<16;){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}O.head&&(O.head.xflags=255&yt,O.head.os=yt>>8),512&O.flags&&(mt[0]=255&yt,mt[1]=yt>>>8&255,O.check=o(O.check,mt,2,0)),gt=yt=0,O.mode=5;case 5:if(1024&O.flags){for(;gt<16;){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}O.length=yt,O.head&&(O.head.extra_len=yt),512&O.flags&&(mt[0]=255&yt,mt[1]=yt>>>8&255,O.check=o(O.check,mt,2,0)),gt=yt=0}else O.head&&(O.head.extra=null);O.mode=6;case 6:if(1024&O.flags&&(Dt<(Kt=O.length)&&(Kt=Dt),Kt&&(O.head&&(P=O.head.extra_len-O.length,O.head.extra||(O.head.extra=new Array(O.head.extra_len)),r.arraySet(O.head.extra,pt,Ft,Kt,P)),512&O.flags&&(O.check=o(O.check,pt,Kt,Ft)),Dt-=Kt,Ft+=Kt,O.length-=Kt),O.length))break t;O.length=0,O.mode=7;case 7:if(2048&O.flags){if(Dt===0)break t;for(Kt=0;P=pt[Ft+Kt++],O.head&&P&&O.length<65536&&(O.head.name+=String.fromCharCode(P)),P&&Kt<Dt;);if(512&O.flags&&(O.check=o(O.check,pt,Kt,Ft)),Dt-=Kt,Ft+=Kt,P)break t}else O.head&&(O.head.name=null);O.length=0,O.mode=8;case 8:if(4096&O.flags){if(Dt===0)break t;for(Kt=0;P=pt[Ft+Kt++],O.head&&P&&O.length<65536&&(O.head.comment+=String.fromCharCode(P)),P&&Kt<Dt;);if(512&O.flags&&(O.check=o(O.check,pt,Kt,Ft)),Dt-=Kt,Ft+=Kt,P)break t}else O.head&&(O.head.comment=null);O.mode=9;case 9:if(512&O.flags){for(;gt<16;){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}if(yt!==(65535&O.check)){Z.msg="header crc mismatch",O.mode=30;break}gt=yt=0}O.head&&(O.head.hcrc=O.flags>>9&1,O.head.done=!0),Z.adler=O.check=0,O.mode=12;break;case 10:for(;gt<32;){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}Z.adler=O.check=M(yt),gt=yt=0,O.mode=11;case 11:if(O.havedict===0)return Z.next_out=oe,Z.avail_out=re,Z.next_in=Ft,Z.avail_in=Dt,O.hold=yt,O.bits=gt,2;Z.adler=O.check=1,O.mode=12;case 12:if(ht===5||ht===6)break t;case 13:if(O.last){yt>>>=7&gt,gt-=7&gt,O.mode=27;break}for(;gt<3;){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}switch(O.last=1&yt,gt-=1,3&(yt>>>=1)){case 0:O.mode=14;break;case 1:if(rt(O),O.mode=20,ht!==6)break;yt>>>=2,gt-=2;break t;case 2:O.mode=17;break;case 3:Z.msg="invalid block type",O.mode=30}yt>>>=2,gt-=2;break;case 14:for(yt>>>=7&gt,gt-=7&gt;gt<32;){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}if((65535&yt)!=(yt>>>16^65535)){Z.msg="invalid stored block lengths",O.mode=30;break}if(O.length=65535&yt,gt=yt=0,O.mode=15,ht===6)break t;case 15:O.mode=16;case 16:if(Kt=O.length){if(Dt<Kt&&(Kt=Dt),re<Kt&&(Kt=re),Kt===0)break t;r.arraySet(Gt,pt,Ft,Kt,oe),Dt-=Kt,Ft+=Kt,re-=Kt,oe+=Kt,O.length-=Kt;break}O.mode=12;break;case 17:for(;gt<14;){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}if(O.nlen=257+(31&yt),yt>>>=5,gt-=5,O.ndist=1+(31&yt),yt>>>=5,gt-=5,O.ncode=4+(15&yt),yt>>>=4,gt-=4,286<O.nlen||30<O.ndist){Z.msg="too many length or distance symbols",O.mode=30;break}O.have=0,O.mode=18;case 18:for(;O.have<O.ncode;){for(;gt<3;){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}O.lens[Ht[O.have++]]=7&yt,yt>>>=3,gt-=3}for(;O.have<19;)O.lens[Ht[O.have++]]=0;if(O.lencode=O.lendyn,O.lenbits=7,Ct={bits:O.lenbits},Ut=l(0,O.lens,0,19,O.lencode,0,O.work,Ct),O.lenbits=Ct.bits,Ut){Z.msg="invalid code lengths set",O.mode=30;break}O.have=0,O.mode=19;case 19:for(;O.have<O.nlen+O.ndist;){for(;Xe=(tt=O.lencode[yt&(1<<O.lenbits)-1])>>>16&255,ti=65535&tt,!((Te=tt>>>24)<=gt);){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}if(ti<16)yt>>>=Te,gt-=Te,O.lens[O.have++]=ti;else{if(ti===16){for(nt=Te+2;gt<nt;){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}if(yt>>>=Te,gt-=Te,O.have===0){Z.msg="invalid bit length repeat",O.mode=30;break}P=O.lens[O.have-1],Kt=3+(3&yt),yt>>>=2,gt-=2}else if(ti===17){for(nt=Te+3;gt<nt;){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}gt-=Te,P=0,Kt=3+(7&(yt>>>=Te)),yt>>>=3,gt-=3}else{for(nt=Te+7;gt<nt;){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}gt-=Te,P=0,Kt=11+(127&(yt>>>=Te)),yt>>>=7,gt-=7}if(O.have+Kt>O.nlen+O.ndist){Z.msg="invalid bit length repeat",O.mode=30;break}for(;Kt--;)O.lens[O.have++]=P}}if(O.mode===30)break;if(O.lens[256]===0){Z.msg="invalid code -- missing end-of-block",O.mode=30;break}if(O.lenbits=9,Ct={bits:O.lenbits},Ut=l(u,O.lens,0,O.nlen,O.lencode,0,O.work,Ct),O.lenbits=Ct.bits,Ut){Z.msg="invalid literal/lengths set",O.mode=30;break}if(O.distbits=6,O.distcode=O.distdyn,Ct={bits:O.distbits},Ut=l(f,O.lens,O.nlen,O.ndist,O.distcode,0,O.work,Ct),O.distbits=Ct.bits,Ut){Z.msg="invalid distances set",O.mode=30;break}if(O.mode=20,ht===6)break t;case 20:O.mode=21;case 21:if(6<=Dt&&258<=re){Z.next_out=oe,Z.avail_out=re,Z.next_in=Ft,Z.avail_in=Dt,O.hold=yt,O.bits=gt,h(Z,Et),oe=Z.next_out,Gt=Z.output,re=Z.avail_out,Ft=Z.next_in,pt=Z.input,Dt=Z.avail_in,yt=O.hold,gt=O.bits,O.mode===12&&(O.back=-1);break}for(O.back=0;Xe=(tt=O.lencode[yt&(1<<O.lenbits)-1])>>>16&255,ti=65535&tt,!((Te=tt>>>24)<=gt);){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}if(Xe&&(240&Xe)==0){for(je=Te,ms=Xe,gs=ti;Xe=(tt=O.lencode[gs+((yt&(1<<je+ms)-1)>>je)])>>>16&255,ti=65535&tt,!(je+(Te=tt>>>24)<=gt);){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}yt>>>=je,gt-=je,O.back+=je}if(yt>>>=Te,gt-=Te,O.back+=Te,O.length=ti,Xe===0){O.mode=26;break}if(32&Xe){O.back=-1,O.mode=12;break}if(64&Xe){Z.msg="invalid literal/length code",O.mode=30;break}O.extra=15&Xe,O.mode=22;case 22:if(O.extra){for(nt=O.extra;gt<nt;){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}O.length+=yt&(1<<O.extra)-1,yt>>>=O.extra,gt-=O.extra,O.back+=O.extra}O.was=O.length,O.mode=23;case 23:for(;Xe=(tt=O.distcode[yt&(1<<O.distbits)-1])>>>16&255,ti=65535&tt,!((Te=tt>>>24)<=gt);){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}if((240&Xe)==0){for(je=Te,ms=Xe,gs=ti;Xe=(tt=O.distcode[gs+((yt&(1<<je+ms)-1)>>je)])>>>16&255,ti=65535&tt,!(je+(Te=tt>>>24)<=gt);){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}yt>>>=je,gt-=je,O.back+=je}if(yt>>>=Te,gt-=Te,O.back+=Te,64&Xe){Z.msg="invalid distance code",O.mode=30;break}O.offset=ti,O.extra=15&Xe,O.mode=24;case 24:if(O.extra){for(nt=O.extra;gt<nt;){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}O.offset+=yt&(1<<O.extra)-1,yt>>>=O.extra,gt-=O.extra,O.back+=O.extra}if(O.offset>O.dmax){Z.msg="invalid distance too far back",O.mode=30;break}O.mode=25;case 25:if(re===0)break t;if(Kt=Et-re,O.offset>Kt){if((Kt=O.offset-Kt)>O.whave&&O.sane){Z.msg="invalid distance too far back",O.mode=30;break}Je=Kt>O.wnext?(Kt-=O.wnext,O.wsize-Kt):O.wnext-Kt,Kt>O.length&&(Kt=O.length),Qe=O.window}else Qe=Gt,Je=oe-O.offset,Kt=O.length;for(re<Kt&&(Kt=re),re-=Kt,O.length-=Kt;Gt[oe++]=Qe[Je++],--Kt;);O.length===0&&(O.mode=21);break;case 26:if(re===0)break t;Gt[oe++]=O.length,re--,O.mode=21;break;case 27:if(O.wrap){for(;gt<32;){if(Dt===0)break t;Dt--,yt|=pt[Ft++]<<gt,gt+=8}if(Et-=re,Z.total_out+=Et,O.total+=Et,Et&&(Z.adler=O.check=O.flags?o(O.check,Gt,Et,oe-Et):a(O.check,Gt,Et,oe-Et)),Et=re,(O.flags?yt:M(yt))!==O.check){Z.msg="incorrect data check",O.mode=30;break}gt=yt=0}O.mode=28;case 28:if(O.wrap&&O.flags){for(;gt<32;){if(Dt===0)break t;Dt--,yt+=pt[Ft++]<<gt,gt+=8}if(yt!==(4294967295&O.total)){Z.msg="incorrect length check",O.mode=30;break}gt=yt=0}O.mode=29;case 29:Ut=1;break t;case 30:Ut=-3;break t;case 31:return-4;case 32:default:return g}return Z.next_out=oe,Z.avail_out=re,Z.next_in=Ft,Z.avail_in=Dt,O.hold=yt,O.bits=gt,(O.wsize||Et!==Z.avail_out&&O.mode<30&&(O.mode<27||ht!==4))&&ut(Z,Z.output,Z.next_out,Et-Z.avail_out)?(O.mode=31,-4):(ge-=Z.avail_in,Et-=Z.avail_out,Z.total_in+=ge,Z.total_out+=Et,O.total+=Et,O.wrap&&Et&&(Z.adler=O.check=O.flags?o(O.check,Gt,Et,Z.next_out-Et):a(O.check,Gt,Et,Z.next_out-Et)),Z.data_type=O.bits+(O.last?64:0)+(O.mode===12?128:0)+(O.mode===20||O.mode===15?256:0),(ge==0&&Et===0||ht===4)&&Ut===m&&(Ut=-5),Ut)},s.inflateEnd=function(Z){if(!Z||!Z.state)return g;var ht=Z.state;return ht.window&&(ht.window=null),Z.state=null,m},s.inflateGetHeader=function(Z,ht){var O;return Z&&Z.state?(2&(O=Z.state).wrap)==0?g:((O.head=ht).done=!1,m):g},s.inflateSetDictionary=function(Z,ht){var O,pt=ht.length;return Z&&Z.state?(O=Z.state).wrap!==0&&O.mode!==11?g:O.mode===11&&a(1,ht,pt,0)!==O.check?-3:ut(Z,ht,pt,pt)?(O.mode=31,-4):(O.havedict=1,m):g},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,i,s){var r=e("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(u,f,m,g,y,_,w,M){var T,A,R,I,L,k,Y,K,rt,ut=M.bits,Z=0,ht=0,O=0,pt=0,Gt=0,Ft=0,oe=0,Dt=0,re=0,yt=0,gt=null,ge=0,Et=new r.Buf16(16),Kt=new r.Buf16(16),Je=null,Qe=0;for(Z=0;Z<=15;Z++)Et[Z]=0;for(ht=0;ht<g;ht++)Et[f[m+ht]]++;for(Gt=ut,pt=15;1<=pt&&Et[pt]===0;pt--);if(pt<Gt&&(Gt=pt),pt===0)return y[_++]=20971520,y[_++]=20971520,M.bits=1,0;for(O=1;O<pt&&Et[O]===0;O++);for(Gt<O&&(Gt=O),Z=Dt=1;Z<=15;Z++)if(Dt<<=1,(Dt-=Et[Z])<0)return-1;if(0<Dt&&(u===0||pt!==1))return-1;for(Kt[1]=0,Z=1;Z<15;Z++)Kt[Z+1]=Kt[Z]+Et[Z];for(ht=0;ht<g;ht++)f[m+ht]!==0&&(w[Kt[f[m+ht]]++]=ht);if(k=u===0?(gt=Je=w,19):u===1?(gt=a,ge-=257,Je=o,Qe-=257,256):(gt=h,Je=l,-1),Z=O,L=_,oe=ht=yt=0,R=-1,I=(re=1<<(Ft=Gt))-1,u===1&&852<re||u===2&&592<re)return 1;for(;;){for(Y=Z-oe,rt=w[ht]<k?(K=0,w[ht]):w[ht]>k?(K=Je[Qe+w[ht]],gt[ge+w[ht]]):(K=96,0),T=1<<Z-oe,O=A=1<<Ft;y[L+(yt>>oe)+(A-=T)]=Y<<24|K<<16|rt|0,A!==0;);for(T=1<<Z-1;yt&T;)T>>=1;if(T!==0?(yt&=T-1,yt+=T):yt=0,ht++,--Et[Z]==0){if(Z===pt)break;Z=f[m+w[ht]]}if(Gt<Z&&(yt&I)!==R){for(oe===0&&(oe=Gt),L+=O,Dt=1<<(Ft=Z-oe);Ft+oe<pt&&!((Dt-=Et[Ft+oe])<=0);)Ft++,Dt<<=1;if(re+=1<<Ft,u===1&&852<re||u===2&&592<re)return 1;y[R=yt&I]=Gt<<24|Ft<<16|L-_|0}}return yt!==0&&(y[L+yt]=Z-oe<<24|64<<16|0),M.bits=Gt,0}},{"../utils/common":41}],51:[function(e,i,s){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,i,s){var r=e("../utils/common"),a=0,o=1;function h(tt){for(var mt=tt.length;0<=--mt;)tt[mt]=0}var l=0,u=29,f=256,m=f+1+u,g=30,y=19,_=2*m+1,w=15,M=16,T=7,A=256,R=16,I=17,L=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Y=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],K=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],rt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ut=new Array(2*(m+2));h(ut);var Z=new Array(2*g);h(Z);var ht=new Array(512);h(ht);var O=new Array(256);h(O);var pt=new Array(u);h(pt);var Gt,Ft,oe,Dt=new Array(g);function re(tt,mt,Ht,Xt,_t){this.static_tree=tt,this.extra_bits=mt,this.extra_base=Ht,this.elems=Xt,this.max_length=_t,this.has_stree=tt&&tt.length}function yt(tt,mt){this.dyn_tree=tt,this.max_code=0,this.stat_desc=mt}function gt(tt){return tt<256?ht[tt]:ht[256+(tt>>>7)]}function ge(tt,mt){tt.pending_buf[tt.pending++]=255&mt,tt.pending_buf[tt.pending++]=mt>>>8&255}function Et(tt,mt,Ht){tt.bi_valid>M-Ht?(tt.bi_buf|=mt<<tt.bi_valid&65535,ge(tt,tt.bi_buf),tt.bi_buf=mt>>M-tt.bi_valid,tt.bi_valid+=Ht-M):(tt.bi_buf|=mt<<tt.bi_valid&65535,tt.bi_valid+=Ht)}function Kt(tt,mt,Ht){Et(tt,Ht[2*mt],Ht[2*mt+1])}function Je(tt,mt){for(var Ht=0;Ht|=1&tt,tt>>>=1,Ht<<=1,0<--mt;);return Ht>>>1}function Qe(tt,mt,Ht){var Xt,_t,Qt=new Array(w+1),At=0;for(Xt=1;Xt<=w;Xt++)Qt[Xt]=At=At+Ht[Xt-1]<<1;for(_t=0;_t<=mt;_t++){var jt=tt[2*_t+1];jt!==0&&(tt[2*_t]=Je(Qt[jt]++,jt))}}function Te(tt){var mt;for(mt=0;mt<m;mt++)tt.dyn_ltree[2*mt]=0;for(mt=0;mt<g;mt++)tt.dyn_dtree[2*mt]=0;for(mt=0;mt<y;mt++)tt.bl_tree[2*mt]=0;tt.dyn_ltree[2*A]=1,tt.opt_len=tt.static_len=0,tt.last_lit=tt.matches=0}function Xe(tt){8<tt.bi_valid?ge(tt,tt.bi_buf):0<tt.bi_valid&&(tt.pending_buf[tt.pending++]=tt.bi_buf),tt.bi_buf=0,tt.bi_valid=0}function ti(tt,mt,Ht,Xt){var _t=2*mt,Qt=2*Ht;return tt[_t]<tt[Qt]||tt[_t]===tt[Qt]&&Xt[mt]<=Xt[Ht]}function je(tt,mt,Ht){for(var Xt=tt.heap[Ht],_t=Ht<<1;_t<=tt.heap_len&&(_t<tt.heap_len&&ti(mt,tt.heap[_t+1],tt.heap[_t],tt.depth)&&_t++,!ti(mt,Xt,tt.heap[_t],tt.depth));)tt.heap[Ht]=tt.heap[_t],Ht=_t,_t<<=1;tt.heap[Ht]=Xt}function ms(tt,mt,Ht){var Xt,_t,Qt,At,jt=0;if(tt.last_lit!==0)for(;Xt=tt.pending_buf[tt.d_buf+2*jt]<<8|tt.pending_buf[tt.d_buf+2*jt+1],_t=tt.pending_buf[tt.l_buf+jt],jt++,Xt===0?Kt(tt,_t,mt):(Kt(tt,(Qt=O[_t])+f+1,mt),(At=k[Qt])!==0&&Et(tt,_t-=pt[Qt],At),Kt(tt,Qt=gt(--Xt),Ht),(At=Y[Qt])!==0&&Et(tt,Xt-=Dt[Qt],At)),jt<tt.last_lit;);Kt(tt,A,mt)}function gs(tt,mt){var Ht,Xt,_t,Qt=mt.dyn_tree,At=mt.stat_desc.static_tree,jt=mt.stat_desc.has_stree,ve=mt.stat_desc.elems,pi=-1;for(tt.heap_len=0,tt.heap_max=_,Ht=0;Ht<ve;Ht++)Qt[2*Ht]!==0?(tt.heap[++tt.heap_len]=pi=Ht,tt.depth[Ht]=0):Qt[2*Ht+1]=0;for(;tt.heap_len<2;)Qt[2*(_t=tt.heap[++tt.heap_len]=pi<2?++pi:0)]=1,tt.depth[_t]=0,tt.opt_len--,jt&&(tt.static_len-=At[2*_t+1]);for(mt.max_code=pi,Ht=tt.heap_len>>1;1<=Ht;Ht--)je(tt,Qt,Ht);for(_t=ve;Ht=tt.heap[1],tt.heap[1]=tt.heap[tt.heap_len--],je(tt,Qt,1),Xt=tt.heap[1],tt.heap[--tt.heap_max]=Ht,tt.heap[--tt.heap_max]=Xt,Qt[2*_t]=Qt[2*Ht]+Qt[2*Xt],tt.depth[_t]=(tt.depth[Ht]>=tt.depth[Xt]?tt.depth[Ht]:tt.depth[Xt])+1,Qt[2*Ht+1]=Qt[2*Xt+1]=_t,tt.heap[1]=_t++,je(tt,Qt,1),2<=tt.heap_len;);tt.heap[--tt.heap_max]=tt.heap[1],function(Ye,wn){var Ga,ys,ha,Ni,ko,Ih,As=wn.dyn_tree,la=wn.max_code,ca=wn.stat_desc.static_tree,Nh=wn.stat_desc.has_stree,kh=wn.stat_desc.extra_bits,ua=wn.stat_desc.extra_base,js=wn.stat_desc.max_length,Ee=0;for(Ni=0;Ni<=w;Ni++)Ye.bl_count[Ni]=0;for(As[2*Ye.heap[Ye.heap_max]+1]=0,Ga=Ye.heap_max+1;Ga<_;Ga++)js<(Ni=As[2*As[2*(ys=Ye.heap[Ga])+1]+1]+1)&&(Ni=js,Ee++),As[2*ys+1]=Ni,la<ys||(Ye.bl_count[Ni]++,ko=0,ua<=ys&&(ko=kh[ys-ua]),Ih=As[2*ys],Ye.opt_len+=Ih*(Ni+ko),Nh&&(Ye.static_len+=Ih*(ca[2*ys+1]+ko)));if(Ee!==0){do{for(Ni=js-1;Ye.bl_count[Ni]===0;)Ni--;Ye.bl_count[Ni]--,Ye.bl_count[Ni+1]+=2,Ye.bl_count[js]--,Ee-=2}while(0<Ee);for(Ni=js;Ni!==0;Ni--)for(ys=Ye.bl_count[Ni];ys!==0;)la<(ha=Ye.heap[--Ga])||(As[2*ha+1]!==Ni&&(Ye.opt_len+=(Ni-As[2*ha+1])*As[2*ha],As[2*ha+1]=Ni),ys--)}}(tt,mt),Qe(Qt,pi,tt.bl_count)}function P(tt,mt,Ht){var Xt,_t,Qt=-1,At=mt[1],jt=0,ve=7,pi=4;for(At===0&&(ve=138,pi=3),mt[2*(Ht+1)+1]=65535,Xt=0;Xt<=Ht;Xt++)_t=At,At=mt[2*(Xt+1)+1],++jt<ve&&_t===At||(jt<pi?tt.bl_tree[2*_t]+=jt:_t!==0?(_t!==Qt&&tt.bl_tree[2*_t]++,tt.bl_tree[2*R]++):jt<=10?tt.bl_tree[2*I]++:tt.bl_tree[2*L]++,Qt=_t,pi=(jt=0)===At?(ve=138,3):_t===At?(ve=6,3):(ve=7,4))}function Ut(tt,mt,Ht){var Xt,_t,Qt=-1,At=mt[1],jt=0,ve=7,pi=4;for(At===0&&(ve=138,pi=3),Xt=0;Xt<=Ht;Xt++)if(_t=At,At=mt[2*(Xt+1)+1],!(++jt<ve&&_t===At)){if(jt<pi)for(;Kt(tt,_t,tt.bl_tree),--jt!=0;);else _t!==0?(_t!==Qt&&(Kt(tt,_t,tt.bl_tree),jt--),Kt(tt,R,tt.bl_tree),Et(tt,jt-3,2)):jt<=10?(Kt(tt,I,tt.bl_tree),Et(tt,jt-3,3)):(Kt(tt,L,tt.bl_tree),Et(tt,jt-11,7));Qt=_t,pi=(jt=0)===At?(ve=138,3):_t===At?(ve=6,3):(ve=7,4)}}h(Dt);var Ct=!1;function nt(tt,mt,Ht,Xt){Et(tt,(l<<1)+(Xt?1:0),3),function(_t,Qt,At,jt){Xe(_t),jt&&(ge(_t,At),ge(_t,~At)),r.arraySet(_t.pending_buf,_t.window,Qt,At,_t.pending),_t.pending+=At}(tt,mt,Ht,!0)}s._tr_init=function(tt){Ct||(function(){var mt,Ht,Xt,_t,Qt,At=new Array(w+1);for(_t=Xt=0;_t<u-1;_t++)for(pt[_t]=Xt,mt=0;mt<1<<k[_t];mt++)O[Xt++]=_t;for(O[Xt-1]=_t,_t=Qt=0;_t<16;_t++)for(Dt[_t]=Qt,mt=0;mt<1<<Y[_t];mt++)ht[Qt++]=_t;for(Qt>>=7;_t<g;_t++)for(Dt[_t]=Qt<<7,mt=0;mt<1<<Y[_t]-7;mt++)ht[256+Qt++]=_t;for(Ht=0;Ht<=w;Ht++)At[Ht]=0;for(mt=0;mt<=143;)ut[2*mt+1]=8,mt++,At[8]++;for(;mt<=255;)ut[2*mt+1]=9,mt++,At[9]++;for(;mt<=279;)ut[2*mt+1]=7,mt++,At[7]++;for(;mt<=287;)ut[2*mt+1]=8,mt++,At[8]++;for(Qe(ut,m+1,At),mt=0;mt<g;mt++)Z[2*mt+1]=5,Z[2*mt]=Je(mt,5);Gt=new re(ut,k,f+1,m,w),Ft=new re(Z,Y,0,g,w),oe=new re(new Array(0),K,0,y,T)}(),Ct=!0),tt.l_desc=new yt(tt.dyn_ltree,Gt),tt.d_desc=new yt(tt.dyn_dtree,Ft),tt.bl_desc=new yt(tt.bl_tree,oe),tt.bi_buf=0,tt.bi_valid=0,Te(tt)},s._tr_stored_block=nt,s._tr_flush_block=function(tt,mt,Ht,Xt){var _t,Qt,At=0;0<tt.level?(tt.strm.data_type===2&&(tt.strm.data_type=function(jt){var ve,pi=4093624447;for(ve=0;ve<=31;ve++,pi>>>=1)if(1&pi&&jt.dyn_ltree[2*ve]!==0)return a;if(jt.dyn_ltree[18]!==0||jt.dyn_ltree[20]!==0||jt.dyn_ltree[26]!==0)return o;for(ve=32;ve<f;ve++)if(jt.dyn_ltree[2*ve]!==0)return o;return a}(tt)),gs(tt,tt.l_desc),gs(tt,tt.d_desc),At=function(jt){var ve;for(P(jt,jt.dyn_ltree,jt.l_desc.max_code),P(jt,jt.dyn_dtree,jt.d_desc.max_code),gs(jt,jt.bl_desc),ve=y-1;3<=ve&&jt.bl_tree[2*rt[ve]+1]===0;ve--);return jt.opt_len+=3*(ve+1)+5+5+4,ve}(tt),_t=tt.opt_len+3+7>>>3,(Qt=tt.static_len+3+7>>>3)<=_t&&(_t=Qt)):_t=Qt=Ht+5,Ht+4<=_t&&mt!==-1?nt(tt,mt,Ht,Xt):tt.strategy===4||Qt===_t?(Et(tt,2+(Xt?1:0),3),ms(tt,ut,Z)):(Et(tt,4+(Xt?1:0),3),function(jt,ve,pi,Ye){var wn;for(Et(jt,ve-257,5),Et(jt,pi-1,5),Et(jt,Ye-4,4),wn=0;wn<Ye;wn++)Et(jt,jt.bl_tree[2*rt[wn]+1],3);Ut(jt,jt.dyn_ltree,ve-1),Ut(jt,jt.dyn_dtree,pi-1)}(tt,tt.l_desc.max_code+1,tt.d_desc.max_code+1,At+1),ms(tt,tt.dyn_ltree,tt.dyn_dtree)),Te(tt),Xt&&Xe(tt)},s._tr_tally=function(tt,mt,Ht){return tt.pending_buf[tt.d_buf+2*tt.last_lit]=mt>>>8&255,tt.pending_buf[tt.d_buf+2*tt.last_lit+1]=255&mt,tt.pending_buf[tt.l_buf+tt.last_lit]=255&Ht,tt.last_lit++,mt===0?tt.dyn_ltree[2*Ht]++:(tt.matches++,mt--,tt.dyn_ltree[2*(O[Ht]+f+1)]++,tt.dyn_dtree[2*gt(mt)]++),tt.last_lit===tt.lit_bufsize-1},s._tr_align=function(tt){Et(tt,2,3),Kt(tt,A,ut),function(mt){mt.bi_valid===16?(ge(mt,mt.bi_buf),mt.bi_buf=0,mt.bi_valid=0):8<=mt.bi_valid&&(mt.pending_buf[mt.pending++]=255&mt.bi_buf,mt.bi_buf>>=8,mt.bi_valid-=8)}(tt)}},{"../utils/common":41}],53:[function(e,i,s){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,i,s){(function(r){(function(a,o){if(!a.setImmediate){var h,l,u,f,m=1,g={},y=!1,_=a.document,w=Object.getPrototypeOf&&Object.getPrototypeOf(a);w=w&&w.setTimeout?w:a,h={}.toString.call(a.process)==="[object process]"?function(R){process.nextTick(function(){T(R)})}:function(){if(a.postMessage&&!a.importScripts){var R=!0,I=a.onmessage;return a.onmessage=function(){R=!1},a.postMessage("","*"),a.onmessage=I,R}}()?(f="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",A,!1):a.attachEvent("onmessage",A),function(R){a.postMessage(f+R,"*")}):a.MessageChannel?((u=new MessageChannel).port1.onmessage=function(R){T(R.data)},function(R){u.port2.postMessage(R)}):_&&"onreadystatechange"in _.createElement("script")?(l=_.documentElement,function(R){var I=_.createElement("script");I.onreadystatechange=function(){T(R),I.onreadystatechange=null,l.removeChild(I),I=null},l.appendChild(I)}):function(R){setTimeout(T,0,R)},w.setImmediate=function(R){typeof R!="function"&&(R=new Function(""+R));for(var I=new Array(arguments.length-1),L=0;L<I.length;L++)I[L]=arguments[L+1];var k={callback:R,args:I};return g[m]=k,h(m),m++},w.clearImmediate=M}function M(R){delete g[R]}function T(R){if(y)setTimeout(T,0,R);else{var I=g[R];if(I){y=!0;try{(function(L){var k=L.callback,Y=L.args;switch(Y.length){case 0:k();break;case 1:k(Y[0]);break;case 2:k(Y[0],Y[1]);break;case 3:k(Y[0],Y[1],Y[2]);break;default:k.apply(o,Y)}})(I)}finally{M(R),y=!1}}}}function A(R){R.source===a&&typeof R.data=="string"&&R.data.indexOf(f)===0&&T(+R.data.slice(f.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof wa<"u"?wa:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(EA);const SA=EA.exports;var mm={exports:{}};(function(n,t){(function(e,i){n.exports=i()})(wa,function(){function e(c){c("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),c("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),c("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),c.WGS84=c["EPSG:4326"],c["EPSG:3785"]=c["EPSG:3857"],c.GOOGLE=c["EPSG:3857"],c["EPSG:900913"]=c["EPSG:3857"],c["EPSG:102113"]=c["EPSG:3857"]}var i=1,s=2,r=3,a=4,o=5,h=6378137,l=6356752314e-3,u=.0066943799901413165,f=484813681109536e-20,m=Math.PI/2,g=.16666666666666666,y=.04722222222222222,_=.022156084656084655,w=1e-10,M=.017453292519943295,T=57.29577951308232,A=Math.PI/4,R=Math.PI*2,I=3.14159265359,L={};L.greenwich=0,L.lisbon=-9.131906111111,L.paris=2.337229166667,L.bogota=-74.080916666667,L.madrid=-3.687938888889,L.rome=12.452333333333,L.bern=7.439583333333,L.jakarta=106.807719444444,L.ferro=-17.666666666667,L.brussels=4.367975,L.stockholm=18.058277777778,L.athens=23.7163375,L.oslo=10.722916666667;var k={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},Y=/[\s_\-\/\(\)]/g;function K(c,d){if(c[d])return c[d];for(var p=Object.keys(c),v=d.toLowerCase().replace(Y,""),x=-1,b,E;++x<p.length;)if(b=p[x],E=b.toLowerCase().replace(Y,""),E===v)return c[b]}function rt(c){var d={},p=c.split("+").map(function(S){return S.trim()}).filter(function(S){return S}).reduce(function(S,C){var N=C.split("=");return N.push(!0),S[N[0].toLowerCase()]=N[1],S},{}),v,x,b,E={proj:"projName",datum:"datumCode",rf:function(S){d.rf=parseFloat(S)},lat_0:function(S){d.lat0=S*M},lat_1:function(S){d.lat1=S*M},lat_2:function(S){d.lat2=S*M},lat_ts:function(S){d.lat_ts=S*M},lon_0:function(S){d.long0=S*M},lon_1:function(S){d.long1=S*M},lon_2:function(S){d.long2=S*M},alpha:function(S){d.alpha=parseFloat(S)*M},gamma:function(S){d.rectified_grid_angle=parseFloat(S)},lonc:function(S){d.longc=S*M},x_0:function(S){d.x0=parseFloat(S)},y_0:function(S){d.y0=parseFloat(S)},k_0:function(S){d.k0=parseFloat(S)},k:function(S){d.k0=parseFloat(S)},a:function(S){d.a=parseFloat(S)},b:function(S){d.b=parseFloat(S)},r_a:function(){d.R_A=!0},zone:function(S){d.zone=parseInt(S,10)},south:function(){d.utmSouth=!0},towgs84:function(S){d.datum_params=S.split(",").map(function(C){return parseFloat(C)})},to_meter:function(S){d.to_meter=parseFloat(S)},units:function(S){d.units=S;var C=K(k,S);C&&(d.to_meter=C.to_meter)},from_greenwich:function(S){d.from_greenwich=S*M},pm:function(S){var C=K(L,S);d.from_greenwich=(C||parseFloat(S))*M},nadgrids:function(S){S==="@null"?d.datumCode="none":d.nadgrids=S},axis:function(S){var C="ewnsud";S.length===3&&C.indexOf(S.substr(0,1))!==-1&&C.indexOf(S.substr(1,1))!==-1&&C.indexOf(S.substr(2,1))!==-1&&(d.axis=S)},approx:function(){d.approx=!0}};for(v in p)x=p[v],v in E?(b=E[v],typeof b=="function"?b(x):d[b]=x):d[v]=x;return typeof d.datumCode=="string"&&d.datumCode!=="WGS84"&&(d.datumCode=d.datumCode.toLowerCase()),d}var ut=1,Z=2,ht=3,O=4,pt=5,Gt=-1,Ft=/\s/,oe=/[A-Za-z]/,Dt=/[A-Za-z84_]/,re=/[,\]]/,yt=/[\d\.E\-\+]/;function gt(c){if(typeof c!="string")throw new Error("not a string");this.text=c.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=ut}gt.prototype.readCharicter=function(){var c=this.text[this.place++];if(this.state!==O)for(;Ft.test(c);){if(this.place>=this.text.length)return;c=this.text[this.place++]}switch(this.state){case ut:return this.neutral(c);case Z:return this.keyword(c);case O:return this.quoted(c);case pt:return this.afterquote(c);case ht:return this.number(c);case Gt:return}},gt.prototype.afterquote=function(c){if(c==='"'){this.word+='"',this.state=O;return}if(re.test(c)){this.word=this.word.trim(),this.afterItem(c);return}throw new Error(`havn't handled "`+c+'" in afterquote yet, index '+this.place)},gt.prototype.afterItem=function(c){if(c===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=ut;return}if(c==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=ut,this.currentObject=this.stack.pop(),this.currentObject||(this.state=Gt);return}},gt.prototype.number=function(c){if(yt.test(c)){this.word+=c;return}if(re.test(c)){this.word=parseFloat(this.word),this.afterItem(c);return}throw new Error(`havn't handled "`+c+'" in number yet, index '+this.place)},gt.prototype.quoted=function(c){if(c==='"'){this.state=pt;return}this.word+=c},gt.prototype.keyword=function(c){if(Dt.test(c)){this.word+=c;return}if(c==="["){var d=[];d.push(this.word),this.level++,this.root===null?this.root=d:this.currentObject.push(d),this.stack.push(this.currentObject),this.currentObject=d,this.state=ut;return}if(re.test(c)){this.afterItem(c);return}throw new Error(`havn't handled "`+c+'" in keyword yet, index '+this.place)},gt.prototype.neutral=function(c){if(oe.test(c)){this.word=c,this.state=Z;return}if(c==='"'){this.word="",this.state=O;return}if(yt.test(c)){this.word=c,this.state=ht;return}if(re.test(c)){this.afterItem(c);return}throw new Error(`havn't handled "`+c+'" in neutral yet, index '+this.place)},gt.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===Gt)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function ge(c){var d=new gt(c);return d.output()}function Et(c,d,p){Array.isArray(d)&&(p.unshift(d),d=null);var v=d?{}:c,x=p.reduce(function(b,E){return Kt(E,b),b},v);d&&(c[d]=x)}function Kt(c,d){if(!Array.isArray(c)){d[c]=!0;return}var p=c.shift();if(p==="PARAMETER"&&(p=c.shift()),c.length===1){if(Array.isArray(c[0])){d[p]={},Kt(c[0],d[p]);return}d[p]=c[0];return}if(!c.length){d[p]=!0;return}if(p==="TOWGS84"){d[p]=c;return}if(p==="AXIS"){p in d||(d[p]=[]),d[p].push(c);return}Array.isArray(p)||(d[p]={});var v;switch(p){case"UNIT":case"PRIMEM":case"VERT_DATUM":d[p]={name:c[0].toLowerCase(),convert:c[1]},c.length===3&&Kt(c[2],d[p]);return;case"SPHEROID":case"ELLIPSOID":d[p]={name:c[0],a:c[1],rf:c[2]},c.length===4&&Kt(c[3],d[p]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":c[0]=["name",c[0]],Et(d,p,c);return;default:for(v=-1;++v<c.length;)if(!Array.isArray(c[v]))return Kt(c,d[p]);return Et(d,p,c)}}var Je=.017453292519943295;function Qe(c,d){var p=d[0],v=d[1];!(p in c)&&v in c&&(c[p]=c[v],d.length===3&&(c[p]=d[2](c[p])))}function Te(c){return c*Je}function Xe(c){if(c.type==="GEOGCS"?c.projName="longlat":c.type==="LOCAL_CS"?(c.projName="identity",c.local=!0):typeof c.PROJECTION=="object"?c.projName=Object.keys(c.PROJECTION)[0]:c.projName=c.PROJECTION,c.AXIS){for(var d="",p=0,v=c.AXIS.length;p<v;++p){var x=[c.AXIS[p][0].toLowerCase(),c.AXIS[p][1].toLowerCase()];x[0].indexOf("north")!==-1||(x[0]==="y"||x[0]==="lat")&&x[1]==="north"?d+="n":x[0].indexOf("south")!==-1||(x[0]==="y"||x[0]==="lat")&&x[1]==="south"?d+="s":x[0].indexOf("east")!==-1||(x[0]==="x"||x[0]==="lon")&&x[1]==="east"?d+="e":(x[0].indexOf("west")!==-1||(x[0]==="x"||x[0]==="lon")&&x[1]==="west")&&(d+="w")}d.length===2&&(d+="u"),d.length===3&&(c.axis=d)}c.UNIT&&(c.units=c.UNIT.name.toLowerCase(),c.units==="metre"&&(c.units="meter"),c.UNIT.convert&&(c.type==="GEOGCS"?c.DATUM&&c.DATUM.SPHEROID&&(c.to_meter=c.UNIT.convert*c.DATUM.SPHEROID.a):c.to_meter=c.UNIT.convert));var b=c.GEOGCS;c.type==="GEOGCS"&&(b=c),b&&(b.DATUM?c.datumCode=b.DATUM.name.toLowerCase():c.datumCode=b.name.toLowerCase(),c.datumCode.slice(0,2)==="d_"&&(c.datumCode=c.datumCode.slice(2)),(c.datumCode==="new_zealand_geodetic_datum_1949"||c.datumCode==="new_zealand_1949")&&(c.datumCode="nzgd49"),(c.datumCode==="wgs_1984"||c.datumCode==="world_geodetic_system_1984")&&(c.PROJECTION==="Mercator_Auxiliary_Sphere"&&(c.sphere=!0),c.datumCode="wgs84"),c.datumCode.slice(-6)==="_ferro"&&(c.datumCode=c.datumCode.slice(0,-6)),c.datumCode.slice(-8)==="_jakarta"&&(c.datumCode=c.datumCode.slice(0,-8)),~c.datumCode.indexOf("belge")&&(c.datumCode="rnb72"),b.DATUM&&b.DATUM.SPHEROID&&(c.ellps=b.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),c.ellps.toLowerCase().slice(0,13)==="international"&&(c.ellps="intl"),c.a=b.DATUM.SPHEROID.a,c.rf=parseFloat(b.DATUM.SPHEROID.rf,10)),b.DATUM&&b.DATUM.TOWGS84&&(c.datum_params=b.DATUM.TOWGS84),~c.datumCode.indexOf("osgb_1936")&&(c.datumCode="osgb36"),~c.datumCode.indexOf("osni_1952")&&(c.datumCode="osni52"),(~c.datumCode.indexOf("tm65")||~c.datumCode.indexOf("geodetic_datum_of_1965"))&&(c.datumCode="ire65"),c.datumCode==="ch1903+"&&(c.datumCode="ch1903"),~c.datumCode.indexOf("israel")&&(c.datumCode="isr93")),c.b&&!isFinite(c.b)&&(c.b=c.a);function E(N){var U=c.to_meter||1;return N*U}var S=function(N){return Qe(c,N)},C=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Te],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Te],["x0","false_easting",E],["y0","false_northing",E],["long0","central_meridian",Te],["lat0","latitude_of_origin",Te],["lat0","standard_parallel_1",Te],["lat1","standard_parallel_1",Te],["lat2","standard_parallel_2",Te],["azimuth","Azimuth"],["alpha","azimuth",Te],["srsCode","name"]];C.forEach(S),!c.long0&&c.longc&&(c.projName==="Albers_Conic_Equal_Area"||c.projName==="Lambert_Azimuthal_Equal_Area")&&(c.long0=c.longc),!c.lat_ts&&c.lat1&&(c.projName==="Stereographic_South_Pole"||c.projName==="Polar Stereographic (variant B)")?(c.lat0=Te(c.lat1>0?90:-90),c.lat_ts=c.lat1):!c.lat_ts&&c.lat0&&c.projName==="Polar_Stereographic"&&(c.lat_ts=c.lat0,c.lat0=Te(c.lat0>0?90:-90))}function ti(c){var d=ge(c),p=d.shift(),v=d.shift();d.unshift(["name",v]),d.unshift(["type",p]);var x={};return Kt(d,x),Xe(x),x}function je(c){var d=this;if(arguments.length===2){var p=arguments[1];typeof p=="string"?p.charAt(0)==="+"?je[c]=rt(arguments[1]):je[c]=ti(arguments[1]):je[c]=p}else if(arguments.length===1){if(Array.isArray(c))return c.map(function(v){Array.isArray(v)?je.apply(d,v):je(v)});if(typeof c=="string"){if(c in je)return je[c]}else"EPSG"in c?je["EPSG:"+c.EPSG]=c:"ESRI"in c?je["ESRI:"+c.ESRI]=c:"IAU2000"in c?je["IAU2000:"+c.IAU2000]=c:console.log(c);return}}e(je);function ms(c){return typeof c=="string"}function gs(c){return c in je}var P=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function Ut(c){return P.some(function(d){return c.indexOf(d)>-1})}var Ct=["3857","900913","3785","102113"];function nt(c){var d=K(c,"authority");if(!!d){var p=K(d,"epsg");return p&&Ct.indexOf(p)>-1}}function tt(c){var d=K(c,"extension");if(!!d)return K(d,"proj4")}function mt(c){return c[0]==="+"}function Ht(c){if(ms(c)){if(gs(c))return je[c];if(Ut(c)){var d=ti(c);if(nt(d))return je["EPSG:3857"];var p=tt(d);return p?rt(p):d}if(mt(c))return rt(c)}else return c}function Xt(c,d){c=c||{};var p,v;if(!d)return c;for(v in d)p=d[v],p!==void 0&&(c[v]=p);return c}function _t(c,d,p){var v=c*d;return p/Math.sqrt(1-v*v)}function Qt(c){return c<0?-1:1}function At(c){return Math.abs(c)<=I?c:c-Qt(c)*R}function jt(c,d,p){var v=c*p,x=.5*c;return v=Math.pow((1-v)/(1+v),x),Math.tan(.5*(m-d))/v}function ve(c,d){for(var p=.5*c,v,x,b=m-2*Math.atan(d),E=0;E<=15;E++)if(v=c*Math.sin(b),x=m-2*Math.atan(d*Math.pow((1-v)/(1+v),p))-b,b+=x,Math.abs(x)<=1e-10)return b;return-9999}function pi(){var c=this.b/this.a;this.es=1-c*c,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=_t(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function Ye(c){var d=c.x,p=c.y;if(p*T>90&&p*T<-90&&d*T>180&&d*T<-180)return null;var v,x;if(Math.abs(Math.abs(p)-m)<=w)return null;if(this.sphere)v=this.x0+this.a*this.k0*At(d-this.long0),x=this.y0+this.a*this.k0*Math.log(Math.tan(A+.5*p));else{var b=Math.sin(p),E=jt(this.e,p,b);v=this.x0+this.a*this.k0*At(d-this.long0),x=this.y0-this.a*this.k0*Math.log(E)}return c.x=v,c.y=x,c}function wn(c){var d=c.x-this.x0,p=c.y-this.y0,v,x;if(this.sphere)x=m-2*Math.atan(Math.exp(-p/(this.a*this.k0)));else{var b=Math.exp(-p/(this.a*this.k0));if(x=ve(this.e,b),x===-9999)return null}return v=At(this.long0+d/(this.a*this.k0)),c.x=v,c.y=x,c}var Ga=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"],ys={init:pi,forward:Ye,inverse:wn,names:Ga};function ha(){}function Ni(c){return c}var ko=["longlat","identity"],Ih={init:ha,forward:Ni,inverse:Ni,names:ko},As=[ys,Ih],la={},ca=[];function Nh(c,d){var p=ca.length;return c.names?(ca[p]=c,c.names.forEach(function(v){la[v.toLowerCase()]=p}),this):(console.log(d),!0)}function kh(c){if(!c)return!1;var d=c.toLowerCase();if(typeof la[d]<"u"&&ca[la[d]])return ca[la[d]]}function ua(){As.forEach(Nh)}var js={start:ua,add:Nh,get:kh},Ee={};Ee.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"},Ee.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},Ee.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},Ee.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"},Ee.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"},Ee.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},Ee.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},Ee.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"},Ee.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},Ee.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},Ee.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},Ee.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"},Ee.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},Ee.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"},Ee.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."},Ee.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},Ee.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"},Ee.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},Ee.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},Ee.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"},Ee.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"},Ee.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"},Ee.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"},Ee.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"},Ee.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},Ee.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},Ee.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"},Ee.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"},Ee.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"},Ee.hough={a:6378270,rf:297,ellipseName:"Hough"},Ee.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},Ee.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"},Ee.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"},Ee.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"},Ee.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"},Ee.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},Ee.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},Ee.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"},Ee.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"},Ee.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"},Ee.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"},Ee.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var n0=Ee.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};Ee.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function s0(c,d,p,v){var x=c*c,b=d*d,E=(x-b)/x,S=0;v?(c*=1-E*(g+E*(y+E*_)),x=c*c,E=0):S=Math.sqrt(E);var C=(x-b)/b;return{es:E,e:S,ep2:C}}function Rs(c,d,p,v,x){if(!c){var b=K(Ee,v);b||(b=n0),c=b.a,d=b.b,p=b.rf}return p&&!d&&(d=(1-1/p)*c),(p===0||Math.abs(c-d)<w)&&(x=!0,d=c),{a:c,b:d,rf:p,sphere:x}}var Fi={};Fi.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},Fi.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},Fi.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},Fi.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},Fi.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},Fi.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},Fi.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},Fi.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},Fi.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},Fi.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},Fi.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},Fi.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},Fi.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},Fi.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},Fi.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},Fi.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},Fi.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},Fi.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function Is(c,d,p,v,x,b,E){var S={};return c===void 0||c==="none"?S.datum_type=o:S.datum_type=a,d&&(S.datum_params=d.map(parseFloat),(S.datum_params[0]!==0||S.datum_params[1]!==0||S.datum_params[2]!==0)&&(S.datum_type=i),S.datum_params.length>3&&(S.datum_params[3]!==0||S.datum_params[4]!==0||S.datum_params[5]!==0||S.datum_params[6]!==0)&&(S.datum_type=s,S.datum_params[3]*=f,S.datum_params[4]*=f,S.datum_params[5]*=f,S.datum_params[6]=S.datum_params[6]/1e6+1)),E&&(S.datum_type=r,S.grids=E),S.a=p,S.b=v,S.es=x,S.ep2=b,S}var Zs={};function Ns(c,d){var p=new DataView(d),v=Gn(p),x=Ir(p,v),b=Dk(p,x,v),E={header:x,subgrids:b};return Zs[c]=E,E}function Ar(c){if(c===void 0)return null;var d=c.split(",");return d.map(Rr)}function Rr(c){if(c.length===0)return null;var d=c[0]==="@";return d&&(c=c.slice(1)),c==="null"?{name:"null",mandatory:!d,grid:null,isNull:!0}:{name:c,mandatory:!d,grid:Zs[c]||null,isNull:!1}}function Ii(c){return c/3600*Math.PI/180}function Gn(c){var d=c.getInt32(8,!1);return d===11?!1:(d=c.getInt32(8,!0),d!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function Ir(c,d){return{nFields:c.getInt32(8,d),nSubgridFields:c.getInt32(24,d),nSubgrids:c.getInt32(40,d),shiftType:Ou(c,56,56+8).trim(),fromSemiMajorAxis:c.getFloat64(120,d),fromSemiMinorAxis:c.getFloat64(136,d),toSemiMajorAxis:c.getFloat64(152,d),toSemiMinorAxis:c.getFloat64(168,d)}}function Ou(c,d,p){return String.fromCharCode.apply(null,new Uint8Array(c.buffer.slice(d,p)))}function Dk(c,d,p){for(var v=176,x=[],b=0;b<d.nSubgrids;b++){var E=Bk(c,v,p),S=Uk(c,v,E,p),C=Math.round(1+(E.upperLongitude-E.lowerLongitude)/E.longitudeInterval),N=Math.round(1+(E.upperLatitude-E.lowerLatitude)/E.latitudeInterval);x.push({ll:[Ii(E.lowerLongitude),Ii(E.lowerLatitude)],del:[Ii(E.longitudeInterval),Ii(E.latitudeInterval)],lim:[C,N],count:E.gridNodeCount,cvs:zk(S)}),v+=176+E.gridNodeCount*16}return x}function zk(c){return c.map(function(d){return[Ii(d.longitudeShift),Ii(d.latitudeShift)]})}function Bk(c,d,p){return{name:Ou(c,d+8,d+16).trim(),parent:Ou(c,d+24,d+24+8).trim(),lowerLatitude:c.getFloat64(d+72,p),upperLatitude:c.getFloat64(d+88,p),lowerLongitude:c.getFloat64(d+104,p),upperLongitude:c.getFloat64(d+120,p),latitudeInterval:c.getFloat64(d+136,p),longitudeInterval:c.getFloat64(d+152,p),gridNodeCount:c.getInt32(d+168,p)}}function Uk(c,d,p,v){for(var x=d+176,b=16,E=[],S=0;S<p.gridNodeCount;S++){var C={latitudeShift:c.getFloat32(x+S*b,v),longitudeShift:c.getFloat32(x+S*b+4,v),latitudeAccuracy:c.getFloat32(x+S*b+8,v),longitudeAccuracy:c.getFloat32(x+S*b+12,v)};E.push(C)}return E}function da(c,d){if(!(this instanceof da))return new da(c);d=d||function(N){if(N)throw N};var p=Ht(c);if(typeof p!="object"){d(c);return}var v=da.projections.get(p.projName);if(!v){d(c);return}if(p.datumCode&&p.datumCode!=="none"){var x=K(Fi,p.datumCode);x&&(p.datum_params=p.datum_params||(x.towgs84?x.towgs84.split(","):null),p.ellps=x.ellipse,p.datumName=x.datumName?x.datumName:p.datumCode)}p.k0=p.k0||1,p.axis=p.axis||"enu",p.ellps=p.ellps||"wgs84",p.lat1=p.lat1||p.lat0;var b=Rs(p.a,p.b,p.rf,p.ellps,p.sphere),E=s0(b.a,b.b,b.rf,p.R_A),S=Ar(p.nadgrids),C=p.datum||Is(p.datumCode,p.datum_params,b.a,b.b,E.es,E.ep2,S);Xt(this,p),Xt(this,v),this.a=b.a,this.b=b.b,this.rf=b.rf,this.sphere=b.sphere,this.es=E.es,this.e=E.e,this.ep2=E.ep2,this.datum=C,this.init(),d(null,this)}da.projections=js,da.projections.start();function Gk(c,d){return c.datum_type!==d.datum_type||c.a!==d.a||Math.abs(c.es-d.es)>5e-11?!1:c.datum_type===i?c.datum_params[0]===d.datum_params[0]&&c.datum_params[1]===d.datum_params[1]&&c.datum_params[2]===d.datum_params[2]:c.datum_type===s?c.datum_params[0]===d.datum_params[0]&&c.datum_params[1]===d.datum_params[1]&&c.datum_params[2]===d.datum_params[2]&&c.datum_params[3]===d.datum_params[3]&&c.datum_params[4]===d.datum_params[4]&&c.datum_params[5]===d.datum_params[5]&&c.datum_params[6]===d.datum_params[6]:!0}function w2(c,d,p){var v=c.x,x=c.y,b=c.z?c.z:0,E,S,C,N;if(x<-m&&x>-1.001*m)x=-m;else if(x>m&&x<1.001*m)x=m;else{if(x<-m)return{x:-1/0,y:-1/0,z:c.z};if(x>m)return{x:1/0,y:1/0,z:c.z}}return v>Math.PI&&(v-=2*Math.PI),S=Math.sin(x),N=Math.cos(x),C=S*S,E=p/Math.sqrt(1-d*C),{x:(E+b)*N*Math.cos(v),y:(E+b)*N*Math.sin(v),z:(E*(1-d)+b)*S}}function b2(c,d,p,v){var x=1e-12,b=x*x,E=30,S,C,N,U,z,H,D,q,V,X,j,J,st,dt=c.x,lt=c.y,bt=c.z?c.z:0,It,Vt,Nt;if(S=Math.sqrt(dt*dt+lt*lt),C=Math.sqrt(dt*dt+lt*lt+bt*bt),S/p<x){if(It=0,C/p<x)return Vt=m,Nt=-v,{x:c.x,y:c.y,z:c.z}}else It=Math.atan2(lt,dt);N=bt/C,U=S/C,z=1/Math.sqrt(1-d*(2-d)*U*U),q=U*(1-d)*z,V=N*z,st=0;do st++,D=p/Math.sqrt(1-d*V*V),Nt=S*q+bt*V-D*(1-d*V*V),H=d*D/(D+Nt),z=1/Math.sqrt(1-H*(2-H)*U*U),X=U*(1-H)*z,j=N*z,J=j*q-X*V,q=X,V=j;while(J*J>b&&st<E);return Vt=Math.atan(j/Math.abs(X)),{x:It,y:Vt,z:Nt}}function Vk(c,d,p){if(d===i)return{x:c.x+p[0],y:c.y+p[1],z:c.z+p[2]};if(d===s){var v=p[0],x=p[1],b=p[2],E=p[3],S=p[4],C=p[5],N=p[6];return{x:N*(c.x-C*c.y+S*c.z)+v,y:N*(C*c.x+c.y-E*c.z)+x,z:N*(-S*c.x+E*c.y+c.z)+b}}}function Wk(c,d,p){if(d===i)return{x:c.x-p[0],y:c.y-p[1],z:c.z-p[2]};if(d===s){var v=p[0],x=p[1],b=p[2],E=p[3],S=p[4],C=p[5],N=p[6],U=(c.x-v)/N,z=(c.y-x)/N,H=(c.z-b)/N;return{x:U+C*z-S*H,y:-C*U+z+E*H,z:S*U-E*z+H}}}function r0(c){return c===i||c===s}function $k(c,d,p){if(Gk(c,d)||c.datum_type===o||d.datum_type===o)return p;var v=c.a,x=c.es;if(c.datum_type===r){var b=M2(c,!1,p);if(b!==0)return;v=h,x=u}var E=d.a,S=d.b,C=d.es;if(d.datum_type===r&&(E=h,S=l,C=u),x===C&&v===E&&!r0(c.datum_type)&&!r0(d.datum_type))return p;if(p=w2(p,x,v),r0(c.datum_type)&&(p=Vk(p,c.datum_type,c.datum_params)),r0(d.datum_type)&&(p=Wk(p,d.datum_type,d.datum_params)),p=b2(p,C,E,S),d.datum_type===r){var N=M2(d,!0,p);if(N!==0)return}return p}function M2(c,d,p){if(c.grids===null||c.grids.length===0)return console.log("Grid shift grids not found"),-1;var v={x:-p.x,y:p.y},x={x:Number.NaN,y:Number.NaN},b=[];t:for(var E=0;E<c.grids.length;E++){var S=c.grids[E];if(b.push(S.name),S.isNull){x=v;break}if(S.mandatory,S.grid===null){if(S.mandatory)return console.log("Unable to find mandatory grid '"+S.name+"'"),-1;continue}for(var C=S.grid.subgrids,N=0,U=C.length;N<U;N++){var z=C[N],H=(Math.abs(z.del[1])+Math.abs(z.del[0]))/1e4,D=z.ll[0]-H,q=z.ll[1]-H,V=z.ll[0]+(z.lim[0]-1)*z.del[0]+H,X=z.ll[1]+(z.lim[1]-1)*z.del[1]+H;if(!(q>v.y||D>v.x||X<v.y||V<v.x)&&(x=Yk(v,d,z),!isNaN(x.x)))break t}}return isNaN(x.x)?(console.log("Failed to find a grid shift table for location '"+-v.x*T+" "+v.y*T+" tried: '"+b+"'"),-1):(p.x=-x.x,p.y=x.y,0)}function Yk(c,d,p){var v={x:Number.NaN,y:Number.NaN};if(isNaN(c.x))return v;var x={x:c.x,y:c.y};x.x-=p.ll[0],x.y-=p.ll[1],x.x=At(x.x-Math.PI)+Math.PI;var b=E2(x,p);if(d){if(isNaN(b.x))return v;b.x=x.x-b.x,b.y=x.y-b.y;var E=9,S=1e-12,C,N;do{if(N=E2(b,p),isNaN(N.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}C={x:x.x-(N.x+b.x),y:x.y-(N.y+b.y)},b.x+=C.x,b.y+=C.y}while(E--&&Math.abs(C.x)>S&&Math.abs(C.y)>S);if(E<0)return console.log("Inverse grid shift iterator failed to converge."),v;v.x=At(b.x+p.ll[0]),v.y=b.y+p.ll[1]}else isNaN(b.x)||(v.x=c.x+b.x,v.y=c.y+b.y);return v}function E2(c,d){var p={x:c.x/d.del[0],y:c.y/d.del[1]},v={x:Math.floor(p.x),y:Math.floor(p.y)},x={x:p.x-1*v.x,y:p.y-1*v.y},b={x:Number.NaN,y:Number.NaN},E;if(v.x<0||v.x>=d.lim[0]||v.y<0||v.y>=d.lim[1])return b;E=v.y*d.lim[0]+v.x;var S={x:d.cvs[E][0],y:d.cvs[E][1]};E++;var C={x:d.cvs[E][0],y:d.cvs[E][1]};E+=d.lim[0];var N={x:d.cvs[E][0],y:d.cvs[E][1]};E--;var U={x:d.cvs[E][0],y:d.cvs[E][1]},z=x.x*x.y,H=x.x*(1-x.y),D=(1-x.x)*(1-x.y),q=(1-x.x)*x.y;return b.x=D*S.x+H*C.x+q*U.x+z*N.x,b.y=D*S.y+H*C.y+q*U.y+z*N.y,b}function S2(c,d,p){var v=p.x,x=p.y,b=p.z||0,E,S,C,N={};for(C=0;C<3;C++)if(!(d&&C===2&&p.z===void 0))switch(C===0?(E=v,"ew".indexOf(c.axis[C])!==-1?S="x":S="y"):C===1?(E=x,"ns".indexOf(c.axis[C])!==-1?S="y":S="x"):(E=b,S="z"),c.axis[C]){case"e":N[S]=E;break;case"w":N[S]=-E;break;case"n":N[S]=E;break;case"s":N[S]=-E;break;case"u":p[S]!==void 0&&(N.z=E);break;case"d":p[S]!==void 0&&(N.z=-E);break;default:return null}return N}function T2(c){var d={x:c[0],y:c[1]};return c.length>2&&(d.z=c[2]),c.length>3&&(d.m=c[3]),d}function Hk(c){C2(c.x),C2(c.y)}function C2(c){if(typeof Number.isFinite=="function"){if(Number.isFinite(c))return;throw new TypeError("coordinates must be finite numbers")}if(typeof c!="number"||c!==c||!isFinite(c))throw new TypeError("coordinates must be finite numbers")}function qk(c,d){return(c.datum.datum_type===i||c.datum.datum_type===s||c.datum.datum_type===r)&&d.datumCode!=="WGS84"||(d.datum.datum_type===i||d.datum.datum_type===s||d.datum.datum_type===r)&&c.datumCode!=="WGS84"}function a0(c,d,p,v){var x;Array.isArray(p)?p=T2(p):p={x:p.x,y:p.y,z:p.z,m:p.m};var b=p.z!==void 0;if(Hk(p),c.datum&&d.datum&&qk(c,d)&&(x=new da("WGS84"),p=a0(c,x,p,v),c=x),v&&c.axis!=="enu"&&(p=S2(c,!1,p)),c.projName==="longlat")p={x:p.x*M,y:p.y*M,z:p.z||0};else if(c.to_meter&&(p={x:p.x*c.to_meter,y:p.y*c.to_meter,z:p.z||0}),p=c.inverse(p),!p)return;if(c.from_greenwich&&(p.x+=c.from_greenwich),p=$k(c.datum,d.datum,p),!!p)return d.from_greenwich&&(p={x:p.x-d.from_greenwich,y:p.y,z:p.z||0}),d.projName==="longlat"?p={x:p.x*T,y:p.y*T,z:p.z||0}:(p=d.forward(p),d.to_meter&&(p={x:p.x/d.to_meter,y:p.y/d.to_meter,z:p.z||0})),v&&d.axis!=="enu"?S2(d,!0,p):(p&&!b&&delete p.z,p)}var A2=da("WGS84");function ey(c,d,p,v){var x,b,E;return Array.isArray(p)?(x=a0(c,d,p,v)||{x:NaN,y:NaN},p.length>2?typeof c.name<"u"&&c.name==="geocent"||typeof d.name<"u"&&d.name==="geocent"?typeof x.z=="number"?[x.x,x.y,x.z].concat(p.splice(3)):[x.x,x.y,p[2]].concat(p.splice(3)):[x.x,x.y].concat(p.splice(2)):[x.x,x.y]):(b=a0(c,d,p,v),E=Object.keys(p),E.length===2||E.forEach(function(S){if(typeof c.name<"u"&&c.name==="geocent"||typeof d.name<"u"&&d.name==="geocent"){if(S==="x"||S==="y"||S==="z")return}else if(S==="x"||S==="y")return;b[S]=p[S]}),b)}function R2(c){return c instanceof da?c:c.oProj?c.oProj:da(c)}function _s(c,d,p){c=R2(c);var v=!1,x;return typeof d>"u"?(d=c,c=A2,v=!0):(typeof d.x<"u"||Array.isArray(d))&&(p=d,d=c,c=A2,v=!0),d=R2(d),p?ey(c,d,p):(x={forward:function(b,E){return ey(c,d,b,E)},inverse:function(b,E){return ey(d,c,b,E)}},v&&(x.oProj=d),x)}var I2=6,N2="AJSAJS",k2="AFAFAF",Nl=65,ks=73,rr=79,Pu=86,Fu=90,Xk={forward:L2,inverse:jk,toPoint:O2};function L2(c,d){return d=d||5,Jk(Zk({lat:c[1],lon:c[0]}),d)}function jk(c){var d=ny(D2(c.toUpperCase()));return d.lat&&d.lon?[d.lon,d.lat,d.lon,d.lat]:[d.left,d.bottom,d.right,d.top]}function O2(c){var d=ny(D2(c.toUpperCase()));return d.lat&&d.lon?[d.lon,d.lat]:[(d.left+d.right)/2,(d.top+d.bottom)/2]}function iy(c){return c*(Math.PI/180)}function P2(c){return 180*(c/Math.PI)}function Zk(c){var d=c.lat,p=c.lon,v=6378137,x=.00669438,b=.9996,E,S,C,N,U,z,H,D=iy(d),q=iy(p),V,X;X=Math.floor((p+180)/6)+1,p===180&&(X=60),d>=56&&d<64&&p>=3&&p<12&&(X=32),d>=72&&d<84&&(p>=0&&p<9?X=31:p>=9&&p<21?X=33:p>=21&&p<33?X=35:p>=33&&p<42&&(X=37)),E=(X-1)*6-180+3,V=iy(E),S=x/(1-x),C=v/Math.sqrt(1-x*Math.sin(D)*Math.sin(D)),N=Math.tan(D)*Math.tan(D),U=S*Math.cos(D)*Math.cos(D),z=Math.cos(D)*(q-V),H=v*((1-x/4-3*x*x/64-5*x*x*x/256)*D-(3*x/8+3*x*x/32+45*x*x*x/1024)*Math.sin(2*D)+(15*x*x/256+45*x*x*x/1024)*Math.sin(4*D)-35*x*x*x/3072*Math.sin(6*D));var j=b*C*(z+(1-N+U)*z*z*z/6+(5-18*N+N*N+72*U-58*S)*z*z*z*z*z/120)+5e5,J=b*(H+C*Math.tan(D)*(z*z/2+(5-N+9*U+4*U*U)*z*z*z*z/24+(61-58*N+N*N+600*U-330*S)*z*z*z*z*z*z/720));return d<0&&(J+=1e7),{northing:Math.round(J),easting:Math.round(j),zoneNumber:X,zoneLetter:Kk(d)}}function ny(c){var d=c.northing,p=c.easting,v=c.zoneLetter,x=c.zoneNumber;if(x<0||x>60)return null;var b=.9996,E=6378137,S=.00669438,C,N=(1-Math.sqrt(1-S))/(1+Math.sqrt(1-S)),U,z,H,D,q,V,X,j,J,st=p-5e5,dt=d;v<"N"&&(dt-=1e7),X=(x-1)*6-180+3,C=S/(1-S),V=dt/b,j=V/(E*(1-S/4-3*S*S/64-5*S*S*S/256)),J=j+(3*N/2-27*N*N*N/32)*Math.sin(2*j)+(21*N*N/16-55*N*N*N*N/32)*Math.sin(4*j)+151*N*N*N/96*Math.sin(6*j),U=E/Math.sqrt(1-S*Math.sin(J)*Math.sin(J)),z=Math.tan(J)*Math.tan(J),H=C*Math.cos(J)*Math.cos(J),D=E*(1-S)/Math.pow(1-S*Math.sin(J)*Math.sin(J),1.5),q=st/(U*b);var lt=J-U*Math.tan(J)/D*(q*q/2-(5+3*z+10*H-4*H*H-9*C)*q*q*q*q/24+(61+90*z+298*H+45*z*z-252*C-3*H*H)*q*q*q*q*q*q/720);lt=P2(lt);var bt=(q-(1+2*z+H)*q*q*q/6+(5-2*H+28*z-3*H*H+8*C+24*z*z)*q*q*q*q*q/120)/Math.cos(J);bt=X+P2(bt);var It;if(c.accuracy){var Vt=ny({northing:c.northing+c.accuracy,easting:c.easting+c.accuracy,zoneLetter:c.zoneLetter,zoneNumber:c.zoneNumber});It={top:Vt.lat,right:Vt.lon,bottom:lt,left:bt}}else It={lat:lt,lon:bt};return It}function Kk(c){var d="Z";return 84>=c&&c>=72?d="X":72>c&&c>=64?d="W":64>c&&c>=56?d="V":56>c&&c>=48?d="U":48>c&&c>=40?d="T":40>c&&c>=32?d="S":32>c&&c>=24?d="R":24>c&&c>=16?d="Q":16>c&&c>=8?d="P":8>c&&c>=0?d="N":0>c&&c>=-8?d="M":-8>c&&c>=-16?d="L":-16>c&&c>=-24?d="K":-24>c&&c>=-32?d="J":-32>c&&c>=-40?d="H":-40>c&&c>=-48?d="G":-48>c&&c>=-56?d="F":-56>c&&c>=-64?d="E":-64>c&&c>=-72?d="D":-72>c&&c>=-80&&(d="C"),d}function Jk(c,d){var p="00000"+c.easting,v="00000"+c.northing;return c.zoneNumber+c.zoneLetter+Qk(c.easting,c.northing,c.zoneNumber)+p.substr(p.length-5,d)+v.substr(v.length-5,d)}function Qk(c,d,p){var v=F2(p),x=Math.floor(c/1e5),b=Math.floor(d/1e5)%20;return t5(x,b,v)}function F2(c){var d=c%I2;return d===0&&(d=I2),d}function t5(c,d,p){var v=p-1,x=N2.charCodeAt(v),b=k2.charCodeAt(v),E=x+c-1,S=b+d,C=!1;E>Fu&&(E=E-Fu+Nl-1,C=!0),(E===ks||x<ks&&E>ks||(E>ks||x<ks)&&C)&&E++,(E===rr||x<rr&&E>rr||(E>rr||x<rr)&&C)&&(E++,E===ks&&E++),E>Fu&&(E=E-Fu+Nl-1),S>Pu?(S=S-Pu+Nl-1,C=!0):C=!1,(S===ks||b<ks&&S>ks||(S>ks||b<ks)&&C)&&S++,(S===rr||b<rr&&S>rr||(S>rr||b<rr)&&C)&&(S++,S===ks&&S++),S>Pu&&(S=S-Pu+Nl-1);var N=String.fromCharCode(E)+String.fromCharCode(S);return N}function D2(c){if(c&&c.length===0)throw"MGRSPoint coverting from nothing";for(var d=c.length,p=null,v="",x,b=0;!/[A-Z]/.test(x=c.charAt(b));){if(b>=2)throw"MGRSPoint bad conversion from: "+c;v+=x,b++}var E=parseInt(v,10);if(b===0||b+3>d)throw"MGRSPoint bad conversion from: "+c;var S=c.charAt(b++);if(S<="A"||S==="B"||S==="Y"||S>="Z"||S==="I"||S==="O")throw"MGRSPoint zone letter "+S+" not handled: "+c;p=c.substring(b,b+=2);for(var C=F2(E),N=e5(p.charAt(0),C),U=i5(p.charAt(1),C);U<n5(S);)U+=2e6;var z=d-b;if(z%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+c;var H=z/2,D=0,q=0,V,X,j,J,st;return H>0&&(V=1e5/Math.pow(10,H),X=c.substring(b,b+H),D=parseFloat(X)*V,j=c.substring(b+H),q=parseFloat(j)*V),J=D+N,st=q+U,{easting:J,northing:st,zoneLetter:S,zoneNumber:E,accuracy:V}}function e5(c,d){for(var p=N2.charCodeAt(d-1),v=1e5,x=!1;p!==c.charCodeAt(0);){if(p++,p===ks&&p++,p===rr&&p++,p>Fu){if(x)throw"Bad character: "+c;p=Nl,x=!0}v+=1e5}return v}function i5(c,d){if(c>"V")throw"MGRSPoint given invalid Northing "+c;for(var p=k2.charCodeAt(d-1),v=0,x=!1;p!==c.charCodeAt(0);){if(p++,p===ks&&p++,p===rr&&p++,p>Pu){if(x)throw"Bad character: "+c;p=Nl,x=!0}v+=1e5}return v}function n5(c){var d;switch(c){case"C":d=11e5;break;case"D":d=2e6;break;case"E":d=28e5;break;case"F":d=37e5;break;case"G":d=46e5;break;case"H":d=55e5;break;case"J":d=64e5;break;case"K":d=73e5;break;case"L":d=82e5;break;case"M":d=91e5;break;case"N":d=0;break;case"P":d=8e5;break;case"Q":d=17e5;break;case"R":d=26e5;break;case"S":d=35e5;break;case"T":d=44e5;break;case"U":d=53e5;break;case"V":d=62e5;break;case"W":d=7e6;break;case"X":d=79e5;break;default:d=-1}if(d>=0)return d;throw"Invalid zone letter: "+c}function kl(c,d,p){if(!(this instanceof kl))return new kl(c,d,p);if(Array.isArray(c))this.x=c[0],this.y=c[1],this.z=c[2]||0;else if(typeof c=="object")this.x=c.x,this.y=c.y,this.z=c.z||0;else if(typeof c=="string"&&typeof d>"u"){var v=c.split(",");this.x=parseFloat(v[0],10),this.y=parseFloat(v[1],10),this.z=parseFloat(v[2],10)||0}else this.x=c,this.y=d,this.z=p||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}kl.fromMGRS=function(c){return new kl(O2(c))},kl.prototype.toMGRS=function(c){return L2([this.x,this.y],c)};var s5=1,r5=.25,z2=.046875,B2=.01953125,U2=.01068115234375,a5=.75,o5=.46875,h5=.013020833333333334,l5=.007120768229166667,c5=.3645833333333333,u5=.005696614583333333,d5=.3076171875;function G2(c){var d=[];d[0]=s5-c*(r5+c*(z2+c*(B2+c*U2))),d[1]=c*(a5-c*(z2+c*(B2+c*U2)));var p=c*c;return d[2]=p*(o5-c*(h5+c*l5)),p*=c,d[3]=p*(c5-c*u5),d[4]=p*c*d5,d}function o0(c,d,p,v){return p*=d,d*=d,v[0]*c-p*(v[1]+d*(v[2]+d*(v[3]+d*v[4])))}var f5=20;function V2(c,d,p){for(var v=1/(1-d),x=c,b=f5;b;--b){var E=Math.sin(x),S=1-d*E*E;if(S=(o0(x,E,Math.cos(x),p)-c)*(S*Math.sqrt(S))*v,x-=S,Math.abs(S)<w)return x}return x}function p5(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=G2(this.es),this.ml0=o0(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function m5(c){var d=c.x,p=c.y,v=At(d-this.long0),x,b,E,S=Math.sin(p),C=Math.cos(p);if(this.es){var U=C*v,z=Math.pow(U,2),H=this.ep2*Math.pow(C,2),D=Math.pow(H,2),q=Math.abs(C)>w?Math.tan(p):0,V=Math.pow(q,2),X=Math.pow(V,2);x=1-this.es*Math.pow(S,2),U=U/Math.sqrt(x);var j=o0(p,S,C,this.en);b=this.a*(this.k0*U*(1+z/6*(1-V+H+z/20*(5-18*V+X+14*H-58*V*H+z/42*(61+179*X-X*V-479*V)))))+this.x0,E=this.a*(this.k0*(j-this.ml0+S*v*U/2*(1+z/12*(5-V+9*H+4*D+z/30*(61+X-58*V+270*H-330*V*H+z/56*(1385+543*X-X*V-3111*V))))))+this.y0}else{var N=C*Math.sin(v);if(Math.abs(Math.abs(N)-1)<w)return 93;if(b=.5*this.a*this.k0*Math.log((1+N)/(1-N))+this.x0,E=C*Math.cos(v)/Math.sqrt(1-Math.pow(N,2)),N=Math.abs(E),N>=1){if(N-1>w)return 93;E=0}else E=Math.acos(E);p<0&&(E=-E),E=this.a*this.k0*(E-this.lat0)+this.y0}return c.x=b,c.y=E,c}function g5(c){var d,p,v,x,b=(c.x-this.x0)*(1/this.a),E=(c.y-this.y0)*(1/this.a);if(this.es)if(d=this.ml0+E/this.k0,p=V2(d,this.es,this.en),Math.abs(p)<m){var z=Math.sin(p),H=Math.cos(p),D=Math.abs(H)>w?Math.tan(p):0,q=this.ep2*Math.pow(H,2),V=Math.pow(q,2),X=Math.pow(D,2),j=Math.pow(X,2);d=1-this.es*Math.pow(z,2);var J=b*Math.sqrt(d)/this.k0,st=Math.pow(J,2);d=d*D,v=p-d*st/(1-this.es)*.5*(1-st/12*(5+3*X-9*q*X+q-4*V-st/30*(61+90*X-252*q*X+45*j+46*q-st/56*(1385+3633*X+4095*j+1574*j*X)))),x=At(this.long0+J*(1-st/6*(1+2*X+q-st/20*(5+28*X+24*j+8*q*X+6*q-st/42*(61+662*X+1320*j+720*j*X))))/H)}else v=m*Qt(E),x=0;else{var S=Math.exp(b/this.k0),C=.5*(S-1/S),N=this.lat0+E/this.k0,U=Math.cos(N);d=Math.sqrt((1-Math.pow(U,2))/(1+Math.pow(C,2))),v=Math.asin(d),E<0&&(v=-v),C===0&&U===0?x=0:x=At(Math.atan2(C,U)+this.long0)}return c.x=x,c.y=v,c}var y5=["Fast_Transverse_Mercator","Fast Transverse Mercator"],h0={init:p5,forward:m5,inverse:g5,names:y5};function W2(c){var d=Math.exp(c);return d=(d-1/d)/2,d}function ar(c,d){c=Math.abs(c),d=Math.abs(d);var p=Math.max(c,d),v=Math.min(c,d)/(p||1);return p*Math.sqrt(1+Math.pow(v,2))}function _5(c){var d=1+c,p=d-1;return p===0?c:c*Math.log(d)/p}function x5(c){var d=Math.abs(c);return d=_5(d*(1+d/(ar(1,d)+1))),c<0?-d:d}function sy(c,d){for(var p=2*Math.cos(2*d),v=c.length-1,x=c[v],b=0,E;--v>=0;)E=-b+p*x+c[v],b=x,x=E;return d+E*Math.sin(2*d)}function v5(c,d){for(var p=2*Math.cos(d),v=c.length-1,x=c[v],b=0,E;--v>=0;)E=-b+p*x+c[v],b=x,x=E;return Math.sin(d)*E}function w5(c){var d=Math.exp(c);return d=(d+1/d)/2,d}function $2(c,d,p){for(var v=Math.sin(d),x=Math.cos(d),b=W2(p),E=w5(p),S=2*x*E,C=-2*v*b,N=c.length-1,U=c[N],z=0,H=0,D=0,q,V;--N>=0;)q=H,V=z,H=U,z=D,U=-q+S*H-C*z+c[N],D=-V+C*H+S*z;return S=v*E,C=x*b,[S*U-C*D,S*D+C*U]}function b5(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(h0.init.apply(this),this.forward=h0.forward,this.inverse=h0.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var c=this.es/(1+Math.sqrt(1-this.es)),d=c/(2-c),p=d;this.cgb[0]=d*(2+d*(-2/3+d*(-2+d*(116/45+d*(26/45+d*(-2854/675)))))),this.cbg[0]=d*(-2+d*(2/3+d*(4/3+d*(-82/45+d*(32/45+d*(4642/4725)))))),p=p*d,this.cgb[1]=p*(7/3+d*(-8/5+d*(-227/45+d*(2704/315+d*(2323/945))))),this.cbg[1]=p*(5/3+d*(-16/15+d*(-13/9+d*(904/315+d*(-1522/945))))),p=p*d,this.cgb[2]=p*(56/15+d*(-136/35+d*(-1262/105+d*(73814/2835)))),this.cbg[2]=p*(-26/15+d*(34/21+d*(8/5+d*(-12686/2835)))),p=p*d,this.cgb[3]=p*(4279/630+d*(-332/35+d*(-399572/14175))),this.cbg[3]=p*(1237/630+d*(-12/5+d*(-24832/14175))),p=p*d,this.cgb[4]=p*(4174/315+d*(-144838/6237)),this.cbg[4]=p*(-734/315+d*(109598/31185)),p=p*d,this.cgb[5]=p*(601676/22275),this.cbg[5]=p*(444337/155925),p=Math.pow(d,2),this.Qn=this.k0/(1+d)*(1+p*(1/4+p*(1/64+p/256))),this.utg[0]=d*(-.5+d*(2/3+d*(-37/96+d*(1/360+d*(81/512+d*(-96199/604800)))))),this.gtu[0]=d*(.5+d*(-2/3+d*(5/16+d*(41/180+d*(-127/288+d*(7891/37800)))))),this.utg[1]=p*(-1/48+d*(-1/15+d*(437/1440+d*(-46/105+d*(1118711/3870720))))),this.gtu[1]=p*(13/48+d*(-3/5+d*(557/1440+d*(281/630+d*(-1983433/1935360))))),p=p*d,this.utg[2]=p*(-17/480+d*(37/840+d*(209/4480+d*(-5569/90720)))),this.gtu[2]=p*(61/240+d*(-103/140+d*(15061/26880+d*(167603/181440)))),p=p*d,this.utg[3]=p*(-4397/161280+d*(11/504+d*(830251/7257600))),this.gtu[3]=p*(49561/161280+d*(-179/168+d*(6601661/7257600))),p=p*d,this.utg[4]=p*(-4583/161280+d*(108847/3991680)),this.gtu[4]=p*(34729/80640+d*(-3418889/1995840)),p=p*d,this.utg[5]=p*(-20648693/638668800),this.gtu[5]=p*(212378941/319334400);var v=sy(this.cbg,this.lat0);this.Zb=-this.Qn*(v+v5(this.gtu,2*v))}function M5(c){var d=At(c.x-this.long0),p=c.y;p=sy(this.cbg,p);var v=Math.sin(p),x=Math.cos(p),b=Math.sin(d),E=Math.cos(d);p=Math.atan2(v,E*x),d=Math.atan2(b*x,ar(v,x*E)),d=x5(Math.tan(d));var S=$2(this.gtu,2*p,2*d);p=p+S[0],d=d+S[1];var C,N;return Math.abs(d)<=2.623395162778?(C=this.a*(this.Qn*d)+this.x0,N=this.a*(this.Qn*p+this.Zb)+this.y0):(C=1/0,N=1/0),c.x=C,c.y=N,c}function E5(c){var d=(c.x-this.x0)*(1/this.a),p=(c.y-this.y0)*(1/this.a);p=(p-this.Zb)/this.Qn,d=d/this.Qn;var v,x;if(Math.abs(d)<=2.623395162778){var b=$2(this.utg,2*p,2*d);p=p+b[0],d=d+b[1],d=Math.atan(W2(d));var E=Math.sin(p),S=Math.cos(p),C=Math.sin(d),N=Math.cos(d);p=Math.atan2(E*N,ar(C,N*S)),d=Math.atan2(C,N*S),v=At(d+this.long0),x=sy(this.cgb,p)}else v=1/0,x=1/0;return c.x=v,c.y=x,c}var S5=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"],l0={init:b5,forward:M5,inverse:E5,names:S5};function T5(c,d){if(c===void 0){if(c=Math.floor((At(d)+Math.PI)*30/Math.PI)+1,c<0)return 0;if(c>60)return 60}return c}var C5="etmerc";function A5(){var c=T5(this.zone,this.long0);if(c===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(c)-183)*M,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,l0.init.apply(this),this.forward=l0.forward,this.inverse=l0.inverse}var R5=["Universal Transverse Mercator System","utm"],I5={init:A5,names:R5,dependsOn:C5};function ry(c,d){return Math.pow((1-c)/(1+c),d)}var N5=20;function k5(){var c=Math.sin(this.lat0),d=Math.cos(this.lat0);d*=d,this.rc=Math.sqrt(1-this.es)/(1-this.es*c*c),this.C=Math.sqrt(1+this.es*d*d/(1-this.es)),this.phic0=Math.asin(c/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+A)/(Math.pow(Math.tan(.5*this.lat0+A),this.C)*ry(this.e*c,this.ratexp))}function L5(c){var d=c.x,p=c.y;return c.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*p+A),this.C)*ry(this.e*Math.sin(p),this.ratexp))-m,c.x=this.C*d,c}function O5(c){for(var d=1e-14,p=c.x/this.C,v=c.y,x=Math.pow(Math.tan(.5*v+A)/this.K,1/this.C),b=N5;b>0&&(v=2*Math.atan(x*ry(this.e*Math.sin(c.y),-.5*this.e))-m,!(Math.abs(v-c.y)<d));--b)c.y=v;return b?(c.x=p,c.y=v,c):null}var P5=["gauss"],ay={init:k5,forward:L5,inverse:O5,names:P5};function F5(){ay.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function D5(c){var d,p,v,x;return c.x=At(c.x-this.long0),ay.forward.apply(this,[c]),d=Math.sin(c.y),p=Math.cos(c.y),v=Math.cos(c.x),x=this.k0*this.R2/(1+this.sinc0*d+this.cosc0*p*v),c.x=x*p*Math.sin(c.x),c.y=x*(this.cosc0*d-this.sinc0*p*v),c.x=this.a*c.x+this.x0,c.y=this.a*c.y+this.y0,c}function z5(c){var d,p,v,x,b;if(c.x=(c.x-this.x0)/this.a,c.y=(c.y-this.y0)/this.a,c.x/=this.k0,c.y/=this.k0,b=ar(c.x,c.y)){var E=2*Math.atan2(b,this.R2);d=Math.sin(E),p=Math.cos(E),x=Math.asin(p*this.sinc0+c.y*d*this.cosc0/b),v=Math.atan2(c.x*d,b*this.cosc0*p-c.y*this.sinc0*d)}else x=this.phic0,v=0;return c.x=v,c.y=x,ay.inverse.apply(this,[c]),c.x=At(c.x+this.long0),c}var B5=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"],U5={init:F5,forward:D5,inverse:z5,names:B5};function G5(c,d,p){return d*=p,Math.tan(.5*(m+c))*Math.pow((1-d)/(1+d),.5*p)}function V5(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=w&&(this.k0=.5*(1+Qt(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=w&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=w&&Math.abs(Math.cos(this.lat_ts))>w&&(this.k0=.5*this.cons*_t(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/jt(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=_t(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-m,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function W5(c){var d=c.x,p=c.y,v=Math.sin(p),x=Math.cos(p),b,E,S,C,N,U,z=At(d-this.long0);return Math.abs(Math.abs(d-this.long0)-Math.PI)<=w&&Math.abs(p+this.lat0)<=w?(c.x=NaN,c.y=NaN,c):this.sphere?(b=2*this.k0/(1+this.sinlat0*v+this.coslat0*x*Math.cos(z)),c.x=this.a*b*x*Math.sin(z)+this.x0,c.y=this.a*b*(this.coslat0*v-this.sinlat0*x*Math.cos(z))+this.y0,c):(E=2*Math.atan(this.ssfn_(p,v,this.e))-m,C=Math.cos(E),S=Math.sin(E),Math.abs(this.coslat0)<=w?(N=jt(this.e,p*this.con,this.con*v),U=2*this.a*this.k0*N/this.cons,c.x=this.x0+U*Math.sin(d-this.long0),c.y=this.y0-this.con*U*Math.cos(d-this.long0),c):(Math.abs(this.sinlat0)<w?(b=2*this.a*this.k0/(1+C*Math.cos(z)),c.y=b*S):(b=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*S+this.cosX0*C*Math.cos(z))),c.y=b*(this.cosX0*S-this.sinX0*C*Math.cos(z))+this.y0),c.x=b*C*Math.sin(z)+this.x0,c))}function $5(c){c.x-=this.x0,c.y-=this.y0;var d,p,v,x,b,E=Math.sqrt(c.x*c.x+c.y*c.y);if(this.sphere){var S=2*Math.atan(E/(2*this.a*this.k0));return d=this.long0,p=this.lat0,E<=w?(c.x=d,c.y=p,c):(p=Math.asin(Math.cos(S)*this.sinlat0+c.y*Math.sin(S)*this.coslat0/E),Math.abs(this.coslat0)<w?this.lat0>0?d=At(this.long0+Math.atan2(c.x,-1*c.y)):d=At(this.long0+Math.atan2(c.x,c.y)):d=At(this.long0+Math.atan2(c.x*Math.sin(S),E*this.coslat0*Math.cos(S)-c.y*this.sinlat0*Math.sin(S))),c.x=d,c.y=p,c)}else if(Math.abs(this.coslat0)<=w){if(E<=w)return p=this.lat0,d=this.long0,c.x=d,c.y=p,c;c.x*=this.con,c.y*=this.con,v=E*this.cons/(2*this.a*this.k0),p=this.con*ve(this.e,v),d=this.con*At(this.con*this.long0+Math.atan2(c.x,-1*c.y))}else x=2*Math.atan(E*this.cosX0/(2*this.a*this.k0*this.ms1)),d=this.long0,E<=w?b=this.X0:(b=Math.asin(Math.cos(x)*this.sinX0+c.y*Math.sin(x)*this.cosX0/E),d=At(this.long0+Math.atan2(c.x*Math.sin(x),E*this.cosX0*Math.cos(x)-c.y*this.sinX0*Math.sin(x)))),p=-1*ve(this.e,Math.tan(.5*(m+b)));return c.x=d,c.y=p,c}var Y5=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"],H5={init:V5,forward:W5,inverse:$5,names:Y5,ssfn_:G5};function q5(){var c=this.lat0;this.lambda0=this.long0;var d=Math.sin(c),p=this.a,v=this.rf,x=1/v,b=2*x-Math.pow(x,2),E=this.e=Math.sqrt(b);this.R=this.k0*p*Math.sqrt(1-b)/(1-b*Math.pow(d,2)),this.alpha=Math.sqrt(1+b/(1-b)*Math.pow(Math.cos(c),4)),this.b0=Math.asin(d/this.alpha);var S=Math.log(Math.tan(Math.PI/4+this.b0/2)),C=Math.log(Math.tan(Math.PI/4+c/2)),N=Math.log((1+E*d)/(1-E*d));this.K=S-this.alpha*C+this.alpha*E/2*N}function X5(c){var d=Math.log(Math.tan(Math.PI/4-c.y/2)),p=this.e/2*Math.log((1+this.e*Math.sin(c.y))/(1-this.e*Math.sin(c.y))),v=-this.alpha*(d+p)+this.K,x=2*(Math.atan(Math.exp(v))-Math.PI/4),b=this.alpha*(c.x-this.lambda0),E=Math.atan(Math.sin(b)/(Math.sin(this.b0)*Math.tan(x)+Math.cos(this.b0)*Math.cos(b))),S=Math.asin(Math.cos(this.b0)*Math.sin(x)-Math.sin(this.b0)*Math.cos(x)*Math.cos(b));return c.y=this.R/2*Math.log((1+Math.sin(S))/(1-Math.sin(S)))+this.y0,c.x=this.R*E+this.x0,c}function j5(c){for(var d=c.x-this.x0,p=c.y-this.y0,v=d/this.R,x=2*(Math.atan(Math.exp(p/this.R))-Math.PI/4),b=Math.asin(Math.cos(this.b0)*Math.sin(x)+Math.sin(this.b0)*Math.cos(x)*Math.cos(v)),E=Math.atan(Math.sin(v)/(Math.cos(this.b0)*Math.cos(v)-Math.sin(this.b0)*Math.tan(x))),S=this.lambda0+E/this.alpha,C=0,N=b,U=-1e3,z=0;Math.abs(N-U)>1e-7;){if(++z>20)return;C=1/this.alpha*(Math.log(Math.tan(Math.PI/4+b/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(N))/2)),U=N,N=2*Math.atan(Math.exp(C))-Math.PI/2}return c.x=S,c.y=N,c}var Z5=["somerc"],K5={init:q5,forward:X5,inverse:j5,names:Z5},Ll=1e-7;function J5(c){var d=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],p=typeof c.PROJECTION=="object"?Object.keys(c.PROJECTION)[0]:c.PROJECTION;return"no_uoff"in c||"no_off"in c||d.indexOf(p)!==-1}function Q5(){var c,d,p,v,x,b,E,S,C,N,U=0,z,H=0,D=0,q=0,V=0,X=0,j=0;this.no_off=J5(this),this.no_rot="no_rot"in this;var J=!1;"alpha"in this&&(J=!0);var st=!1;if("rectified_grid_angle"in this&&(st=!0),J&&(j=this.alpha),st&&(U=this.rectified_grid_angle*M),J||st)H=this.longc;else if(D=this.long1,V=this.lat1,q=this.long2,X=this.lat2,Math.abs(V-X)<=Ll||(c=Math.abs(V))<=Ll||Math.abs(c-m)<=Ll||Math.abs(Math.abs(this.lat0)-m)<=Ll||Math.abs(Math.abs(X)-m)<=Ll)throw new Error;var dt=1-this.es;d=Math.sqrt(dt),Math.abs(this.lat0)>w?(S=Math.sin(this.lat0),p=Math.cos(this.lat0),c=1-this.es*S*S,this.B=p*p,this.B=Math.sqrt(1+this.es*this.B*this.B/dt),this.A=this.B*this.k0*d/c,v=this.B*d/(p*Math.sqrt(c)),x=v*v-1,x<=0?x=0:(x=Math.sqrt(x),this.lat0<0&&(x=-x)),this.E=x+=v,this.E*=Math.pow(jt(this.e,this.lat0,S),this.B)):(this.B=1/d,this.A=this.k0,this.E=v=x=1),J||st?(J?(z=Math.asin(Math.sin(j)/v),st||(U=j)):(z=U,j=Math.asin(v*Math.sin(z))),this.lam0=H-Math.asin(.5*(x-1/x)*Math.tan(z))/this.B):(b=Math.pow(jt(this.e,V,Math.sin(V)),this.B),E=Math.pow(jt(this.e,X,Math.sin(X)),this.B),x=this.E/b,C=(E-b)/(E+b),N=this.E*this.E,N=(N-E*b)/(N+E*b),c=D-q,c<-Math.pi?q-=R:c>Math.pi&&(q+=R),this.lam0=At(.5*(D+q)-Math.atan(N*Math.tan(.5*this.B*(D-q))/C)/this.B),z=Math.atan(2*Math.sin(this.B*At(D-this.lam0))/(x-1/x)),U=j=Math.asin(v*Math.sin(z))),this.singam=Math.sin(z),this.cosgam=Math.cos(z),this.sinrot=Math.sin(U),this.cosrot=Math.cos(U),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(v*v-1)/Math.cos(j))),this.lat0<0&&(this.u_0=-this.u_0)),x=.5*z,this.v_pole_n=this.ArB*Math.log(Math.tan(A-x)),this.v_pole_s=this.ArB*Math.log(Math.tan(A+x))}function tL(c){var d={},p,v,x,b,E,S,C,N;if(c.x=c.x-this.lam0,Math.abs(Math.abs(c.y)-m)>w){if(E=this.E/Math.pow(jt(this.e,c.y,Math.sin(c.y)),this.B),S=1/E,p=.5*(E-S),v=.5*(E+S),b=Math.sin(this.B*c.x),x=(p*this.singam-b*this.cosgam)/v,Math.abs(Math.abs(x)-1)<w)throw new Error;N=.5*this.ArB*Math.log((1-x)/(1+x)),S=Math.cos(this.B*c.x),Math.abs(S)<Ll?C=this.A*c.x:C=this.ArB*Math.atan2(p*this.cosgam+b*this.singam,S)}else N=c.y>0?this.v_pole_n:this.v_pole_s,C=this.ArB*c.y;return this.no_rot?(d.x=C,d.y=N):(C-=this.u_0,d.x=N*this.cosrot+C*this.sinrot,d.y=C*this.cosrot-N*this.sinrot),d.x=this.a*d.x+this.x0,d.y=this.a*d.y+this.y0,d}function eL(c){var d,p,v,x,b,E,S,C={};if(c.x=(c.x-this.x0)*(1/this.a),c.y=(c.y-this.y0)*(1/this.a),this.no_rot?(p=c.y,d=c.x):(p=c.x*this.cosrot-c.y*this.sinrot,d=c.y*this.cosrot+c.x*this.sinrot+this.u_0),v=Math.exp(-this.BrA*p),x=.5*(v-1/v),b=.5*(v+1/v),E=Math.sin(this.BrA*d),S=(E*this.cosgam+x*this.singam)/b,Math.abs(Math.abs(S)-1)<w)C.x=0,C.y=S<0?-m:m;else{if(C.y=this.E/Math.sqrt((1+S)/(1-S)),C.y=ve(this.e,Math.pow(C.y,1/this.B)),C.y===1/0)throw new Error;C.x=-this.rB*Math.atan2(x*this.cosgam-E*this.singam,Math.cos(this.BrA*d))}return C.x+=this.lam0,C}var iL=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"],nL={init:Q5,forward:tL,inverse:eL,names:iL};function sL(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<w)){var c=this.b/this.a;this.e=Math.sqrt(1-c*c);var d=Math.sin(this.lat1),p=Math.cos(this.lat1),v=_t(this.e,d,p),x=jt(this.e,this.lat1,d),b=Math.sin(this.lat2),E=Math.cos(this.lat2),S=_t(this.e,b,E),C=jt(this.e,this.lat2,b),N=jt(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>w?this.ns=Math.log(v/S)/Math.log(x/C):this.ns=d,isNaN(this.ns)&&(this.ns=d),this.f0=v/(this.ns*Math.pow(x,this.ns)),this.rh=this.a*this.f0*Math.pow(N,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function rL(c){var d=c.x,p=c.y;Math.abs(2*Math.abs(p)-Math.PI)<=w&&(p=Qt(p)*(m-2*w));var v=Math.abs(Math.abs(p)-m),x,b;if(v>w)x=jt(this.e,p,Math.sin(p)),b=this.a*this.f0*Math.pow(x,this.ns);else{if(v=p*this.ns,v<=0)return null;b=0}var E=this.ns*At(d-this.long0);return c.x=this.k0*(b*Math.sin(E))+this.x0,c.y=this.k0*(this.rh-b*Math.cos(E))+this.y0,c}function aL(c){var d,p,v,x,b,E=(c.x-this.x0)/this.k0,S=this.rh-(c.y-this.y0)/this.k0;this.ns>0?(d=Math.sqrt(E*E+S*S),p=1):(d=-Math.sqrt(E*E+S*S),p=-1);var C=0;if(d!==0&&(C=Math.atan2(p*E,p*S)),d!==0||this.ns>0){if(p=1/this.ns,v=Math.pow(d/(this.a*this.f0),p),x=ve(this.e,v),x===-9999)return null}else x=-m;return b=At(C/this.ns+this.long0),c.x=b,c.y=x,c}var oL=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"],hL={init:sL,forward:rL,inverse:aL,names:oL};function lL(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function cL(c){var d,p,v,x,b,E,S,C=c.x,N=c.y,U=At(C-this.long0);return d=Math.pow((1+this.e*Math.sin(N))/(1-this.e*Math.sin(N)),this.alfa*this.e/2),p=2*(Math.atan(this.k*Math.pow(Math.tan(N/2+this.s45),this.alfa)/d)-this.s45),v=-U*this.alfa,x=Math.asin(Math.cos(this.ad)*Math.sin(p)+Math.sin(this.ad)*Math.cos(p)*Math.cos(v)),b=Math.asin(Math.cos(p)*Math.sin(v)/Math.cos(x)),E=this.n*b,S=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(x/2+this.s45),this.n),c.y=S*Math.cos(E)/1,c.x=S*Math.sin(E)/1,this.czech||(c.y*=-1,c.x*=-1),c}function uL(c){var d,p,v,x,b,E,S,C,N=c.x;c.x=c.y,c.y=N,this.czech||(c.y*=-1,c.x*=-1),E=Math.sqrt(c.x*c.x+c.y*c.y),b=Math.atan2(c.y,c.x),x=b/Math.sin(this.s0),v=2*(Math.atan(Math.pow(this.ro0/E,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),d=Math.asin(Math.cos(this.ad)*Math.sin(v)-Math.sin(this.ad)*Math.cos(v)*Math.cos(x)),p=Math.asin(Math.cos(v)*Math.sin(x)/Math.cos(d)),c.x=this.long0-p/this.alfa,S=d,C=0;var U=0;do c.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(d/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(S))/(1-this.e*Math.sin(S)),this.e/2))-this.s45),Math.abs(S-c.y)<1e-10&&(C=1),S=c.y,U+=1;while(C===0&&U<15);return U>=15?null:c}var dL=["Krovak","krovak"],fL={init:lL,forward:cL,inverse:uL,names:dL};function xs(c,d,p,v,x){return c*x-d*Math.sin(2*x)+p*Math.sin(4*x)-v*Math.sin(6*x)}function Du(c){return 1-.25*c*(1+c/16*(3+1.25*c))}function zu(c){return .375*c*(1+.25*c*(1+.46875*c))}function Bu(c){return .05859375*c*c*(1+.75*c)}function Uu(c){return c*c*c*(35/3072)}function Ol(c,d,p){var v=d*p;return c/Math.sqrt(1-v*v)}function Pl(c){return Math.abs(c)<m?c:c-Qt(c)*Math.PI}function c0(c,d,p,v,x){var b,E;b=c/d;for(var S=0;S<15;S++)if(E=(c-(d*b-p*Math.sin(2*b)+v*Math.sin(4*b)-x*Math.sin(6*b)))/(d-2*p*Math.cos(2*b)+4*v*Math.cos(4*b)-6*x*Math.cos(6*b)),b+=E,Math.abs(E)<=1e-10)return b;return NaN}function pL(){this.sphere||(this.e0=Du(this.es),this.e1=zu(this.es),this.e2=Bu(this.es),this.e3=Uu(this.es),this.ml0=this.a*xs(this.e0,this.e1,this.e2,this.e3,this.lat0))}function mL(c){var d,p,v=c.x,x=c.y;if(v=At(v-this.long0),this.sphere)d=this.a*Math.asin(Math.cos(x)*Math.sin(v)),p=this.a*(Math.atan2(Math.tan(x),Math.cos(v))-this.lat0);else{var b=Math.sin(x),E=Math.cos(x),S=Ol(this.a,this.e,b),C=Math.tan(x)*Math.tan(x),N=v*Math.cos(x),U=N*N,z=this.es*E*E/(1-this.es),H=this.a*xs(this.e0,this.e1,this.e2,this.e3,x);d=S*N*(1-U*C*(1/6-(8-C+8*z)*U/120)),p=H-this.ml0+S*b/E*U*(.5+(5-C+6*z)*U/24)}return c.x=d+this.x0,c.y=p+this.y0,c}function gL(c){c.x-=this.x0,c.y-=this.y0;var d=c.x/this.a,p=c.y/this.a,v,x;if(this.sphere){var b=p+this.lat0;v=Math.asin(Math.sin(b)*Math.cos(d)),x=Math.atan2(Math.tan(d),Math.cos(b))}else{var E=this.ml0/this.a+p,S=c0(E,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(S)-m)<=w)return c.x=this.long0,c.y=m,p<0&&(c.y*=-1),c;var C=Ol(this.a,this.e,Math.sin(S)),N=C*C*C/this.a/this.a*(1-this.es),U=Math.pow(Math.tan(S),2),z=d*this.a/C,H=z*z;v=S-C*Math.tan(S)/N*z*z*(.5-(1+3*U)*z*z/24),x=z*(1-H*(U/3+(1+3*U)*U*H/15))/Math.cos(S)}return c.x=At(x+this.long0),c.y=Pl(v),c}var yL=["Cassini","Cassini_Soldner","cass"],_L={init:pL,forward:mL,inverse:gL,names:yL};function Lo(c,d){var p;return c>1e-7?(p=c*d,(1-c*c)*(d/(1-p*p)-.5/c*Math.log((1-p)/(1+p)))):2*d}var xL=1,vL=2,wL=3,bL=4;function ML(){var c=Math.abs(this.lat0);if(Math.abs(c-m)<w?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(c)<w?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var d;switch(this.qp=Lo(this.e,1),this.mmf=.5/(1-this.es),this.apa=kL(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),d=Math.sin(this.lat0),this.sinb1=Lo(this.e,d)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*d*d)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function EL(c){var d,p,v,x,b,E,S,C,N,U,z=c.x,H=c.y;if(z=At(z-this.long0),this.sphere){if(b=Math.sin(H),U=Math.cos(H),v=Math.cos(z),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(p=this.mode===this.EQUIT?1+U*v:1+this.sinph0*b+this.cosph0*U*v,p<=w)return null;p=Math.sqrt(2/p),d=p*U*Math.sin(z),p*=this.mode===this.EQUIT?b:this.cosph0*b-this.sinph0*U*v}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(v=-v),Math.abs(H+this.lat0)<w)return null;p=A-H*.5,p=2*(this.mode===this.S_POLE?Math.cos(p):Math.sin(p)),d=p*Math.sin(z),p*=v}}else{switch(S=0,C=0,N=0,v=Math.cos(z),x=Math.sin(z),b=Math.sin(H),E=Lo(this.e,b),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(S=E/this.qp,C=Math.sqrt(1-S*S)),this.mode){case this.OBLIQ:N=1+this.sinb1*S+this.cosb1*C*v;break;case this.EQUIT:N=1+C*v;break;case this.N_POLE:N=m+H,E=this.qp-E;break;case this.S_POLE:N=H-m,E=this.qp+E;break}if(Math.abs(N)<w)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:N=Math.sqrt(2/N),this.mode===this.OBLIQ?p=this.ymf*N*(this.cosb1*S-this.sinb1*C*v):p=(N=Math.sqrt(2/(1+C*v)))*S*this.ymf,d=this.xmf*N*C*x;break;case this.N_POLE:case this.S_POLE:E>=0?(d=(N=Math.sqrt(E))*x,p=v*(this.mode===this.S_POLE?N:-N)):d=p=0;break}}return c.x=this.a*d+this.x0,c.y=this.a*p+this.y0,c}function SL(c){c.x-=this.x0,c.y-=this.y0;var d=c.x/this.a,p=c.y/this.a,v,x,b,E,S,C,N;if(this.sphere){var U=0,z,H=0;if(z=Math.sqrt(d*d+p*p),x=z*.5,x>1)return null;switch(x=2*Math.asin(x),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(H=Math.sin(x),U=Math.cos(x)),this.mode){case this.EQUIT:x=Math.abs(z)<=w?0:Math.asin(p*H/z),d*=H,p=U*z;break;case this.OBLIQ:x=Math.abs(z)<=w?this.lat0:Math.asin(U*this.sinph0+p*H*this.cosph0/z),d*=H*this.cosph0,p=(U-Math.sin(x)*this.sinph0)*z;break;case this.N_POLE:p=-p,x=m-x;break;case this.S_POLE:x-=m;break}v=p===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(d,p)}else{if(N=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(d/=this.dd,p*=this.dd,C=Math.sqrt(d*d+p*p),C<w)return c.x=this.long0,c.y=this.lat0,c;E=2*Math.asin(.5*C/this.rq),b=Math.cos(E),d*=E=Math.sin(E),this.mode===this.OBLIQ?(N=b*this.sinb1+p*E*this.cosb1/C,S=this.qp*N,p=C*this.cosb1*b-p*this.sinb1*E):(N=p*E/C,S=this.qp*N,p=C*b)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(p=-p),S=d*d+p*p,!S)return c.x=this.long0,c.y=this.lat0,c;N=1-S/this.qp,this.mode===this.S_POLE&&(N=-N)}v=Math.atan2(d,p),x=LL(Math.asin(N),this.apa)}return c.x=At(this.long0+v),c.y=x,c}var TL=.3333333333333333,CL=.17222222222222222,AL=.10257936507936508,RL=.06388888888888888,IL=.0664021164021164,NL=.016415012942191543;function kL(c){var d,p=[];return p[0]=c*TL,d=c*c,p[0]+=d*CL,p[1]=d*RL,d*=c,p[0]+=d*AL,p[1]+=d*IL,p[2]=d*NL,p}function LL(c,d){var p=c+c;return c+d[0]*Math.sin(p)+d[1]*Math.sin(p+p)+d[2]*Math.sin(p+p+p)}var OL=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],PL={init:ML,forward:EL,inverse:SL,names:OL,S_POLE:xL,N_POLE:vL,EQUIT:wL,OBLIQ:bL};function Oo(c){return Math.abs(c)>1&&(c=c>1?1:-1),Math.asin(c)}function FL(){Math.abs(this.lat1+this.lat2)<w||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=_t(this.e3,this.sin_po,this.cos_po),this.qs1=Lo(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=_t(this.e3,this.sin_po,this.cos_po),this.qs2=Lo(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Lo(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>w?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function DL(c){var d=c.x,p=c.y;this.sin_phi=Math.sin(p),this.cos_phi=Math.cos(p);var v=Lo(this.e3,this.sin_phi),x=this.a*Math.sqrt(this.c-this.ns0*v)/this.ns0,b=this.ns0*At(d-this.long0),E=x*Math.sin(b)+this.x0,S=this.rh-x*Math.cos(b)+this.y0;return c.x=E,c.y=S,c}function zL(c){var d,p,v,x,b,E;return c.x-=this.x0,c.y=this.rh-c.y+this.y0,this.ns0>=0?(d=Math.sqrt(c.x*c.x+c.y*c.y),v=1):(d=-Math.sqrt(c.x*c.x+c.y*c.y),v=-1),x=0,d!==0&&(x=Math.atan2(v*c.x,v*c.y)),v=d*this.ns0/this.a,this.sphere?E=Math.asin((this.c-v*v)/(2*this.ns0)):(p=(this.c-v*v)/this.ns0,E=this.phi1z(this.e3,p)),b=At(x/this.ns0+this.long0),c.x=b,c.y=E,c}function BL(c,d){var p,v,x,b,E,S=Oo(.5*d);if(c<w)return S;for(var C=c*c,N=1;N<=25;N++)if(p=Math.sin(S),v=Math.cos(S),x=c*p,b=1-x*x,E=.5*b*b/v*(d/(1-C)-p/b+.5/c*Math.log((1-x)/(1+x))),S=S+E,Math.abs(E)<=1e-7)return S;return null}var UL=["Albers_Conic_Equal_Area","Albers","aea"],GL={init:FL,forward:DL,inverse:zL,names:UL,phi1z:BL};function VL(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function WL(c){var d,p,v,x,b,E,S,C,N=c.x,U=c.y;return v=At(N-this.long0),d=Math.sin(U),p=Math.cos(U),x=Math.cos(v),E=this.sin_p14*d+this.cos_p14*p*x,b=1,E>0||Math.abs(E)<=w?(S=this.x0+this.a*b*p*Math.sin(v)/E,C=this.y0+this.a*b*(this.cos_p14*d-this.sin_p14*p*x)/E):(S=this.x0+this.infinity_dist*p*Math.sin(v),C=this.y0+this.infinity_dist*(this.cos_p14*d-this.sin_p14*p*x)),c.x=S,c.y=C,c}function $L(c){var d,p,v,x,b,E;return c.x=(c.x-this.x0)/this.a,c.y=(c.y-this.y0)/this.a,c.x/=this.k0,c.y/=this.k0,(d=Math.sqrt(c.x*c.x+c.y*c.y))?(x=Math.atan2(d,this.rc),p=Math.sin(x),v=Math.cos(x),E=Oo(v*this.sin_p14+c.y*p*this.cos_p14/d),b=Math.atan2(c.x*p,d*this.cos_p14*v-c.y*this.sin_p14*p),b=At(this.long0+b)):(E=this.phic0,b=0),c.x=b,c.y=E,c}var YL=["gnom"],HL={init:VL,forward:WL,inverse:$L,names:YL};function qL(c,d){var p=1-(1-c*c)/(2*c)*Math.log((1-c)/(1+c));if(Math.abs(Math.abs(d)-p)<1e-6)return d<0?-1*m:m;for(var v=Math.asin(.5*d),x,b,E,S,C=0;C<30;C++)if(b=Math.sin(v),E=Math.cos(v),S=c*b,x=Math.pow(1-S*S,2)/(2*E)*(d/(1-c*c)-b/(1-S*S)+.5/c*Math.log((1-S)/(1+S))),v+=x,Math.abs(x)<=1e-10)return v;return NaN}function XL(){this.sphere||(this.k0=_t(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function jL(c){var d=c.x,p=c.y,v,x,b=At(d-this.long0);if(this.sphere)v=this.x0+this.a*b*Math.cos(this.lat_ts),x=this.y0+this.a*Math.sin(p)/Math.cos(this.lat_ts);else{var E=Lo(this.e,Math.sin(p));v=this.x0+this.a*this.k0*b,x=this.y0+this.a*E*.5/this.k0}return c.x=v,c.y=x,c}function ZL(c){c.x-=this.x0,c.y-=this.y0;var d,p;return this.sphere?(d=At(this.long0+c.x/this.a/Math.cos(this.lat_ts)),p=Math.asin(c.y/this.a*Math.cos(this.lat_ts))):(p=qL(this.e,2*c.y*this.k0/this.a),d=At(this.long0+c.x/(this.a*this.k0))),c.x=d,c.y=p,c}var KL=["cea"],JL={init:XL,forward:jL,inverse:ZL,names:KL};function QL(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function tO(c){var d=c.x,p=c.y,v=At(d-this.long0),x=Pl(p-this.lat0);return c.x=this.x0+this.a*v*this.rc,c.y=this.y0+this.a*x,c}function eO(c){var d=c.x,p=c.y;return c.x=At(this.long0+(d-this.x0)/(this.a*this.rc)),c.y=Pl(this.lat0+(p-this.y0)/this.a),c}var iO=["Equirectangular","Equidistant_Cylindrical","eqc"],nO={init:QL,forward:tO,inverse:eO,names:iO},Y2=20;function sO(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Du(this.es),this.e1=zu(this.es),this.e2=Bu(this.es),this.e3=Uu(this.es),this.ml0=this.a*xs(this.e0,this.e1,this.e2,this.e3,this.lat0)}function rO(c){var d=c.x,p=c.y,v,x,b,E=At(d-this.long0);if(b=E*Math.sin(p),this.sphere)Math.abs(p)<=w?(v=this.a*E,x=-1*this.a*this.lat0):(v=this.a*Math.sin(b)/Math.tan(p),x=this.a*(Pl(p-this.lat0)+(1-Math.cos(b))/Math.tan(p)));else if(Math.abs(p)<=w)v=this.a*E,x=-1*this.ml0;else{var S=Ol(this.a,this.e,Math.sin(p))/Math.tan(p);v=S*Math.sin(b),x=this.a*xs(this.e0,this.e1,this.e2,this.e3,p)-this.ml0+S*(1-Math.cos(b))}return c.x=v+this.x0,c.y=x+this.y0,c}function aO(c){var d,p,v,x,b,E,S,C,N;if(v=c.x-this.x0,x=c.y-this.y0,this.sphere)if(Math.abs(x+this.a*this.lat0)<=w)d=At(v/this.a+this.long0),p=0;else{E=this.lat0+x/this.a,S=v*v/this.a/this.a+E*E,C=E;var U;for(b=Y2;b;--b)if(U=Math.tan(C),N=-1*(E*(C*U+1)-C-.5*(C*C+S)*U)/((C-E)/U-1),C+=N,Math.abs(N)<=w){p=C;break}d=At(this.long0+Math.asin(v*Math.tan(C)/this.a)/Math.sin(p))}else if(Math.abs(x+this.ml0)<=w)p=0,d=At(this.long0+v/this.a);else{E=(this.ml0+x)/this.a,S=v*v/this.a/this.a+E*E,C=E;var z,H,D,q,V;for(b=Y2;b;--b)if(V=this.e*Math.sin(C),z=Math.sqrt(1-V*V)*Math.tan(C),H=this.a*xs(this.e0,this.e1,this.e2,this.e3,C),D=this.e0-2*this.e1*Math.cos(2*C)+4*this.e2*Math.cos(4*C)-6*this.e3*Math.cos(6*C),q=H/this.a,N=(E*(z*q+1)-q-.5*z*(q*q+S))/(this.es*Math.sin(2*C)*(q*q+S-2*E*q)/(4*z)+(E-q)*(z*D-2/Math.sin(2*C))-D),C-=N,Math.abs(N)<=w){p=C;break}z=Math.sqrt(1-this.es*Math.pow(Math.sin(p),2))*Math.tan(p),d=At(this.long0+Math.asin(v*z/this.a)/Math.sin(p))}return c.x=d,c.y=p,c}var oO=["Polyconic","poly"],hO={init:sO,forward:rO,inverse:aO,names:oO};function lO(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function cO(c){var d,p=c.x,v=c.y,x=v-this.lat0,b=p-this.long0,E=x/f*1e-5,S=b,C=1,N=0;for(d=1;d<=10;d++)C=C*E,N=N+this.A[d]*C;var U=N,z=S,H=1,D=0,q,V,X=0,j=0;for(d=1;d<=6;d++)q=H*U-D*z,V=D*U+H*z,H=q,D=V,X=X+this.B_re[d]*H-this.B_im[d]*D,j=j+this.B_im[d]*H+this.B_re[d]*D;return c.x=j*this.a+this.x0,c.y=X*this.a+this.y0,c}function uO(c){var d,p=c.x,v=c.y,x=p-this.x0,b=v-this.y0,E=b/this.a,S=x/this.a,C=1,N=0,U,z,H=0,D=0;for(d=1;d<=6;d++)U=C*E-N*S,z=N*E+C*S,C=U,N=z,H=H+this.C_re[d]*C-this.C_im[d]*N,D=D+this.C_im[d]*C+this.C_re[d]*N;for(var q=0;q<this.iterations;q++){var V=H,X=D,j,J,st=E,dt=S;for(d=2;d<=6;d++)j=V*H-X*D,J=X*H+V*D,V=j,X=J,st=st+(d-1)*(this.B_re[d]*V-this.B_im[d]*X),dt=dt+(d-1)*(this.B_im[d]*V+this.B_re[d]*X);V=1,X=0;var lt=this.B_re[1],bt=this.B_im[1];for(d=2;d<=6;d++)j=V*H-X*D,J=X*H+V*D,V=j,X=J,lt=lt+d*(this.B_re[d]*V-this.B_im[d]*X),bt=bt+d*(this.B_im[d]*V+this.B_re[d]*X);var It=lt*lt+bt*bt;H=(st*lt+dt*bt)/It,D=(dt*lt-st*bt)/It}var Vt=H,Nt=D,Jt=1,be=0;for(d=1;d<=9;d++)Jt=Jt*Vt,be=be+this.D[d]*Jt;var at=this.lat0+be*f*1e5,zt=this.long0+Nt;return c.x=zt,c.y=at,c}var dO=["New_Zealand_Map_Grid","nzmg"],fO={init:lO,forward:cO,inverse:uO,names:dO};function pO(){}function mO(c){var d=c.x,p=c.y,v=At(d-this.long0),x=this.x0+this.a*v,b=this.y0+this.a*Math.log(Math.tan(Math.PI/4+p/2.5))*1.25;return c.x=x,c.y=b,c}function gO(c){c.x-=this.x0,c.y-=this.y0;var d=At(this.long0+c.x/this.a),p=2.5*(Math.atan(Math.exp(.8*c.y/this.a))-Math.PI/4);return c.x=d,c.y=p,c}var yO=["Miller_Cylindrical","mill"],_O={init:pO,forward:mO,inverse:gO,names:yO},xO=20;function vO(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=G2(this.es)}function wO(c){var d,p,v=c.x,x=c.y;if(v=At(v-this.long0),this.sphere){if(!this.m)x=this.n!==1?Math.asin(this.n*Math.sin(x)):x;else for(var b=this.n*Math.sin(x),E=xO;E;--E){var S=(this.m*x+Math.sin(x)-b)/(this.m+Math.cos(x));if(x-=S,Math.abs(S)<w)break}d=this.a*this.C_x*v*(this.m+Math.cos(x)),p=this.a*this.C_y*x}else{var C=Math.sin(x),N=Math.cos(x);p=this.a*o0(x,C,N,this.en),d=this.a*v*N/Math.sqrt(1-this.es*C*C)}return c.x=d,c.y=p,c}function bO(c){var d,p,v,x;return c.x-=this.x0,v=c.x/this.a,c.y-=this.y0,d=c.y/this.a,this.sphere?(d/=this.C_y,v=v/(this.C_x*(this.m+Math.cos(d))),this.m?d=Oo((this.m*d+Math.sin(d))/this.n):this.n!==1&&(d=Oo(Math.sin(d)/this.n)),v=At(v+this.long0),d=Pl(d)):(d=V2(c.y/this.a,this.es,this.en),x=Math.abs(d),x<m?(x=Math.sin(d),p=this.long0+c.x*Math.sqrt(1-this.es*x*x)/(this.a*Math.cos(d)),v=At(p)):x-w<m&&(v=this.long0)),c.x=v,c.y=d,c}var MO=["Sinusoidal","sinu"],EO={init:vO,forward:wO,inverse:bO,names:MO};function SO(){}function TO(c){for(var d=c.x,p=c.y,v=At(d-this.long0),x=p,b=Math.PI*Math.sin(p);;){var E=-(x+Math.sin(x)-b)/(1+Math.cos(x));if(x+=E,Math.abs(E)<w)break}x/=2,Math.PI/2-Math.abs(p)<w&&(v=0);var S=.900316316158*this.a*v*Math.cos(x)+this.x0,C=1.4142135623731*this.a*Math.sin(x)+this.y0;return c.x=S,c.y=C,c}function CO(c){var d,p;c.x-=this.x0,c.y-=this.y0,p=c.y/(1.4142135623731*this.a),Math.abs(p)>.999999999999&&(p=.999999999999),d=Math.asin(p);var v=At(this.long0+c.x/(.900316316158*this.a*Math.cos(d)));v<-Math.PI&&(v=-Math.PI),v>Math.PI&&(v=Math.PI),p=(2*d+Math.sin(2*d))/Math.PI,Math.abs(p)>1&&(p=1);var x=Math.asin(p);return c.x=v,c.y=x,c}var AO=["Mollweide","moll"],RO={init:SO,forward:TO,inverse:CO,names:AO};function IO(){Math.abs(this.lat1+this.lat2)<w||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Du(this.es),this.e1=zu(this.es),this.e2=Bu(this.es),this.e3=Uu(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=_t(this.e,this.sinphi,this.cosphi),this.ml1=xs(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<w?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=_t(this.e,this.sinphi,this.cosphi),this.ml2=xs(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=xs(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function NO(c){var d=c.x,p=c.y,v;if(this.sphere)v=this.a*(this.g-p);else{var x=xs(this.e0,this.e1,this.e2,this.e3,p);v=this.a*(this.g-x)}var b=this.ns*At(d-this.long0),E=this.x0+v*Math.sin(b),S=this.y0+this.rh-v*Math.cos(b);return c.x=E,c.y=S,c}function kO(c){c.x-=this.x0,c.y=this.rh-c.y+this.y0;var d,p,v,x;this.ns>=0?(p=Math.sqrt(c.x*c.x+c.y*c.y),d=1):(p=-Math.sqrt(c.x*c.x+c.y*c.y),d=-1);var b=0;if(p!==0&&(b=Math.atan2(d*c.x,d*c.y)),this.sphere)return x=At(this.long0+b/this.ns),v=Pl(this.g-p/this.a),c.x=x,c.y=v,c;var E=this.g-p/this.a;return v=c0(E,this.e0,this.e1,this.e2,this.e3),x=At(this.long0+b/this.ns),c.x=x,c.y=v,c}var LO=["Equidistant_Conic","eqdc"],OO={init:IO,forward:NO,inverse:kO,names:LO};function PO(){this.R=this.a}function FO(c){var d=c.x,p=c.y,v=At(d-this.long0),x,b;Math.abs(p)<=w&&(x=this.x0+this.R*v,b=this.y0);var E=Oo(2*Math.abs(p/Math.PI));(Math.abs(v)<=w||Math.abs(Math.abs(p)-m)<=w)&&(x=this.x0,p>=0?b=this.y0+Math.PI*this.R*Math.tan(.5*E):b=this.y0+Math.PI*this.R*-Math.tan(.5*E));var S=.5*Math.abs(Math.PI/v-v/Math.PI),C=S*S,N=Math.sin(E),U=Math.cos(E),z=U/(N+U-1),H=z*z,D=z*(2/N-1),q=D*D,V=Math.PI*this.R*(S*(z-q)+Math.sqrt(C*(z-q)*(z-q)-(q+C)*(H-q)))/(q+C);v<0&&(V=-V),x=this.x0+V;var X=C+z;return V=Math.PI*this.R*(D*X-S*Math.sqrt((q+C)*(C+1)-X*X))/(q+C),p>=0?b=this.y0+V:b=this.y0-V,c.x=x,c.y=b,c}function DO(c){var d,p,v,x,b,E,S,C,N,U,z,H,D;return c.x-=this.x0,c.y-=this.y0,z=Math.PI*this.R,v=c.x/z,x=c.y/z,b=v*v+x*x,E=-Math.abs(x)*(1+b),S=E-2*x*x+v*v,C=-2*E+1+2*x*x+b*b,D=x*x/C+(2*S*S*S/C/C/C-9*E*S/C/C)/27,N=(E-S*S/3/C)/C,U=2*Math.sqrt(-N/3),z=3*D/N/U,Math.abs(z)>1&&(z>=0?z=1:z=-1),H=Math.acos(z)/3,c.y>=0?p=(-U*Math.cos(H+Math.PI/3)-S/3/C)*Math.PI:p=-(-U*Math.cos(H+Math.PI/3)-S/3/C)*Math.PI,Math.abs(v)<w?d=this.long0:d=At(this.long0+Math.PI*(b-1+Math.sqrt(1+2*(v*v-x*x)+b*b))/2/v),c.x=d,c.y=p,c}var zO=["Van_der_Grinten_I","VanDerGrinten","vandg"],BO={init:PO,forward:FO,inverse:DO,names:zO};function UO(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function GO(c){var d=c.x,p=c.y,v=Math.sin(c.y),x=Math.cos(c.y),b=At(d-this.long0),E,S,C,N,U,z,H,D,q,V,X,j,J,st,dt,lt,bt,It,Vt,Nt,Jt,be,at;return this.sphere?Math.abs(this.sin_p12-1)<=w?(c.x=this.x0+this.a*(m-p)*Math.sin(b),c.y=this.y0-this.a*(m-p)*Math.cos(b),c):Math.abs(this.sin_p12+1)<=w?(c.x=this.x0+this.a*(m+p)*Math.sin(b),c.y=this.y0+this.a*(m+p)*Math.cos(b),c):(It=this.sin_p12*v+this.cos_p12*x*Math.cos(b),lt=Math.acos(It),bt=lt?lt/Math.sin(lt):1,c.x=this.x0+this.a*bt*x*Math.sin(b),c.y=this.y0+this.a*bt*(this.cos_p12*v-this.sin_p12*x*Math.cos(b)),c):(E=Du(this.es),S=zu(this.es),C=Bu(this.es),N=Uu(this.es),Math.abs(this.sin_p12-1)<=w?(U=this.a*xs(E,S,C,N,m),z=this.a*xs(E,S,C,N,p),c.x=this.x0+(U-z)*Math.sin(b),c.y=this.y0-(U-z)*Math.cos(b),c):Math.abs(this.sin_p12+1)<=w?(U=this.a*xs(E,S,C,N,m),z=this.a*xs(E,S,C,N,p),c.x=this.x0+(U+z)*Math.sin(b),c.y=this.y0+(U+z)*Math.cos(b),c):(H=v/x,D=Ol(this.a,this.e,this.sin_p12),q=Ol(this.a,this.e,v),V=Math.atan((1-this.es)*H+this.es*D*this.sin_p12/(q*x)),X=Math.atan2(Math.sin(b),this.cos_p12*Math.tan(V)-this.sin_p12*Math.cos(b)),X===0?Vt=Math.asin(this.cos_p12*Math.sin(V)-this.sin_p12*Math.cos(V)):Math.abs(Math.abs(X)-Math.PI)<=w?Vt=-Math.asin(this.cos_p12*Math.sin(V)-this.sin_p12*Math.cos(V)):Vt=Math.asin(Math.sin(b)*Math.cos(V)/Math.sin(X)),j=this.e*this.sin_p12/Math.sqrt(1-this.es),J=this.e*this.cos_p12*Math.cos(X)/Math.sqrt(1-this.es),st=j*J,dt=J*J,Nt=Vt*Vt,Jt=Nt*Vt,be=Jt*Vt,at=be*Vt,lt=D*Vt*(1-Nt*dt*(1-dt)/6+Jt/8*st*(1-2*dt)+be/120*(dt*(4-7*dt)-3*j*j*(1-7*dt))-at/48*st),c.x=this.x0+lt*Math.sin(X),c.y=this.y0+lt*Math.cos(X),c))}function VO(c){c.x-=this.x0,c.y-=this.y0;var d,p,v,x,b,E,S,C,N,U,z,H,D,q,V,X,j,J,st,dt,lt,bt,It,Vt;return this.sphere?(d=Math.sqrt(c.x*c.x+c.y*c.y),d>2*m*this.a?void 0:(p=d/this.a,v=Math.sin(p),x=Math.cos(p),b=this.long0,Math.abs(d)<=w?E=this.lat0:(E=Oo(x*this.sin_p12+c.y*v*this.cos_p12/d),S=Math.abs(this.lat0)-m,Math.abs(S)<=w?this.lat0>=0?b=At(this.long0+Math.atan2(c.x,-c.y)):b=At(this.long0-Math.atan2(-c.x,c.y)):b=At(this.long0+Math.atan2(c.x*v,d*this.cos_p12*x-c.y*this.sin_p12*v))),c.x=b,c.y=E,c)):(C=Du(this.es),N=zu(this.es),U=Bu(this.es),z=Uu(this.es),Math.abs(this.sin_p12-1)<=w?(H=this.a*xs(C,N,U,z,m),d=Math.sqrt(c.x*c.x+c.y*c.y),D=H-d,E=c0(D/this.a,C,N,U,z),b=At(this.long0+Math.atan2(c.x,-1*c.y)),c.x=b,c.y=E,c):Math.abs(this.sin_p12+1)<=w?(H=this.a*xs(C,N,U,z,m),d=Math.sqrt(c.x*c.x+c.y*c.y),D=d-H,E=c0(D/this.a,C,N,U,z),b=At(this.long0+Math.atan2(c.x,c.y)),c.x=b,c.y=E,c):(d=Math.sqrt(c.x*c.x+c.y*c.y),X=Math.atan2(c.x,c.y),q=Ol(this.a,this.e,this.sin_p12),j=Math.cos(X),J=this.e*this.cos_p12*j,st=-J*J/(1-this.es),dt=3*this.es*(1-st)*this.sin_p12*this.cos_p12*j/(1-this.es),lt=d/q,bt=lt-st*(1+st)*Math.pow(lt,3)/6-dt*(1+3*st)*Math.pow(lt,4)/24,It=1-st*bt*bt/2-lt*bt*bt*bt/6,V=Math.asin(this.sin_p12*Math.cos(bt)+this.cos_p12*Math.sin(bt)*j),b=At(this.long0+Math.asin(Math.sin(X)*Math.sin(bt)/Math.cos(V))),Vt=Math.sin(V),E=Math.atan2((Vt-this.es*It*this.sin_p12)*Math.tan(V),Vt*(1-this.es)),c.x=b,c.y=E,c))}var WO=["Azimuthal_Equidistant","aeqd"],$O={init:UO,forward:GO,inverse:VO,names:WO};function YO(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function HO(c){var d,p,v,x,b,E,S,C,N=c.x,U=c.y;return v=At(N-this.long0),d=Math.sin(U),p=Math.cos(U),x=Math.cos(v),E=this.sin_p14*d+this.cos_p14*p*x,b=1,(E>0||Math.abs(E)<=w)&&(S=this.a*b*p*Math.sin(v),C=this.y0+this.a*b*(this.cos_p14*d-this.sin_p14*p*x)),c.x=S,c.y=C,c}function qO(c){var d,p,v,x,b,E,S;return c.x-=this.x0,c.y-=this.y0,d=Math.sqrt(c.x*c.x+c.y*c.y),p=Oo(d/this.a),v=Math.sin(p),x=Math.cos(p),E=this.long0,Math.abs(d)<=w?(S=this.lat0,c.x=E,c.y=S,c):(S=Oo(x*this.sin_p14+c.y*v*this.cos_p14/d),b=Math.abs(this.lat0)-m,Math.abs(b)<=w?(this.lat0>=0?E=At(this.long0+Math.atan2(c.x,-c.y)):E=At(this.long0-Math.atan2(-c.x,c.y)),c.x=E,c.y=S,c):(E=At(this.long0+Math.atan2(c.x*v,d*this.cos_p14*x-c.y*this.sin_p14*v)),c.x=E,c.y=S,c))}var XO=["ortho"],jO={init:YO,forward:HO,inverse:qO,names:XO},qi={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},Si={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function ZO(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=m-A/2?this.face=qi.TOP:this.lat0<=-(m-A/2)?this.face=qi.BOTTOM:Math.abs(this.long0)<=A?this.face=qi.FRONT:Math.abs(this.long0)<=m+A?this.face=this.long0>0?qi.RIGHT:qi.LEFT:this.face=qi.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function KO(c){var d={x:0,y:0},p,v,x,b,E,S,C={value:0};if(c.x-=this.long0,this.es!==0?p=Math.atan(this.one_minus_f_squared*Math.tan(c.y)):p=c.y,v=c.x,this.face===qi.TOP)b=m-p,v>=A&&v<=m+A?(C.value=Si.AREA_0,x=v-m):v>m+A||v<=-(m+A)?(C.value=Si.AREA_1,x=v>0?v-I:v+I):v>-(m+A)&&v<=-A?(C.value=Si.AREA_2,x=v+m):(C.value=Si.AREA_3,x=v);else if(this.face===qi.BOTTOM)b=m+p,v>=A&&v<=m+A?(C.value=Si.AREA_0,x=-v+m):v<A&&v>=-A?(C.value=Si.AREA_1,x=-v):v<-A&&v>=-(m+A)?(C.value=Si.AREA_2,x=-v-m):(C.value=Si.AREA_3,x=v>0?-v+I:-v-I);else{var N,U,z,H,D,q,V;this.face===qi.RIGHT?v=Fl(v,+m):this.face===qi.BACK?v=Fl(v,+I):this.face===qi.LEFT&&(v=Fl(v,-m)),H=Math.sin(p),D=Math.cos(p),q=Math.sin(v),V=Math.cos(v),N=D*V,U=D*q,z=H,this.face===qi.FRONT?(b=Math.acos(N),x=u0(b,z,U,C)):this.face===qi.RIGHT?(b=Math.acos(U),x=u0(b,z,-N,C)):this.face===qi.BACK?(b=Math.acos(-N),x=u0(b,z,-U,C)):this.face===qi.LEFT?(b=Math.acos(-U),x=u0(b,z,N,C)):(b=x=0,C.value=Si.AREA_0)}return S=Math.atan(12/I*(x+Math.acos(Math.sin(x)*Math.cos(A))-m)),E=Math.sqrt((1-Math.cos(b))/(Math.cos(S)*Math.cos(S))/(1-Math.cos(Math.atan(1/Math.cos(x))))),C.value===Si.AREA_1?S+=m:C.value===Si.AREA_2?S+=I:C.value===Si.AREA_3&&(S+=1.5*I),d.x=E*Math.cos(S),d.y=E*Math.sin(S),d.x=d.x*this.a+this.x0,d.y=d.y*this.a+this.y0,c.x=d.x,c.y=d.y,c}function JO(c){var d={lam:0,phi:0},p,v,x,b,E,S,C,N,U,z={value:0};if(c.x=(c.x-this.x0)/this.a,c.y=(c.y-this.y0)/this.a,v=Math.atan(Math.sqrt(c.x*c.x+c.y*c.y)),p=Math.atan2(c.y,c.x),c.x>=0&&c.x>=Math.abs(c.y)?z.value=Si.AREA_0:c.y>=0&&c.y>=Math.abs(c.x)?(z.value=Si.AREA_1,p-=m):c.x<0&&-c.x>=Math.abs(c.y)?(z.value=Si.AREA_2,p=p<0?p+I:p-I):(z.value=Si.AREA_3,p+=m),U=I/12*Math.tan(p),E=Math.sin(U)/(Math.cos(U)-1/Math.sqrt(2)),S=Math.atan(E),x=Math.cos(p),b=Math.tan(v),C=1-x*x*b*b*(1-Math.cos(Math.atan(1/Math.cos(S)))),C<-1?C=-1:C>1&&(C=1),this.face===qi.TOP)N=Math.acos(C),d.phi=m-N,z.value===Si.AREA_0?d.lam=S+m:z.value===Si.AREA_1?d.lam=S<0?S+I:S-I:z.value===Si.AREA_2?d.lam=S-m:d.lam=S;else if(this.face===qi.BOTTOM)N=Math.acos(C),d.phi=N-m,z.value===Si.AREA_0?d.lam=-S+m:z.value===Si.AREA_1?d.lam=-S:z.value===Si.AREA_2?d.lam=-S-m:d.lam=S<0?-S-I:-S+I;else{var H,D,q;H=C,U=H*H,U>=1?q=0:q=Math.sqrt(1-U)*Math.sin(S),U+=q*q,U>=1?D=0:D=Math.sqrt(1-U),z.value===Si.AREA_1?(U=D,D=-q,q=U):z.value===Si.AREA_2?(D=-D,q=-q):z.value===Si.AREA_3&&(U=D,D=q,q=-U),this.face===qi.RIGHT?(U=H,H=-D,D=U):this.face===qi.BACK?(H=-H,D=-D):this.face===qi.LEFT&&(U=H,H=D,D=-U),d.phi=Math.acos(-q)-m,d.lam=Math.atan2(D,H),this.face===qi.RIGHT?d.lam=Fl(d.lam,-m):this.face===qi.BACK?d.lam=Fl(d.lam,-I):this.face===qi.LEFT&&(d.lam=Fl(d.lam,+m))}if(this.es!==0){var V,X,j;V=d.phi<0?1:0,X=Math.tan(d.phi),j=this.b/Math.sqrt(X*X+this.one_minus_f_squared),d.phi=Math.atan(Math.sqrt(this.a*this.a-j*j)/(this.one_minus_f*j)),V&&(d.phi=-d.phi)}return d.lam+=this.long0,c.x=d.lam,c.y=d.phi,c}function u0(c,d,p,v){var x;return c<w?(v.value=Si.AREA_0,x=0):(x=Math.atan2(d,p),Math.abs(x)<=A?v.value=Si.AREA_0:x>A&&x<=m+A?(v.value=Si.AREA_1,x-=m):x>m+A||x<=-(m+A)?(v.value=Si.AREA_2,x=x>=0?x-I:x+I):(v.value=Si.AREA_3,x+=m)),x}function Fl(c,d){var p=c+d;return p<-I?p+=R:p>+I&&(p-=R),p}var QO=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"],tP={init:ZO,forward:KO,inverse:JO,names:QO},oy=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Gu=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],H2=.8487,q2=1.3523,X2=T/5,eP=1/X2,Dl=18,d0=function(c,d){return c[0]+d*(c[1]+d*(c[2]+d*c[3]))},iP=function(c,d){return c[1]+d*(2*c[2]+d*3*c[3])};function nP(c,d,p,v){for(var x=d;v;--v){var b=c(x);if(x-=b,Math.abs(b)<p)break}return x}function sP(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function rP(c){var d=At(c.x-this.long0),p=Math.abs(c.y),v=Math.floor(p*X2);v<0?v=0:v>=Dl&&(v=Dl-1),p=T*(p-eP*v);var x={x:d0(oy[v],p)*d,y:d0(Gu[v],p)};return c.y<0&&(x.y=-x.y),x.x=x.x*this.a*H2+this.x0,x.y=x.y*this.a*q2+this.y0,x}function aP(c){var d={x:(c.x-this.x0)/(this.a*H2),y:Math.abs(c.y-this.y0)/(this.a*q2)};if(d.y>=1)d.x/=oy[Dl][0],d.y=c.y<0?-m:m;else{var p=Math.floor(d.y*Dl);for(p<0?p=0:p>=Dl&&(p=Dl-1);;)if(Gu[p][0]>d.y)--p;else if(Gu[p+1][0]<=d.y)++p;else break;var v=Gu[p],x=5*(d.y-v[0])/(Gu[p+1][0]-v[0]);x=nP(function(b){return(d0(v,b)-d.y)/iP(v,b)},x,w,100),d.x/=d0(oy[p],x),d.y=(5*p+x)*M,c.y<0&&(d.y=-d.y)}return d.x=At(d.x+this.long0),d}var oP=["Robinson","robin"],hP={init:sP,forward:rP,inverse:aP,names:oP};function lP(){this.name="geocent"}function cP(c){var d=w2(c,this.es,this.a);return d}function uP(c){var d=b2(c,this.es,this.a,this.b);return d}var dP=["Geocentric","geocentric","geocent","Geocent"],fP={init:lP,forward:cP,inverse:uP,names:dP},Qn={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},Vu={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function pP(){if(Object.keys(Vu).forEach(function(p){if(typeof this[p]>"u")this[p]=Vu[p].def;else{if(Vu[p].num&&isNaN(this[p]))throw new Error("Invalid parameter value, must be numeric "+p+" = "+this[p]);Vu[p].num&&(this[p]=parseFloat(this[p]))}Vu[p].degrees&&(this[p]=this[p]*M)}.bind(this)),Math.abs(Math.abs(this.lat0)-m)<w?this.mode=this.lat0<0?Qn.S_POLE:Qn.N_POLE:Math.abs(this.lat0)<w?this.mode=Qn.EQUIT:(this.mode=Qn.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var c=this.tilt,d=this.azi;this.cg=Math.cos(d),this.sg=Math.sin(d),this.cw=Math.cos(c),this.sw=Math.sin(c)}function mP(c){c.x-=this.long0;var d=Math.sin(c.y),p=Math.cos(c.y),v=Math.cos(c.x),x,b;switch(this.mode){case Qn.OBLIQ:b=this.sinph0*d+this.cosph0*p*v;break;case Qn.EQUIT:b=p*v;break;case Qn.S_POLE:b=-d;break;case Qn.N_POLE:b=d;break}switch(b=this.pn1/(this.p-b),x=b*p*Math.sin(c.x),this.mode){case Qn.OBLIQ:b*=this.cosph0*d-this.sinph0*p*v;break;case Qn.EQUIT:b*=d;break;case Qn.N_POLE:b*=-(p*v);break;case Qn.S_POLE:b*=p*v;break}var E,S;return E=b*this.cg+x*this.sg,S=1/(E*this.sw*this.h1+this.cw),x=(x*this.cg-b*this.sg)*this.cw*S,b=E*S,c.x=x*this.a,c.y=b*this.a,c}function gP(c){c.x/=this.a,c.y/=this.a;var d={x:c.x,y:c.y},p,v,x;x=1/(this.pn1-c.y*this.sw),p=this.pn1*c.x*x,v=this.pn1*c.y*this.cw*x,c.x=p*this.cg+v*this.sg,c.y=v*this.cg-p*this.sg;var b=ar(c.x,c.y);if(Math.abs(b)<w)d.x=0,d.y=c.y;else{var E,S;switch(S=1-b*b*this.pfact,S=(this.p-Math.sqrt(S))/(this.pn1/b+b/this.pn1),E=Math.sqrt(1-S*S),this.mode){case Qn.OBLIQ:d.y=Math.asin(E*this.sinph0+c.y*S*this.cosph0/b),c.y=(E-this.sinph0*Math.sin(d.y))*b,c.x*=S*this.cosph0;break;case Qn.EQUIT:d.y=Math.asin(c.y*S/b),c.y=E*b,c.x*=S;break;case Qn.N_POLE:d.y=Math.asin(E),c.y=-c.y;break;case Qn.S_POLE:d.y=-Math.asin(E);break}d.x=Math.atan2(c.x,c.y)}return c.x=d.x+this.long0,c.y=d.y,c}var yP=["Tilted_Perspective","tpers"],_P={init:pP,forward:mP,inverse:gP,names:yP};function xP(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var c=1-this.es,d=1/c;this.radius_p=Math.sqrt(c),this.radius_p2=c,this.radius_p_inv2=d,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function vP(c){var d=c.x,p=c.y,v,x,b,E;if(d=d-this.long0,this.shape==="ellipse"){p=Math.atan(this.radius_p2*Math.tan(p));var S=this.radius_p/ar(this.radius_p*Math.cos(p),Math.sin(p));if(x=S*Math.cos(d)*Math.cos(p),b=S*Math.sin(d)*Math.cos(p),E=S*Math.sin(p),(this.radius_g-x)*x-b*b-E*E*this.radius_p_inv2<0)return c.x=Number.NaN,c.y=Number.NaN,c;v=this.radius_g-x,this.flip_axis?(c.x=this.radius_g_1*Math.atan(b/ar(E,v)),c.y=this.radius_g_1*Math.atan(E/v)):(c.x=this.radius_g_1*Math.atan(b/v),c.y=this.radius_g_1*Math.atan(E/ar(b,v)))}else this.shape==="sphere"&&(v=Math.cos(p),x=Math.cos(d)*v,b=Math.sin(d)*v,E=Math.sin(p),v=this.radius_g-x,this.flip_axis?(c.x=this.radius_g_1*Math.atan(b/ar(E,v)),c.y=this.radius_g_1*Math.atan(E/v)):(c.x=this.radius_g_1*Math.atan(b/v),c.y=this.radius_g_1*Math.atan(E/ar(b,v))));return c.x=c.x*this.a,c.y=c.y*this.a,c}function wP(c){var d=-1,p=0,v=0,x,b,E,S;if(c.x=c.x/this.a,c.y=c.y/this.a,this.shape==="ellipse"){this.flip_axis?(v=Math.tan(c.y/this.radius_g_1),p=Math.tan(c.x/this.radius_g_1)*ar(1,v)):(p=Math.tan(c.x/this.radius_g_1),v=Math.tan(c.y/this.radius_g_1)*ar(1,p));var C=v/this.radius_p;if(x=p*p+C*C+d*d,b=2*this.radius_g*d,E=b*b-4*x*this.C,E<0)return c.x=Number.NaN,c.y=Number.NaN,c;S=(-b-Math.sqrt(E))/(2*x),d=this.radius_g+S*d,p*=S,v*=S,c.x=Math.atan2(p,d),c.y=Math.atan(v*Math.cos(c.x)/d),c.y=Math.atan(this.radius_p_inv2*Math.tan(c.y))}else if(this.shape==="sphere"){if(this.flip_axis?(v=Math.tan(c.y/this.radius_g_1),p=Math.tan(c.x/this.radius_g_1)*Math.sqrt(1+v*v)):(p=Math.tan(c.x/this.radius_g_1),v=Math.tan(c.y/this.radius_g_1)*Math.sqrt(1+p*p)),x=p*p+v*v+d*d,b=2*this.radius_g*d,E=b*b-4*x*this.C,E<0)return c.x=Number.NaN,c.y=Number.NaN,c;S=(-b-Math.sqrt(E))/(2*x),d=this.radius_g+S*d,p*=S,v*=S,c.x=Math.atan2(p,d),c.y=Math.atan(v*Math.cos(c.x)/d)}return c.x=c.x+this.long0,c}var bP=["Geostationary Satellite View","Geostationary_Satellite","geos"],MP={init:xP,forward:vP,inverse:wP,names:bP};function EP(c){c.Proj.projections.add(h0),c.Proj.projections.add(l0),c.Proj.projections.add(I5),c.Proj.projections.add(U5),c.Proj.projections.add(H5),c.Proj.projections.add(K5),c.Proj.projections.add(nL),c.Proj.projections.add(hL),c.Proj.projections.add(fL),c.Proj.projections.add(_L),c.Proj.projections.add(PL),c.Proj.projections.add(GL),c.Proj.projections.add(HL),c.Proj.projections.add(JL),c.Proj.projections.add(nO),c.Proj.projections.add(hO),c.Proj.projections.add(fO),c.Proj.projections.add(_O),c.Proj.projections.add(EO),c.Proj.projections.add(RO),c.Proj.projections.add(OO),c.Proj.projections.add(BO),c.Proj.projections.add($O),c.Proj.projections.add(jO),c.Proj.projections.add(tP),c.Proj.projections.add(hP),c.Proj.projections.add(fP),c.Proj.projections.add(_P),c.Proj.projections.add(MP)}_s.defaultDatum="WGS84",_s.Proj=da,_s.WGS84=new _s.Proj("WGS84"),_s.Point=kl,_s.toPoint=T2,_s.defs=je,_s.nadgrid=Ns,_s.transform=a0,_s.mgrs=Xk,_s.version="__VERSION__",EP(_s);var Wu=typeof wa<"u"?wa:typeof self<"u"?self:typeof window<"u"?window:{},fa=[],or=[],SP=typeof Uint8Array<"u"?Uint8Array:Array,hy=!1;function j2(){hy=!0;for(var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=0,p=c.length;d<p;++d)fa[d]=c[d],or[c.charCodeAt(d)]=d;or["-".charCodeAt(0)]=62,or["_".charCodeAt(0)]=63}function TP(c){hy||j2();var d,p,v,x,b,E,S=c.length;if(S%4>0)throw new Error("Invalid string. Length must be a multiple of 4");b=c[S-2]==="="?2:c[S-1]==="="?1:0,E=new SP(S*3/4-b),v=b>0?S-4:S;var C=0;for(d=0,p=0;d<v;d+=4,p+=3)x=or[c.charCodeAt(d)]<<18|or[c.charCodeAt(d+1)]<<12|or[c.charCodeAt(d+2)]<<6|or[c.charCodeAt(d+3)],E[C++]=x>>16&255,E[C++]=x>>8&255,E[C++]=x&255;return b===2?(x=or[c.charCodeAt(d)]<<2|or[c.charCodeAt(d+1)]>>4,E[C++]=x&255):b===1&&(x=or[c.charCodeAt(d)]<<10|or[c.charCodeAt(d+1)]<<4|or[c.charCodeAt(d+2)]>>2,E[C++]=x>>8&255,E[C++]=x&255),E}function CP(c){return fa[c>>18&63]+fa[c>>12&63]+fa[c>>6&63]+fa[c&63]}function AP(c,d,p){for(var v,x=[],b=d;b<p;b+=3)v=(c[b]<<16)+(c[b+1]<<8)+c[b+2],x.push(CP(v));return x.join("")}function Z2(c){hy||j2();for(var d,p=c.length,v=p%3,x="",b=[],E=16383,S=0,C=p-v;S<C;S+=E)b.push(AP(c,S,S+E>C?C:S+E));return v===1?(d=c[p-1],x+=fa[d>>2],x+=fa[d<<4&63],x+="=="):v===2&&(d=(c[p-2]<<8)+c[p-1],x+=fa[d>>10],x+=fa[d>>4&63],x+=fa[d<<2&63],x+="="),b.push(x),b.join("")}function f0(c,d,p,v,x){var b,E,S=x*8-v-1,C=(1<<S)-1,N=C>>1,U=-7,z=p?x-1:0,H=p?-1:1,D=c[d+z];for(z+=H,b=D&(1<<-U)-1,D>>=-U,U+=S;U>0;b=b*256+c[d+z],z+=H,U-=8);for(E=b&(1<<-U)-1,b>>=-U,U+=v;U>0;E=E*256+c[d+z],z+=H,U-=8);if(b===0)b=1-N;else{if(b===C)return E?NaN:(D?-1:1)*(1/0);E=E+Math.pow(2,v),b=b-N}return(D?-1:1)*E*Math.pow(2,b-v)}function K2(c,d,p,v,x,b){var E,S,C,N=b*8-x-1,U=(1<<N)-1,z=U>>1,H=x===23?Math.pow(2,-24)-Math.pow(2,-77):0,D=v?0:b-1,q=v?1:-1,V=d<0||d===0&&1/d<0?1:0;for(d=Math.abs(d),isNaN(d)||d===1/0?(S=isNaN(d)?1:0,E=U):(E=Math.floor(Math.log(d)/Math.LN2),d*(C=Math.pow(2,-E))<1&&(E--,C*=2),E+z>=1?d+=H/C:d+=H*Math.pow(2,1-z),d*C>=2&&(E++,C/=2),E+z>=U?(S=0,E=U):E+z>=1?(S=(d*C-1)*Math.pow(2,x),E=E+z):(S=d*Math.pow(2,z-1)*Math.pow(2,x),E=0));x>=8;c[p+D]=S&255,D+=q,S/=256,x-=8);for(E=E<<x|S,N+=x;N>0;c[p+D]=E&255,D+=q,E/=256,N-=8);c[p+D-q]|=V*128}var RP={}.toString,J2=Array.isArray||function(c){return RP.call(c)=="[object Array]"};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */var IP=50;Bt.TYPED_ARRAY_SUPPORT=Wu.TYPED_ARRAY_SUPPORT!==void 0?Wu.TYPED_ARRAY_SUPPORT:!0,p0();function p0(){return Bt.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Va(c,d){if(p0()<d)throw new RangeError("Invalid typed array length");return Bt.TYPED_ARRAY_SUPPORT?(c=new Uint8Array(d),c.__proto__=Bt.prototype):(c===null&&(c=new Bt(d)),c.length=d),c}function Bt(c,d,p){if(!Bt.TYPED_ARRAY_SUPPORT&&!(this instanceof Bt))return new Bt(c,d,p);if(typeof c=="number"){if(typeof d=="string")throw new Error("If encoding is specified then the first argument must be a string");return ly(this,c)}return Q2(this,c,d,p)}Bt.poolSize=8192,Bt._augment=function(c){return c.__proto__=Bt.prototype,c};function Q2(c,d,p,v){if(typeof d=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&d instanceof ArrayBuffer?LP(c,d,p,v):typeof d=="string"?kP(c,d,p):OP(c,d)}Bt.from=function(c,d,p){return Q2(null,c,d,p)},Bt.TYPED_ARRAY_SUPPORT&&(Bt.prototype.__proto__=Uint8Array.prototype,Bt.__proto__=Uint8Array);function tb(c){if(typeof c!="number")throw new TypeError('"size" argument must be a number');if(c<0)throw new RangeError('"size" argument must not be negative')}function NP(c,d,p,v){return tb(d),d<=0?Va(c,d):p!==void 0?typeof v=="string"?Va(c,d).fill(p,v):Va(c,d).fill(p):Va(c,d)}Bt.alloc=function(c,d,p){return NP(null,c,d,p)};function ly(c,d){if(tb(d),c=Va(c,d<0?0:uy(d)|0),!Bt.TYPED_ARRAY_SUPPORT)for(var p=0;p<d;++p)c[p]=0;return c}Bt.allocUnsafe=function(c){return ly(null,c)},Bt.allocUnsafeSlow=function(c){return ly(null,c)};function kP(c,d,p){if((typeof p!="string"||p==="")&&(p="utf8"),!Bt.isEncoding(p))throw new TypeError('"encoding" must be a valid string encoding');var v=eb(d,p)|0;c=Va(c,v);var x=c.write(d,p);return x!==v&&(c=c.slice(0,x)),c}function cy(c,d){var p=d.length<0?0:uy(d.length)|0;c=Va(c,p);for(var v=0;v<p;v+=1)c[v]=d[v]&255;return c}function LP(c,d,p,v){if(d.byteLength,p<0||d.byteLength<p)throw new RangeError("'offset' is out of bounds");if(d.byteLength<p+(v||0))throw new RangeError("'length' is out of bounds");return p===void 0&&v===void 0?d=new Uint8Array(d):v===void 0?d=new Uint8Array(d,p):d=new Uint8Array(d,p,v),Bt.TYPED_ARRAY_SUPPORT?(c=d,c.__proto__=Bt.prototype):c=cy(c,d),c}function OP(c,d){if(pa(d)){var p=uy(d.length)|0;return c=Va(c,p),c.length===0||d.copy(c,0,0,p),c}if(d){if(typeof ArrayBuffer<"u"&&d.buffer instanceof ArrayBuffer||"length"in d)return typeof d.length!="number"||QP(d.length)?Va(c,0):cy(c,d);if(d.type==="Buffer"&&J2(d.data))return cy(c,d.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function uy(c){if(c>=p0())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+p0().toString(16)+" bytes");return c|0}Bt.isBuffer=tF;function pa(c){return!!(c!=null&&c._isBuffer)}Bt.compare=function(d,p){if(!pa(d)||!pa(p))throw new TypeError("Arguments must be Buffers");if(d===p)return 0;for(var v=d.length,x=p.length,b=0,E=Math.min(v,x);b<E;++b)if(d[b]!==p[b]){v=d[b],x=p[b];break}return v<x?-1:x<v?1:0},Bt.isEncoding=function(d){switch(String(d).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Bt.concat=function(d,p){if(!J2(d))throw new TypeError('"list" argument must be an Array of Buffers');if(d.length===0)return Bt.alloc(0);var v;if(p===void 0)for(p=0,v=0;v<d.length;++v)p+=d[v].length;var x=Bt.allocUnsafe(p),b=0;for(v=0;v<d.length;++v){var E=d[v];if(!pa(E))throw new TypeError('"list" argument must be an Array of Buffers');E.copy(x,b),b+=E.length}return x};function eb(c,d){if(pa(c))return c.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(c)||c instanceof ArrayBuffer))return c.byteLength;typeof c!="string"&&(c=""+c);var p=c.length;if(p===0)return 0;for(var v=!1;;)switch(d){case"ascii":case"latin1":case"binary":return p;case"utf8":case"utf-8":case void 0:return y0(c).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return p*2;case"hex":return p>>>1;case"base64":return cb(c).length;default:if(v)return y0(c).length;d=(""+d).toLowerCase(),v=!0}}Bt.byteLength=eb;function PP(c,d,p){var v=!1;if((d===void 0||d<0)&&(d=0),d>this.length||((p===void 0||p>this.length)&&(p=this.length),p<=0)||(p>>>=0,d>>>=0,p<=d))return"";for(c||(c="utf8");;)switch(c){case"hex":return YP(this,d,p);case"utf8":case"utf-8":return rb(this,d,p);case"ascii":return WP(this,d,p);case"latin1":case"binary":return $P(this,d,p);case"base64":return GP(this,d,p);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return HP(this,d,p);default:if(v)throw new TypeError("Unknown encoding: "+c);c=(c+"").toLowerCase(),v=!0}}Bt.prototype._isBuffer=!0;function Lh(c,d,p){var v=c[d];c[d]=c[p],c[p]=v}Bt.prototype.swap16=function(){var d=this.length;if(d%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var p=0;p<d;p+=2)Lh(this,p,p+1);return this},Bt.prototype.swap32=function(){var d=this.length;if(d%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var p=0;p<d;p+=4)Lh(this,p,p+3),Lh(this,p+1,p+2);return this},Bt.prototype.swap64=function(){var d=this.length;if(d%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var p=0;p<d;p+=8)Lh(this,p,p+7),Lh(this,p+1,p+6),Lh(this,p+2,p+5),Lh(this,p+3,p+4);return this},Bt.prototype.toString=function(){var d=this.length|0;return d===0?"":arguments.length===0?rb(this,0,d):PP.apply(this,arguments)},Bt.prototype.equals=function(d){if(!pa(d))throw new TypeError("Argument must be a Buffer");return this===d?!0:Bt.compare(this,d)===0},Bt.prototype.inspect=function(){var d="",p=IP;return this.length>0&&(d=this.toString("hex",0,p).match(/.{2}/g).join(" "),this.length>p&&(d+=" ... ")),"<Buffer "+d+">"},Bt.prototype.compare=function(d,p,v,x,b){if(!pa(d))throw new TypeError("Argument must be a Buffer");if(p===void 0&&(p=0),v===void 0&&(v=d?d.length:0),x===void 0&&(x=0),b===void 0&&(b=this.length),p<0||v>d.length||x<0||b>this.length)throw new RangeError("out of range index");if(x>=b&&p>=v)return 0;if(x>=b)return-1;if(p>=v)return 1;if(p>>>=0,v>>>=0,x>>>=0,b>>>=0,this===d)return 0;for(var E=b-x,S=v-p,C=Math.min(E,S),N=this.slice(x,b),U=d.slice(p,v),z=0;z<C;++z)if(N[z]!==U[z]){E=N[z],S=U[z];break}return E<S?-1:S<E?1:0};function ib(c,d,p,v,x){if(c.length===0)return-1;if(typeof p=="string"?(v=p,p=0):p>2147483647?p=2147483647:p<-2147483648&&(p=-2147483648),p=+p,isNaN(p)&&(p=x?0:c.length-1),p<0&&(p=c.length+p),p>=c.length){if(x)return-1;p=c.length-1}else if(p<0)if(x)p=0;else return-1;if(typeof d=="string"&&(d=Bt.from(d,v)),pa(d))return d.length===0?-1:nb(c,d,p,v,x);if(typeof d=="number")return d=d&255,Bt.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?x?Uint8Array.prototype.indexOf.call(c,d,p):Uint8Array.prototype.lastIndexOf.call(c,d,p):nb(c,[d],p,v,x);throw new TypeError("val must be string, number or Buffer")}function nb(c,d,p,v,x){var b=1,E=c.length,S=d.length;if(v!==void 0&&(v=String(v).toLowerCase(),v==="ucs2"||v==="ucs-2"||v==="utf16le"||v==="utf-16le")){if(c.length<2||d.length<2)return-1;b=2,E/=2,S/=2,p/=2}function C(D,q){return b===1?D[q]:D.readUInt16BE(q*b)}var N;if(x){var U=-1;for(N=p;N<E;N++)if(C(c,N)===C(d,U===-1?0:N-U)){if(U===-1&&(U=N),N-U+1===S)return U*b}else U!==-1&&(N-=N-U),U=-1}else for(p+S>E&&(p=E-S),N=p;N>=0;N--){for(var z=!0,H=0;H<S;H++)if(C(c,N+H)!==C(d,H)){z=!1;break}if(z)return N}return-1}Bt.prototype.includes=function(d,p,v){return this.indexOf(d,p,v)!==-1},Bt.prototype.indexOf=function(d,p,v){return ib(this,d,p,v,!0)},Bt.prototype.lastIndexOf=function(d,p,v){return ib(this,d,p,v,!1)};function FP(c,d,p,v){p=Number(p)||0;var x=c.length-p;v?(v=Number(v),v>x&&(v=x)):v=x;var b=d.length;if(b%2!==0)throw new TypeError("Invalid hex string");v>b/2&&(v=b/2);for(var E=0;E<v;++E){var S=parseInt(d.substr(E*2,2),16);if(isNaN(S))return E;c[p+E]=S}return E}function DP(c,d,p,v){return _0(y0(d,c.length-p),c,p,v)}function sb(c,d,p,v){return _0(KP(d),c,p,v)}function zP(c,d,p,v){return sb(c,d,p,v)}function BP(c,d,p,v){return _0(cb(d),c,p,v)}function UP(c,d,p,v){return _0(JP(d,c.length-p),c,p,v)}Bt.prototype.write=function(d,p,v,x){if(p===void 0)x="utf8",v=this.length,p=0;else if(v===void 0&&typeof p=="string")x=p,v=this.length,p=0;else if(isFinite(p))p=p|0,isFinite(v)?(v=v|0,x===void 0&&(x="utf8")):(x=v,v=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var b=this.length-p;if((v===void 0||v>b)&&(v=b),d.length>0&&(v<0||p<0)||p>this.length)throw new RangeError("Attempt to write outside buffer bounds");x||(x="utf8");for(var E=!1;;)switch(x){case"hex":return FP(this,d,p,v);case"utf8":case"utf-8":return DP(this,d,p,v);case"ascii":return sb(this,d,p,v);case"latin1":case"binary":return zP(this,d,p,v);case"base64":return BP(this,d,p,v);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return UP(this,d,p,v);default:if(E)throw new TypeError("Unknown encoding: "+x);x=(""+x).toLowerCase(),E=!0}},Bt.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function GP(c,d,p){return d===0&&p===c.length?Z2(c):Z2(c.slice(d,p))}function rb(c,d,p){p=Math.min(c.length,p);for(var v=[],x=d;x<p;){var b=c[x],E=null,S=b>239?4:b>223?3:b>191?2:1;if(x+S<=p){var C,N,U,z;switch(S){case 1:b<128&&(E=b);break;case 2:C=c[x+1],(C&192)===128&&(z=(b&31)<<6|C&63,z>127&&(E=z));break;case 3:C=c[x+1],N=c[x+2],(C&192)===128&&(N&192)===128&&(z=(b&15)<<12|(C&63)<<6|N&63,z>2047&&(z<55296||z>57343)&&(E=z));break;case 4:C=c[x+1],N=c[x+2],U=c[x+3],(C&192)===128&&(N&192)===128&&(U&192)===128&&(z=(b&15)<<18|(C&63)<<12|(N&63)<<6|U&63,z>65535&&z<1114112&&(E=z))}}E===null?(E=65533,S=1):E>65535&&(E-=65536,v.push(E>>>10&1023|55296),E=56320|E&1023),v.push(E),x+=S}return VP(v)}var ab=4096;function VP(c){var d=c.length;if(d<=ab)return String.fromCharCode.apply(String,c);for(var p="",v=0;v<d;)p+=String.fromCharCode.apply(String,c.slice(v,v+=ab));return p}function WP(c,d,p){var v="";p=Math.min(c.length,p);for(var x=d;x<p;++x)v+=String.fromCharCode(c[x]&127);return v}function $P(c,d,p){var v="";p=Math.min(c.length,p);for(var x=d;x<p;++x)v+=String.fromCharCode(c[x]);return v}function YP(c,d,p){var v=c.length;(!d||d<0)&&(d=0),(!p||p<0||p>v)&&(p=v);for(var x="",b=d;b<p;++b)x+=ZP(c[b]);return x}function HP(c,d,p){for(var v=c.slice(d,p),x="",b=0;b<v.length;b+=2)x+=String.fromCharCode(v[b]+v[b+1]*256);return x}Bt.prototype.slice=function(d,p){var v=this.length;d=~~d,p=p===void 0?v:~~p,d<0?(d+=v,d<0&&(d=0)):d>v&&(d=v),p<0?(p+=v,p<0&&(p=0)):p>v&&(p=v),p<d&&(p=d);var x;if(Bt.TYPED_ARRAY_SUPPORT)x=this.subarray(d,p),x.__proto__=Bt.prototype;else{var b=p-d;x=new Bt(b,void 0);for(var E=0;E<b;++E)x[E]=this[E+d]}return x};function Nn(c,d,p){if(c%1!==0||c<0)throw new RangeError("offset is not uint");if(c+d>p)throw new RangeError("Trying to access beyond buffer length")}Bt.prototype.readUIntLE=function(d,p,v){d=d|0,p=p|0,v||Nn(d,p,this.length);for(var x=this[d],b=1,E=0;++E<p&&(b*=256);)x+=this[d+E]*b;return x},Bt.prototype.readUIntBE=function(d,p,v){d=d|0,p=p|0,v||Nn(d,p,this.length);for(var x=this[d+--p],b=1;p>0&&(b*=256);)x+=this[d+--p]*b;return x},Bt.prototype.readUInt8=function(d,p){return p||Nn(d,1,this.length),this[d]},Bt.prototype.readUInt16LE=function(d,p){return p||Nn(d,2,this.length),this[d]|this[d+1]<<8},Bt.prototype.readUInt16BE=function(d,p){return p||Nn(d,2,this.length),this[d]<<8|this[d+1]},Bt.prototype.readUInt32LE=function(d,p){return p||Nn(d,4,this.length),(this[d]|this[d+1]<<8|this[d+2]<<16)+this[d+3]*16777216},Bt.prototype.readUInt32BE=function(d,p){return p||Nn(d,4,this.length),this[d]*16777216+(this[d+1]<<16|this[d+2]<<8|this[d+3])},Bt.prototype.readIntLE=function(d,p,v){d=d|0,p=p|0,v||Nn(d,p,this.length);for(var x=this[d],b=1,E=0;++E<p&&(b*=256);)x+=this[d+E]*b;return b*=128,x>=b&&(x-=Math.pow(2,8*p)),x},Bt.prototype.readIntBE=function(d,p,v){d=d|0,p=p|0,v||Nn(d,p,this.length);for(var x=p,b=1,E=this[d+--x];x>0&&(b*=256);)E+=this[d+--x]*b;return b*=128,E>=b&&(E-=Math.pow(2,8*p)),E},Bt.prototype.readInt8=function(d,p){return p||Nn(d,1,this.length),this[d]&128?(255-this[d]+1)*-1:this[d]},Bt.prototype.readInt16LE=function(d,p){p||Nn(d,2,this.length);var v=this[d]|this[d+1]<<8;return v&32768?v|4294901760:v},Bt.prototype.readInt16BE=function(d,p){p||Nn(d,2,this.length);var v=this[d+1]|this[d]<<8;return v&32768?v|4294901760:v},Bt.prototype.readInt32LE=function(d,p){return p||Nn(d,4,this.length),this[d]|this[d+1]<<8|this[d+2]<<16|this[d+3]<<24},Bt.prototype.readInt32BE=function(d,p){return p||Nn(d,4,this.length),this[d]<<24|this[d+1]<<16|this[d+2]<<8|this[d+3]},Bt.prototype.readFloatLE=function(d,p){return p||Nn(d,4,this.length),f0(this,d,!0,23,4)},Bt.prototype.readFloatBE=function(d,p){return p||Nn(d,4,this.length),f0(this,d,!1,23,4)},Bt.prototype.readDoubleLE=function(d,p){return p||Nn(d,8,this.length),f0(this,d,!0,52,8)},Bt.prototype.readDoubleBE=function(d,p){return p||Nn(d,8,this.length),f0(this,d,!1,52,8)};function Ls(c,d,p,v,x,b){if(!pa(c))throw new TypeError('"buffer" argument must be a Buffer instance');if(d>x||d<b)throw new RangeError('"value" argument is out of bounds');if(p+v>c.length)throw new RangeError("Index out of range")}Bt.prototype.writeUIntLE=function(d,p,v,x){if(d=+d,p=p|0,v=v|0,!x){var b=Math.pow(2,8*v)-1;Ls(this,d,p,v,b,0)}var E=1,S=0;for(this[p]=d&255;++S<v&&(E*=256);)this[p+S]=d/E&255;return p+v},Bt.prototype.writeUIntBE=function(d,p,v,x){if(d=+d,p=p|0,v=v|0,!x){var b=Math.pow(2,8*v)-1;Ls(this,d,p,v,b,0)}var E=v-1,S=1;for(this[p+E]=d&255;--E>=0&&(S*=256);)this[p+E]=d/S&255;return p+v},Bt.prototype.writeUInt8=function(d,p,v){return d=+d,p=p|0,v||Ls(this,d,p,1,255,0),Bt.TYPED_ARRAY_SUPPORT||(d=Math.floor(d)),this[p]=d&255,p+1};function m0(c,d,p,v){d<0&&(d=65535+d+1);for(var x=0,b=Math.min(c.length-p,2);x<b;++x)c[p+x]=(d&255<<8*(v?x:1-x))>>>(v?x:1-x)*8}Bt.prototype.writeUInt16LE=function(d,p,v){return d=+d,p=p|0,v||Ls(this,d,p,2,65535,0),Bt.TYPED_ARRAY_SUPPORT?(this[p]=d&255,this[p+1]=d>>>8):m0(this,d,p,!0),p+2},Bt.prototype.writeUInt16BE=function(d,p,v){return d=+d,p=p|0,v||Ls(this,d,p,2,65535,0),Bt.TYPED_ARRAY_SUPPORT?(this[p]=d>>>8,this[p+1]=d&255):m0(this,d,p,!1),p+2};function g0(c,d,p,v){d<0&&(d=4294967295+d+1);for(var x=0,b=Math.min(c.length-p,4);x<b;++x)c[p+x]=d>>>(v?x:3-x)*8&255}Bt.prototype.writeUInt32LE=function(d,p,v){return d=+d,p=p|0,v||Ls(this,d,p,4,4294967295,0),Bt.TYPED_ARRAY_SUPPORT?(this[p+3]=d>>>24,this[p+2]=d>>>16,this[p+1]=d>>>8,this[p]=d&255):g0(this,d,p,!0),p+4},Bt.prototype.writeUInt32BE=function(d,p,v){return d=+d,p=p|0,v||Ls(this,d,p,4,4294967295,0),Bt.TYPED_ARRAY_SUPPORT?(this[p]=d>>>24,this[p+1]=d>>>16,this[p+2]=d>>>8,this[p+3]=d&255):g0(this,d,p,!1),p+4},Bt.prototype.writeIntLE=function(d,p,v,x){if(d=+d,p=p|0,!x){var b=Math.pow(2,8*v-1);Ls(this,d,p,v,b-1,-b)}var E=0,S=1,C=0;for(this[p]=d&255;++E<v&&(S*=256);)d<0&&C===0&&this[p+E-1]!==0&&(C=1),this[p+E]=(d/S>>0)-C&255;return p+v},Bt.prototype.writeIntBE=function(d,p,v,x){if(d=+d,p=p|0,!x){var b=Math.pow(2,8*v-1);Ls(this,d,p,v,b-1,-b)}var E=v-1,S=1,C=0;for(this[p+E]=d&255;--E>=0&&(S*=256);)d<0&&C===0&&this[p+E+1]!==0&&(C=1),this[p+E]=(d/S>>0)-C&255;return p+v},Bt.prototype.writeInt8=function(d,p,v){return d=+d,p=p|0,v||Ls(this,d,p,1,127,-128),Bt.TYPED_ARRAY_SUPPORT||(d=Math.floor(d)),d<0&&(d=255+d+1),this[p]=d&255,p+1},Bt.prototype.writeInt16LE=function(d,p,v){return d=+d,p=p|0,v||Ls(this,d,p,2,32767,-32768),Bt.TYPED_ARRAY_SUPPORT?(this[p]=d&255,this[p+1]=d>>>8):m0(this,d,p,!0),p+2},Bt.prototype.writeInt16BE=function(d,p,v){return d=+d,p=p|0,v||Ls(this,d,p,2,32767,-32768),Bt.TYPED_ARRAY_SUPPORT?(this[p]=d>>>8,this[p+1]=d&255):m0(this,d,p,!1),p+2},Bt.prototype.writeInt32LE=function(d,p,v){return d=+d,p=p|0,v||Ls(this,d,p,4,2147483647,-2147483648),Bt.TYPED_ARRAY_SUPPORT?(this[p]=d&255,this[p+1]=d>>>8,this[p+2]=d>>>16,this[p+3]=d>>>24):g0(this,d,p,!0),p+4},Bt.prototype.writeInt32BE=function(d,p,v){return d=+d,p=p|0,v||Ls(this,d,p,4,2147483647,-2147483648),d<0&&(d=4294967295+d+1),Bt.TYPED_ARRAY_SUPPORT?(this[p]=d>>>24,this[p+1]=d>>>16,this[p+2]=d>>>8,this[p+3]=d&255):g0(this,d,p,!1),p+4};function ob(c,d,p,v,x,b){if(p+v>c.length)throw new RangeError("Index out of range");if(p<0)throw new RangeError("Index out of range")}function hb(c,d,p,v,x){return x||ob(c,d,p,4),K2(c,d,p,v,23,4),p+4}Bt.prototype.writeFloatLE=function(d,p,v){return hb(this,d,p,!0,v)},Bt.prototype.writeFloatBE=function(d,p,v){return hb(this,d,p,!1,v)};function lb(c,d,p,v,x){return x||ob(c,d,p,8),K2(c,d,p,v,52,8),p+8}Bt.prototype.writeDoubleLE=function(d,p,v){return lb(this,d,p,!0,v)},Bt.prototype.writeDoubleBE=function(d,p,v){return lb(this,d,p,!1,v)},Bt.prototype.copy=function(d,p,v,x){if(v||(v=0),!x&&x!==0&&(x=this.length),p>=d.length&&(p=d.length),p||(p=0),x>0&&x<v&&(x=v),x===v||d.length===0||this.length===0)return 0;if(p<0)throw new RangeError("targetStart out of bounds");if(v<0||v>=this.length)throw new RangeError("sourceStart out of bounds");if(x<0)throw new RangeError("sourceEnd out of bounds");x>this.length&&(x=this.length),d.length-p<x-v&&(x=d.length-p+v);var b=x-v,E;if(this===d&&v<p&&p<x)for(E=b-1;E>=0;--E)d[E+p]=this[E+v];else if(b<1e3||!Bt.TYPED_ARRAY_SUPPORT)for(E=0;E<b;++E)d[E+p]=this[E+v];else Uint8Array.prototype.set.call(d,this.subarray(v,v+b),p);return b},Bt.prototype.fill=function(d,p,v,x){if(typeof d=="string"){if(typeof p=="string"?(x=p,p=0,v=this.length):typeof v=="string"&&(x=v,v=this.length),d.length===1){var b=d.charCodeAt(0);b<256&&(d=b)}if(x!==void 0&&typeof x!="string")throw new TypeError("encoding must be a string");if(typeof x=="string"&&!Bt.isEncoding(x))throw new TypeError("Unknown encoding: "+x)}else typeof d=="number"&&(d=d&255);if(p<0||this.length<p||this.length<v)throw new RangeError("Out of range index");if(v<=p)return this;p=p>>>0,v=v===void 0?this.length:v>>>0,d||(d=0);var E;if(typeof d=="number")for(E=p;E<v;++E)this[E]=d;else{var S=pa(d)?d:y0(new Bt(d,x).toString()),C=S.length;for(E=0;E<v-p;++E)this[E+p]=S[E%C]}return this};var qP=/[^+\/0-9A-Za-z-_]/g;function XP(c){if(c=jP(c).replace(qP,""),c.length<2)return"";for(;c.length%4!==0;)c=c+"=";return c}function jP(c){return c.trim?c.trim():c.replace(/^\s+|\s+$/g,"")}function ZP(c){return c<16?"0"+c.toString(16):c.toString(16)}function y0(c,d){d=d||1/0;for(var p,v=c.length,x=null,b=[],E=0;E<v;++E){if(p=c.charCodeAt(E),p>55295&&p<57344){if(!x){if(p>56319){(d-=3)>-1&&b.push(239,191,189);continue}else if(E+1===v){(d-=3)>-1&&b.push(239,191,189);continue}x=p;continue}if(p<56320){(d-=3)>-1&&b.push(239,191,189),x=p;continue}p=(x-55296<<10|p-56320)+65536}else x&&(d-=3)>-1&&b.push(239,191,189);if(x=null,p<128){if((d-=1)<0)break;b.push(p)}else if(p<2048){if((d-=2)<0)break;b.push(p>>6|192,p&63|128)}else if(p<65536){if((d-=3)<0)break;b.push(p>>12|224,p>>6&63|128,p&63|128)}else if(p<1114112){if((d-=4)<0)break;b.push(p>>18|240,p>>12&63|128,p>>6&63|128,p&63|128)}else throw new Error("Invalid code point")}return b}function KP(c){for(var d=[],p=0;p<c.length;++p)d.push(c.charCodeAt(p)&255);return d}function JP(c,d){for(var p,v,x,b=[],E=0;E<c.length&&!((d-=2)<0);++E)p=c.charCodeAt(E),v=p>>8,x=p%256,b.push(x),b.push(v);return b}function cb(c){return TP(XP(c))}function _0(c,d,p,v){for(var x=0;x<v&&!(x+p>=d.length||x>=c.length);++x)d[x+p]=c[x];return x}function QP(c){return c!==c}function tF(c){return c!=null&&(!!c._isBuffer||ub(c)||eF(c))}function ub(c){return!!c.constructor&&typeof c.constructor.isBuffer=="function"&&c.constructor.isBuffer(c)}function eF(c){return typeof c.readFloatLE=="function"&&typeof c.slice=="function"&&ub(c.slice(0,0))}function db(){throw new Error("setTimeout has not been defined")}function fb(){throw new Error("clearTimeout has not been defined")}var Po=db,Fo=fb;typeof Wu.setTimeout=="function"&&(Po=setTimeout),typeof Wu.clearTimeout=="function"&&(Fo=clearTimeout);function pb(c){if(Po===setTimeout)return setTimeout(c,0);if((Po===db||!Po)&&setTimeout)return Po=setTimeout,setTimeout(c,0);try{return Po(c,0)}catch{try{return Po.call(null,c,0)}catch{return Po.call(this,c,0)}}}function iF(c){if(Fo===clearTimeout)return clearTimeout(c);if((Fo===fb||!Fo)&&clearTimeout)return Fo=clearTimeout,clearTimeout(c);try{return Fo(c)}catch{try{return Fo.call(null,c)}catch{return Fo.call(this,c)}}}var Wa=[],zl=!1,Oh,x0=-1;function nF(){!zl||!Oh||(zl=!1,Oh.length?Wa=Oh.concat(Wa):x0=-1,Wa.length&&mb())}function mb(){if(!zl){var c=pb(nF);zl=!0;for(var d=Wa.length;d;){for(Oh=Wa,Wa=[];++x0<d;)Oh&&Oh[x0].run();x0=-1,d=Wa.length}Oh=null,zl=!1,iF(c)}}function sF(c){var d=new Array(arguments.length-1);if(arguments.length>1)for(var p=1;p<arguments.length;p++)d[p-1]=arguments[p];Wa.push(new gb(c,d)),Wa.length===1&&!zl&&pb(mb)}function gb(c,d){this.fun=c,this.array=d}gb.prototype.run=function(){this.fun.apply(null,this.array)};var rF="browser",aF="browser",oF=!0,hF={},lF=[],cF="",uF={},dF={},fF={};function Ph(){}var pF=Ph,mF=Ph,gF=Ph,yF=Ph,_F=Ph,xF=Ph,vF=Ph;function wF(c){throw new Error("process.binding is not supported")}function bF(){return"/"}function MF(c){throw new Error("process.chdir is not supported")}function EF(){return 0}var Bl=Wu.performance||{},SF=Bl.now||Bl.mozNow||Bl.msNow||Bl.oNow||Bl.webkitNow||function(){return new Date().getTime()};function TF(c){var d=SF.call(Bl)*.001,p=Math.floor(d),v=Math.floor(d%1*1e9);return c&&(p=p-c[0],v=v-c[1],v<0&&(p--,v+=1e9)),[p,v]}var CF=new Date;function AF(){var c=new Date,d=c-CF;return d/1e3}var RF={nextTick:sF,title:rF,browser:oF,env:hF,argv:lF,version:cF,versions:uF,on:pF,addListener:mF,once:gF,off:yF,removeListener:_F,removeAllListeners:xF,emit:vF,binding:wF,cwd:bF,chdir:MF,umask:EF,hrtime:TF,platform:aF,release:dF,config:fF,uptime:AF},$u=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof wa<"u"?wa:typeof self<"u"?self:{};function yb(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}function IF(c){if(c.__esModule)return c;var d=c.default;if(typeof d=="function"){var p=function v(){return this instanceof v?Reflect.construct(d,arguments,this.constructor):d.apply(this,arguments)};p.prototype=d.prototype}else p={};return Object.defineProperty(p,"__esModule",{value:!0}),Object.keys(c).forEach(function(v){var x=Object.getOwnPropertyDescriptor(c,v);Object.defineProperty(p,v,x.get?x:{enumerable:!0,get:function(){return c[v]}})}),p}function v0(c){throw new Error('Could not dynamically require "'+c+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var _b={exports:{}};(function(c,d){(function(p){c.exports=p()})(function(){return function p(v,x,b){function E(N,U){if(!x[N]){if(!v[N]){var z=typeof v0=="function"&&v0;if(!U&&z)return z(N,!0);if(S)return S(N,!0);var H=new Error("Cannot find module '"+N+"'");throw H.code="MODULE_NOT_FOUND",H}var D=x[N]={exports:{}};v[N][0].call(D.exports,function(q){var V=v[N][1][q];return E(V||q)},D,D.exports,p,v,x,b)}return x[N].exports}for(var S=typeof v0=="function"&&v0,C=0;C<b.length;C++)E(b[C]);return E}({1:[function(p,v,x){var b=p("./utils"),E=p("./support"),S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";x.encode=function(C){for(var N,U,z,H,D,q,V,X=[],j=0,J=C.length,st=J,dt=b.getTypeOf(C)!=="string";j<C.length;)st=J-j,z=dt?(N=C[j++],U=j<J?C[j++]:0,j<J?C[j++]:0):(N=C.charCodeAt(j++),U=j<J?C.charCodeAt(j++):0,j<J?C.charCodeAt(j++):0),H=N>>2,D=(3&N)<<4|U>>4,q=1<st?(15&U)<<2|z>>6:64,V=2<st?63&z:64,X.push(S.charAt(H)+S.charAt(D)+S.charAt(q)+S.charAt(V));return X.join("")},x.decode=function(C){var N,U,z,H,D,q,V=0,X=0,j="data:";if(C.substr(0,j.length)===j)throw new Error("Invalid base64 input, it looks like a data url.");var J,st=3*(C=C.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(C.charAt(C.length-1)===S.charAt(64)&&st--,C.charAt(C.length-2)===S.charAt(64)&&st--,st%1!=0)throw new Error("Invalid base64 input, bad content length.");for(J=E.uint8array?new Uint8Array(0|st):new Array(0|st);V<C.length;)N=S.indexOf(C.charAt(V++))<<2|(H=S.indexOf(C.charAt(V++)))>>4,U=(15&H)<<4|(D=S.indexOf(C.charAt(V++)))>>2,z=(3&D)<<6|(q=S.indexOf(C.charAt(V++))),J[X++]=N,D!==64&&(J[X++]=U),q!==64&&(J[X++]=z);return J}},{"./support":30,"./utils":32}],2:[function(p,v,x){var b=p("./external"),E=p("./stream/DataWorker"),S=p("./stream/Crc32Probe"),C=p("./stream/DataLengthProbe");function N(U,z,H,D,q){this.compressedSize=U,this.uncompressedSize=z,this.crc32=H,this.compression=D,this.compressedContent=q}N.prototype={getContentWorker:function(){var U=new E(b.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new C("data_length")),z=this;return U.on("end",function(){if(this.streamInfo.data_length!==z.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),U},getCompressedWorker:function(){return new E(b.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},N.createWorkerFrom=function(U,z,H){return U.pipe(new S).pipe(new C("uncompressedSize")).pipe(z.compressWorker(H)).pipe(new C("compressedSize")).withStreamInfo("compression",z)},v.exports=N},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(p,v,x){var b=p("./stream/GenericWorker");x.STORE={magic:"\0\0",compressWorker:function(){return new b("STORE compression")},uncompressWorker:function(){return new b("STORE decompression")}},x.DEFLATE=p("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(p,v,x){var b=p("./utils"),E=function(){for(var S,C=[],N=0;N<256;N++){S=N;for(var U=0;U<8;U++)S=1&S?3988292384^S>>>1:S>>>1;C[N]=S}return C}();v.exports=function(S,C){return S!==void 0&&S.length?b.getTypeOf(S)!=="string"?function(N,U,z,H){var D=E,q=H+z;N^=-1;for(var V=H;V<q;V++)N=N>>>8^D[255&(N^U[V])];return-1^N}(0|C,S,S.length,0):function(N,U,z,H){var D=E,q=H+z;N^=-1;for(var V=H;V<q;V++)N=N>>>8^D[255&(N^U.charCodeAt(V))];return-1^N}(0|C,S,S.length,0):0}},{"./utils":32}],5:[function(p,v,x){x.base64=!1,x.binary=!1,x.dir=!1,x.createFolders=!0,x.date=null,x.compression=null,x.compressionOptions=null,x.comment=null,x.unixPermissions=null,x.dosPermissions=null},{}],6:[function(p,v,x){var b=null;b=typeof Promise<"u"?Promise:p("lie"),v.exports={Promise:b}},{lie:37}],7:[function(p,v,x){var b=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",E=p("pako"),S=p("./utils"),C=p("./stream/GenericWorker"),N=b?"uint8array":"array";function U(z,H){C.call(this,"FlateWorker/"+z),this._pako=null,this._pakoAction=z,this._pakoOptions=H,this.meta={}}x.magic="\b\0",S.inherits(U,C),U.prototype.processChunk=function(z){this.meta=z.meta,this._pako===null&&this._createPako(),this._pako.push(S.transformTo(N,z.data),!1)},U.prototype.flush=function(){C.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},U.prototype.cleanUp=function(){C.prototype.cleanUp.call(this),this._pako=null},U.prototype._createPako=function(){this._pako=new E[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var z=this;this._pako.onData=function(H){z.push({data:H,meta:z.meta})}},x.compressWorker=function(z){return new U("Deflate",z)},x.uncompressWorker=function(){return new U("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(p,v,x){function b(D,q){var V,X="";for(V=0;V<q;V++)X+=String.fromCharCode(255&D),D>>>=8;return X}function E(D,q,V,X,j,J){var st,dt,lt=D.file,bt=D.compression,It=J!==N.utf8encode,Vt=S.transformTo("string",J(lt.name)),Nt=S.transformTo("string",N.utf8encode(lt.name)),Jt=lt.comment,be=S.transformTo("string",J(Jt)),at=S.transformTo("string",N.utf8encode(Jt)),zt=Nt.length!==lt.name.length,$=at.length!==Jt.length,$t="",De="",te="",Ze=lt.dir,ae=lt.date,Le={crc32:0,compressedSize:0,uncompressedSize:0};q&&!V||(Le.crc32=D.crc32,Le.compressedSize=D.compressedSize,Le.uncompressedSize=D.uncompressedSize);var Rt=0;q&&(Rt|=8),It||!zt&&!$||(Rt|=2048);var St=0,Re=0;Ze&&(St|=16),j==="UNIX"?(Re=798,St|=function(he,Xi){var kn=he;return he||(kn=Xi?16893:33204),(65535&kn)<<16}(lt.unixPermissions,Ze)):(Re=20,St|=function(he){return 63&(he||0)}(lt.dosPermissions)),st=ae.getUTCHours(),st<<=6,st|=ae.getUTCMinutes(),st<<=5,st|=ae.getUTCSeconds()/2,dt=ae.getUTCFullYear()-1980,dt<<=4,dt|=ae.getUTCMonth()+1,dt<<=5,dt|=ae.getUTCDate(),zt&&(De=b(1,1)+b(U(Vt),4)+Nt,$t+="up"+b(De.length,2)+De),$&&(te=b(1,1)+b(U(be),4)+at,$t+="uc"+b(te.length,2)+te);var me="";return me+=`
\0`,me+=b(Rt,2),me+=bt.magic,me+=b(st,2),me+=b(dt,2),me+=b(Le.crc32,4),me+=b(Le.compressedSize,4),me+=b(Le.uncompressedSize,4),me+=b(Vt.length,2),me+=b($t.length,2),{fileRecord:z.LOCAL_FILE_HEADER+me+Vt+$t,dirRecord:z.CENTRAL_FILE_HEADER+b(Re,2)+me+b(be.length,2)+"\0\0\0\0"+b(St,4)+b(X,4)+Vt+$t+be}}var S=p("../utils"),C=p("../stream/GenericWorker"),N=p("../utf8"),U=p("../crc32"),z=p("../signature");function H(D,q,V,X){C.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=q,this.zipPlatform=V,this.encodeFileName=X,this.streamFiles=D,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}S.inherits(H,C),H.prototype.push=function(D){var q=D.meta.percent||0,V=this.entriesCount,X=this._sources.length;this.accumulate?this.contentBuffer.push(D):(this.bytesWritten+=D.data.length,C.prototype.push.call(this,{data:D.data,meta:{currentFile:this.currentFile,percent:V?(q+100*(V-X-1))/V:100}}))},H.prototype.openedSource=function(D){this.currentSourceOffset=this.bytesWritten,this.currentFile=D.file.name;var q=this.streamFiles&&!D.file.dir;if(q){var V=E(D,q,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:V.fileRecord,meta:{percent:0}})}else this.accumulate=!0},H.prototype.closedSource=function(D){this.accumulate=!1;var q=this.streamFiles&&!D.file.dir,V=E(D,q,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(V.dirRecord),q)this.push({data:function(X){return z.DATA_DESCRIPTOR+b(X.crc32,4)+b(X.compressedSize,4)+b(X.uncompressedSize,4)}(D),meta:{percent:100}});else for(this.push({data:V.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},H.prototype.flush=function(){for(var D=this.bytesWritten,q=0;q<this.dirRecords.length;q++)this.push({data:this.dirRecords[q],meta:{percent:100}});var V=this.bytesWritten-D,X=function(j,J,st,dt,lt){var bt=S.transformTo("string",lt(dt));return z.CENTRAL_DIRECTORY_END+"\0\0\0\0"+b(j,2)+b(j,2)+b(J,4)+b(st,4)+b(bt.length,2)+bt}(this.dirRecords.length,V,D,this.zipComment,this.encodeFileName);this.push({data:X,meta:{percent:100}})},H.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},H.prototype.registerPrevious=function(D){this._sources.push(D);var q=this;return D.on("data",function(V){q.processChunk(V)}),D.on("end",function(){q.closedSource(q.previous.streamInfo),q._sources.length?q.prepareNextSource():q.end()}),D.on("error",function(V){q.error(V)}),this},H.prototype.resume=function(){return!!C.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},H.prototype.error=function(D){var q=this._sources;if(!C.prototype.error.call(this,D))return!1;for(var V=0;V<q.length;V++)try{q[V].error(D)}catch{}return!0},H.prototype.lock=function(){C.prototype.lock.call(this);for(var D=this._sources,q=0;q<D.length;q++)D[q].lock()},v.exports=H},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(p,v,x){var b=p("../compressions"),E=p("./ZipFileWorker");x.generateWorker=function(S,C,N){var U=new E(C.streamFiles,N,C.platform,C.encodeFileName),z=0;try{S.forEach(function(H,D){z++;var q=function(J,st){var dt=J||st,lt=b[dt];if(!lt)throw new Error(dt+" is not a valid compression method !");return lt}(D.options.compression,C.compression),V=D.options.compressionOptions||C.compressionOptions||{},X=D.dir,j=D.date;D._compressWorker(q,V).withStreamInfo("file",{name:H,dir:X,date:j,comment:D.comment||"",unixPermissions:D.unixPermissions,dosPermissions:D.dosPermissions}).pipe(U)}),U.entriesCount=z}catch(H){U.error(H)}return U}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(p,v,x){function b(){if(!(this instanceof b))return new b;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var E=new b;for(var S in this)typeof this[S]!="function"&&(E[S]=this[S]);return E}}(b.prototype=p("./object")).loadAsync=p("./load"),b.support=p("./support"),b.defaults=p("./defaults"),b.version="3.10.1",b.loadAsync=function(E,S){return new b().loadAsync(E,S)},b.external=p("./external"),v.exports=b},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(p,v,x){var b=p("./utils"),E=p("./external"),S=p("./utf8"),C=p("./zipEntries"),N=p("./stream/Crc32Probe"),U=p("./nodejsUtils");function z(H){return new E.Promise(function(D,q){var V=H.decompressed.getContentWorker().pipe(new N);V.on("error",function(X){q(X)}).on("end",function(){V.streamInfo.crc32!==H.decompressed.crc32?q(new Error("Corrupted zip : CRC32 mismatch")):D()}).resume()})}v.exports=function(H,D){var q=this;return D=b.extend(D||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:S.utf8decode}),U.isNode&&U.isStream(H)?E.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):b.prepareContent("the loaded zip file",H,!0,D.optimizedBinaryString,D.base64).then(function(V){var X=new C(D);return X.load(V),X}).then(function(V){var X=[E.Promise.resolve(V)],j=V.files;if(D.checkCRC32)for(var J=0;J<j.length;J++)X.push(z(j[J]));return E.Promise.all(X)}).then(function(V){for(var X=V.shift(),j=X.files,J=0;J<j.length;J++){var st=j[J],dt=st.fileNameStr,lt=b.resolve(st.fileNameStr);q.file(lt,st.decompressed,{binary:!0,optimizedBinaryString:!0,date:st.date,dir:st.dir,comment:st.fileCommentStr.length?st.fileCommentStr:null,unixPermissions:st.unixPermissions,dosPermissions:st.dosPermissions,createFolders:D.createFolders}),st.dir||(q.file(lt).unsafeOriginalName=dt)}return X.zipComment.length&&(q.comment=X.zipComment),q})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(p,v,x){var b=p("../utils"),E=p("../stream/GenericWorker");function S(C,N){E.call(this,"Nodejs stream input adapter for "+C),this._upstreamEnded=!1,this._bindStream(N)}b.inherits(S,E),S.prototype._bindStream=function(C){var N=this;(this._stream=C).pause(),C.on("data",function(U){N.push({data:U,meta:{percent:0}})}).on("error",function(U){N.isPaused?this.generatedError=U:N.error(U)}).on("end",function(){N.isPaused?N._upstreamEnded=!0:N.end()})},S.prototype.pause=function(){return!!E.prototype.pause.call(this)&&(this._stream.pause(),!0)},S.prototype.resume=function(){return!!E.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},v.exports=S},{"../stream/GenericWorker":28,"../utils":32}],13:[function(p,v,x){var b=p("readable-stream").Readable;function E(S,C,N){b.call(this,C),this._helper=S;var U=this;S.on("data",function(z,H){U.push(z)||U._helper.pause(),N&&N(H)}).on("error",function(z){U.emit("error",z)}).on("end",function(){U.push(null)})}p("../utils").inherits(E,b),E.prototype._read=function(){this._helper.resume()},v.exports=E},{"../utils":32,"readable-stream":16}],14:[function(p,v,x){v.exports={isNode:typeof Bt<"u",newBufferFrom:function(b,E){if(Bt.from&&Bt.from!==Uint8Array.from)return Bt.from(b,E);if(typeof b=="number")throw new Error('The "data" argument must not be a number');return new Bt(b,E)},allocBuffer:function(b){if(Bt.alloc)return Bt.alloc(b);var E=new Bt(b);return E.fill(0),E},isBuffer:function(b){return Bt.isBuffer(b)},isStream:function(b){return b&&typeof b.on=="function"&&typeof b.pause=="function"&&typeof b.resume=="function"}}},{}],15:[function(p,v,x){function b(lt,bt,It){var Vt,Nt=S.getTypeOf(bt),Jt=S.extend(It||{},U);Jt.date=Jt.date||new Date,Jt.compression!==null&&(Jt.compression=Jt.compression.toUpperCase()),typeof Jt.unixPermissions=="string"&&(Jt.unixPermissions=parseInt(Jt.unixPermissions,8)),Jt.unixPermissions&&16384&Jt.unixPermissions&&(Jt.dir=!0),Jt.dosPermissions&&16&Jt.dosPermissions&&(Jt.dir=!0),Jt.dir&&(lt=j(lt)),Jt.createFolders&&(Vt=X(lt))&&J.call(this,Vt,!0);var be=Nt==="string"&&Jt.binary===!1&&Jt.base64===!1;It&&It.binary!==void 0||(Jt.binary=!be),(bt instanceof z&&bt.uncompressedSize===0||Jt.dir||!bt||bt.length===0)&&(Jt.base64=!1,Jt.binary=!0,bt="",Jt.compression="STORE",Nt="string");var at=null;at=bt instanceof z||bt instanceof C?bt:q.isNode&&q.isStream(bt)?new V(lt,bt):S.prepareContent(lt,bt,Jt.binary,Jt.optimizedBinaryString,Jt.base64);var zt=new H(lt,at,Jt);this.files[lt]=zt}var E=p("./utf8"),S=p("./utils"),C=p("./stream/GenericWorker"),N=p("./stream/StreamHelper"),U=p("./defaults"),z=p("./compressedObject"),H=p("./zipObject"),D=p("./generate"),q=p("./nodejsUtils"),V=p("./nodejs/NodejsStreamInputAdapter"),X=function(lt){lt.slice(-1)==="/"&&(lt=lt.substring(0,lt.length-1));var bt=lt.lastIndexOf("/");return 0<bt?lt.substring(0,bt):""},j=function(lt){return lt.slice(-1)!=="/"&&(lt+="/"),lt},J=function(lt,bt){return bt=bt!==void 0?bt:U.createFolders,lt=j(lt),this.files[lt]||b.call(this,lt,null,{dir:!0,createFolders:bt}),this.files[lt]};function st(lt){return Object.prototype.toString.call(lt)==="[object RegExp]"}var dt={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(lt){var bt,It,Vt;for(bt in this.files)Vt=this.files[bt],(It=bt.slice(this.root.length,bt.length))&&bt.slice(0,this.root.length)===this.root&&lt(It,Vt)},filter:function(lt){var bt=[];return this.forEach(function(It,Vt){lt(It,Vt)&&bt.push(Vt)}),bt},file:function(lt,bt,It){if(arguments.length!==1)return lt=this.root+lt,b.call(this,lt,bt,It),this;if(st(lt)){var Vt=lt;return this.filter(function(Jt,be){return!be.dir&&Vt.test(Jt)})}var Nt=this.files[this.root+lt];return Nt&&!Nt.dir?Nt:null},folder:function(lt){if(!lt)return this;if(st(lt))return this.filter(function(Nt,Jt){return Jt.dir&&lt.test(Nt)});var bt=this.root+lt,It=J.call(this,bt),Vt=this.clone();return Vt.root=It.name,Vt},remove:function(lt){lt=this.root+lt;var bt=this.files[lt];if(bt||(lt.slice(-1)!=="/"&&(lt+="/"),bt=this.files[lt]),bt&&!bt.dir)delete this.files[lt];else for(var It=this.filter(function(Nt,Jt){return Jt.name.slice(0,lt.length)===lt}),Vt=0;Vt<It.length;Vt++)delete this.files[It[Vt].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(lt){var bt,It={};try{if((It=S.extend(lt||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:E.utf8encode})).type=It.type.toLowerCase(),It.compression=It.compression.toUpperCase(),It.type==="binarystring"&&(It.type="string"),!It.type)throw new Error("No output type specified.");S.checkSupport(It.type),It.platform!=="darwin"&&It.platform!=="freebsd"&&It.platform!=="linux"&&It.platform!=="sunos"||(It.platform="UNIX"),It.platform==="win32"&&(It.platform="DOS");var Vt=It.comment||this.comment||"";bt=D.generateWorker(this,It,Vt)}catch(Nt){(bt=new C("error")).error(Nt)}return new N(bt,It.type||"string",It.mimeType)},generateAsync:function(lt,bt){return this.generateInternalStream(lt).accumulate(bt)},generateNodeStream:function(lt,bt){return(lt=lt||{}).type||(lt.type="nodebuffer"),this.generateInternalStream(lt).toNodejsStream(bt)}};v.exports=dt},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(p,v,x){v.exports=p("stream")},{stream:void 0}],17:[function(p,v,x){var b=p("./DataReader");function E(S){b.call(this,S);for(var C=0;C<this.data.length;C++)S[C]=255&S[C]}p("../utils").inherits(E,b),E.prototype.byteAt=function(S){return this.data[this.zero+S]},E.prototype.lastIndexOfSignature=function(S){for(var C=S.charCodeAt(0),N=S.charCodeAt(1),U=S.charCodeAt(2),z=S.charCodeAt(3),H=this.length-4;0<=H;--H)if(this.data[H]===C&&this.data[H+1]===N&&this.data[H+2]===U&&this.data[H+3]===z)return H-this.zero;return-1},E.prototype.readAndCheckSignature=function(S){var C=S.charCodeAt(0),N=S.charCodeAt(1),U=S.charCodeAt(2),z=S.charCodeAt(3),H=this.readData(4);return C===H[0]&&N===H[1]&&U===H[2]&&z===H[3]},E.prototype.readData=function(S){if(this.checkOffset(S),S===0)return[];var C=this.data.slice(this.zero+this.index,this.zero+this.index+S);return this.index+=S,C},v.exports=E},{"../utils":32,"./DataReader":18}],18:[function(p,v,x){var b=p("../utils");function E(S){this.data=S,this.length=S.length,this.index=0,this.zero=0}E.prototype={checkOffset:function(S){this.checkIndex(this.index+S)},checkIndex:function(S){if(this.length<this.zero+S||S<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+S+"). Corrupted zip ?")},setIndex:function(S){this.checkIndex(S),this.index=S},skip:function(S){this.setIndex(this.index+S)},byteAt:function(){},readInt:function(S){var C,N=0;for(this.checkOffset(S),C=this.index+S-1;C>=this.index;C--)N=(N<<8)+this.byteAt(C);return this.index+=S,N},readString:function(S){return b.transformTo("string",this.readData(S))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var S=this.readInt(4);return new Date(Date.UTC(1980+(S>>25&127),(S>>21&15)-1,S>>16&31,S>>11&31,S>>5&63,(31&S)<<1))}},v.exports=E},{"../utils":32}],19:[function(p,v,x){var b=p("./Uint8ArrayReader");function E(S){b.call(this,S)}p("../utils").inherits(E,b),E.prototype.readData=function(S){this.checkOffset(S);var C=this.data.slice(this.zero+this.index,this.zero+this.index+S);return this.index+=S,C},v.exports=E},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(p,v,x){var b=p("./DataReader");function E(S){b.call(this,S)}p("../utils").inherits(E,b),E.prototype.byteAt=function(S){return this.data.charCodeAt(this.zero+S)},E.prototype.lastIndexOfSignature=function(S){return this.data.lastIndexOf(S)-this.zero},E.prototype.readAndCheckSignature=function(S){return S===this.readData(4)},E.prototype.readData=function(S){this.checkOffset(S);var C=this.data.slice(this.zero+this.index,this.zero+this.index+S);return this.index+=S,C},v.exports=E},{"../utils":32,"./DataReader":18}],21:[function(p,v,x){var b=p("./ArrayReader");function E(S){b.call(this,S)}p("../utils").inherits(E,b),E.prototype.readData=function(S){if(this.checkOffset(S),S===0)return new Uint8Array(0);var C=this.data.subarray(this.zero+this.index,this.zero+this.index+S);return this.index+=S,C},v.exports=E},{"../utils":32,"./ArrayReader":17}],22:[function(p,v,x){var b=p("../utils"),E=p("../support"),S=p("./ArrayReader"),C=p("./StringReader"),N=p("./NodeBufferReader"),U=p("./Uint8ArrayReader");v.exports=function(z){var H=b.getTypeOf(z);return b.checkSupport(H),H!=="string"||E.uint8array?H==="nodebuffer"?new N(z):E.uint8array?new U(b.transformTo("uint8array",z)):new S(b.transformTo("array",z)):new C(z)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(p,v,x){x.LOCAL_FILE_HEADER="PK",x.CENTRAL_FILE_HEADER="PK",x.CENTRAL_DIRECTORY_END="PK",x.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",x.ZIP64_CENTRAL_DIRECTORY_END="PK",x.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(p,v,x){var b=p("./GenericWorker"),E=p("../utils");function S(C){b.call(this,"ConvertWorker to "+C),this.destType=C}E.inherits(S,b),S.prototype.processChunk=function(C){this.push({data:E.transformTo(this.destType,C.data),meta:C.meta})},v.exports=S},{"../utils":32,"./GenericWorker":28}],25:[function(p,v,x){var b=p("./GenericWorker"),E=p("../crc32");function S(){b.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}p("../utils").inherits(S,b),S.prototype.processChunk=function(C){this.streamInfo.crc32=E(C.data,this.streamInfo.crc32||0),this.push(C)},v.exports=S},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(p,v,x){var b=p("../utils"),E=p("./GenericWorker");function S(C){E.call(this,"DataLengthProbe for "+C),this.propName=C,this.withStreamInfo(C,0)}b.inherits(S,E),S.prototype.processChunk=function(C){if(C){var N=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=N+C.data.length}E.prototype.processChunk.call(this,C)},v.exports=S},{"../utils":32,"./GenericWorker":28}],27:[function(p,v,x){var b=p("../utils"),E=p("./GenericWorker");function S(C){E.call(this,"DataWorker");var N=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,C.then(function(U){N.dataIsReady=!0,N.data=U,N.max=U&&U.length||0,N.type=b.getTypeOf(U),N.isPaused||N._tickAndRepeat()},function(U){N.error(U)})}b.inherits(S,E),S.prototype.cleanUp=function(){E.prototype.cleanUp.call(this),this.data=null},S.prototype.resume=function(){return!!E.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,b.delay(this._tickAndRepeat,[],this)),!0)},S.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(b.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},S.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var C=null,N=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":C=this.data.substring(this.index,N);break;case"uint8array":C=this.data.subarray(this.index,N);break;case"array":case"nodebuffer":C=this.data.slice(this.index,N)}return this.index=N,this.push({data:C,meta:{percent:this.max?this.index/this.max*100:0}})},v.exports=S},{"../utils":32,"./GenericWorker":28}],28:[function(p,v,x){function b(E){this.name=E||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}b.prototype={push:function(E){this.emit("data",E)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(E){this.emit("error",E)}return!0},error:function(E){return!this.isFinished&&(this.isPaused?this.generatedError=E:(this.isFinished=!0,this.emit("error",E),this.previous&&this.previous.error(E),this.cleanUp()),!0)},on:function(E,S){return this._listeners[E].push(S),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(E,S){if(this._listeners[E])for(var C=0;C<this._listeners[E].length;C++)this._listeners[E][C].call(this,S)},pipe:function(E){return E.registerPrevious(this)},registerPrevious:function(E){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=E.streamInfo,this.mergeStreamInfo(),this.previous=E;var S=this;return E.on("data",function(C){S.processChunk(C)}),E.on("end",function(){S.end()}),E.on("error",function(C){S.error(C)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var E=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),E=!0),this.previous&&this.previous.resume(),!E},flush:function(){},processChunk:function(E){this.push(E)},withStreamInfo:function(E,S){return this.extraStreamInfo[E]=S,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var E in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,E)&&(this.streamInfo[E]=this.extraStreamInfo[E])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var E="Worker "+this.name;return this.previous?this.previous+" -> "+E:E}},v.exports=b},{}],29:[function(p,v,x){var b=p("../utils"),E=p("./ConvertWorker"),S=p("./GenericWorker"),C=p("../base64"),N=p("../support"),U=p("../external"),z=null;if(N.nodestream)try{z=p("../nodejs/NodejsStreamOutputAdapter")}catch{}function H(q,V){return new U.Promise(function(X,j){var J=[],st=q._internalType,dt=q._outputType,lt=q._mimeType;q.on("data",function(bt,It){J.push(bt),V&&V(It)}).on("error",function(bt){J=[],j(bt)}).on("end",function(){try{var bt=function(It,Vt,Nt){switch(It){case"blob":return b.newBlob(b.transformTo("arraybuffer",Vt),Nt);case"base64":return C.encode(Vt);default:return b.transformTo(It,Vt)}}(dt,function(It,Vt){var Nt,Jt=0,be=null,at=0;for(Nt=0;Nt<Vt.length;Nt++)at+=Vt[Nt].length;switch(It){case"string":return Vt.join("");case"array":return Array.prototype.concat.apply([],Vt);case"uint8array":for(be=new Uint8Array(at),Nt=0;Nt<Vt.length;Nt++)be.set(Vt[Nt],Jt),Jt+=Vt[Nt].length;return be;case"nodebuffer":return Bt.concat(Vt);default:throw new Error("concat : unsupported type '"+It+"'")}}(st,J),lt);X(bt)}catch(It){j(It)}J=[]}).resume()})}function D(q,V,X){var j=V;switch(V){case"blob":case"arraybuffer":j="uint8array";break;case"base64":j="string"}try{this._internalType=j,this._outputType=V,this._mimeType=X,b.checkSupport(j),this._worker=q.pipe(new E(j)),q.lock()}catch(J){this._worker=new S("error"),this._worker.error(J)}}D.prototype={accumulate:function(q){return H(this,q)},on:function(q,V){var X=this;return q==="data"?this._worker.on(q,function(j){V.call(X,j.data,j.meta)}):this._worker.on(q,function(){b.delay(V,arguments,X)}),this},resume:function(){return b.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(q){if(b.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new z(this,{objectMode:this._outputType!=="nodebuffer"},q)}},v.exports=D},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(p,v,x){if(x.base64=!0,x.array=!0,x.string=!0,x.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",x.nodebuffer=typeof Bt<"u",x.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")x.blob=!1;else{var b=new ArrayBuffer(0);try{x.blob=new Blob([b],{type:"application/zip"}).size===0}catch{try{var E=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);E.append(b),x.blob=E.getBlob("application/zip").size===0}catch{x.blob=!1}}}try{x.nodestream=!!p("readable-stream").Readable}catch{x.nodestream=!1}},{"readable-stream":16}],31:[function(p,v,x){for(var b=p("./utils"),E=p("./support"),S=p("./nodejsUtils"),C=p("./stream/GenericWorker"),N=new Array(256),U=0;U<256;U++)N[U]=252<=U?6:248<=U?5:240<=U?4:224<=U?3:192<=U?2:1;N[254]=N[254]=1;function z(){C.call(this,"utf-8 decode"),this.leftOver=null}function H(){C.call(this,"utf-8 encode")}x.utf8encode=function(D){return E.nodebuffer?S.newBufferFrom(D,"utf-8"):function(q){var V,X,j,J,st,dt=q.length,lt=0;for(J=0;J<dt;J++)(64512&(X=q.charCodeAt(J)))==55296&&J+1<dt&&(64512&(j=q.charCodeAt(J+1)))==56320&&(X=65536+(X-55296<<10)+(j-56320),J++),lt+=X<128?1:X<2048?2:X<65536?3:4;for(V=E.uint8array?new Uint8Array(lt):new Array(lt),J=st=0;st<lt;J++)(64512&(X=q.charCodeAt(J)))==55296&&J+1<dt&&(64512&(j=q.charCodeAt(J+1)))==56320&&(X=65536+(X-55296<<10)+(j-56320),J++),X<128?V[st++]=X:(X<2048?V[st++]=192|X>>>6:(X<65536?V[st++]=224|X>>>12:(V[st++]=240|X>>>18,V[st++]=128|X>>>12&63),V[st++]=128|X>>>6&63),V[st++]=128|63&X);return V}(D)},x.utf8decode=function(D){return E.nodebuffer?b.transformTo("nodebuffer",D).toString("utf-8"):function(q){var V,X,j,J,st=q.length,dt=new Array(2*st);for(V=X=0;V<st;)if((j=q[V++])<128)dt[X++]=j;else if(4<(J=N[j]))dt[X++]=65533,V+=J-1;else{for(j&=J===2?31:J===3?15:7;1<J&&V<st;)j=j<<6|63&q[V++],J--;1<J?dt[X++]=65533:j<65536?dt[X++]=j:(j-=65536,dt[X++]=55296|j>>10&1023,dt[X++]=56320|1023&j)}return dt.length!==X&&(dt.subarray?dt=dt.subarray(0,X):dt.length=X),b.applyFromCharCode(dt)}(D=b.transformTo(E.uint8array?"uint8array":"array",D))},b.inherits(z,C),z.prototype.processChunk=function(D){var q=b.transformTo(E.uint8array?"uint8array":"array",D.data);if(this.leftOver&&this.leftOver.length){if(E.uint8array){var V=q;(q=new Uint8Array(V.length+this.leftOver.length)).set(this.leftOver,0),q.set(V,this.leftOver.length)}else q=this.leftOver.concat(q);this.leftOver=null}var X=function(J,st){var dt;for((st=st||J.length)>J.length&&(st=J.length),dt=st-1;0<=dt&&(192&J[dt])==128;)dt--;return dt<0||dt===0?st:dt+N[J[dt]]>st?dt:st}(q),j=q;X!==q.length&&(E.uint8array?(j=q.subarray(0,X),this.leftOver=q.subarray(X,q.length)):(j=q.slice(0,X),this.leftOver=q.slice(X,q.length))),this.push({data:x.utf8decode(j),meta:D.meta})},z.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:x.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},x.Utf8DecodeWorker=z,b.inherits(H,C),H.prototype.processChunk=function(D){this.push({data:x.utf8encode(D.data),meta:D.meta})},x.Utf8EncodeWorker=H},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(p,v,x){var b=p("./support"),E=p("./base64"),S=p("./nodejsUtils"),C=p("./external");function N(V){return V}function U(V,X){for(var j=0;j<V.length;++j)X[j]=255&V.charCodeAt(j);return X}p("setimmediate"),x.newBlob=function(V,X){x.checkSupport("blob");try{return new Blob([V],{type:X})}catch{try{var j=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return j.append(V),j.getBlob(X)}catch{throw new Error("Bug : can't construct the Blob.")}}};var z={stringifyByChunk:function(V,X,j){var J=[],st=0,dt=V.length;if(dt<=j)return String.fromCharCode.apply(null,V);for(;st<dt;)X==="array"||X==="nodebuffer"?J.push(String.fromCharCode.apply(null,V.slice(st,Math.min(st+j,dt)))):J.push(String.fromCharCode.apply(null,V.subarray(st,Math.min(st+j,dt)))),st+=j;return J.join("")},stringifyByChar:function(V){for(var X="",j=0;j<V.length;j++)X+=String.fromCharCode(V[j]);return X},applyCanBeUsed:{uint8array:function(){try{return b.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return b.nodebuffer&&String.fromCharCode.apply(null,S.allocBuffer(1)).length===1}catch{return!1}}()}};function H(V){var X=65536,j=x.getTypeOf(V),J=!0;if(j==="uint8array"?J=z.applyCanBeUsed.uint8array:j==="nodebuffer"&&(J=z.applyCanBeUsed.nodebuffer),J)for(;1<X;)try{return z.stringifyByChunk(V,j,X)}catch{X=Math.floor(X/2)}return z.stringifyByChar(V)}function D(V,X){for(var j=0;j<V.length;j++)X[j]=V[j];return X}x.applyFromCharCode=H;var q={};q.string={string:N,array:function(V){return U(V,new Array(V.length))},arraybuffer:function(V){return q.string.uint8array(V).buffer},uint8array:function(V){return U(V,new Uint8Array(V.length))},nodebuffer:function(V){return U(V,S.allocBuffer(V.length))}},q.array={string:H,array:N,arraybuffer:function(V){return new Uint8Array(V).buffer},uint8array:function(V){return new Uint8Array(V)},nodebuffer:function(V){return S.newBufferFrom(V)}},q.arraybuffer={string:function(V){return H(new Uint8Array(V))},array:function(V){return D(new Uint8Array(V),new Array(V.byteLength))},arraybuffer:N,uint8array:function(V){return new Uint8Array(V)},nodebuffer:function(V){return S.newBufferFrom(new Uint8Array(V))}},q.uint8array={string:H,array:function(V){return D(V,new Array(V.length))},arraybuffer:function(V){return V.buffer},uint8array:N,nodebuffer:function(V){return S.newBufferFrom(V)}},q.nodebuffer={string:H,array:function(V){return D(V,new Array(V.length))},arraybuffer:function(V){return q.nodebuffer.uint8array(V).buffer},uint8array:function(V){return D(V,new Uint8Array(V.length))},nodebuffer:N},x.transformTo=function(V,X){if(X=X||"",!V)return X;x.checkSupport(V);var j=x.getTypeOf(X);return q[j][V](X)},x.resolve=function(V){for(var X=V.split("/"),j=[],J=0;J<X.length;J++){var st=X[J];st==="."||st===""&&J!==0&&J!==X.length-1||(st===".."?j.pop():j.push(st))}return j.join("/")},x.getTypeOf=function(V){return typeof V=="string"?"string":Object.prototype.toString.call(V)==="[object Array]"?"array":b.nodebuffer&&S.isBuffer(V)?"nodebuffer":b.uint8array&&V instanceof Uint8Array?"uint8array":b.arraybuffer&&V instanceof ArrayBuffer?"arraybuffer":void 0},x.checkSupport=function(V){if(!b[V.toLowerCase()])throw new Error(V+" is not supported by this platform")},x.MAX_VALUE_16BITS=65535,x.MAX_VALUE_32BITS=-1,x.pretty=function(V){var X,j,J="";for(j=0;j<(V||"").length;j++)J+="\\x"+((X=V.charCodeAt(j))<16?"0":"")+X.toString(16).toUpperCase();return J},x.delay=function(V,X,j){setImmediate(function(){V.apply(j||null,X||[])})},x.inherits=function(V,X){function j(){}j.prototype=X.prototype,V.prototype=new j},x.extend=function(){var V,X,j={};for(V=0;V<arguments.length;V++)for(X in arguments[V])Object.prototype.hasOwnProperty.call(arguments[V],X)&&j[X]===void 0&&(j[X]=arguments[V][X]);return j},x.prepareContent=function(V,X,j,J,st){return C.Promise.resolve(X).then(function(dt){return b.blob&&(dt instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(dt))!==-1)&&typeof FileReader<"u"?new C.Promise(function(lt,bt){var It=new FileReader;It.onload=function(Vt){lt(Vt.target.result)},It.onerror=function(Vt){bt(Vt.target.error)},It.readAsArrayBuffer(dt)}):dt}).then(function(dt){var lt=x.getTypeOf(dt);return lt?(lt==="arraybuffer"?dt=x.transformTo("uint8array",dt):lt==="string"&&(st?dt=E.decode(dt):j&&J!==!0&&(dt=function(bt){return U(bt,b.uint8array?new Uint8Array(bt.length):new Array(bt.length))}(dt))),dt):C.Promise.reject(new Error("Can't read the data of '"+V+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(p,v,x){var b=p("./reader/readerFor"),E=p("./utils"),S=p("./signature"),C=p("./zipEntry"),N=p("./support");function U(z){this.files=[],this.loadOptions=z}U.prototype={checkSignature:function(z){if(!this.reader.readAndCheckSignature(z)){this.reader.index-=4;var H=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+E.pretty(H)+", expected "+E.pretty(z)+")")}},isSignature:function(z,H){var D=this.reader.index;this.reader.setIndex(z);var q=this.reader.readString(4)===H;return this.reader.setIndex(D),q},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var z=this.reader.readData(this.zipCommentLength),H=N.uint8array?"uint8array":"array",D=E.transformTo(H,z);this.zipComment=this.loadOptions.decodeFileName(D)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var z,H,D,q=this.zip64EndOfCentralSize-44;0<q;)z=this.reader.readInt(2),H=this.reader.readInt(4),D=this.reader.readData(H),this.zip64ExtensibleData[z]={id:z,length:H,value:D}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var z,H;for(z=0;z<this.files.length;z++)H=this.files[z],this.reader.setIndex(H.localHeaderOffset),this.checkSignature(S.LOCAL_FILE_HEADER),H.readLocalPart(this.reader),H.handleUTF8(),H.processAttributes()},readCentralDir:function(){var z;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(S.CENTRAL_FILE_HEADER);)(z=new C({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(z);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var z=this.reader.lastIndexOfSignature(S.CENTRAL_DIRECTORY_END);if(z<0)throw this.isSignature(0,S.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(z);var H=z;if(this.checkSignature(S.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===E.MAX_VALUE_16BITS||this.diskWithCentralDirStart===E.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===E.MAX_VALUE_16BITS||this.centralDirRecords===E.MAX_VALUE_16BITS||this.centralDirSize===E.MAX_VALUE_32BITS||this.centralDirOffset===E.MAX_VALUE_32BITS){if(this.zip64=!0,(z=this.reader.lastIndexOfSignature(S.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(z),this.checkSignature(S.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,S.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(S.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(S.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var D=this.centralDirOffset+this.centralDirSize;this.zip64&&(D+=20,D+=12+this.zip64EndOfCentralSize);var q=H-D;if(0<q)this.isSignature(H,S.CENTRAL_FILE_HEADER)||(this.reader.zero=q);else if(q<0)throw new Error("Corrupted zip: missing "+Math.abs(q)+" bytes.")},prepareReader:function(z){this.reader=b(z)},load:function(z){this.prepareReader(z),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},v.exports=U},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(p,v,x){var b=p("./reader/readerFor"),E=p("./utils"),S=p("./compressedObject"),C=p("./crc32"),N=p("./utf8"),U=p("./compressions"),z=p("./support");function H(D,q){this.options=D,this.loadOptions=q}H.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(D){var q,V;if(D.skip(22),this.fileNameLength=D.readInt(2),V=D.readInt(2),this.fileName=D.readData(this.fileNameLength),D.skip(V),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((q=function(X){for(var j in U)if(Object.prototype.hasOwnProperty.call(U,j)&&U[j].magic===X)return U[j];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+E.pretty(this.compressionMethod)+" unknown (inner file : "+E.transformTo("string",this.fileName)+")");this.decompressed=new S(this.compressedSize,this.uncompressedSize,this.crc32,q,D.readData(this.compressedSize))},readCentralPart:function(D){this.versionMadeBy=D.readInt(2),D.skip(2),this.bitFlag=D.readInt(2),this.compressionMethod=D.readString(2),this.date=D.readDate(),this.crc32=D.readInt(4),this.compressedSize=D.readInt(4),this.uncompressedSize=D.readInt(4);var q=D.readInt(2);if(this.extraFieldsLength=D.readInt(2),this.fileCommentLength=D.readInt(2),this.diskNumberStart=D.readInt(2),this.internalFileAttributes=D.readInt(2),this.externalFileAttributes=D.readInt(4),this.localHeaderOffset=D.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");D.skip(q),this.readExtraFields(D),this.parseZIP64ExtraField(D),this.fileComment=D.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var D=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),D==0&&(this.dosPermissions=63&this.externalFileAttributes),D==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var D=b(this.extraFields[1].value);this.uncompressedSize===E.MAX_VALUE_32BITS&&(this.uncompressedSize=D.readInt(8)),this.compressedSize===E.MAX_VALUE_32BITS&&(this.compressedSize=D.readInt(8)),this.localHeaderOffset===E.MAX_VALUE_32BITS&&(this.localHeaderOffset=D.readInt(8)),this.diskNumberStart===E.MAX_VALUE_32BITS&&(this.diskNumberStart=D.readInt(4))}},readExtraFields:function(D){var q,V,X,j=D.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});D.index+4<j;)q=D.readInt(2),V=D.readInt(2),X=D.readData(V),this.extraFields[q]={id:q,length:V,value:X};D.setIndex(j)},handleUTF8:function(){var D=z.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=N.utf8decode(this.fileName),this.fileCommentStr=N.utf8decode(this.fileComment);else{var q=this.findExtraFieldUnicodePath();if(q!==null)this.fileNameStr=q;else{var V=E.transformTo(D,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(V)}var X=this.findExtraFieldUnicodeComment();if(X!==null)this.fileCommentStr=X;else{var j=E.transformTo(D,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(j)}}},findExtraFieldUnicodePath:function(){var D=this.extraFields[28789];if(D){var q=b(D.value);return q.readInt(1)!==1||C(this.fileName)!==q.readInt(4)?null:N.utf8decode(q.readData(D.length-5))}return null},findExtraFieldUnicodeComment:function(){var D=this.extraFields[25461];if(D){var q=b(D.value);return q.readInt(1)!==1||C(this.fileComment)!==q.readInt(4)?null:N.utf8decode(q.readData(D.length-5))}return null}},v.exports=H},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(p,v,x){function b(q,V,X){this.name=q,this.dir=X.dir,this.date=X.date,this.comment=X.comment,this.unixPermissions=X.unixPermissions,this.dosPermissions=X.dosPermissions,this._data=V,this._dataBinary=X.binary,this.options={compression:X.compression,compressionOptions:X.compressionOptions}}var E=p("./stream/StreamHelper"),S=p("./stream/DataWorker"),C=p("./utf8"),N=p("./compressedObject"),U=p("./stream/GenericWorker");b.prototype={internalStream:function(q){var V=null,X="string";try{if(!q)throw new Error("No output type specified.");var j=(X=q.toLowerCase())==="string"||X==="text";X!=="binarystring"&&X!=="text"||(X="string"),V=this._decompressWorker();var J=!this._dataBinary;J&&!j&&(V=V.pipe(new C.Utf8EncodeWorker)),!J&&j&&(V=V.pipe(new C.Utf8DecodeWorker))}catch(st){(V=new U("error")).error(st)}return new E(V,X,"")},async:function(q,V){return this.internalStream(q).accumulate(V)},nodeStream:function(q,V){return this.internalStream(q||"nodebuffer").toNodejsStream(V)},_compressWorker:function(q,V){if(this._data instanceof N&&this._data.compression.magic===q.magic)return this._data.getCompressedWorker();var X=this._decompressWorker();return this._dataBinary||(X=X.pipe(new C.Utf8EncodeWorker)),N.createWorkerFrom(X,q,V)},_decompressWorker:function(){return this._data instanceof N?this._data.getContentWorker():this._data instanceof U?this._data:new S(this._data)}};for(var z=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],H=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},D=0;D<z.length;D++)b.prototype[z[D]]=H;v.exports=b},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(p,v,x){(function(b){var E,S,C=b.MutationObserver||b.WebKitMutationObserver;if(C){var N=0,U=new C(q),z=b.document.createTextNode("");U.observe(z,{characterData:!0}),E=function(){z.data=N=++N%2}}else if(b.setImmediate||b.MessageChannel===void 0)E="document"in b&&"onreadystatechange"in b.document.createElement("script")?function(){var V=b.document.createElement("script");V.onreadystatechange=function(){q(),V.onreadystatechange=null,V.parentNode.removeChild(V),V=null},b.document.documentElement.appendChild(V)}:function(){setTimeout(q,0)};else{var H=new b.MessageChannel;H.port1.onmessage=q,E=function(){H.port2.postMessage(0)}}var D=[];function q(){var V,X;S=!0;for(var j=D.length;j;){for(X=D,D=[],V=-1;++V<j;)X[V]();j=D.length}S=!1}v.exports=function(V){D.push(V)!==1||S||E()}}).call(this,typeof $u<"u"?$u:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(p,v,x){var b=p("immediate");function E(){}var S={},C=["REJECTED"],N=["FULFILLED"],U=["PENDING"];function z(j){if(typeof j!="function")throw new TypeError("resolver must be a function");this.state=U,this.queue=[],this.outcome=void 0,j!==E&&V(this,j)}function H(j,J,st){this.promise=j,typeof J=="function"&&(this.onFulfilled=J,this.callFulfilled=this.otherCallFulfilled),typeof st=="function"&&(this.onRejected=st,this.callRejected=this.otherCallRejected)}function D(j,J,st){b(function(){var dt;try{dt=J(st)}catch(lt){return S.reject(j,lt)}dt===j?S.reject(j,new TypeError("Cannot resolve promise with itself")):S.resolve(j,dt)})}function q(j){var J=j&&j.then;if(j&&(typeof j=="object"||typeof j=="function")&&typeof J=="function")return function(){J.apply(j,arguments)}}function V(j,J){var st=!1;function dt(It){st||(st=!0,S.reject(j,It))}function lt(It){st||(st=!0,S.resolve(j,It))}var bt=X(function(){J(lt,dt)});bt.status==="error"&&dt(bt.value)}function X(j,J){var st={};try{st.value=j(J),st.status="success"}catch(dt){st.status="error",st.value=dt}return st}(v.exports=z).prototype.finally=function(j){if(typeof j!="function")return this;var J=this.constructor;return this.then(function(st){return J.resolve(j()).then(function(){return st})},function(st){return J.resolve(j()).then(function(){throw st})})},z.prototype.catch=function(j){return this.then(null,j)},z.prototype.then=function(j,J){if(typeof j!="function"&&this.state===N||typeof J!="function"&&this.state===C)return this;var st=new this.constructor(E);return this.state!==U?D(st,this.state===N?j:J,this.outcome):this.queue.push(new H(st,j,J)),st},H.prototype.callFulfilled=function(j){S.resolve(this.promise,j)},H.prototype.otherCallFulfilled=function(j){D(this.promise,this.onFulfilled,j)},H.prototype.callRejected=function(j){S.reject(this.promise,j)},H.prototype.otherCallRejected=function(j){D(this.promise,this.onRejected,j)},S.resolve=function(j,J){var st=X(q,J);if(st.status==="error")return S.reject(j,st.value);var dt=st.value;if(dt)V(j,dt);else{j.state=N,j.outcome=J;for(var lt=-1,bt=j.queue.length;++lt<bt;)j.queue[lt].callFulfilled(J)}return j},S.reject=function(j,J){j.state=C,j.outcome=J;for(var st=-1,dt=j.queue.length;++st<dt;)j.queue[st].callRejected(J);return j},z.resolve=function(j){return j instanceof this?j:S.resolve(new this(E),j)},z.reject=function(j){var J=new this(E);return S.reject(J,j)},z.all=function(j){var J=this;if(Object.prototype.toString.call(j)!=="[object Array]")return this.reject(new TypeError("must be an array"));var st=j.length,dt=!1;if(!st)return this.resolve([]);for(var lt=new Array(st),bt=0,It=-1,Vt=new this(E);++It<st;)Nt(j[It],It);return Vt;function Nt(Jt,be){J.resolve(Jt).then(function(at){lt[be]=at,++bt!==st||dt||(dt=!0,S.resolve(Vt,lt))},function(at){dt||(dt=!0,S.reject(Vt,at))})}},z.race=function(j){var J=this;if(Object.prototype.toString.call(j)!=="[object Array]")return this.reject(new TypeError("must be an array"));var st=j.length,dt=!1;if(!st)return this.resolve([]);for(var lt=-1,bt=new this(E);++lt<st;)It=j[lt],J.resolve(It).then(function(Vt){dt||(dt=!0,S.resolve(bt,Vt))},function(Vt){dt||(dt=!0,S.reject(bt,Vt))});var It;return bt}},{immediate:36}],38:[function(p,v,x){var b={};(0,p("./lib/utils/common").assign)(b,p("./lib/deflate"),p("./lib/inflate"),p("./lib/zlib/constants")),v.exports=b},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(p,v,x){var b=p("./zlib/deflate"),E=p("./utils/common"),S=p("./utils/strings"),C=p("./zlib/messages"),N=p("./zlib/zstream"),U=Object.prototype.toString,z=0,H=-1,D=0,q=8;function V(j){if(!(this instanceof V))return new V(j);this.options=E.assign({level:H,method:q,chunkSize:16384,windowBits:15,memLevel:8,strategy:D,to:""},j||{});var J=this.options;J.raw&&0<J.windowBits?J.windowBits=-J.windowBits:J.gzip&&0<J.windowBits&&J.windowBits<16&&(J.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new N,this.strm.avail_out=0;var st=b.deflateInit2(this.strm,J.level,J.method,J.windowBits,J.memLevel,J.strategy);if(st!==z)throw new Error(C[st]);if(J.header&&b.deflateSetHeader(this.strm,J.header),J.dictionary){var dt;if(dt=typeof J.dictionary=="string"?S.string2buf(J.dictionary):U.call(J.dictionary)==="[object ArrayBuffer]"?new Uint8Array(J.dictionary):J.dictionary,(st=b.deflateSetDictionary(this.strm,dt))!==z)throw new Error(C[st]);this._dict_set=!0}}function X(j,J){var st=new V(J);if(st.push(j,!0),st.err)throw st.msg||C[st.err];return st.result}V.prototype.push=function(j,J){var st,dt,lt=this.strm,bt=this.options.chunkSize;if(this.ended)return!1;dt=J===~~J?J:J===!0?4:0,typeof j=="string"?lt.input=S.string2buf(j):U.call(j)==="[object ArrayBuffer]"?lt.input=new Uint8Array(j):lt.input=j,lt.next_in=0,lt.avail_in=lt.input.length;do{if(lt.avail_out===0&&(lt.output=new E.Buf8(bt),lt.next_out=0,lt.avail_out=bt),(st=b.deflate(lt,dt))!==1&&st!==z)return this.onEnd(st),!(this.ended=!0);lt.avail_out!==0&&(lt.avail_in!==0||dt!==4&&dt!==2)||(this.options.to==="string"?this.onData(S.buf2binstring(E.shrinkBuf(lt.output,lt.next_out))):this.onData(E.shrinkBuf(lt.output,lt.next_out)))}while((0<lt.avail_in||lt.avail_out===0)&&st!==1);return dt===4?(st=b.deflateEnd(this.strm),this.onEnd(st),this.ended=!0,st===z):dt!==2||(this.onEnd(z),!(lt.avail_out=0))},V.prototype.onData=function(j){this.chunks.push(j)},V.prototype.onEnd=function(j){j===z&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=E.flattenChunks(this.chunks)),this.chunks=[],this.err=j,this.msg=this.strm.msg},x.Deflate=V,x.deflate=X,x.deflateRaw=function(j,J){return(J=J||{}).raw=!0,X(j,J)},x.gzip=function(j,J){return(J=J||{}).gzip=!0,X(j,J)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(p,v,x){var b=p("./zlib/inflate"),E=p("./utils/common"),S=p("./utils/strings"),C=p("./zlib/constants"),N=p("./zlib/messages"),U=p("./zlib/zstream"),z=p("./zlib/gzheader"),H=Object.prototype.toString;function D(V){if(!(this instanceof D))return new D(V);this.options=E.assign({chunkSize:16384,windowBits:0,to:""},V||{});var X=this.options;X.raw&&0<=X.windowBits&&X.windowBits<16&&(X.windowBits=-X.windowBits,X.windowBits===0&&(X.windowBits=-15)),!(0<=X.windowBits&&X.windowBits<16)||V&&V.windowBits||(X.windowBits+=32),15<X.windowBits&&X.windowBits<48&&(15&X.windowBits)==0&&(X.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new U,this.strm.avail_out=0;var j=b.inflateInit2(this.strm,X.windowBits);if(j!==C.Z_OK)throw new Error(N[j]);this.header=new z,b.inflateGetHeader(this.strm,this.header)}function q(V,X){var j=new D(X);if(j.push(V,!0),j.err)throw j.msg||N[j.err];return j.result}D.prototype.push=function(V,X){var j,J,st,dt,lt,bt,It=this.strm,Vt=this.options.chunkSize,Nt=this.options.dictionary,Jt=!1;if(this.ended)return!1;J=X===~~X?X:X===!0?C.Z_FINISH:C.Z_NO_FLUSH,typeof V=="string"?It.input=S.binstring2buf(V):H.call(V)==="[object ArrayBuffer]"?It.input=new Uint8Array(V):It.input=V,It.next_in=0,It.avail_in=It.input.length;do{if(It.avail_out===0&&(It.output=new E.Buf8(Vt),It.next_out=0,It.avail_out=Vt),(j=b.inflate(It,C.Z_NO_FLUSH))===C.Z_NEED_DICT&&Nt&&(bt=typeof Nt=="string"?S.string2buf(Nt):H.call(Nt)==="[object ArrayBuffer]"?new Uint8Array(Nt):Nt,j=b.inflateSetDictionary(this.strm,bt)),j===C.Z_BUF_ERROR&&Jt===!0&&(j=C.Z_OK,Jt=!1),j!==C.Z_STREAM_END&&j!==C.Z_OK)return this.onEnd(j),!(this.ended=!0);It.next_out&&(It.avail_out!==0&&j!==C.Z_STREAM_END&&(It.avail_in!==0||J!==C.Z_FINISH&&J!==C.Z_SYNC_FLUSH)||(this.options.to==="string"?(st=S.utf8border(It.output,It.next_out),dt=It.next_out-st,lt=S.buf2string(It.output,st),It.next_out=dt,It.avail_out=Vt-dt,dt&&E.arraySet(It.output,It.output,st,dt,0),this.onData(lt)):this.onData(E.shrinkBuf(It.output,It.next_out)))),It.avail_in===0&&It.avail_out===0&&(Jt=!0)}while((0<It.avail_in||It.avail_out===0)&&j!==C.Z_STREAM_END);return j===C.Z_STREAM_END&&(J=C.Z_FINISH),J===C.Z_FINISH?(j=b.inflateEnd(this.strm),this.onEnd(j),this.ended=!0,j===C.Z_OK):J!==C.Z_SYNC_FLUSH||(this.onEnd(C.Z_OK),!(It.avail_out=0))},D.prototype.onData=function(V){this.chunks.push(V)},D.prototype.onEnd=function(V){V===C.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=E.flattenChunks(this.chunks)),this.chunks=[],this.err=V,this.msg=this.strm.msg},x.Inflate=D,x.inflate=q,x.inflateRaw=function(V,X){return(X=X||{}).raw=!0,q(V,X)},x.ungzip=q},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(p,v,x){var b=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";x.assign=function(C){for(var N=Array.prototype.slice.call(arguments,1);N.length;){var U=N.shift();if(U){if(typeof U!="object")throw new TypeError(U+"must be non-object");for(var z in U)U.hasOwnProperty(z)&&(C[z]=U[z])}}return C},x.shrinkBuf=function(C,N){return C.length===N?C:C.subarray?C.subarray(0,N):(C.length=N,C)};var E={arraySet:function(C,N,U,z,H){if(N.subarray&&C.subarray)C.set(N.subarray(U,U+z),H);else for(var D=0;D<z;D++)C[H+D]=N[U+D]},flattenChunks:function(C){var N,U,z,H,D,q;for(N=z=0,U=C.length;N<U;N++)z+=C[N].length;for(q=new Uint8Array(z),N=H=0,U=C.length;N<U;N++)D=C[N],q.set(D,H),H+=D.length;return q}},S={arraySet:function(C,N,U,z,H){for(var D=0;D<z;D++)C[H+D]=N[U+D]},flattenChunks:function(C){return[].concat.apply([],C)}};x.setTyped=function(C){C?(x.Buf8=Uint8Array,x.Buf16=Uint16Array,x.Buf32=Int32Array,x.assign(x,E)):(x.Buf8=Array,x.Buf16=Array,x.Buf32=Array,x.assign(x,S))},x.setTyped(b)},{}],42:[function(p,v,x){var b=p("./common"),E=!0,S=!0;try{String.fromCharCode.apply(null,[0])}catch{E=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{S=!1}for(var C=new b.Buf8(256),N=0;N<256;N++)C[N]=252<=N?6:248<=N?5:240<=N?4:224<=N?3:192<=N?2:1;function U(z,H){if(H<65537&&(z.subarray&&S||!z.subarray&&E))return String.fromCharCode.apply(null,b.shrinkBuf(z,H));for(var D="",q=0;q<H;q++)D+=String.fromCharCode(z[q]);return D}C[254]=C[254]=1,x.string2buf=function(z){var H,D,q,V,X,j=z.length,J=0;for(V=0;V<j;V++)(64512&(D=z.charCodeAt(V)))==55296&&V+1<j&&(64512&(q=z.charCodeAt(V+1)))==56320&&(D=65536+(D-55296<<10)+(q-56320),V++),J+=D<128?1:D<2048?2:D<65536?3:4;for(H=new b.Buf8(J),V=X=0;X<J;V++)(64512&(D=z.charCodeAt(V)))==55296&&V+1<j&&(64512&(q=z.charCodeAt(V+1)))==56320&&(D=65536+(D-55296<<10)+(q-56320),V++),D<128?H[X++]=D:(D<2048?H[X++]=192|D>>>6:(D<65536?H[X++]=224|D>>>12:(H[X++]=240|D>>>18,H[X++]=128|D>>>12&63),H[X++]=128|D>>>6&63),H[X++]=128|63&D);return H},x.buf2binstring=function(z){return U(z,z.length)},x.binstring2buf=function(z){for(var H=new b.Buf8(z.length),D=0,q=H.length;D<q;D++)H[D]=z.charCodeAt(D);return H},x.buf2string=function(z,H){var D,q,V,X,j=H||z.length,J=new Array(2*j);for(D=q=0;D<j;)if((V=z[D++])<128)J[q++]=V;else if(4<(X=C[V]))J[q++]=65533,D+=X-1;else{for(V&=X===2?31:X===3?15:7;1<X&&D<j;)V=V<<6|63&z[D++],X--;1<X?J[q++]=65533:V<65536?J[q++]=V:(V-=65536,J[q++]=55296|V>>10&1023,J[q++]=56320|1023&V)}return U(J,q)},x.utf8border=function(z,H){var D;for((H=H||z.length)>z.length&&(H=z.length),D=H-1;0<=D&&(192&z[D])==128;)D--;return D<0||D===0?H:D+C[z[D]]>H?D:H}},{"./common":41}],43:[function(p,v,x){v.exports=function(b,E,S,C){for(var N=65535&b|0,U=b>>>16&65535|0,z=0;S!==0;){for(S-=z=2e3<S?2e3:S;U=U+(N=N+E[C++]|0)|0,--z;);N%=65521,U%=65521}return N|U<<16|0}},{}],44:[function(p,v,x){v.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(p,v,x){var b=function(){for(var E,S=[],C=0;C<256;C++){E=C;for(var N=0;N<8;N++)E=1&E?3988292384^E>>>1:E>>>1;S[C]=E}return S}();v.exports=function(E,S,C,N){var U=b,z=N+C;E^=-1;for(var H=N;H<z;H++)E=E>>>8^U[255&(E^S[H])];return-1^E}},{}],46:[function(p,v,x){var b,E=p("../utils/common"),S=p("./trees"),C=p("./adler32"),N=p("./crc32"),U=p("./messages"),z=0,H=4,D=0,q=-2,V=-1,X=4,j=2,J=8,st=9,dt=286,lt=30,bt=19,It=2*dt+1,Vt=15,Nt=3,Jt=258,be=Jt+Nt+1,at=42,zt=113,$=1,$t=2,De=3,te=4;function Ze(F,Wt){return F.msg=U[Wt],Wt}function ae(F){return(F<<1)-(4<F?9:0)}function Le(F){for(var Wt=F.length;0<=--Wt;)F[Wt]=0}function Rt(F){var Wt=F.state,kt=Wt.pending;kt>F.avail_out&&(kt=F.avail_out),kt!==0&&(E.arraySet(F.output,Wt.pending_buf,Wt.pending_out,kt,F.next_out),F.next_out+=kt,Wt.pending_out+=kt,F.total_out+=kt,F.avail_out-=kt,Wt.pending-=kt,Wt.pending===0&&(Wt.pending_out=0))}function St(F,Wt){S._tr_flush_block(F,0<=F.block_start?F.block_start:-1,F.strstart-F.block_start,Wt),F.block_start=F.strstart,Rt(F.strm)}function Re(F,Wt){F.pending_buf[F.pending++]=Wt}function me(F,Wt){F.pending_buf[F.pending++]=Wt>>>8&255,F.pending_buf[F.pending++]=255&Wt}function he(F,Wt){var kt,B,G=F.max_chain_length,W=F.strstart,et=F.prev_length,Q=F.nice_match,it=F.strstart>F.w_size-be?F.strstart-(F.w_size-be):0,ft=F.window,Yt=F.w_mask,vt=F.prev,fe=F.strstart+Jt,ii=ft[W+et-1],Ue=ft[W+et];F.prev_length>=F.good_match&&(G>>=2),Q>F.lookahead&&(Q=F.lookahead);do if(ft[(kt=Wt)+et]===Ue&&ft[kt+et-1]===ii&&ft[kt]===ft[W]&&ft[++kt]===ft[W+1]){W+=2,kt++;do;while(ft[++W]===ft[++kt]&&ft[++W]===ft[++kt]&&ft[++W]===ft[++kt]&&ft[++W]===ft[++kt]&&ft[++W]===ft[++kt]&&ft[++W]===ft[++kt]&&ft[++W]===ft[++kt]&&ft[++W]===ft[++kt]&&W<fe);if(B=Jt-(fe-W),W=fe-Jt,et<B){if(F.match_start=Wt,Q<=(et=B))break;ii=ft[W+et-1],Ue=ft[W+et]}}while((Wt=vt[Wt&Yt])>it&&--G!=0);return et<=F.lookahead?et:F.lookahead}function Xi(F){var Wt,kt,B,G,W,et,Q,it,ft,Yt,vt=F.w_size;do{if(G=F.window_size-F.lookahead-F.strstart,F.strstart>=vt+(vt-be)){for(E.arraySet(F.window,F.window,vt,vt,0),F.match_start-=vt,F.strstart-=vt,F.block_start-=vt,Wt=kt=F.hash_size;B=F.head[--Wt],F.head[Wt]=vt<=B?B-vt:0,--kt;);for(Wt=kt=vt;B=F.prev[--Wt],F.prev[Wt]=vt<=B?B-vt:0,--kt;);G+=vt}if(F.strm.avail_in===0)break;if(et=F.strm,Q=F.window,it=F.strstart+F.lookahead,ft=G,Yt=void 0,Yt=et.avail_in,ft<Yt&&(Yt=ft),kt=Yt===0?0:(et.avail_in-=Yt,E.arraySet(Q,et.input,et.next_in,Yt,it),et.state.wrap===1?et.adler=C(et.adler,Q,Yt,it):et.state.wrap===2&&(et.adler=N(et.adler,Q,Yt,it)),et.next_in+=Yt,et.total_in+=Yt,Yt),F.lookahead+=kt,F.lookahead+F.insert>=Nt)for(W=F.strstart-F.insert,F.ins_h=F.window[W],F.ins_h=(F.ins_h<<F.hash_shift^F.window[W+1])&F.hash_mask;F.insert&&(F.ins_h=(F.ins_h<<F.hash_shift^F.window[W+Nt-1])&F.hash_mask,F.prev[W&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=W,W++,F.insert--,!(F.lookahead+F.insert<Nt)););}while(F.lookahead<be&&F.strm.avail_in!==0)}function kn(F,Wt){for(var kt,B;;){if(F.lookahead<be){if(Xi(F),F.lookahead<be&&Wt===z)return $;if(F.lookahead===0)break}if(kt=0,F.lookahead>=Nt&&(F.ins_h=(F.ins_h<<F.hash_shift^F.window[F.strstart+Nt-1])&F.hash_mask,kt=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart),kt!==0&&F.strstart-kt<=F.w_size-be&&(F.match_length=he(F,kt)),F.match_length>=Nt)if(B=S._tr_tally(F,F.strstart-F.match_start,F.match_length-Nt),F.lookahead-=F.match_length,F.match_length<=F.max_lazy_match&&F.lookahead>=Nt){for(F.match_length--;F.strstart++,F.ins_h=(F.ins_h<<F.hash_shift^F.window[F.strstart+Nt-1])&F.hash_mask,kt=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart,--F.match_length!=0;);F.strstart++}else F.strstart+=F.match_length,F.match_length=0,F.ins_h=F.window[F.strstart],F.ins_h=(F.ins_h<<F.hash_shift^F.window[F.strstart+1])&F.hash_mask;else B=S._tr_tally(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++;if(B&&(St(F,!1),F.strm.avail_out===0))return $}return F.insert=F.strstart<Nt-1?F.strstart:Nt-1,Wt===H?(St(F,!0),F.strm.avail_out===0?De:te):F.last_lit&&(St(F,!1),F.strm.avail_out===0)?$:$t}function ei(F,Wt){for(var kt,B,G;;){if(F.lookahead<be){if(Xi(F),F.lookahead<be&&Wt===z)return $;if(F.lookahead===0)break}if(kt=0,F.lookahead>=Nt&&(F.ins_h=(F.ins_h<<F.hash_shift^F.window[F.strstart+Nt-1])&F.hash_mask,kt=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart),F.prev_length=F.match_length,F.prev_match=F.match_start,F.match_length=Nt-1,kt!==0&&F.prev_length<F.max_lazy_match&&F.strstart-kt<=F.w_size-be&&(F.match_length=he(F,kt),F.match_length<=5&&(F.strategy===1||F.match_length===Nt&&4096<F.strstart-F.match_start)&&(F.match_length=Nt-1)),F.prev_length>=Nt&&F.match_length<=F.prev_length){for(G=F.strstart+F.lookahead-Nt,B=S._tr_tally(F,F.strstart-1-F.prev_match,F.prev_length-Nt),F.lookahead-=F.prev_length-1,F.prev_length-=2;++F.strstart<=G&&(F.ins_h=(F.ins_h<<F.hash_shift^F.window[F.strstart+Nt-1])&F.hash_mask,kt=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart),--F.prev_length!=0;);if(F.match_available=0,F.match_length=Nt-1,F.strstart++,B&&(St(F,!1),F.strm.avail_out===0))return $}else if(F.match_available){if((B=S._tr_tally(F,0,F.window[F.strstart-1]))&&St(F,!1),F.strstart++,F.lookahead--,F.strm.avail_out===0)return $}else F.match_available=1,F.strstart++,F.lookahead--}return F.match_available&&(B=S._tr_tally(F,0,F.window[F.strstart-1]),F.match_available=0),F.insert=F.strstart<Nt-1?F.strstart:Nt-1,Wt===H?(St(F,!0),F.strm.avail_out===0?De:te):F.last_lit&&(St(F,!1),F.strm.avail_out===0)?$:$t}function mi(F,Wt,kt,B,G){this.good_length=F,this.max_lazy=Wt,this.nice_length=kt,this.max_chain=B,this.func=G}function un(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=J,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new E.Buf16(2*It),this.dyn_dtree=new E.Buf16(2*(2*lt+1)),this.bl_tree=new E.Buf16(2*(2*bt+1)),Le(this.dyn_ltree),Le(this.dyn_dtree),Le(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new E.Buf16(Vt+1),this.heap=new E.Buf16(2*dt+1),Le(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new E.Buf16(2*dt+1),Le(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ji(F){var Wt;return F&&F.state?(F.total_in=F.total_out=0,F.data_type=j,(Wt=F.state).pending=0,Wt.pending_out=0,Wt.wrap<0&&(Wt.wrap=-Wt.wrap),Wt.status=Wt.wrap?at:zt,F.adler=Wt.wrap===2?0:1,Wt.last_flush=z,S._tr_init(Wt),D):Ze(F,q)}function vs(F){var Wt=ji(F);return Wt===D&&function(kt){kt.window_size=2*kt.w_size,Le(kt.head),kt.max_lazy_match=b[kt.level].max_lazy,kt.good_match=b[kt.level].good_length,kt.nice_match=b[kt.level].nice_length,kt.max_chain_length=b[kt.level].max_chain,kt.strstart=0,kt.block_start=0,kt.lookahead=0,kt.insert=0,kt.match_length=kt.prev_length=Nt-1,kt.match_available=0,kt.ins_h=0}(F.state),Wt}function Os(F,Wt,kt,B,G,W){if(!F)return q;var et=1;if(Wt===V&&(Wt=6),B<0?(et=0,B=-B):15<B&&(et=2,B-=16),G<1||st<G||kt!==J||B<8||15<B||Wt<0||9<Wt||W<0||X<W)return Ze(F,q);B===8&&(B=9);var Q=new un;return(F.state=Q).strm=F,Q.wrap=et,Q.gzhead=null,Q.w_bits=B,Q.w_size=1<<Q.w_bits,Q.w_mask=Q.w_size-1,Q.hash_bits=G+7,Q.hash_size=1<<Q.hash_bits,Q.hash_mask=Q.hash_size-1,Q.hash_shift=~~((Q.hash_bits+Nt-1)/Nt),Q.window=new E.Buf8(2*Q.w_size),Q.head=new E.Buf16(Q.hash_size),Q.prev=new E.Buf16(Q.w_size),Q.lit_bufsize=1<<G+6,Q.pending_buf_size=4*Q.lit_bufsize,Q.pending_buf=new E.Buf8(Q.pending_buf_size),Q.d_buf=1*Q.lit_bufsize,Q.l_buf=3*Q.lit_bufsize,Q.level=Wt,Q.strategy=W,Q.method=kt,vs(F)}b=[new mi(0,0,0,0,function(F,Wt){var kt=65535;for(kt>F.pending_buf_size-5&&(kt=F.pending_buf_size-5);;){if(F.lookahead<=1){if(Xi(F),F.lookahead===0&&Wt===z)return $;if(F.lookahead===0)break}F.strstart+=F.lookahead,F.lookahead=0;var B=F.block_start+kt;if((F.strstart===0||F.strstart>=B)&&(F.lookahead=F.strstart-B,F.strstart=B,St(F,!1),F.strm.avail_out===0)||F.strstart-F.block_start>=F.w_size-be&&(St(F,!1),F.strm.avail_out===0))return $}return F.insert=0,Wt===H?(St(F,!0),F.strm.avail_out===0?De:te):(F.strstart>F.block_start&&(St(F,!1),F.strm.avail_out),$)}),new mi(4,4,8,4,kn),new mi(4,5,16,8,kn),new mi(4,6,32,32,kn),new mi(4,4,16,16,ei),new mi(8,16,32,32,ei),new mi(8,16,128,128,ei),new mi(8,32,128,256,ei),new mi(32,128,258,1024,ei),new mi(32,258,258,4096,ei)],x.deflateInit=function(F,Wt){return Os(F,Wt,J,15,8,0)},x.deflateInit2=Os,x.deflateReset=vs,x.deflateResetKeep=ji,x.deflateSetHeader=function(F,Wt){return F&&F.state?F.state.wrap!==2?q:(F.state.gzhead=Wt,D):q},x.deflate=function(F,Wt){var kt,B,G,W;if(!F||!F.state||5<Wt||Wt<0)return F?Ze(F,q):q;if(B=F.state,!F.output||!F.input&&F.avail_in!==0||B.status===666&&Wt!==H)return Ze(F,F.avail_out===0?-5:q);if(B.strm=F,kt=B.last_flush,B.last_flush=Wt,B.status===at)if(B.wrap===2)F.adler=0,Re(B,31),Re(B,139),Re(B,8),B.gzhead?(Re(B,(B.gzhead.text?1:0)+(B.gzhead.hcrc?2:0)+(B.gzhead.extra?4:0)+(B.gzhead.name?8:0)+(B.gzhead.comment?16:0)),Re(B,255&B.gzhead.time),Re(B,B.gzhead.time>>8&255),Re(B,B.gzhead.time>>16&255),Re(B,B.gzhead.time>>24&255),Re(B,B.level===9?2:2<=B.strategy||B.level<2?4:0),Re(B,255&B.gzhead.os),B.gzhead.extra&&B.gzhead.extra.length&&(Re(B,255&B.gzhead.extra.length),Re(B,B.gzhead.extra.length>>8&255)),B.gzhead.hcrc&&(F.adler=N(F.adler,B.pending_buf,B.pending,0)),B.gzindex=0,B.status=69):(Re(B,0),Re(B,0),Re(B,0),Re(B,0),Re(B,0),Re(B,B.level===9?2:2<=B.strategy||B.level<2?4:0),Re(B,3),B.status=zt);else{var et=J+(B.w_bits-8<<4)<<8;et|=(2<=B.strategy||B.level<2?0:B.level<6?1:B.level===6?2:3)<<6,B.strstart!==0&&(et|=32),et+=31-et%31,B.status=zt,me(B,et),B.strstart!==0&&(me(B,F.adler>>>16),me(B,65535&F.adler)),F.adler=1}if(B.status===69)if(B.gzhead.extra){for(G=B.pending;B.gzindex<(65535&B.gzhead.extra.length)&&(B.pending!==B.pending_buf_size||(B.gzhead.hcrc&&B.pending>G&&(F.adler=N(F.adler,B.pending_buf,B.pending-G,G)),Rt(F),G=B.pending,B.pending!==B.pending_buf_size));)Re(B,255&B.gzhead.extra[B.gzindex]),B.gzindex++;B.gzhead.hcrc&&B.pending>G&&(F.adler=N(F.adler,B.pending_buf,B.pending-G,G)),B.gzindex===B.gzhead.extra.length&&(B.gzindex=0,B.status=73)}else B.status=73;if(B.status===73)if(B.gzhead.name){G=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>G&&(F.adler=N(F.adler,B.pending_buf,B.pending-G,G)),Rt(F),G=B.pending,B.pending===B.pending_buf_size)){W=1;break}W=B.gzindex<B.gzhead.name.length?255&B.gzhead.name.charCodeAt(B.gzindex++):0,Re(B,W)}while(W!==0);B.gzhead.hcrc&&B.pending>G&&(F.adler=N(F.adler,B.pending_buf,B.pending-G,G)),W===0&&(B.gzindex=0,B.status=91)}else B.status=91;if(B.status===91)if(B.gzhead.comment){G=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>G&&(F.adler=N(F.adler,B.pending_buf,B.pending-G,G)),Rt(F),G=B.pending,B.pending===B.pending_buf_size)){W=1;break}W=B.gzindex<B.gzhead.comment.length?255&B.gzhead.comment.charCodeAt(B.gzindex++):0,Re(B,W)}while(W!==0);B.gzhead.hcrc&&B.pending>G&&(F.adler=N(F.adler,B.pending_buf,B.pending-G,G)),W===0&&(B.status=103)}else B.status=103;if(B.status===103&&(B.gzhead.hcrc?(B.pending+2>B.pending_buf_size&&Rt(F),B.pending+2<=B.pending_buf_size&&(Re(B,255&F.adler),Re(B,F.adler>>8&255),F.adler=0,B.status=zt)):B.status=zt),B.pending!==0){if(Rt(F),F.avail_out===0)return B.last_flush=-1,D}else if(F.avail_in===0&&ae(Wt)<=ae(kt)&&Wt!==H)return Ze(F,-5);if(B.status===666&&F.avail_in!==0)return Ze(F,-5);if(F.avail_in!==0||B.lookahead!==0||Wt!==z&&B.status!==666){var Q=B.strategy===2?function(it,ft){for(var Yt;;){if(it.lookahead===0&&(Xi(it),it.lookahead===0)){if(ft===z)return $;break}if(it.match_length=0,Yt=S._tr_tally(it,0,it.window[it.strstart]),it.lookahead--,it.strstart++,Yt&&(St(it,!1),it.strm.avail_out===0))return $}return it.insert=0,ft===H?(St(it,!0),it.strm.avail_out===0?De:te):it.last_lit&&(St(it,!1),it.strm.avail_out===0)?$:$t}(B,Wt):B.strategy===3?function(it,ft){for(var Yt,vt,fe,ii,Ue=it.window;;){if(it.lookahead<=Jt){if(Xi(it),it.lookahead<=Jt&&ft===z)return $;if(it.lookahead===0)break}if(it.match_length=0,it.lookahead>=Nt&&0<it.strstart&&(vt=Ue[fe=it.strstart-1])===Ue[++fe]&&vt===Ue[++fe]&&vt===Ue[++fe]){ii=it.strstart+Jt;do;while(vt===Ue[++fe]&&vt===Ue[++fe]&&vt===Ue[++fe]&&vt===Ue[++fe]&&vt===Ue[++fe]&&vt===Ue[++fe]&&vt===Ue[++fe]&&vt===Ue[++fe]&&fe<ii);it.match_length=Jt-(ii-fe),it.match_length>it.lookahead&&(it.match_length=it.lookahead)}if(it.match_length>=Nt?(Yt=S._tr_tally(it,1,it.match_length-Nt),it.lookahead-=it.match_length,it.strstart+=it.match_length,it.match_length=0):(Yt=S._tr_tally(it,0,it.window[it.strstart]),it.lookahead--,it.strstart++),Yt&&(St(it,!1),it.strm.avail_out===0))return $}return it.insert=0,ft===H?(St(it,!0),it.strm.avail_out===0?De:te):it.last_lit&&(St(it,!1),it.strm.avail_out===0)?$:$t}(B,Wt):b[B.level].func(B,Wt);if(Q!==De&&Q!==te||(B.status=666),Q===$||Q===De)return F.avail_out===0&&(B.last_flush=-1),D;if(Q===$t&&(Wt===1?S._tr_align(B):Wt!==5&&(S._tr_stored_block(B,0,0,!1),Wt===3&&(Le(B.head),B.lookahead===0&&(B.strstart=0,B.block_start=0,B.insert=0))),Rt(F),F.avail_out===0))return B.last_flush=-1,D}return Wt!==H?D:B.wrap<=0?1:(B.wrap===2?(Re(B,255&F.adler),Re(B,F.adler>>8&255),Re(B,F.adler>>16&255),Re(B,F.adler>>24&255),Re(B,255&F.total_in),Re(B,F.total_in>>8&255),Re(B,F.total_in>>16&255),Re(B,F.total_in>>24&255)):(me(B,F.adler>>>16),me(B,65535&F.adler)),Rt(F),0<B.wrap&&(B.wrap=-B.wrap),B.pending!==0?D:1)},x.deflateEnd=function(F){var Wt;return F&&F.state?(Wt=F.state.status)!==at&&Wt!==69&&Wt!==73&&Wt!==91&&Wt!==103&&Wt!==zt&&Wt!==666?Ze(F,q):(F.state=null,Wt===zt?Ze(F,-3):D):q},x.deflateSetDictionary=function(F,Wt){var kt,B,G,W,et,Q,it,ft,Yt=Wt.length;if(!F||!F.state||(W=(kt=F.state).wrap)===2||W===1&&kt.status!==at||kt.lookahead)return q;for(W===1&&(F.adler=C(F.adler,Wt,Yt,0)),kt.wrap=0,Yt>=kt.w_size&&(W===0&&(Le(kt.head),kt.strstart=0,kt.block_start=0,kt.insert=0),ft=new E.Buf8(kt.w_size),E.arraySet(ft,Wt,Yt-kt.w_size,kt.w_size,0),Wt=ft,Yt=kt.w_size),et=F.avail_in,Q=F.next_in,it=F.input,F.avail_in=Yt,F.next_in=0,F.input=Wt,Xi(kt);kt.lookahead>=Nt;){for(B=kt.strstart,G=kt.lookahead-(Nt-1);kt.ins_h=(kt.ins_h<<kt.hash_shift^kt.window[B+Nt-1])&kt.hash_mask,kt.prev[B&kt.w_mask]=kt.head[kt.ins_h],kt.head[kt.ins_h]=B,B++,--G;);kt.strstart=B,kt.lookahead=Nt-1,Xi(kt)}return kt.strstart+=kt.lookahead,kt.block_start=kt.strstart,kt.insert=kt.lookahead,kt.lookahead=0,kt.match_length=kt.prev_length=Nt-1,kt.match_available=0,F.next_in=Q,F.input=it,F.avail_in=et,kt.wrap=W,D},x.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(p,v,x){v.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(p,v,x){v.exports=function(b,E){var S,C,N,U,z,H,D,q,V,X,j,J,st,dt,lt,bt,It,Vt,Nt,Jt,be,at,zt,$,$t;S=b.state,C=b.next_in,$=b.input,N=C+(b.avail_in-5),U=b.next_out,$t=b.output,z=U-(E-b.avail_out),H=U+(b.avail_out-257),D=S.dmax,q=S.wsize,V=S.whave,X=S.wnext,j=S.window,J=S.hold,st=S.bits,dt=S.lencode,lt=S.distcode,bt=(1<<S.lenbits)-1,It=(1<<S.distbits)-1;t:do{st<15&&(J+=$[C++]<<st,st+=8,J+=$[C++]<<st,st+=8),Vt=dt[J&bt];e:for(;;){if(J>>>=Nt=Vt>>>24,st-=Nt,(Nt=Vt>>>16&255)===0)$t[U++]=65535&Vt;else{if(!(16&Nt)){if((64&Nt)==0){Vt=dt[(65535&Vt)+(J&(1<<Nt)-1)];continue e}if(32&Nt){S.mode=12;break t}b.msg="invalid literal/length code",S.mode=30;break t}Jt=65535&Vt,(Nt&=15)&&(st<Nt&&(J+=$[C++]<<st,st+=8),Jt+=J&(1<<Nt)-1,J>>>=Nt,st-=Nt),st<15&&(J+=$[C++]<<st,st+=8,J+=$[C++]<<st,st+=8),Vt=lt[J&It];i:for(;;){if(J>>>=Nt=Vt>>>24,st-=Nt,!(16&(Nt=Vt>>>16&255))){if((64&Nt)==0){Vt=lt[(65535&Vt)+(J&(1<<Nt)-1)];continue i}b.msg="invalid distance code",S.mode=30;break t}if(be=65535&Vt,st<(Nt&=15)&&(J+=$[C++]<<st,(st+=8)<Nt&&(J+=$[C++]<<st,st+=8)),D<(be+=J&(1<<Nt)-1)){b.msg="invalid distance too far back",S.mode=30;break t}if(J>>>=Nt,st-=Nt,(Nt=U-z)<be){if(V<(Nt=be-Nt)&&S.sane){b.msg="invalid distance too far back",S.mode=30;break t}if(zt=j,(at=0)===X){if(at+=q-Nt,Nt<Jt){for(Jt-=Nt;$t[U++]=j[at++],--Nt;);at=U-be,zt=$t}}else if(X<Nt){if(at+=q+X-Nt,(Nt-=X)<Jt){for(Jt-=Nt;$t[U++]=j[at++],--Nt;);if(at=0,X<Jt){for(Jt-=Nt=X;$t[U++]=j[at++],--Nt;);at=U-be,zt=$t}}}else if(at+=X-Nt,Nt<Jt){for(Jt-=Nt;$t[U++]=j[at++],--Nt;);at=U-be,zt=$t}for(;2<Jt;)$t[U++]=zt[at++],$t[U++]=zt[at++],$t[U++]=zt[at++],Jt-=3;Jt&&($t[U++]=zt[at++],1<Jt&&($t[U++]=zt[at++]))}else{for(at=U-be;$t[U++]=$t[at++],$t[U++]=$t[at++],$t[U++]=$t[at++],2<(Jt-=3););Jt&&($t[U++]=$t[at++],1<Jt&&($t[U++]=$t[at++]))}break}}break}}while(C<N&&U<H);C-=Jt=st>>3,J&=(1<<(st-=Jt<<3))-1,b.next_in=C,b.next_out=U,b.avail_in=C<N?N-C+5:5-(C-N),b.avail_out=U<H?H-U+257:257-(U-H),S.hold=J,S.bits=st}},{}],49:[function(p,v,x){var b=p("../utils/common"),E=p("./adler32"),S=p("./crc32"),C=p("./inffast"),N=p("./inftrees"),U=1,z=2,H=0,D=-2,q=1,V=852,X=592;function j(at){return(at>>>24&255)+(at>>>8&65280)+((65280&at)<<8)+((255&at)<<24)}function J(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new b.Buf16(320),this.work=new b.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function st(at){var zt;return at&&at.state?(zt=at.state,at.total_in=at.total_out=zt.total=0,at.msg="",zt.wrap&&(at.adler=1&zt.wrap),zt.mode=q,zt.last=0,zt.havedict=0,zt.dmax=32768,zt.head=null,zt.hold=0,zt.bits=0,zt.lencode=zt.lendyn=new b.Buf32(V),zt.distcode=zt.distdyn=new b.Buf32(X),zt.sane=1,zt.back=-1,H):D}function dt(at){var zt;return at&&at.state?((zt=at.state).wsize=0,zt.whave=0,zt.wnext=0,st(at)):D}function lt(at,zt){var $,$t;return at&&at.state?($t=at.state,zt<0?($=0,zt=-zt):($=1+(zt>>4),zt<48&&(zt&=15)),zt&&(zt<8||15<zt)?D:($t.window!==null&&$t.wbits!==zt&&($t.window=null),$t.wrap=$,$t.wbits=zt,dt(at))):D}function bt(at,zt){var $,$t;return at?($t=new J,(at.state=$t).window=null,($=lt(at,zt))!==H&&(at.state=null),$):D}var It,Vt,Nt=!0;function Jt(at){if(Nt){var zt;for(It=new b.Buf32(512),Vt=new b.Buf32(32),zt=0;zt<144;)at.lens[zt++]=8;for(;zt<256;)at.lens[zt++]=9;for(;zt<280;)at.lens[zt++]=7;for(;zt<288;)at.lens[zt++]=8;for(N(U,at.lens,0,288,It,0,at.work,{bits:9}),zt=0;zt<32;)at.lens[zt++]=5;N(z,at.lens,0,32,Vt,0,at.work,{bits:5}),Nt=!1}at.lencode=It,at.lenbits=9,at.distcode=Vt,at.distbits=5}function be(at,zt,$,$t){var De,te=at.state;return te.window===null&&(te.wsize=1<<te.wbits,te.wnext=0,te.whave=0,te.window=new b.Buf8(te.wsize)),$t>=te.wsize?(b.arraySet(te.window,zt,$-te.wsize,te.wsize,0),te.wnext=0,te.whave=te.wsize):($t<(De=te.wsize-te.wnext)&&(De=$t),b.arraySet(te.window,zt,$-$t,De,te.wnext),($t-=De)?(b.arraySet(te.window,zt,$-$t,$t,0),te.wnext=$t,te.whave=te.wsize):(te.wnext+=De,te.wnext===te.wsize&&(te.wnext=0),te.whave<te.wsize&&(te.whave+=De))),0}x.inflateReset=dt,x.inflateReset2=lt,x.inflateResetKeep=st,x.inflateInit=function(at){return bt(at,15)},x.inflateInit2=bt,x.inflate=function(at,zt){var $,$t,De,te,Ze,ae,Le,Rt,St,Re,me,he,Xi,kn,ei,mi,un,ji,vs,Os,F,Wt,kt,B,G=0,W=new b.Buf8(4),et=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!at||!at.state||!at.output||!at.input&&at.avail_in!==0)return D;($=at.state).mode===12&&($.mode=13),Ze=at.next_out,De=at.output,Le=at.avail_out,te=at.next_in,$t=at.input,ae=at.avail_in,Rt=$.hold,St=$.bits,Re=ae,me=Le,Wt=H;t:for(;;)switch($.mode){case q:if($.wrap===0){$.mode=13;break}for(;St<16;){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}if(2&$.wrap&&Rt===35615){W[$.check=0]=255&Rt,W[1]=Rt>>>8&255,$.check=S($.check,W,2,0),St=Rt=0,$.mode=2;break}if($.flags=0,$.head&&($.head.done=!1),!(1&$.wrap)||(((255&Rt)<<8)+(Rt>>8))%31){at.msg="incorrect header check",$.mode=30;break}if((15&Rt)!=8){at.msg="unknown compression method",$.mode=30;break}if(St-=4,F=8+(15&(Rt>>>=4)),$.wbits===0)$.wbits=F;else if(F>$.wbits){at.msg="invalid window size",$.mode=30;break}$.dmax=1<<F,at.adler=$.check=1,$.mode=512&Rt?10:12,St=Rt=0;break;case 2:for(;St<16;){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}if($.flags=Rt,(255&$.flags)!=8){at.msg="unknown compression method",$.mode=30;break}if(57344&$.flags){at.msg="unknown header flags set",$.mode=30;break}$.head&&($.head.text=Rt>>8&1),512&$.flags&&(W[0]=255&Rt,W[1]=Rt>>>8&255,$.check=S($.check,W,2,0)),St=Rt=0,$.mode=3;case 3:for(;St<32;){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}$.head&&($.head.time=Rt),512&$.flags&&(W[0]=255&Rt,W[1]=Rt>>>8&255,W[2]=Rt>>>16&255,W[3]=Rt>>>24&255,$.check=S($.check,W,4,0)),St=Rt=0,$.mode=4;case 4:for(;St<16;){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}$.head&&($.head.xflags=255&Rt,$.head.os=Rt>>8),512&$.flags&&(W[0]=255&Rt,W[1]=Rt>>>8&255,$.check=S($.check,W,2,0)),St=Rt=0,$.mode=5;case 5:if(1024&$.flags){for(;St<16;){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}$.length=Rt,$.head&&($.head.extra_len=Rt),512&$.flags&&(W[0]=255&Rt,W[1]=Rt>>>8&255,$.check=S($.check,W,2,0)),St=Rt=0}else $.head&&($.head.extra=null);$.mode=6;case 6:if(1024&$.flags&&(ae<(he=$.length)&&(he=ae),he&&($.head&&(F=$.head.extra_len-$.length,$.head.extra||($.head.extra=new Array($.head.extra_len)),b.arraySet($.head.extra,$t,te,he,F)),512&$.flags&&($.check=S($.check,$t,he,te)),ae-=he,te+=he,$.length-=he),$.length))break t;$.length=0,$.mode=7;case 7:if(2048&$.flags){if(ae===0)break t;for(he=0;F=$t[te+he++],$.head&&F&&$.length<65536&&($.head.name+=String.fromCharCode(F)),F&&he<ae;);if(512&$.flags&&($.check=S($.check,$t,he,te)),ae-=he,te+=he,F)break t}else $.head&&($.head.name=null);$.length=0,$.mode=8;case 8:if(4096&$.flags){if(ae===0)break t;for(he=0;F=$t[te+he++],$.head&&F&&$.length<65536&&($.head.comment+=String.fromCharCode(F)),F&&he<ae;);if(512&$.flags&&($.check=S($.check,$t,he,te)),ae-=he,te+=he,F)break t}else $.head&&($.head.comment=null);$.mode=9;case 9:if(512&$.flags){for(;St<16;){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}if(Rt!==(65535&$.check)){at.msg="header crc mismatch",$.mode=30;break}St=Rt=0}$.head&&($.head.hcrc=$.flags>>9&1,$.head.done=!0),at.adler=$.check=0,$.mode=12;break;case 10:for(;St<32;){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}at.adler=$.check=j(Rt),St=Rt=0,$.mode=11;case 11:if($.havedict===0)return at.next_out=Ze,at.avail_out=Le,at.next_in=te,at.avail_in=ae,$.hold=Rt,$.bits=St,2;at.adler=$.check=1,$.mode=12;case 12:if(zt===5||zt===6)break t;case 13:if($.last){Rt>>>=7&St,St-=7&St,$.mode=27;break}for(;St<3;){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}switch($.last=1&Rt,St-=1,3&(Rt>>>=1)){case 0:$.mode=14;break;case 1:if(Jt($),$.mode=20,zt!==6)break;Rt>>>=2,St-=2;break t;case 2:$.mode=17;break;case 3:at.msg="invalid block type",$.mode=30}Rt>>>=2,St-=2;break;case 14:for(Rt>>>=7&St,St-=7&St;St<32;){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}if((65535&Rt)!=(Rt>>>16^65535)){at.msg="invalid stored block lengths",$.mode=30;break}if($.length=65535&Rt,St=Rt=0,$.mode=15,zt===6)break t;case 15:$.mode=16;case 16:if(he=$.length){if(ae<he&&(he=ae),Le<he&&(he=Le),he===0)break t;b.arraySet(De,$t,te,he,Ze),ae-=he,te+=he,Le-=he,Ze+=he,$.length-=he;break}$.mode=12;break;case 17:for(;St<14;){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}if($.nlen=257+(31&Rt),Rt>>>=5,St-=5,$.ndist=1+(31&Rt),Rt>>>=5,St-=5,$.ncode=4+(15&Rt),Rt>>>=4,St-=4,286<$.nlen||30<$.ndist){at.msg="too many length or distance symbols",$.mode=30;break}$.have=0,$.mode=18;case 18:for(;$.have<$.ncode;){for(;St<3;){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}$.lens[et[$.have++]]=7&Rt,Rt>>>=3,St-=3}for(;$.have<19;)$.lens[et[$.have++]]=0;if($.lencode=$.lendyn,$.lenbits=7,kt={bits:$.lenbits},Wt=N(0,$.lens,0,19,$.lencode,0,$.work,kt),$.lenbits=kt.bits,Wt){at.msg="invalid code lengths set",$.mode=30;break}$.have=0,$.mode=19;case 19:for(;$.have<$.nlen+$.ndist;){for(;mi=(G=$.lencode[Rt&(1<<$.lenbits)-1])>>>16&255,un=65535&G,!((ei=G>>>24)<=St);){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}if(un<16)Rt>>>=ei,St-=ei,$.lens[$.have++]=un;else{if(un===16){for(B=ei+2;St<B;){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}if(Rt>>>=ei,St-=ei,$.have===0){at.msg="invalid bit length repeat",$.mode=30;break}F=$.lens[$.have-1],he=3+(3&Rt),Rt>>>=2,St-=2}else if(un===17){for(B=ei+3;St<B;){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}St-=ei,F=0,he=3+(7&(Rt>>>=ei)),Rt>>>=3,St-=3}else{for(B=ei+7;St<B;){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}St-=ei,F=0,he=11+(127&(Rt>>>=ei)),Rt>>>=7,St-=7}if($.have+he>$.nlen+$.ndist){at.msg="invalid bit length repeat",$.mode=30;break}for(;he--;)$.lens[$.have++]=F}}if($.mode===30)break;if($.lens[256]===0){at.msg="invalid code -- missing end-of-block",$.mode=30;break}if($.lenbits=9,kt={bits:$.lenbits},Wt=N(U,$.lens,0,$.nlen,$.lencode,0,$.work,kt),$.lenbits=kt.bits,Wt){at.msg="invalid literal/lengths set",$.mode=30;break}if($.distbits=6,$.distcode=$.distdyn,kt={bits:$.distbits},Wt=N(z,$.lens,$.nlen,$.ndist,$.distcode,0,$.work,kt),$.distbits=kt.bits,Wt){at.msg="invalid distances set",$.mode=30;break}if($.mode=20,zt===6)break t;case 20:$.mode=21;case 21:if(6<=ae&&258<=Le){at.next_out=Ze,at.avail_out=Le,at.next_in=te,at.avail_in=ae,$.hold=Rt,$.bits=St,C(at,me),Ze=at.next_out,De=at.output,Le=at.avail_out,te=at.next_in,$t=at.input,ae=at.avail_in,Rt=$.hold,St=$.bits,$.mode===12&&($.back=-1);break}for($.back=0;mi=(G=$.lencode[Rt&(1<<$.lenbits)-1])>>>16&255,un=65535&G,!((ei=G>>>24)<=St);){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}if(mi&&(240&mi)==0){for(ji=ei,vs=mi,Os=un;mi=(G=$.lencode[Os+((Rt&(1<<ji+vs)-1)>>ji)])>>>16&255,un=65535&G,!(ji+(ei=G>>>24)<=St);){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}Rt>>>=ji,St-=ji,$.back+=ji}if(Rt>>>=ei,St-=ei,$.back+=ei,$.length=un,mi===0){$.mode=26;break}if(32&mi){$.back=-1,$.mode=12;break}if(64&mi){at.msg="invalid literal/length code",$.mode=30;break}$.extra=15&mi,$.mode=22;case 22:if($.extra){for(B=$.extra;St<B;){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}$.length+=Rt&(1<<$.extra)-1,Rt>>>=$.extra,St-=$.extra,$.back+=$.extra}$.was=$.length,$.mode=23;case 23:for(;mi=(G=$.distcode[Rt&(1<<$.distbits)-1])>>>16&255,un=65535&G,!((ei=G>>>24)<=St);){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}if((240&mi)==0){for(ji=ei,vs=mi,Os=un;mi=(G=$.distcode[Os+((Rt&(1<<ji+vs)-1)>>ji)])>>>16&255,un=65535&G,!(ji+(ei=G>>>24)<=St);){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}Rt>>>=ji,St-=ji,$.back+=ji}if(Rt>>>=ei,St-=ei,$.back+=ei,64&mi){at.msg="invalid distance code",$.mode=30;break}$.offset=un,$.extra=15&mi,$.mode=24;case 24:if($.extra){for(B=$.extra;St<B;){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}$.offset+=Rt&(1<<$.extra)-1,Rt>>>=$.extra,St-=$.extra,$.back+=$.extra}if($.offset>$.dmax){at.msg="invalid distance too far back",$.mode=30;break}$.mode=25;case 25:if(Le===0)break t;if(he=me-Le,$.offset>he){if((he=$.offset-he)>$.whave&&$.sane){at.msg="invalid distance too far back",$.mode=30;break}Xi=he>$.wnext?(he-=$.wnext,$.wsize-he):$.wnext-he,he>$.length&&(he=$.length),kn=$.window}else kn=De,Xi=Ze-$.offset,he=$.length;for(Le<he&&(he=Le),Le-=he,$.length-=he;De[Ze++]=kn[Xi++],--he;);$.length===0&&($.mode=21);break;case 26:if(Le===0)break t;De[Ze++]=$.length,Le--,$.mode=21;break;case 27:if($.wrap){for(;St<32;){if(ae===0)break t;ae--,Rt|=$t[te++]<<St,St+=8}if(me-=Le,at.total_out+=me,$.total+=me,me&&(at.adler=$.check=$.flags?S($.check,De,me,Ze-me):E($.check,De,me,Ze-me)),me=Le,($.flags?Rt:j(Rt))!==$.check){at.msg="incorrect data check",$.mode=30;break}St=Rt=0}$.mode=28;case 28:if($.wrap&&$.flags){for(;St<32;){if(ae===0)break t;ae--,Rt+=$t[te++]<<St,St+=8}if(Rt!==(4294967295&$.total)){at.msg="incorrect length check",$.mode=30;break}St=Rt=0}$.mode=29;case 29:Wt=1;break t;case 30:Wt=-3;break t;case 31:return-4;case 32:default:return D}return at.next_out=Ze,at.avail_out=Le,at.next_in=te,at.avail_in=ae,$.hold=Rt,$.bits=St,($.wsize||me!==at.avail_out&&$.mode<30&&($.mode<27||zt!==4))&&be(at,at.output,at.next_out,me-at.avail_out)?($.mode=31,-4):(Re-=at.avail_in,me-=at.avail_out,at.total_in+=Re,at.total_out+=me,$.total+=me,$.wrap&&me&&(at.adler=$.check=$.flags?S($.check,De,me,at.next_out-me):E($.check,De,me,at.next_out-me)),at.data_type=$.bits+($.last?64:0)+($.mode===12?128:0)+($.mode===20||$.mode===15?256:0),(Re==0&&me===0||zt===4)&&Wt===H&&(Wt=-5),Wt)},x.inflateEnd=function(at){if(!at||!at.state)return D;var zt=at.state;return zt.window&&(zt.window=null),at.state=null,H},x.inflateGetHeader=function(at,zt){var $;return at&&at.state?(2&($=at.state).wrap)==0?D:(($.head=zt).done=!1,H):D},x.inflateSetDictionary=function(at,zt){var $,$t=zt.length;return at&&at.state?($=at.state).wrap!==0&&$.mode!==11?D:$.mode===11&&E(1,zt,$t,0)!==$.check?-3:be(at,zt,$t,$t)?($.mode=31,-4):($.havedict=1,H):D},x.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(p,v,x){var b=p("../utils/common"),E=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],S=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],C=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],N=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];v.exports=function(U,z,H,D,q,V,X,j){var J,st,dt,lt,bt,It,Vt,Nt,Jt,be=j.bits,at=0,zt=0,$=0,$t=0,De=0,te=0,Ze=0,ae=0,Le=0,Rt=0,St=null,Re=0,me=new b.Buf16(16),he=new b.Buf16(16),Xi=null,kn=0;for(at=0;at<=15;at++)me[at]=0;for(zt=0;zt<D;zt++)me[z[H+zt]]++;for(De=be,$t=15;1<=$t&&me[$t]===0;$t--);if($t<De&&(De=$t),$t===0)return q[V++]=20971520,q[V++]=20971520,j.bits=1,0;for($=1;$<$t&&me[$]===0;$++);for(De<$&&(De=$),at=ae=1;at<=15;at++)if(ae<<=1,(ae-=me[at])<0)return-1;if(0<ae&&(U===0||$t!==1))return-1;for(he[1]=0,at=1;at<15;at++)he[at+1]=he[at]+me[at];for(zt=0;zt<D;zt++)z[H+zt]!==0&&(X[he[z[H+zt]]++]=zt);if(It=U===0?(St=Xi=X,19):U===1?(St=E,Re-=257,Xi=S,kn-=257,256):(St=C,Xi=N,-1),at=$,bt=V,Ze=zt=Rt=0,dt=-1,lt=(Le=1<<(te=De))-1,U===1&&852<Le||U===2&&592<Le)return 1;for(;;){for(Vt=at-Ze,Jt=X[zt]<It?(Nt=0,X[zt]):X[zt]>It?(Nt=Xi[kn+X[zt]],St[Re+X[zt]]):(Nt=96,0),J=1<<at-Ze,$=st=1<<te;q[bt+(Rt>>Ze)+(st-=J)]=Vt<<24|Nt<<16|Jt|0,st!==0;);for(J=1<<at-1;Rt&J;)J>>=1;if(J!==0?(Rt&=J-1,Rt+=J):Rt=0,zt++,--me[at]==0){if(at===$t)break;at=z[H+X[zt]]}if(De<at&&(Rt&lt)!==dt){for(Ze===0&&(Ze=De),bt+=$,ae=1<<(te=at-Ze);te+Ze<$t&&!((ae-=me[te+Ze])<=0);)te++,ae<<=1;if(Le+=1<<te,U===1&&852<Le||U===2&&592<Le)return 1;q[dt=Rt&lt]=De<<24|te<<16|bt-V|0}}return Rt!==0&&(q[bt+Rt]=at-Ze<<24|64<<16|0),j.bits=De,0}},{"../utils/common":41}],51:[function(p,v,x){v.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(p,v,x){var b=p("../utils/common"),E=0,S=1;function C(G){for(var W=G.length;0<=--W;)G[W]=0}var N=0,U=29,z=256,H=z+1+U,D=30,q=19,V=2*H+1,X=15,j=16,J=7,st=256,dt=16,lt=17,bt=18,It=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Vt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Nt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Jt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],be=new Array(2*(H+2));C(be);var at=new Array(2*D);C(at);var zt=new Array(512);C(zt);var $=new Array(256);C($);var $t=new Array(U);C($t);var De,te,Ze,ae=new Array(D);function Le(G,W,et,Q,it){this.static_tree=G,this.extra_bits=W,this.extra_base=et,this.elems=Q,this.max_length=it,this.has_stree=G&&G.length}function Rt(G,W){this.dyn_tree=G,this.max_code=0,this.stat_desc=W}function St(G){return G<256?zt[G]:zt[256+(G>>>7)]}function Re(G,W){G.pending_buf[G.pending++]=255&W,G.pending_buf[G.pending++]=W>>>8&255}function me(G,W,et){G.bi_valid>j-et?(G.bi_buf|=W<<G.bi_valid&65535,Re(G,G.bi_buf),G.bi_buf=W>>j-G.bi_valid,G.bi_valid+=et-j):(G.bi_buf|=W<<G.bi_valid&65535,G.bi_valid+=et)}function he(G,W,et){me(G,et[2*W],et[2*W+1])}function Xi(G,W){for(var et=0;et|=1&G,G>>>=1,et<<=1,0<--W;);return et>>>1}function kn(G,W,et){var Q,it,ft=new Array(X+1),Yt=0;for(Q=1;Q<=X;Q++)ft[Q]=Yt=Yt+et[Q-1]<<1;for(it=0;it<=W;it++){var vt=G[2*it+1];vt!==0&&(G[2*it]=Xi(ft[vt]++,vt))}}function ei(G){var W;for(W=0;W<H;W++)G.dyn_ltree[2*W]=0;for(W=0;W<D;W++)G.dyn_dtree[2*W]=0;for(W=0;W<q;W++)G.bl_tree[2*W]=0;G.dyn_ltree[2*st]=1,G.opt_len=G.static_len=0,G.last_lit=G.matches=0}function mi(G){8<G.bi_valid?Re(G,G.bi_buf):0<G.bi_valid&&(G.pending_buf[G.pending++]=G.bi_buf),G.bi_buf=0,G.bi_valid=0}function un(G,W,et,Q){var it=2*W,ft=2*et;return G[it]<G[ft]||G[it]===G[ft]&&Q[W]<=Q[et]}function ji(G,W,et){for(var Q=G.heap[et],it=et<<1;it<=G.heap_len&&(it<G.heap_len&&un(W,G.heap[it+1],G.heap[it],G.depth)&&it++,!un(W,Q,G.heap[it],G.depth));)G.heap[et]=G.heap[it],et=it,it<<=1;G.heap[et]=Q}function vs(G,W,et){var Q,it,ft,Yt,vt=0;if(G.last_lit!==0)for(;Q=G.pending_buf[G.d_buf+2*vt]<<8|G.pending_buf[G.d_buf+2*vt+1],it=G.pending_buf[G.l_buf+vt],vt++,Q===0?he(G,it,W):(he(G,(ft=$[it])+z+1,W),(Yt=It[ft])!==0&&me(G,it-=$t[ft],Yt),he(G,ft=St(--Q),et),(Yt=Vt[ft])!==0&&me(G,Q-=ae[ft],Yt)),vt<G.last_lit;);he(G,st,W)}function Os(G,W){var et,Q,it,ft=W.dyn_tree,Yt=W.stat_desc.static_tree,vt=W.stat_desc.has_stree,fe=W.stat_desc.elems,ii=-1;for(G.heap_len=0,G.heap_max=V,et=0;et<fe;et++)ft[2*et]!==0?(G.heap[++G.heap_len]=ii=et,G.depth[et]=0):ft[2*et+1]=0;for(;G.heap_len<2;)ft[2*(it=G.heap[++G.heap_len]=ii<2?++ii:0)]=1,G.depth[it]=0,G.opt_len--,vt&&(G.static_len-=Yt[2*it+1]);for(W.max_code=ii,et=G.heap_len>>1;1<=et;et--)ji(G,ft,et);for(it=fe;et=G.heap[1],G.heap[1]=G.heap[G.heap_len--],ji(G,ft,1),Q=G.heap[1],G.heap[--G.heap_max]=et,G.heap[--G.heap_max]=Q,ft[2*it]=ft[2*et]+ft[2*Q],G.depth[it]=(G.depth[et]>=G.depth[Q]?G.depth[et]:G.depth[Q])+1,ft[2*et+1]=ft[2*Q+1]=it,G.heap[1]=it++,ji(G,ft,1),2<=G.heap_len;);G.heap[--G.heap_max]=G.heap[1],function(Ue,bn){var Fh,ma,qu,rn,b0,yy,$a=bn.dyn_tree,Eb=bn.max_code,cD=bn.stat_desc.static_tree,uD=bn.stat_desc.has_stree,dD=bn.stat_desc.extra_bits,Sb=bn.stat_desc.extra_base,Xu=bn.stat_desc.max_length,M0=0;for(rn=0;rn<=X;rn++)Ue.bl_count[rn]=0;for($a[2*Ue.heap[Ue.heap_max]+1]=0,Fh=Ue.heap_max+1;Fh<V;Fh++)Xu<(rn=$a[2*$a[2*(ma=Ue.heap[Fh])+1]+1]+1)&&(rn=Xu,M0++),$a[2*ma+1]=rn,Eb<ma||(Ue.bl_count[rn]++,b0=0,Sb<=ma&&(b0=dD[ma-Sb]),yy=$a[2*ma],Ue.opt_len+=yy*(rn+b0),uD&&(Ue.static_len+=yy*(cD[2*ma+1]+b0)));if(M0!==0){do{for(rn=Xu-1;Ue.bl_count[rn]===0;)rn--;Ue.bl_count[rn]--,Ue.bl_count[rn+1]+=2,Ue.bl_count[Xu]--,M0-=2}while(0<M0);for(rn=Xu;rn!==0;rn--)for(ma=Ue.bl_count[rn];ma!==0;)Eb<(qu=Ue.heap[--Fh])||($a[2*qu+1]!==rn&&(Ue.opt_len+=(rn-$a[2*qu+1])*$a[2*qu],$a[2*qu+1]=rn),ma--)}}(G,W),kn(ft,ii,G.bl_count)}function F(G,W,et){var Q,it,ft=-1,Yt=W[1],vt=0,fe=7,ii=4;for(Yt===0&&(fe=138,ii=3),W[2*(et+1)+1]=65535,Q=0;Q<=et;Q++)it=Yt,Yt=W[2*(Q+1)+1],++vt<fe&&it===Yt||(vt<ii?G.bl_tree[2*it]+=vt:it!==0?(it!==ft&&G.bl_tree[2*it]++,G.bl_tree[2*dt]++):vt<=10?G.bl_tree[2*lt]++:G.bl_tree[2*bt]++,ft=it,ii=(vt=0)===Yt?(fe=138,3):it===Yt?(fe=6,3):(fe=7,4))}function Wt(G,W,et){var Q,it,ft=-1,Yt=W[1],vt=0,fe=7,ii=4;for(Yt===0&&(fe=138,ii=3),Q=0;Q<=et;Q++)if(it=Yt,Yt=W[2*(Q+1)+1],!(++vt<fe&&it===Yt)){if(vt<ii)for(;he(G,it,G.bl_tree),--vt!=0;);else it!==0?(it!==ft&&(he(G,it,G.bl_tree),vt--),he(G,dt,G.bl_tree),me(G,vt-3,2)):vt<=10?(he(G,lt,G.bl_tree),me(G,vt-3,3)):(he(G,bt,G.bl_tree),me(G,vt-11,7));ft=it,ii=(vt=0)===Yt?(fe=138,3):it===Yt?(fe=6,3):(fe=7,4)}}C(ae);var kt=!1;function B(G,W,et,Q){me(G,(N<<1)+(Q?1:0),3),function(it,ft,Yt,vt){mi(it),vt&&(Re(it,Yt),Re(it,~Yt)),b.arraySet(it.pending_buf,it.window,ft,Yt,it.pending),it.pending+=Yt}(G,W,et,!0)}x._tr_init=function(G){kt||(function(){var W,et,Q,it,ft,Yt=new Array(X+1);for(it=Q=0;it<U-1;it++)for($t[it]=Q,W=0;W<1<<It[it];W++)$[Q++]=it;for($[Q-1]=it,it=ft=0;it<16;it++)for(ae[it]=ft,W=0;W<1<<Vt[it];W++)zt[ft++]=it;for(ft>>=7;it<D;it++)for(ae[it]=ft<<7,W=0;W<1<<Vt[it]-7;W++)zt[256+ft++]=it;for(et=0;et<=X;et++)Yt[et]=0;for(W=0;W<=143;)be[2*W+1]=8,W++,Yt[8]++;for(;W<=255;)be[2*W+1]=9,W++,Yt[9]++;for(;W<=279;)be[2*W+1]=7,W++,Yt[7]++;for(;W<=287;)be[2*W+1]=8,W++,Yt[8]++;for(kn(be,H+1,Yt),W=0;W<D;W++)at[2*W+1]=5,at[2*W]=Xi(W,5);De=new Le(be,It,z+1,H,X),te=new Le(at,Vt,0,D,X),Ze=new Le(new Array(0),Nt,0,q,J)}(),kt=!0),G.l_desc=new Rt(G.dyn_ltree,De),G.d_desc=new Rt(G.dyn_dtree,te),G.bl_desc=new Rt(G.bl_tree,Ze),G.bi_buf=0,G.bi_valid=0,ei(G)},x._tr_stored_block=B,x._tr_flush_block=function(G,W,et,Q){var it,ft,Yt=0;0<G.level?(G.strm.data_type===2&&(G.strm.data_type=function(vt){var fe,ii=4093624447;for(fe=0;fe<=31;fe++,ii>>>=1)if(1&ii&&vt.dyn_ltree[2*fe]!==0)return E;if(vt.dyn_ltree[18]!==0||vt.dyn_ltree[20]!==0||vt.dyn_ltree[26]!==0)return S;for(fe=32;fe<z;fe++)if(vt.dyn_ltree[2*fe]!==0)return S;return E}(G)),Os(G,G.l_desc),Os(G,G.d_desc),Yt=function(vt){var fe;for(F(vt,vt.dyn_ltree,vt.l_desc.max_code),F(vt,vt.dyn_dtree,vt.d_desc.max_code),Os(vt,vt.bl_desc),fe=q-1;3<=fe&&vt.bl_tree[2*Jt[fe]+1]===0;fe--);return vt.opt_len+=3*(fe+1)+5+5+4,fe}(G),it=G.opt_len+3+7>>>3,(ft=G.static_len+3+7>>>3)<=it&&(it=ft)):it=ft=et+5,et+4<=it&&W!==-1?B(G,W,et,Q):G.strategy===4||ft===it?(me(G,2+(Q?1:0),3),vs(G,be,at)):(me(G,4+(Q?1:0),3),function(vt,fe,ii,Ue){var bn;for(me(vt,fe-257,5),me(vt,ii-1,5),me(vt,Ue-4,4),bn=0;bn<Ue;bn++)me(vt,vt.bl_tree[2*Jt[bn]+1],3);Wt(vt,vt.dyn_ltree,fe-1),Wt(vt,vt.dyn_dtree,ii-1)}(G,G.l_desc.max_code+1,G.d_desc.max_code+1,Yt+1),vs(G,G.dyn_ltree,G.dyn_dtree)),ei(G),Q&&mi(G)},x._tr_tally=function(G,W,et){return G.pending_buf[G.d_buf+2*G.last_lit]=W>>>8&255,G.pending_buf[G.d_buf+2*G.last_lit+1]=255&W,G.pending_buf[G.l_buf+G.last_lit]=255&et,G.last_lit++,W===0?G.dyn_ltree[2*et]++:(G.matches++,W--,G.dyn_ltree[2*($[et]+z+1)]++,G.dyn_dtree[2*St(W)]++),G.last_lit===G.lit_bufsize-1},x._tr_align=function(G){me(G,2,3),he(G,st,be),function(W){W.bi_valid===16?(Re(W,W.bi_buf),W.bi_buf=0,W.bi_valid=0):8<=W.bi_valid&&(W.pending_buf[W.pending++]=255&W.bi_buf,W.bi_buf>>=8,W.bi_valid-=8)}(G)}},{"../utils/common":41}],53:[function(p,v,x){v.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(p,v,x){(function(b){(function(E,S){if(!E.setImmediate){var C,N,U,z,H=1,D={},q=!1,V=E.document,X=Object.getPrototypeOf&&Object.getPrototypeOf(E);X=X&&X.setTimeout?X:E,C={}.toString.call(E.process)==="[object process]"?function(dt){RF.nextTick(function(){J(dt)})}:function(){if(E.postMessage&&!E.importScripts){var dt=!0,lt=E.onmessage;return E.onmessage=function(){dt=!1},E.postMessage("","*"),E.onmessage=lt,dt}}()?(z="setImmediate$"+Math.random()+"$",E.addEventListener?E.addEventListener("message",st,!1):E.attachEvent("onmessage",st),function(dt){E.postMessage(z+dt,"*")}):E.MessageChannel?((U=new MessageChannel).port1.onmessage=function(dt){J(dt.data)},function(dt){U.port2.postMessage(dt)}):V&&"onreadystatechange"in V.createElement("script")?(N=V.documentElement,function(dt){var lt=V.createElement("script");lt.onreadystatechange=function(){J(dt),lt.onreadystatechange=null,N.removeChild(lt),lt=null},N.appendChild(lt)}):function(dt){setTimeout(J,0,dt)},X.setImmediate=function(dt){typeof dt!="function"&&(dt=new Function(""+dt));for(var lt=new Array(arguments.length-1),bt=0;bt<lt.length;bt++)lt[bt]=arguments[bt+1];var It={callback:dt,args:lt};return D[H]=It,C(H),H++},X.clearImmediate=j}function j(dt){delete D[dt]}function J(dt){if(q)setTimeout(J,0,dt);else{var lt=D[dt];if(lt){q=!0;try{(function(bt){var It=bt.callback,Vt=bt.args;switch(Vt.length){case 0:It();break;case 1:It(Vt[0]);break;case 2:It(Vt[0],Vt[1]);break;case 3:It(Vt[0],Vt[1],Vt[2]);break;default:It.apply(S,Vt)}})(lt)}finally{j(dt),q=!1}}}}function st(dt){dt.source===E&&typeof dt.data=="string"&&dt.data.indexOf(z)===0&&J(+dt.data.slice(z.length))}})(typeof self>"u"?b===void 0?this:b:self)}).call(this,typeof $u<"u"?$u:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(_b);var NF=_b.exports,kF=yb(NF),LF=async c=>{const d=new kF;await d.loadAsync(c);const p=d.file(/.+/),v={};return await Promise.all(p.map(async x=>{let b;x.name.slice(-3).toLowerCase()==="shp"||x.name.slice(-3).toLowerCase()==="dbf"?b=await x.async("nodebuffer"):b=await x.async("text"),v[x.name]=b})),v};const OF=globalThis.URL;var xb=(c,d)=>{if(!d)return c;const p=new OF(c);return p.pathname=`${p.pathname}.${d}`,p.href};function PF(c,d){return new Promise(function(p,v){const x=xb(c,d),b=new XMLHttpRequest;b.open("GET",x,!0),d!=="prj"&&d!=="cpg"&&(b.responseType="arraybuffer"),b.addEventListener("load",function(){return b.status>399?d==="prj"||d==="cpg"?p(!1):v(new Error(b.status)):p(d!=="prj"&&d!=="cpg"?Bt.from(b.response):b.response)},!1),b.send()})}async function Yu(c,d){if(!globalThis.fetch)return PF(c,d);const p=xb(c,d),v=d==="prj"||d==="cpg";try{const x=await fetch(p);if(x.status>399)throw new Error(x.statusText);if(v)return x.text();const b=await x.arrayBuffer();return Bt.from(b)}catch(x){if(console.log("ERROR",x,d),v||d==="dbf")return!1;throw x}}function FF(c){let d=0,p=1;const v=c.length;let x,b;const E=[c[0][0],c[0][1],c[0][0],c[0][1]];for(;p<v;)x=b||c[0],b=c[p],d+=(b[0]-x[0])*(b[1]+x[1]),p++,b[0]<E[0]&&(E[0]=b[0]),b[1]<E[1]&&(E[1]=b[1]),b[0]>E[2]&&(E[2]=b[0]),b[1]>E[3]&&(E[3]=b[1]);return{ring:c,clockWise:d>0,bbox:E,children:[]}}function DF(c,d){return!(c.bbox[0]>d.bbox[0]||c.bbox[1]>d.bbox[1]||c.bbox[2]<d.bbox[2]||c.bbox[3]<d.bbox[3])}function zF(c){const d=[],p=[];for(const x of c){const b=FF(x);b.clockWise?d.push(b):p.push(b)}for(const x of p)for(const b of d)if(DF(b,x)){b.children.push(x.ring);break}const v=[];for(const x of d)v.push([x.ring].concat(x.children));return v}sn.prototype.parsePoint=function(c){return{type:"Point",coordinates:this.parseCoord(c,0)}},sn.prototype.parseZPoint=function(c){const d=this.parsePoint(c);return d.coordinates.push(c.readDoubleLE(16)),d},sn.prototype.parsePointArray=function(c,d,p){const v=[];let x=0;for(;x<p;)v.push(this.parseCoord(c,d)),d+=16,x++;return v},sn.prototype.parseZPointArray=function(c,d,p,v){let x=0;for(;x<p;)v[x].push(c.readDoubleLE(d)),x++,d+=8;return v},sn.prototype.parseArrayGroup=function(c,d,p,v,x){const b=[];let E=0,S,C=0,N;for(;E<v;)E++,p+=4,S=C,E===v?C=x:C=c.readInt32LE(p),N=C-S,N&&(b.push(this.parsePointArray(c,d,N)),d+=N<<4);return b},sn.prototype.parseZArrayGroup=function(c,d,p,v){let x=0;for(;x<p;)v[x]=this.parseZPointArray(c,d,v[x].length,v[x]),d+=v[x].length<<3,x++;return v},sn.prototype.parseMultiPoint=function(c){const d={},p=c.readInt32LE(32,!0);if(!p)return null;const v=this.parseCoord(c,0),x=this.parseCoord(c,16);d.bbox=[v[0],v[1],x[0],x[1]];const b=36;return p===1?(d.type="Point",d.coordinates=this.parseCoord(c,b)):(d.type="MultiPoint",d.coordinates=this.parsePointArray(c,b,p)),d},sn.prototype.parseZMultiPoint=function(c){const d=this.parseMultiPoint(c);if(!d)return null;let p;if(d.type==="Point")return d.coordinates.push(c.readDoubleLE(72)),d;p=d.coordinates.length;const v=52+(p<<4);return d.coordinates=this.parseZPointArray(c,v,p,d.coordinates),d},sn.prototype.parsePolyline=function(c){const d={},p=c.readInt32LE(32);if(!p)return null;const v=this.parseCoord(c,0),x=this.parseCoord(c,16);d.bbox=[v[0],v[1],x[0],x[1]];const b=c.readInt32LE(36);let E,S;return p===1?(d.type="LineString",E=44,d.coordinates=this.parsePointArray(c,E,b)):(d.type="MultiLineString",E=40+(p<<2),S=40,d.coordinates=this.parseArrayGroup(c,E,S,p,b)),d},sn.prototype.parseZPolyline=function(c){const d=this.parsePolyline(c);if(!d)return null;const p=d.coordinates.length;let v;return d.type==="LineString"?(v=60+(p<<4),d.coordinates=this.parseZPointArray(c,v,p,d.coordinates),d):(v=56+(d.coordinates.reduce(function(b,E){return b+E.length},0)<<4)+(p<<2),d.coordinates=this.parseZArrayGroup(c,v,p,d.coordinates),d)},sn.prototype.polyFuncs=function(c){return c&&(c.type==="LineString"?(c.type="Polygon",c.coordinates=[c.coordinates],c):(c.coordinates=zF(c.coordinates),c.coordinates.length===1?(c.type="Polygon",c.coordinates=c.coordinates[0],c):(c.type="MultiPolygon",c)))},sn.prototype.parsePolygon=function(c){return this.polyFuncs(this.parsePolyline(c))},sn.prototype.parseZPolygon=function(c){return this.polyFuncs(this.parseZPolyline(c))};const vb={1:"parsePoint",3:"parsePolyline",5:"parsePolygon",8:"parseMultiPoint",11:"parseZPoint",13:"parseZPolyline",15:"parseZPolygon",18:"parseZMultiPoint"};function BF(c){return c?function(d,p){const v=[d.readDoubleLE(p),d.readDoubleLE(p+8)];return c.inverse(v)}:function(d,p){return[d.readDoubleLE(p),d.readDoubleLE(p+8)]}}function sn(c,d){if(!(this instanceof sn))return new sn(c,d);this.buffer=c,this.headers=this.parseHeader(),this.shpFuncs(d),this.rows=this.getRows()}sn.prototype.shpFuncs=function(c){let d=this.headers.shpCode;if(d>20&&(d-=20),!(d in vb))throw new Error("I don't know that shp type");this.parseFunc=this[vb[d]],this.parseCoord=BF(c)},sn.prototype.getShpCode=function(){return this.parseHeader().shpCode},sn.prototype.parseHeader=function(){const c=this.buffer.subarray(0,100);return{length:c.readInt32BE(6<<2)<<1,version:c.readInt32LE(7<<2),shpCode:c.readInt32LE(8<<2),bbox:[c.readDoubleLE(9<<2),c.readDoubleLE(11<<2),c.readDoubleLE(13<<2),c.readDoubleLE(15<<2)]}},sn.prototype.getRows=function(){let c=100;const d=this.buffer.byteLength,p=d-8,v=[];let x;for(;c<=p&&(x=this.getRow(c,d),!!x);)c+=8,c+=x.len,x.type?v.push(this.parseFunc(x.data)):v.push(null);return v},sn.prototype.getRow=function(c,d){const p=this.buffer.subarray(c,c+12),v=p.readInt32BE(4)<<1,x=p.readInt32BE(0);if(v===0)return{id:x,len:v,type:0};if(!(c+v+8>d))return{id:x,len:v,data:this.buffer.subarray(c+12,c+v+8),type:p.readInt32LE(8)}};function dy(c,d){return new sn(c,d).rows}var UF={exports:{}};(function(c){(function(d){c.exports&&d["encoding-indexes"];function p(B,G,W){return G<=B&&B<=W}function v(B,G){return B.indexOf(G)!==-1}var x=Math.floor;function b(B){if(B===void 0)return{};if(B===Object(B))return B;throw TypeError("Could not convert argument to dictionary")}function E(B){for(var G=String(B),W=G.length,et=0,Q=[];et<W;){var it=G.charCodeAt(et);if(it<55296||it>57343)Q.push(it);else if(56320<=it&&it<=57343)Q.push(65533);else if(55296<=it&&it<=56319)if(et===W-1)Q.push(65533);else{var ft=G.charCodeAt(et+1);if(56320<=ft&&ft<=57343){var Yt=it&1023,vt=ft&1023;Q.push(65536+(Yt<<10)+vt),et+=1}else Q.push(65533)}et+=1}return Q}function S(B){for(var G="",W=0;W<B.length;++W){var et=B[W];et<=65535?G+=String.fromCharCode(et):(et-=65536,G+=String.fromCharCode((et>>10)+55296,(et&1023)+56320))}return G}function C(B){return 0<=B&&B<=127}var N=C,U=-1;function z(B){this.tokens=[].slice.call(B),this.tokens.reverse()}z.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.pop():U},prepend:function(B){if(Array.isArray(B))for(var G=B;G.length;)this.tokens.push(G.pop());else this.tokens.push(B)},push:function(B){if(Array.isArray(B))for(var G=B;G.length;)this.tokens.unshift(G.shift());else this.tokens.unshift(B)}};var H=-1;function D(B,G){if(B)throw TypeError("Decoder error");return G||65533}function q(B){throw TypeError("The code point "+B+" could not be encoded.")}function V(B){return B=String(B).trim().toLowerCase(),Object.prototype.hasOwnProperty.call(j,B)?j[B]:null}var X=[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"UTF-8"}],heading:"The Encoding"},{encodings:[{labels:["866","cp866","csibm866","ibm866"],name:"IBM866"},{labels:["csisolatin2","iso-8859-2","iso-ir-101","iso8859-2","iso88592","iso_8859-2","iso_8859-2:1987","l2","latin2"],name:"ISO-8859-2"},{labels:["csisolatin3","iso-8859-3","iso-ir-109","iso8859-3","iso88593","iso_8859-3","iso_8859-3:1988","l3","latin3"],name:"ISO-8859-3"},{labels:["csisolatin4","iso-8859-4","iso-ir-110","iso8859-4","iso88594","iso_8859-4","iso_8859-4:1988","l4","latin4"],name:"ISO-8859-4"},{labels:["csisolatincyrillic","cyrillic","iso-8859-5","iso-ir-144","iso8859-5","iso88595","iso_8859-5","iso_8859-5:1988"],name:"ISO-8859-5"},{labels:["arabic","asmo-708","csiso88596e","csiso88596i","csisolatinarabic","ecma-114","iso-8859-6","iso-8859-6-e","iso-8859-6-i","iso-ir-127","iso8859-6","iso88596","iso_8859-6","iso_8859-6:1987"],name:"ISO-8859-6"},{labels:["csisolatingreek","ecma-118","elot_928","greek","greek8","iso-8859-7","iso-ir-126","iso8859-7","iso88597","iso_8859-7","iso_8859-7:1987","sun_eu_greek"],name:"ISO-8859-7"},{labels:["csiso88598e","csisolatinhebrew","hebrew","iso-8859-8","iso-8859-8-e","iso-ir-138","iso8859-8","iso88598","iso_8859-8","iso_8859-8:1988","visual"],name:"ISO-8859-8"},{labels:["csiso88598i","iso-8859-8-i","logical"],name:"ISO-8859-8-I"},{labels:["csisolatin6","iso-8859-10","iso-ir-157","iso8859-10","iso885910","l6","latin6"],name:"ISO-8859-10"},{labels:["iso-8859-13","iso8859-13","iso885913"],name:"ISO-8859-13"},{labels:["iso-8859-14","iso8859-14","iso885914"],name:"ISO-8859-14"},{labels:["csisolatin9","iso-8859-15","iso8859-15","iso885915","iso_8859-15","l9"],name:"ISO-8859-15"},{labels:["iso-8859-16"],name:"ISO-8859-16"},{labels:["cskoi8r","koi","koi8","koi8-r","koi8_r"],name:"KOI8-R"},{labels:["koi8-ru","koi8-u"],name:"KOI8-U"},{labels:["csmacintosh","mac","macintosh","x-mac-roman"],name:"macintosh"},{labels:["dos-874","iso-8859-11","iso8859-11","iso885911","tis-620","windows-874"],name:"windows-874"},{labels:["cp1250","windows-1250","x-cp1250"],name:"windows-1250"},{labels:["cp1251","windows-1251","x-cp1251"],name:"windows-1251"},{labels:["ansi_x3.4-1968","ascii","cp1252","cp819","csisolatin1","ibm819","iso-8859-1","iso-ir-100","iso8859-1","iso88591","iso_8859-1","iso_8859-1:1987","l1","latin1","us-ascii","windows-1252","x-cp1252"],name:"windows-1252"},{labels:["cp1253","windows-1253","x-cp1253"],name:"windows-1253"},{labels:["cp1254","csisolatin5","iso-8859-9","iso-ir-148","iso8859-9","iso88599","iso_8859-9","iso_8859-9:1989","l5","latin5","windows-1254","x-cp1254"],name:"windows-1254"},{labels:["cp1255","windows-1255","x-cp1255"],name:"windows-1255"},{labels:["cp1256","windows-1256","x-cp1256"],name:"windows-1256"},{labels:["cp1257","windows-1257","x-cp1257"],name:"windows-1257"},{labels:["cp1258","windows-1258","x-cp1258"],name:"windows-1258"},{labels:["x-mac-cyrillic","x-mac-ukrainian"],name:"x-mac-cyrillic"}],heading:"Legacy single-byte encodings"},{encodings:[{labels:["chinese","csgb2312","csiso58gb231280","gb2312","gb_2312","gb_2312-80","gbk","iso-ir-58","x-gbk"],name:"GBK"},{labels:["gb18030"],name:"gb18030"}],heading:"Legacy multi-byte Chinese (simplified) encodings"},{encodings:[{labels:["big5","big5-hkscs","cn-big5","csbig5","x-x-big5"],name:"Big5"}],heading:"Legacy multi-byte Chinese (traditional) encodings"},{encodings:[{labels:["cseucpkdfmtjapanese","euc-jp","x-euc-jp"],name:"EUC-JP"},{labels:["csiso2022jp","iso-2022-jp"],name:"ISO-2022-JP"},{labels:["csshiftjis","ms932","ms_kanji","shift-jis","shift_jis","sjis","windows-31j","x-sjis"],name:"Shift_JIS"}],heading:"Legacy multi-byte Japanese encodings"},{encodings:[{labels:["cseuckr","csksc56011987","euc-kr","iso-ir-149","korean","ks_c_5601-1987","ks_c_5601-1989","ksc5601","ksc_5601","windows-949"],name:"EUC-KR"}],heading:"Legacy multi-byte Korean encodings"},{encodings:[{labels:["csiso2022kr","hz-gb-2312","iso-2022-cn","iso-2022-cn-ext","iso-2022-kr"],name:"replacement"},{labels:["utf-16be"],name:"UTF-16BE"},{labels:["utf-16","utf-16le"],name:"UTF-16LE"},{labels:["x-user-defined"],name:"x-user-defined"}],heading:"Legacy miscellaneous encodings"}],j={};X.forEach(function(B){B.encodings.forEach(function(G){G.labels.forEach(function(W){j[W]=G})})});var J={},st={};function dt(B,G){return G&&G[B]||null}function lt(B,G){var W=G.indexOf(B);return W===-1?null:W}function bt(B){if(!("encoding-indexes"in d))throw Error("Indexes missing. Did you forget to include encoding-indexes.js first?");return d["encoding-indexes"][B]}function It(B){if(B>39419&&B<189e3||B>1237575)return null;if(B===7457)return 59335;var G=0,W=0,et=bt("gb18030-ranges"),Q;for(Q=0;Q<et.length;++Q){var it=et[Q];if(it[0]<=B)G=it[0],W=it[1];else break}return W+B-G}function Vt(B){if(B===59335)return 7457;var G=0,W=0,et=bt("gb18030-ranges"),Q;for(Q=0;Q<et.length;++Q){var it=et[Q];if(it[1]<=B)G=it[1],W=it[0];else break}return W+B-G}function Nt(B){Jt=Jt||bt("jis0208").map(function(W,et){return p(et,8272,8835)?null:W});var G=Jt;return G.indexOf(B)}var Jt;function be(B){at=at||bt("big5").map(function(W,et){return et<(161-129)*157?null:W});var G=at;return B===9552||B===9566||B===9569||B===9578||B===21313||B===21317?G.lastIndexOf(B):lt(B,G)}var at,zt="utf-8";function $(B,G){if(!(this instanceof $))throw TypeError("Called as a function. Did you forget 'new'?");B=B!==void 0?String(B):zt,G=b(G),this._encoding=null,this._decoder=null,this._ignoreBOM=!1,this._BOMseen=!1,this._error_mode="replacement",this._do_not_flush=!1;var W=V(B);if(W===null||W.name==="replacement")throw RangeError("Unknown encoding: "+B);if(!st[W.name])throw Error("Decoder not present. Did you forget to include encoding-indexes.js first?");var et=this;return et._encoding=W,Boolean(G.fatal)&&(et._error_mode="fatal"),Boolean(G.ignoreBOM)&&(et._ignoreBOM=!0),Object.defineProperty||(this.encoding=et._encoding.name.toLowerCase(),this.fatal=et._error_mode==="fatal",this.ignoreBOM=et._ignoreBOM),et}Object.defineProperty&&(Object.defineProperty($.prototype,"encoding",{get:function(){return this._encoding.name.toLowerCase()}}),Object.defineProperty($.prototype,"fatal",{get:function(){return this._error_mode==="fatal"}}),Object.defineProperty($.prototype,"ignoreBOM",{get:function(){return this._ignoreBOM}})),$.prototype.decode=function(G,W){var et;typeof G=="object"&&G instanceof ArrayBuffer?et=new Uint8Array(G):typeof G=="object"&&"buffer"in G&&G.buffer instanceof ArrayBuffer?et=new Uint8Array(G.buffer,G.byteOffset,G.byteLength):et=new Uint8Array(0),W=b(W),this._do_not_flush||(this._decoder=st[this._encoding.name]({fatal:this._error_mode==="fatal"}),this._BOMseen=!1),this._do_not_flush=Boolean(W.stream);for(var Q=new z(et),it=[],ft;;){var Yt=Q.read();if(Yt===U||(ft=this._decoder.handler(Q,Yt),ft===H))break;ft!==null&&(Array.isArray(ft)?it.push.apply(it,ft):it.push(ft))}if(!this._do_not_flush){do{if(ft=this._decoder.handler(Q,Q.read()),ft===H)break;ft!==null&&(Array.isArray(ft)?it.push.apply(it,ft):it.push(ft))}while(!Q.endOfStream());this._decoder=null}function vt(fe){return v(["UTF-8","UTF-16LE","UTF-16BE"],this._encoding.name)&&!this._ignoreBOM&&!this._BOMseen&&(fe.length>0&&fe[0]===65279?(this._BOMseen=!0,fe.shift()):fe.length>0&&(this._BOMseen=!0)),S(fe)}return vt.call(this,it)};function $t(B,G){if(!(this instanceof $t))throw TypeError("Called as a function. Did you forget 'new'?");G=b(G),this._encoding=null,this._encoder=null,this._do_not_flush=!1,this._fatal=Boolean(G.fatal)?"fatal":"replacement";var W=this;if(Boolean(G.NONSTANDARD_allowLegacyEncoding)){B=B!==void 0?String(B):zt;var et=V(B);if(et===null||et.name==="replacement")throw RangeError("Unknown encoding: "+B);if(!J[et.name])throw Error("Encoder not present. Did you forget to include encoding-indexes.js first?");W._encoding=et}else W._encoding=V("utf-8"),B!==void 0&&"console"in d&&console.warn("TextEncoder constructor called with encoding label, which is ignored.");return Object.defineProperty||(this.encoding=W._encoding.name.toLowerCase()),W}Object.defineProperty&&Object.defineProperty($t.prototype,"encoding",{get:function(){return this._encoding.name.toLowerCase()}}),$t.prototype.encode=function(G,W){G=G===void 0?"":String(G),W=b(W),this._do_not_flush||(this._encoder=J[this._encoding.name]({fatal:this._fatal==="fatal"})),this._do_not_flush=Boolean(W.stream);for(var et=new z(E(G)),Q=[],it;;){var ft=et.read();if(ft===U||(it=this._encoder.handler(et,ft),it===H))break;Array.isArray(it)?Q.push.apply(Q,it):Q.push(it)}if(!this._do_not_flush){for(;it=this._encoder.handler(et,et.read()),it!==H;)Array.isArray(it)?Q.push.apply(Q,it):Q.push(it);this._encoder=null}return new Uint8Array(Q)};function De(B){var G=B.fatal,W=0,et=0,Q=0,it=128,ft=191;this.handler=function(Yt,vt){if(vt===U&&Q!==0)return Q=0,D(G);if(vt===U)return H;if(Q===0){if(p(vt,0,127))return vt;if(p(vt,194,223))Q=1,W=vt&31;else if(p(vt,224,239))vt===224&&(it=160),vt===237&&(ft=159),Q=2,W=vt&15;else if(p(vt,240,244))vt===240&&(it=144),vt===244&&(ft=143),Q=3,W=vt&7;else return D(G);return null}if(!p(vt,it,ft))return W=Q=et=0,it=128,ft=191,Yt.prepend(vt),D(G);if(it=128,ft=191,W=W<<6|vt&63,et+=1,et!==Q)return null;var fe=W;return W=Q=et=0,fe}}function te(B){B.fatal,this.handler=function(G,W){if(W===U)return H;if(N(W))return W;var et,Q;p(W,128,2047)?(et=1,Q=192):p(W,2048,65535)?(et=2,Q=224):p(W,65536,1114111)&&(et=3,Q=240);for(var it=[(W>>6*et)+Q];et>0;){var ft=W>>6*(et-1);it.push(128|ft&63),et-=1}return it}}J["UTF-8"]=function(B){return new te(B)},st["UTF-8"]=function(B){return new De(B)};function Ze(B,G){var W=G.fatal;this.handler=function(et,Q){if(Q===U)return H;if(C(Q))return Q;var it=B[Q-128];return it===null?D(W):it}}function ae(B,G){G.fatal,this.handler=function(W,et){if(et===U)return H;if(N(et))return et;var Q=lt(et,B);return Q===null&&q(et),Q+128}}(function(){"encoding-indexes"in d&&X.forEach(function(B){B.heading==="Legacy single-byte encodings"&&B.encodings.forEach(function(G){var W=G.name,et=bt(W.toLowerCase());st[W]=function(Q){return new Ze(et,Q)},J[W]=function(Q){return new ae(et,Q)}})})})(),st.GBK=function(B){return new Le(B)},J.GBK=function(B){return new Rt(B,!0)};function Le(B){var G=B.fatal,W=0,et=0,Q=0;this.handler=function(it,ft){if(ft===U&&W===0&&et===0&&Q===0)return H;ft===U&&(W!==0||et!==0||Q!==0)&&(W=0,et=0,Q=0,D(G));var Yt;if(Q!==0){Yt=null,p(ft,48,57)&&(Yt=It((((W-129)*10+et-48)*126+Q-129)*10+ft-48));var vt=[et,Q,ft];return W=0,et=0,Q=0,Yt===null?(it.prepend(vt),D(G)):Yt}if(et!==0)return p(ft,129,254)?(Q=ft,null):(it.prepend([et,ft]),W=0,et=0,D(G));if(W!==0){if(p(ft,48,57))return et=ft,null;var fe=W,ii=null;W=0;var Ue=ft<127?64:65;return(p(ft,64,126)||p(ft,128,254))&&(ii=(fe-129)*190+(ft-Ue)),Yt=ii===null?null:dt(ii,bt("gb18030")),Yt===null&&C(ft)&&it.prepend(ft),Yt===null?D(G):Yt}return C(ft)?ft:ft===128?8364:p(ft,129,254)?(W=ft,null):D(G)}}function Rt(B,G){B.fatal,this.handler=function(W,et){if(et===U)return H;if(N(et))return et;if(et===58853)return q(et);if(G&&et===8364)return 128;var Q=lt(et,bt("gb18030"));if(Q!==null){var it=x(Q/190)+129,ft=Q%190,Yt=ft<63?64:65;return[it,ft+Yt]}if(G)return q(et);Q=Vt(et);var vt=x(Q/10/126/10);Q=Q-vt*10*126*10;var fe=x(Q/10/126);Q=Q-fe*10*126;var ii=x(Q/10),Ue=Q-ii*10;return[vt+129,fe+48,ii+129,Ue+48]}}J.gb18030=function(B){return new Rt(B)},st.gb18030=function(B){return new Le(B)};function St(B){var G=B.fatal,W=0;this.handler=function(et,Q){if(Q===U&&W!==0)return W=0,D(G);if(Q===U&&W===0)return H;if(W!==0){var it=W,ft=null;W=0;var Yt=Q<127?64:98;switch((p(Q,64,126)||p(Q,161,254))&&(ft=(it-129)*157+(Q-Yt)),ft){case 1133:return[202,772];case 1135:return[202,780];case 1164:return[234,772];case 1166:return[234,780]}var vt=ft===null?null:dt(ft,bt("big5"));return vt===null&&C(Q)&&et.prepend(Q),vt===null?D(G):vt}return C(Q)?Q:p(Q,129,254)?(W=Q,null):D(G)}}function Re(B){B.fatal,this.handler=function(G,W){if(W===U)return H;if(N(W))return W;var et=be(W);if(et===null)return q(W);var Q=x(et/157)+129;if(Q<161)return q(W);var it=et%157,ft=it<63?64:98;return[Q,it+ft]}}J.Big5=function(B){return new Re(B)},st.Big5=function(B){return new St(B)};function me(B){var G=B.fatal,W=!1,et=0;this.handler=function(Q,it){if(it===U&&et!==0)return et=0,D(G);if(it===U&&et===0)return H;if(et===142&&p(it,161,223))return et=0,65377-161+it;if(et===143&&p(it,161,254))return W=!0,et=it,null;if(et!==0){var ft=et;et=0;var Yt=null;return p(ft,161,254)&&p(it,161,254)&&(Yt=dt((ft-161)*94+(it-161),bt(W?"jis0212":"jis0208"))),W=!1,p(it,161,254)||Q.prepend(it),Yt===null?D(G):Yt}return C(it)?it:it===142||it===143||p(it,161,254)?(et=it,null):D(G)}}function he(B){B.fatal,this.handler=function(G,W){if(W===U)return H;if(N(W))return W;if(W===165)return 92;if(W===8254)return 126;if(p(W,65377,65439))return[142,W-65377+161];W===8722&&(W=65293);var et=lt(W,bt("jis0208"));if(et===null)return q(W);var Q=x(et/94)+161,it=et%94+161;return[Q,it]}}J["EUC-JP"]=function(B){return new he(B)},st["EUC-JP"]=function(B){return new me(B)};function Xi(B){var G=B.fatal,W={ASCII:0,Roman:1,Katakana:2,LeadByte:3,TrailByte:4,EscapeStart:5,Escape:6},et=W.ASCII,Q=W.ASCII,it=0,ft=!1;this.handler=function(Yt,vt){switch(et){default:case W.ASCII:return vt===27?(et=W.EscapeStart,null):p(vt,0,127)&&vt!==14&&vt!==15&&vt!==27?(ft=!1,vt):vt===U?H:(ft=!1,D(G));case W.Roman:return vt===27?(et=W.EscapeStart,null):vt===92?(ft=!1,165):vt===126?(ft=!1,8254):p(vt,0,127)&&vt!==14&&vt!==15&&vt!==27&&vt!==92&&vt!==126?(ft=!1,vt):vt===U?H:(ft=!1,D(G));case W.Katakana:return vt===27?(et=W.EscapeStart,null):p(vt,33,95)?(ft=!1,65377-33+vt):vt===U?H:(ft=!1,D(G));case W.LeadByte:return vt===27?(et=W.EscapeStart,null):p(vt,33,126)?(ft=!1,it=vt,et=W.TrailByte,null):vt===U?H:(ft=!1,D(G));case W.TrailByte:if(vt===27)return et=W.EscapeStart,D(G);if(p(vt,33,126)){et=W.LeadByte;var fe=(it-33)*94+vt-33,ii=dt(fe,bt("jis0208"));return ii===null?D(G):ii}return vt===U?(et=W.LeadByte,Yt.prepend(vt),D(G)):(et=W.LeadByte,D(G));case W.EscapeStart:return vt===36||vt===40?(it=vt,et=W.Escape,null):(Yt.prepend(vt),ft=!1,et=Q,D(G));case W.Escape:var Ue=it;it=0;var bn=null;if(Ue===40&&vt===66&&(bn=W.ASCII),Ue===40&&vt===74&&(bn=W.Roman),Ue===40&&vt===73&&(bn=W.Katakana),Ue===36&&(vt===64||vt===66)&&(bn=W.LeadByte),bn!==null){et=et=bn;var Fh=ft;return ft=!0,Fh?D(G):null}return Yt.prepend([Ue,vt]),ft=!1,et=Q,D(G)}}}function kn(B){B.fatal;var G={ASCII:0,Roman:1,jis0208:2},W=G.ASCII;this.handler=function(et,Q){if(Q===U&&W!==G.ASCII)return et.prepend(Q),W=G.ASCII,[27,40,66];if(Q===U&&W===G.ASCII)return H;if((W===G.ASCII||W===G.Roman)&&(Q===14||Q===15||Q===27))return q(65533);if(W===G.ASCII&&N(Q))return Q;if(W===G.Roman&&(N(Q)&&Q!==92&&Q!==126||Q==165||Q==8254)){if(N(Q))return Q;if(Q===165)return 92;if(Q===8254)return 126}if(N(Q)&&W!==G.ASCII)return et.prepend(Q),W=G.ASCII,[27,40,66];if((Q===165||Q===8254)&&W!==G.Roman)return et.prepend(Q),W=G.Roman,[27,40,74];Q===8722&&(Q=65293);var it=lt(Q,bt("jis0208"));if(it===null)return q(Q);if(W!==G.jis0208)return et.prepend(Q),W=G.jis0208,[27,36,66];var ft=x(it/94)+33,Yt=it%94+33;return[ft,Yt]}}J["ISO-2022-JP"]=function(B){return new kn(B)},st["ISO-2022-JP"]=function(B){return new Xi(B)};function ei(B){var G=B.fatal,W=0;this.handler=function(et,Q){if(Q===U&&W!==0)return W=0,D(G);if(Q===U&&W===0)return H;if(W!==0){var it=W,ft=null;W=0;var Yt=Q<127?64:65,vt=it<160?129:193;if((p(Q,64,126)||p(Q,128,252))&&(ft=(it-vt)*188+Q-Yt),p(ft,8836,10715))return 57344-8836+ft;var fe=ft===null?null:dt(ft,bt("jis0208"));return fe===null&&C(Q)&&et.prepend(Q),fe===null?D(G):fe}return C(Q)||Q===128?Q:p(Q,161,223)?65377-161+Q:p(Q,129,159)||p(Q,224,252)?(W=Q,null):D(G)}}function mi(B){B.fatal,this.handler=function(G,W){if(W===U)return H;if(N(W)||W===128)return W;if(W===165)return 92;if(W===8254)return 126;if(p(W,65377,65439))return W-65377+161;W===8722&&(W=65293);var et=Nt(W);if(et===null)return q(W);var Q=x(et/188),it=Q<31?129:193,ft=et%188,Yt=ft<63?64:65;return[Q+it,ft+Yt]}}J.Shift_JIS=function(B){return new mi(B)},st.Shift_JIS=function(B){return new ei(B)};function un(B){var G=B.fatal,W=0;this.handler=function(et,Q){if(Q===U&&W!==0)return W=0,D(G);if(Q===U&&W===0)return H;if(W!==0){var it=W,ft=null;W=0,p(Q,65,254)&&(ft=(it-129)*190+(Q-65));var Yt=ft===null?null:dt(ft,bt("euc-kr"));return ft===null&&C(Q)&&et.prepend(Q),Yt===null?D(G):Yt}return C(Q)?Q:p(Q,129,254)?(W=Q,null):D(G)}}function ji(B){B.fatal,this.handler=function(G,W){if(W===U)return H;if(N(W))return W;var et=lt(W,bt("euc-kr"));if(et===null)return q(W);var Q=x(et/190)+129,it=et%190+65;return[Q,it]}}J["EUC-KR"]=function(B){return new ji(B)},st["EUC-KR"]=function(B){return new un(B)};function vs(B,G){var W=B>>8,et=B&255;return G?[W,et]:[et,W]}function Os(B,G){var W=G.fatal,et=null,Q=null;this.handler=function(it,ft){if(ft===U&&(et!==null||Q!==null))return D(W);if(ft===U&&et===null&&Q===null)return H;if(et===null)return et=ft,null;var Yt;if(B?Yt=(et<<8)+ft:Yt=(ft<<8)+et,et=null,Q!==null){var vt=Q;return Q=null,p(Yt,56320,57343)?65536+(vt-55296)*1024+(Yt-56320):(it.prepend(vs(Yt,B)),D(W))}return p(Yt,55296,56319)?(Q=Yt,null):p(Yt,56320,57343)?D(W):Yt}}function F(B,G){G.fatal,this.handler=function(W,et){if(et===U)return H;if(p(et,0,65535))return vs(et,B);var Q=vs((et-65536>>10)+55296,B),it=vs((et-65536&1023)+56320,B);return Q.concat(it)}}J["UTF-16BE"]=function(B){return new F(!0,B)},st["UTF-16BE"]=function(B){return new Os(!0,B)},J["UTF-16LE"]=function(B){return new F(!1,B)},st["UTF-16LE"]=function(B){return new Os(!1,B)};function Wt(B){B.fatal,this.handler=function(G,W){return W===U?H:C(W)?W:63360+W-128}}function kt(B){B.fatal,this.handler=function(G,W){return W===U?H:N(W)?W:p(W,63360,63487)?W-63360+128:q(W)}}J["x-user-defined"]=function(B){return new kt(B)},st["x-user-defined"]=function(B){return new Wt(B)},d.TextEncoder||(d.TextEncoder=$t),d.TextDecoder||(d.TextDecoder=$),c.exports&&(c.exports={TextEncoder:d.TextEncoder,TextDecoder:d.TextDecoder,EncodingIndexes:d["encoding-indexes"]})})($u||{})})(UF);var GF=Bt.isEncoding||function(c){switch(c&&c.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function VF(c){if(c&&!GF(c))throw new Error("Unknown encoding: "+c)}function w0(c){switch(this.encoding=(c||"utf8").toLowerCase().replace(/[-_]/,""),VF(c),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=$F;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=YF;break;default:this.write=WF;return}this.charBuffer=new Bt(6),this.charReceived=0,this.charLength=0}w0.prototype.write=function(c){for(var d="";this.charLength;){var p=c.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:c.length;if(c.copy(this.charBuffer,this.charReceived,0,p),this.charReceived+=p,this.charReceived<this.charLength)return"";c=c.slice(p,c.length),d=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var x=d.charCodeAt(d.length-1);if(x>=55296&&x<=56319){this.charLength+=this.surrogateSize,d="";continue}if(this.charReceived=this.charLength=0,c.length===0)return d;break}this.detectIncompleteChar(c);var v=c.length;this.charLength&&(c.copy(this.charBuffer,0,c.length-this.charReceived,v),v-=this.charReceived),d+=c.toString(this.encoding,0,v);var v=d.length-1,x=d.charCodeAt(v);if(x>=55296&&x<=56319){var b=this.surrogateSize;return this.charLength+=b,this.charReceived+=b,this.charBuffer.copy(this.charBuffer,b,0,b),c.copy(this.charBuffer,0,0,b),d.substring(0,v)}return d},w0.prototype.detectIncompleteChar=function(c){for(var d=c.length>=3?3:c.length;d>0;d--){var p=c[c.length-d];if(d==1&&p>>5==6){this.charLength=2;break}if(d<=2&&p>>4==14){this.charLength=3;break}if(d<=3&&p>>3==30){this.charLength=4;break}}this.charReceived=d},w0.prototype.end=function(c){var d="";if(c&&c.length&&(d=this.write(c)),this.charReceived){var p=this.charReceived,v=this.charBuffer,x=this.encoding;d+=v.slice(0,p).toString(x)}return d};function WF(c){return c.toString(this.encoding)}function $F(c){this.charReceived=c.length%2,this.charLength=this.charReceived?2:0}function YF(c){this.charReceived=c.length%3,this.charLength=this.charReceived?3:0}var HF=Object.freeze({__proto__:null,StringDecoder:w0}),qF=IF(HF),XF=qF.StringDecoder;function wb(c){var d=new XF,p=d.write(c)+d.end();return p.replace(/\0/g,"").trim()}var jF=bb,ZF=/^(?:ANSI\s)?(\d+)$/m;function bb(c,d){if(!c)return wb;try{new TextDecoder(c.trim())}catch{var p=ZF.exec(c);return p&&!d?bb("windows-"+p[1],!0):wb}return v;function v(x){var b=new TextDecoder(c),E=b.decode(x,{stream:!0})+b.decode();return E.replace(/\0/g,"").trim()}}var KF=jF;function JF(c){var d={};return d.lastUpdated=new Date(c.readUInt8(1)+1900,c.readUInt8(2),c.readUInt8(3)),d.records=c.readUInt32LE(4),d.headerLen=c.readUInt16LE(8),d.recLen=c.readUInt16LE(10),d}function QF(c,d,p){for(var v=[],x=32;x<d&&(v.push({name:p(c.slice(x,x+11)),dataType:String.fromCharCode(c.readUInt8(x+11)),len:c.readUInt8(x+16),decimal:c.readUInt8(x+17)}),c.readUInt8(x+32)!==13);)x+=32;return v}function tD(c,d,p,v,x){var b=c.slice(d,d+p),E=x(b);switch(v){case"N":case"F":case"O":return parseFloat(E,10);case"D":return new Date(E.slice(0,4),parseInt(E.slice(4,6),10)-1,E.slice(6,8));case"L":return E.toLowerCase()==="y"||E.toLowerCase()==="t";default:return E}}function eD(c,d,p,v){for(var x={},b=0,E=p.length,S,C;b<E;)C=p[b],S=tD(c,d,C.len,C.dataType,v),d+=C.len,typeof S<"u"&&(x[C.name]=S),b++;return x}var iD=function(c,d){for(var p=KF(d),v=JF(c),x=QF(c,v.headerLen-1,p),b=(x.length+1<<5)+2,E=v.recLen,S=v.records,C=[];S;)C.push(eD(c,b,x,p)),b+=E,S--;return C},fy=yb(iD);const nD=globalThis.URL;function py(c){if(!c)throw new Error("forgot to pass buffer");if(Bt.isBuffer(c))return c;if(Mb(c))return Bt.from(c);if(Mb(c.buffer))return c.BYTES_PER_ELEMENT===1?Bt.from(c):Bt.from(c.buffer)}function Mb(c){return c instanceof globalThis.ArrayBuffer||Object.prototype.toString.call(c)==="[object ArrayBuffer]"}const my=function([c,d]){const p={};p.type="FeatureCollection",p.features=[];let v=0;const x=c.length;for(d||(d=[]);v<x;)p.features.push({type:"Feature",geometry:c[v],properties:d[v]||{}}),v++;return p},gy=async function(c,d){let p;c=py(c);const v=await LF(c),x=[];d=d||[];for(p in v)p.indexOf("__MACOSX")===-1&&(p.slice(-4).toLowerCase()===".shp"?(x.push(p.slice(0,-4)),v[p.slice(0,-3)+p.slice(-3).toLowerCase()]=v[p]):p.slice(-4).toLowerCase()===".prj"?v[p.slice(0,-3)+p.slice(-3).toLowerCase()]=_s(v[p]):p.slice(-5).toLowerCase()===".json"||d.indexOf(p.split(".").pop())>-1?x.push(p.slice(0,-3)+p.slice(-3).toLowerCase()):(p.slice(-4).toLowerCase()===".dbf"||p.slice(-4).toLowerCase()===".cpg")&&(v[p.slice(0,-3)+p.slice(-3).toLowerCase()]=v[p]));if(!x.length)throw new Error("no layers founds");const b=x.map(function(E){let S,C;const N=E.lastIndexOf(".");return N>-1&&E.slice(N).indexOf("json")>-1?(S=JSON.parse(v[E]),S.fileName=E.slice(0,N)):d.indexOf(E.slice(N+1))>-1?(S=v[E],S.fileName=E):(v[E+".dbf"]&&(C=fy(v[E+".dbf"],v[E+".cpg"])),S=my([dy(v[E+".shp"],v[E+".prj"]),C]),S.fileName=E),S});return b.length===1?b[0]:b};async function sD(c,d){const p=await Yu(c);return gy(p,d)}const rD=async c=>{const d=await Promise.all([Yu(c,"shp"),Yu(c,"prj")]);let p=!1;try{d[1]&&(p=_s(d[1]))}catch{p=!1}return dy(d[0],p)},aD=async c=>{const[d,p]=await Promise.all([Yu(c,"dbf"),Yu(c,"cpg")]);if(!!d)return fy(d,p)},oD=(c,d)=>{var v;return new nD(c,(v=globalThis==null?void 0:globalThis.document)==null?void 0:v.location).pathname.slice(-4).toLowerCase()===d},Hu=async function(c,d){if(typeof c!="string")return gy(c);if(oD(c,".zip"))return sD(c,d);const p=await Promise.all([rD(c),aD(c)]);return my(p)},hD=function(c,d){if(c=py(c),Bt.isBuffer(d)&&(d=d.toString()),typeof d=="string")try{d=_s(d)}catch{d=!1}return dy(c,d)},lD=function(c,d){return c=py(c),fy(c,d)};return Hu.combine=my,Hu.parseDbf=lD,Hu.parseZip=gy,Hu.parseShp=hD,Hu})})(mm);class TA{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=mr,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let i=e.dataProjection?Ri(e.dataProjection):this.readProjection(t);e.extent&&i&&i.getUnits()==="tile-pixels"&&(i=Ri(i),i.setWorldExtent(e.extent)),e={dataProjection:i,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return ke()}readFeature(t,e){return ke()}readFeatures(t,e){return ke()}readGeometry(t,e){return ke()}readProjection(t){return ke()}writeFeature(t,e){return ke()}writeFeatures(t,e){return ke()}writeGeometry(t,e){return ke()}}function Df(n,t,e){const i=e?Ri(e.featureProjection):null,s=e?Ri(e.dataProjection):null;let r=n;if(i&&s&&!zr(i,s)){t&&(r=n.clone());const a=t?i:s,o=t?s:i;a.getUnits()==="tile-pixels"?r.transform(a,o):r.applyTransform(Yd(a,o))}if(t&&e&&e.decimals!==void 0){const a=Math.pow(10,e.decimals),o=function(h){for(let l=0,u=h.length;l<u;++l)h[l]=Math.round(h[l]*a)/a;return h};r===n&&(r=n.clone()),r.applyTransform(o)}return r}const fY={Point:Ra,LineString:Ia,Polygon:ir,MultiPoint:ug,MultiLineString:If,MultiPolygon:dg};function pY(n,t,e){return Array.isArray(t[0])?(hC(n,0,t,e)||(n=n.slice(),s_(n,0,t,e)),n):(sv(n,0,t,e)||(n=n.slice(),Zp(n,0,t,e)),n)}function CA(n,t){var r;const e=n.geometry;if(!e)return[];if(Array.isArray(e))return e.map(a=>CA({...n,geometry:a})).flat();const i=e.type==="MultiPolygon"?"Polygon":e.type;if(i==="GeometryCollection"||i==="Circle")throw new Error("Unsupported geometry type: "+i);const s=e.layout.length;return Df(new no(i,i==="Polygon"?pY(e.flatCoordinates,e.ends,s):e.flatCoordinates,(r=e.ends)==null?void 0:r.flat(),s,n.properties||{},n.id).enableSimplifyTransformed(),!1,t)}function Yv(n,t){if(!n)return null;if(Array.isArray(n)){const i=n.map(s=>Yv(s,t));return new mo(i)}const e=fY[n.type];return Df(new e(n.flatCoordinates,n.layout,n.ends),!1,t)}class mY extends TA{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(j0(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(j0(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return ke()}readFeaturesFromObject(t,e){return ke()}readGeometry(t,e){return this.readGeometryFromObject(j0(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return ke()}readProjection(t){return this.readProjectionFromObject(j0(t))}readProjectionFromObject(t){return ke()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return ke()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return ke()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return ke()}}function j0(n){if(typeof n=="string"){const t=JSON.parse(n);return t||null}return n!==null?n:null}const gY=mY;class yY extends gY{constructor(t){t=t||{},super(),this.dataProjection=Ri(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=Ri(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let i=null;t.type==="Feature"?i=t:i={type:"Feature",geometry:t,properties:null};const s=Hv(i.geometry);if(this.featureClass===no)return CA({geometry:s,id:i.id,properties:i.properties},e);const r=new mr;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&i.geometry_name&&r.setGeometryName(i.geometry_name),r.setGeometry(Yv(s,e)),"id"in i&&r.setId(i.id),i.properties&&r.setProperties(i.properties,!0),r}readFeaturesFromObject(t,e){const i=t;let s=null;if(i.type==="FeatureCollection"){const r=t;s=[];const a=r.features;for(let o=0,h=a.length;o<h;++o){const l=this.readFeatureFromObject(a[o],e);!l||s.push(l)}}else s=[this.readFeatureFromObject(t,e)];return s.flat()}readGeometryFromObject(t,e){return _Y(t,e)}readProjectionFromObject(t){const e=t.crs;let i;if(e)if(e.type=="name")i=Ri(e.properties.name);else if(e.type==="EPSG")i=Ri("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else i=this.dataProjection;return i}writeFeatureObject(t,e){e=this.adaptOptions(e);const i={type:"Feature",geometry:null,properties:null},s=t.getId();if(s!==void 0&&(i.id=s),!t.hasProperties())return i;const r=t.getProperties(),a=t.getGeometry();return a&&(i.geometry=v_(a,e),delete r[t.getGeometryName()]),al(r)||(i.properties=r),i}writeFeaturesObject(t,e){e=this.adaptOptions(e);const i=[];for(let s=0,r=t.length;s<r;++s)i.push(this.writeFeatureObject(t[s],e));return{type:"FeatureCollection",features:i}}writeGeometryObject(t,e){return v_(t,this.adaptOptions(e))}}function Hv(n,t){if(!n)return null;let e;switch(n.type){case"Point":{e=vY(n);break}case"LineString":{e=wY(n);break}case"Polygon":{e=SY(n);break}case"MultiPoint":{e=MY(n);break}case"MultiLineString":{e=bY(n);break}case"MultiPolygon":{e=EY(n);break}case"GeometryCollection":{e=xY(n);break}default:throw new Error("Unsupported GeoJSON type: "+n.type)}return e}function _Y(n,t){const e=Hv(n);return Yv(e,t)}function xY(n,t){return n.geometries.map(function(i){return Hv(i)})}function vY(n){const t=n.coordinates;return{type:"Point",flatCoordinates:t,layout:xl(t.length)}}function wY(n){var i;const t=n.coordinates,e=t.flat();return{type:"LineString",flatCoordinates:e,ends:[e.length],layout:xl(((i=t[0])==null?void 0:i.length)||2)}}function bY(n){var r,a;const t=n.coordinates,e=((a=(r=t[0])==null?void 0:r[0])==null?void 0:a.length)||2,i=[],s=Ef(i,0,t,e);return{type:"MultiLineString",flatCoordinates:i,ends:s,layout:xl(e)}}function MY(n){var e;const t=n.coordinates;return{type:"MultiPoint",flatCoordinates:t.flat(),layout:xl(((e=t[0])==null?void 0:e.length)||2)}}function EY(n){var r,a;const t=n.coordinates,e=[],i=((a=(r=t[0])==null?void 0:r[0])==null?void 0:a[0].length)||2,s=nC(e,0,t,i);return{type:"MultiPolygon",flatCoordinates:e,ends:s,layout:xl(i)}}function SY(n){var r,a;const t=n.coordinates,e=[],i=(a=(r=t[0])==null?void 0:r[0])==null?void 0:a.length,s=Ef(e,0,t,i);return{type:"Polygon",flatCoordinates:e,ends:s,layout:xl(i)}}function v_(n,t){n=Df(n,!0,t);const e=n.getType();let i;switch(e){case"Point":{i=NY(n);break}case"LineString":{i=CY(n);break}case"Polygon":{i=kY(n,t);break}case"MultiPoint":{i=RY(n);break}case"MultiLineString":{i=AY(n);break}case"MultiPolygon":{i=IY(n,t);break}case"GeometryCollection":{i=TY(n,t);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return i}function TY(n,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:n.getGeometriesArray().map(function(i){return v_(i,t)})}}function CY(n,t){return{type:"LineString",coordinates:n.getCoordinates()}}function AY(n,t){return{type:"MultiLineString",coordinates:n.getCoordinates()}}function RY(n,t){return{type:"MultiPoint",coordinates:n.getCoordinates()}}function IY(n,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:n.getCoordinates(e)}}function NY(n,t){return{type:"Point",coordinates:n.getCoordinates()}}function kY(n,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:n.getCoordinates(e)}}const AA=yY,nE="http://www.w3.org/2001/XMLSchema-instance";function zf(n,t){return mg().createElementNS(n,t)}function To(n,t){return RA(n,t,[]).join("")}function RA(n,t,e){if(n.nodeType==Node.CDATA_SECTION_NODE||n.nodeType==Node.TEXT_NODE)t?e.push(String(n.nodeValue).replace(/(\r\n|\r|\n)/g,"")):e.push(n.nodeValue);else{let i;for(i=n.firstChild;i;i=i.nextSibling)RA(i,t,e)}return e}function nh(n){return"documentElement"in n}function sh(n){return new DOMParser().parseFromString(n,"application/xml")}function sE(n,t){return function(e,i){const s=n.call(t!==void 0?t:this,e,i);if(s!==void 0){const r=i[i.length-1];yi(r,s)}}}function Jo(n,t){return function(e,i){const s=n.call(t!==void 0?t:this,e,i);s!==void 0&&i[i.length-1].push(s)}}function qv(n,t){return function(e,i){const s=n.call(t!==void 0?t:this,e,i);s!==void 0&&(i[i.length-1]=s)}}function _e(n,t,e){return function(i,s){const r=n.call(e!==void 0?e:this,i,s);if(r!==void 0){const a=s[s.length-1],o=t!==void 0?t:i.localName;a[o]=r}}}function Ie(n,t){return function(e,i,s){n.call(t!==void 0?t:this,e,i,s),s[s.length-1].node.appendChild(e)}}function Co(n,t){return function(e,i,s){const a=i[i.length-1].node;let o=n;o===void 0&&(o=s);const h=t!==void 0?t:a.namespaceURI;return zf(h,o)}}const xr=Co();function ta(n,t){const e=t.length,i=new Array(e);for(let s=0;s<e;++s)i[s]=n[t[s]];return i}function Se(n,t,e){e=e!==void 0?e:{};let i,s;for(i=0,s=n.length;i<s;++i)e[n[i]]=t;return e}function bu(n,t,e,i){let s;for(s=t.firstElementChild;s;s=s.nextElementSibling){const r=n[s.namespaceURI];if(r!==void 0){const a=r[s.localName];a!==void 0&&a.call(i,s,e)}}}function zi(n,t,e,i,s){return i.push(n),bu(t,e,i,s),i.pop()}function LY(n,t,e,i,s,r){const a=(s!==void 0?s:e).length;let o,h;for(let l=0;l<a;++l)o=e[l],o!==void 0&&(h=t.call(r!==void 0?r:this,o,i,s!==void 0?s[l]:void 0),h!==void 0&&n[h.namespaceURI][h.localName].call(r,h,o,i))}function cn(n,t,e,i,s,r,a){return s.push(n),LY(t,e,i,s,r,a),s.pop()}let Zy;function OY(){return Zy===void 0&&typeof XMLSerializer<"u"&&(Zy=new XMLSerializer),Zy}let Ky;function mg(){return Ky===void 0&&typeof document<"u"&&(Ky=document.implementation.createDocument("","",null)),Ky}class PY extends TA{constructor(){super(),this.xmlSerializer_=OY()}getType(){return"xml"}readFeature(t,e){if(!t)return null;if(typeof t=="string"){const i=sh(t);return this.readFeatureFromDocument(i,e)}return nh(t)?this.readFeatureFromDocument(t,e):this.readFeatureFromNode(t,e)}readFeatureFromDocument(t,e){const i=this.readFeaturesFromDocument(t,e);return i.length>0?i[0]:null}readFeatureFromNode(t,e){return null}readFeatures(t,e){if(!t)return[];if(typeof t=="string"){const i=sh(t);return this.readFeaturesFromDocument(i,e)}return nh(t)?this.readFeaturesFromDocument(t,e):this.readFeaturesFromNode(t,e)}readFeaturesFromDocument(t,e){const i=[];for(let s=t.firstChild;s;s=s.nextSibling)s.nodeType==Node.ELEMENT_NODE&&yi(i,this.readFeaturesFromNode(s,e));return i}readFeaturesFromNode(t,e){return ke()}readGeometry(t,e){if(!t)return null;if(typeof t=="string"){const i=sh(t);return this.readGeometryFromDocument(i,e)}return nh(t)?this.readGeometryFromDocument(t,e):this.readGeometryFromNode(t,e)}readGeometryFromDocument(t,e){return null}readGeometryFromNode(t,e){return null}readProjection(t){if(!t)return null;if(typeof t=="string"){const e=sh(t);return this.readProjectionFromDocument(e)}return nh(t)?this.readProjectionFromDocument(t):this.readProjectionFromNode(t)}readProjectionFromDocument(t){return this.dataProjection}readProjectionFromNode(t){return this.dataProjection}writeFeature(t,e){const i=this.writeFeatureNode(t,e);return this.xmlSerializer_.serializeToString(i)}writeFeatureNode(t,e){return null}writeFeatures(t,e){const i=this.writeFeaturesNode(t,e);return this.xmlSerializer_.serializeToString(i)}writeFeaturesNode(t,e){return null}writeGeometry(t,e){const i=this.writeGeometryNode(t,e);return this.xmlSerializer_.serializeToString(i)}writeGeometryNode(t,e){return null}}const FY=PY;function xh(n){const t=To(n,!1);return DY(t)}function DY(n){const t=/^\s*(true|1)|(false|0)\s*$/.exec(n);if(t)return t[1]!==void 0||!1}function Ji(n){const t=To(n,!1);return zY(t)}function zY(n){const t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(n);if(t)return parseFloat(t[1])}function us(n){return To(n,!1).trim()}function hu(n,t){Br(n,t?"1":"0")}function BY(n,t){n.appendChild(mg().createCDATASection(t))}function Qh(n,t){const e=t.toPrecision();n.appendChild(mg().createTextNode(e))}function Br(n,t){n.appendChild(mg().createTextNode(t))}const Ao=["http://www.google.com/kml/ext/2.2"],we=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],UY="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",rE={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},GY=Se(we,{ExtendedData:$A,Region:YA,MultiGeometry:_e(GA,"geometry"),LineString:_e(BA,"geometry"),LinearRing:_e(UA,"geometry"),Point:_e(VA,"geometry"),Polygon:_e(WA,"geometry"),Style:_e(Zv),StyleMap:EH,address:_e(us),description:_e(us),name:_e(us),open:_e(xh),phoneNumber:_e(us),styleUrl:_e(OA),visibility:_e(xh)},Se(Ao,{MultiTrack:_e(uH,"geometry"),Track:_e(zA,"geometry")})),VY=Se(we,{ExtendedData:$A,Region:YA,Link:FH,address:_e(us),description:_e(us),name:_e(us),open:_e(xh),phoneNumber:_e(us),visibility:_e(xh)}),WY=Se(we,{href:_e(LA)}),$Y=Se(we,{Altitude:_e(Ji),Longitude:_e(Ji),Latitude:_e(Ji),Tilt:_e(Ji),AltitudeMode:_e(us),Heading:_e(Ji),Roll:_e(Ji)}),IA=Se(we,{LatLonAltBox:RH,Lod:NH}),YY=Se(we,["Document","Placemark"]),HY=Se(we,{Document:Ie($H),Placemark:Ie(XA)});let zc,Sp=null,w_,kd,Ld,Od,gm,b_=null,Xv,M_=null,E_,tl=null,aE=null,S_=null;function ym(n){return 32/Math.min(n[0],n[1])}function qY(){zc=[255,255,255,1],Sp=new _n({color:zc}),w_=[20,2],kd="pixels",Ld="pixels",Od=[64,64],gm="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",b_=new vl({anchor:w_,anchorOrigin:"bottom-left",anchorXUnits:kd,anchorYUnits:Ld,crossOrigin:"anonymous",rotation:0,scale:ym(Od),size:Od,src:gm}),Xv="NO_IMAGE",M_=new Xn({color:zc,width:1}),E_=new Xn({color:[51,51,51,1],width:2}),tl=new _v({font:"bold 16px Helvetica",fill:Sp,stroke:E_,scale:.8}),aE=new Hi({fill:Sp,image:b_,text:tl,stroke:M_,zIndex:0}),S_=[aE]}let Z0;function XY(n){return n}class jY extends FY{constructor(t){super(),t=t||{},S_||qY(),this.dataProjection=Ri("EPSG:4326"),this.defaultStyle_=t.defaultStyle?t.defaultStyle:S_,this.extractStyles_=t.extractStyles!==void 0?t.extractStyles:!0,this.writeStyles_=t.writeStyles!==void 0?t.writeStyles:!0,this.sharedStyles_={},this.showPointNames_=t.showPointNames!==void 0?t.showPointNames:!0,this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",this.iconUrlFunction_=t.iconUrlFunction?t.iconUrlFunction:XY,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(t,e){const i=Se(we,{Document:sE(this.readDocumentOrFolder_,this),Folder:sE(this.readDocumentOrFolder_,this),Placemark:Jo(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),s=zi([],i,t,e,this);if(s)return s}readPlacemark_(t,e){const i=zi({geometry:null},GY,t,e,this);if(!i)return;const s=new mr,r=t.getAttribute("id");r!==null&&s.setId(r);const a=e[0],o=i.geometry;if(o&&Df(o,!1,a),s.setGeometry(o),delete i.geometry,this.extractStyles_){const h=i.Style,l=i.styleUrl,u=KY(h,l,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);s.setStyle(u)}return delete i.Style,s.setProperties(i,!0),s}readSharedStyle_(t,e){const i=t.getAttribute("id");if(i!==null){const s=Zv.call(this,t,e);if(s){let r,a=t.baseURI;(!a||a=="about:blank")&&(a=window.location.href),a?r=new URL("#"+i,a).href:r="#"+i,this.sharedStyles_[r]=s}}}readSharedStyleMap_(t,e){const i=t.getAttribute("id");if(i===null)return;const s=FA.call(this,t,e);if(!s)return;let r,a=t.baseURI;(!a||a=="about:blank")&&(a=window.location.href),a?r=new URL("#"+i,a).href:r="#"+i,this.sharedStyles_[r]=s}readFeatureFromNode(t,e){if(!we.includes(t.namespaceURI))return null;const i=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return i||null}readFeaturesFromNode(t,e){if(!we.includes(t.namespaceURI))return[];let i;const s=t.localName;if(s=="Document"||s=="Folder")return i=this.readDocumentOrFolder_(t,[this.getReadOptions(t,e)]),i||[];if(s=="Placemark"){const r=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return r?[r]:[]}if(s=="kml"){i=[];for(let r=t.firstElementChild;r;r=r.nextElementSibling){const a=this.readFeaturesFromNode(r,e);a&&yi(i,a)}return i}return[]}readName(t){if(!!t){if(typeof t=="string"){const e=sh(t);return this.readNameFromDocument(e)}return nh(t)?this.readNameFromDocument(t):this.readNameFromNode(t)}}readNameFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE){const i=this.readNameFromNode(e);if(i)return i}}readNameFromNode(t){for(let e=t.firstElementChild;e;e=e.nextElementSibling)if(we.includes(e.namespaceURI)&&e.localName=="name")return us(e);for(let e=t.firstElementChild;e;e=e.nextElementSibling){const i=e.localName;if(we.includes(e.namespaceURI)&&(i=="Document"||i=="Folder"||i=="Placemark"||i=="kml")){const s=this.readNameFromNode(e);if(s)return s}}}readNetworkLinks(t){const e=[];if(typeof t=="string"){const i=sh(t);yi(e,this.readNetworkLinksFromDocument(i))}else nh(t)?yi(e,this.readNetworkLinksFromDocument(t)):yi(e,this.readNetworkLinksFromNode(t));return e}readNetworkLinksFromDocument(t){const e=[];for(let i=t.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&yi(e,this.readNetworkLinksFromNode(i));return e}readNetworkLinksFromNode(t){const e=[];for(let i=t.firstElementChild;i;i=i.nextElementSibling)if(we.includes(i.namespaceURI)&&i.localName=="NetworkLink"){const s=zi({},VY,i,[]);e.push(s)}for(let i=t.firstElementChild;i;i=i.nextElementSibling){const s=i.localName;we.includes(i.namespaceURI)&&(s=="Document"||s=="Folder"||s=="kml")&&yi(e,this.readNetworkLinksFromNode(i))}return e}readRegion(t){const e=[];if(typeof t=="string"){const i=sh(t);yi(e,this.readRegionFromDocument(i))}else nh(t)?yi(e,this.readRegionFromDocument(t)):yi(e,this.readRegionFromNode(t));return e}readRegionFromDocument(t){const e=[];for(let i=t.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&yi(e,this.readRegionFromNode(i));return e}readRegionFromNode(t){const e=[];for(let i=t.firstElementChild;i;i=i.nextElementSibling)if(we.includes(i.namespaceURI)&&i.localName=="Region"){const s=zi({},IA,i,[]);e.push(s)}for(let i=t.firstElementChild;i;i=i.nextElementSibling){const s=i.localName;we.includes(i.namespaceURI)&&(s=="Document"||s=="Folder"||s=="kml")&&yi(e,this.readRegionFromNode(i))}return e}readCamera(t){const e=[];if(typeof t=="string"){const i=sh(t);yi(e,this.readCameraFromDocument(i))}else nh(t)?yi(e,this.readCameraFromDocument(t)):yi(e,this.readCameraFromNode(t));return e}readCameraFromDocument(t){const e=[];for(let i=t.firstChild;i;i=i.nextSibling)i.nodeType===Node.ELEMENT_NODE&&yi(e,this.readCameraFromNode(i));return e}readCameraFromNode(t){const e=[];for(let i=t.firstElementChild;i;i=i.nextElementSibling)if(we.includes(i.namespaceURI)&&i.localName==="Camera"){const s=zi({},$Y,i,[]);e.push(s)}for(let i=t.firstElementChild;i;i=i.nextElementSibling){const s=i.localName;we.includes(i.namespaceURI)&&(s==="Document"||s==="Folder"||s==="Placemark"||s==="kml")&&yi(e,this.readCameraFromNode(i))}return e}writeFeaturesNode(t,e){e=this.adaptOptions(e);const i=zf(we[4],"kml"),s="http://www.w3.org/2000/xmlns/";i.setAttributeNS(s,"xmlns:gx",Ao[0]),i.setAttributeNS(s,"xmlns:xsi",nE),i.setAttributeNS(nE,"xsi:schemaLocation",UY);const r={node:i},a={};t.length>1?a.Document=t:t.length==1&&(a.Placemark=t[0]);const o=YY[i.namespaceURI],h=ta(a,o);return cn(r,HY,xr,h,[e],o,this),i}}function ZY(n,t){const e=[0,0];let i="start";const s=n.getImage();if(s){const o=s.getSize();if(o&&o.length==2){const h=s.getScaleArray(),l=s.getAnchor();e[0]=h[0]*(o[0]-l[0]),e[1]=h[1]*(o[1]/2-l[1]),i="left"}}let r=n.getText();return r?(r=r.clone(),r.setFont(r.getFont()||tl.getFont()),r.setScale(r.getScale()||tl.getScale()),r.setFill(r.getFill()||tl.getFill()),r.setStroke(r.getStroke()||E_)):r=tl.clone(),r.setText(t),r.setOffsetX(e[0]),r.setOffsetY(e[1]),r.setTextAlign(i),new Hi({image:s,text:r})}function KY(n,t,e,i,s){return function(r,a){let o=s,h="",l=[];if(o){const f=r.getGeometry();if(f)if(f instanceof mo)l=f.getGeometriesArrayRecursive().filter(function(m){const g=m.getType();return g==="Point"||g==="MultiPoint"}),o=l.length>0;else{const m=f.getType();o=m==="Point"||m==="MultiPoint"}}o&&(h=r.get("name"),o=o&&!!h,o&&/&[^&]+;/.test(h)&&(Z0||(Z0=document.createElement("textarea")),Z0.innerHTML=h,h=Z0.value));let u=e;if(n?u=n:t&&(u=NA(t,e,i)),o){const f=ZY(u[0],h);if(l.length>0){f.setGeometry(new mo(l));const m=new Hi({geometry:u[0].getGeometry(),image:null,fill:u[0].getFill(),stroke:u[0].getStroke(),text:null});return[f,m].concat(u.slice(1))}return f}return u}}function NA(n,t,e){return Array.isArray(n)?n:typeof n=="string"?NA(e[n],t,e):t}function gg(n){const t=To(n,!1),e=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(t);if(e){const i=e[1];return[parseInt(i.substr(6,2),16),parseInt(i.substr(4,2),16),parseInt(i.substr(2,2),16),parseInt(i.substr(0,2),16)/255]}}function kA(n){let t=To(n,!1);const e=[];t=t.replace(/\s*,\s*/g,",");const i=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;let s;for(;s=i.exec(t);){const r=parseFloat(s[1]),a=parseFloat(s[2]),o=s[3]?parseFloat(s[3]):0;e.push(r,a,o),t=t.substr(s[0].length)}if(t==="")return e}function LA(n){const t=To(n,!1).trim();let e=n.baseURI;return(!e||e=="about:blank")&&(e=window.location.href),e?new URL(t,e).href:t}function OA(n){const t=To(n,!1).trim().replace(/^(?!.*#)/,"#");let e=n.baseURI;return(!e||e=="about:blank")&&(e=window.location.href),e?new URL(t,e).href:t}function JY(n){const t=n.getAttribute("xunits"),e=n.getAttribute("yunits");let i;return t!=="insetPixels"?e!=="insetPixels"?i="bottom-left":i="top-left":e!=="insetPixels"?i="bottom-right":i="top-right",{x:parseFloat(n.getAttribute("x")),xunits:rE[t],y:parseFloat(n.getAttribute("y")),yunits:rE[e],origin:i}}function PA(n){return Ji(n)}const QY=Se(we,{Pair:MH});function FA(n,t){return zi(void 0,QY,n,t,this)}const tH=Se(we,{Icon:_e(pH),color:_e(gg),heading:_e(Ji),hotSpot:_e(JY),scale:_e(PA)});function eH(n,t){const e=zi({},tH,n,t);if(!e)return;const i=t[t.length-1],s="Icon"in e?e.Icon:{},r=!("Icon"in e)||Object.keys(s).length>0;let a;const o=s.href;o?a=o:r&&(a=gm);let h,l,u,f="bottom-left";const m=e.hotSpot;m?(h=[m.x,m.y],l=m.xunits,u=m.yunits,f=m.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(a)&&(a.includes("pushpin")?(h=w_,l=kd,u=Ld):a.includes("arrow-reverse")?(h=[54,42],l=kd,u=Ld):a.includes("paddle")&&(h=[32,1],l=kd,u=Ld));let g;const y=s.x,_=s.y;y!==void 0&&_!==void 0&&(g=[y,_]);let w;const M=s.w,T=s.h;M!==void 0&&T!==void 0&&(w=[M,T]);let A;const R=e.heading;R!==void 0&&(A=hh(R));const I=e.scale,L=e.color;if(r){a==gm&&(w=Od);const k=new vl({anchor:h,anchorOrigin:f,anchorXUnits:l,anchorYUnits:u,crossOrigin:this.crossOrigin_,offset:g,offsetOrigin:"bottom-left",rotation:A,scale:I,size:w,src:this.iconUrlFunction_(a),color:L}),Y=k.getScaleArray()[0],K=k.getSize();if(K===null){const rt=k.getImageState();if(rt===Ge.IDLE||rt===Ge.LOADING){const ut=function(){const Z=k.getImageState();if(!(Z===Ge.IDLE||Z===Ge.LOADING)){const ht=k.getSize();if(ht&&ht.length==2){const O=ym(ht);k.setScale(Y*O)}k.unlistenImageChange(ut)}};k.listenImageChange(ut),rt===Ge.IDLE&&k.load()}}else if(K.length==2){const rt=ym(K);k.setScale(Y*rt)}i.imageStyle=k}else i.imageStyle=Xv}const iH=Se(we,{color:_e(gg),scale:_e(PA)});function nH(n,t){const e=zi({},iH,n,t);if(!e)return;const i=t[t.length-1],s=new _v({fill:new _n({color:"color"in e?e.color:zc}),scale:e.scale});i.textStyle=s}const sH=Se(we,{color:_e(gg),width:_e(Ji)});function rH(n,t){const e=zi({},sH,n,t);if(!e)return;const i=t[t.length-1],s=new Xn({color:"color"in e?e.color:zc,width:"width"in e?e.width:1});i.strokeStyle=s}const aH=Se(we,{color:_e(gg),fill:_e(xh),outline:_e(xh)});function oH(n,t){const e=zi({},aH,n,t);if(!e)return;const i=t[t.length-1],s=new _n({color:"color"in e?e.color:zc});i.fillStyle=s;const r=e.fill;r!==void 0&&(i.fill=r);const a=e.outline;a!==void 0&&(i.outline=a)}const hH=Se(we,{coordinates:qv(kA)});function DA(n,t){return zi(null,hH,n,t)}function lH(n,t){const i=t[t.length-1].coordinates,s=To(n,!1),a=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(s);if(a){const o=parseFloat(a[1]),h=parseFloat(a[2]),l=parseFloat(a[3]);i.push([o,h,l])}else i.push([])}const cH=Se(Ao,{Track:Jo(zA)});function uH(n,t){const e=zi([],cH,n,t);if(!!e)return new If(e)}const dH=Se(we,{when:DH},Se(Ao,{coord:lH}));function zA(n,t){const e=zi({coordinates:[],whens:[]},dH,n,t);if(!e)return;const i=[],s=e.coordinates,r=e.whens;for(let a=0,o=Math.min(s.length,r.length);a<o;++a)s[a].length==3&&i.push(s[a][0],s[a][1],s[a][2],r[a]);return new Ia(i,"XYZM")}const fH=Se(we,{href:_e(LA)},Se(Ao,{x:_e(Ji),y:_e(Ji),w:_e(Ji),h:_e(Ji)}));function pH(n,t){const e=zi({},fH,n,t);return e||null}const mH=Se(we,{coordinates:qv(kA)});function jv(n,t){return zi(null,mH,n,t)}const yg=Se(we,{extrude:_e(xh),tessellate:_e(xh),altitudeMode:_e(us)});function BA(n,t){const e=zi({},yg,n,t),i=jv(n,t);if(i){const s=new Ia(i,"XYZ");return s.setProperties(e,!0),s}}function UA(n,t){const e=zi({},yg,n,t),i=jv(n,t);if(i){const s=new ir(i,"XYZ",[i.length]);return s.setProperties(e,!0),s}}const gH=Se(we,{LineString:Jo(BA),LinearRing:Jo(UA),MultiGeometry:Jo(GA),Point:Jo(VA),Polygon:Jo(WA)});function GA(n,t){const e=zi([],gH,n,t);if(!e)return null;if(e.length===0)return new mo(e);let i,s=!0;const r=e[0].getType();let a;for(let o=1,h=e.length;o<h;++o)if(a=e[o],a.getType()!=r){s=!1;break}if(s){let o,h;if(r=="Point"){const l=e[0];o=l.getLayout(),h=l.getFlatCoordinates();for(let u=1,f=e.length;u<f;++u)a=e[u],yi(h,a.getFlatCoordinates());i=new ug(h,o),Jy(i,e)}else if(r=="LineString")i=new If(e),Jy(i,e);else if(r=="Polygon")i=new dg(e),Jy(i,e);else if(r=="GeometryCollection")i=new mo(e);else throw new Error("Unknown geometry type found")}else i=new mo(e);return i}function VA(n,t){const e=zi({},yg,n,t),i=jv(n,t);if(i){const s=new Ra(i,"XYZ");return s.setProperties(e,!0),s}}const yH=Se(we,{innerBoundaryIs:LH,outerBoundaryIs:PH});function WA(n,t){const e=zi({},yg,n,t),i=zi([null],yH,n,t);if(i&&i[0]){const s=i[0],r=[s.length];for(let o=1,h=i.length;o<h;++o)yi(s,i[o]),r.push(s.length);const a=new ir(s,"XYZ",r);return a.setProperties(e,!0),a}}const _H=Se(we,{IconStyle:eH,LabelStyle:nH,LineStyle:rH,PolyStyle:oH});function Zv(n,t){const e=zi({},_H,n,t,this);if(!e)return null;let i="fillStyle"in e?e.fillStyle:Sp;const s=e.fill;s!==void 0&&!s&&(i=null);let r;"imageStyle"in e?e.imageStyle!=Xv&&(r=e.imageStyle):r=b_;const a="textStyle"in e?e.textStyle:tl,o="strokeStyle"in e?e.strokeStyle:M_,h=e.outline;return h!==void 0&&!h?[new Hi({geometry:function(l){const u=l.getGeometry(),f=u.getType();if(f==="GeometryCollection"){const m=u;return new mo(m.getGeometriesArrayRecursive().filter(function(g){const y=g.getType();return y!=="Polygon"&&y!=="MultiPolygon"}))}if(f!=="Polygon"&&f!=="MultiPolygon")return u},fill:i,image:r,stroke:o,text:a,zIndex:void 0}),new Hi({geometry:function(l){const u=l.getGeometry(),f=u.getType();if(f==="GeometryCollection"){const m=u;return new mo(m.getGeometriesArrayRecursive().filter(function(g){const y=g.getType();return y==="Polygon"||y==="MultiPolygon"}))}if(f==="Polygon"||f==="MultiPolygon")return u},fill:i,stroke:null,zIndex:void 0})]:[new Hi({fill:i,image:r,stroke:o,text:a,zIndex:void 0})]}function Jy(n,t){const e=t.length,i=new Array(t.length),s=new Array(t.length),r=new Array(t.length);let a,o,h;a=!1,o=!1,h=!1;for(let l=0;l<e;++l){const u=t[l];i[l]=u.get("extrude"),s[l]=u.get("tessellate"),r[l]=u.get("altitudeMode"),a=a||i[l]!==void 0,o=o||s[l]!==void 0,h=h||r[l]}a&&n.set("extrude",i),o&&n.set("tessellate",s),h&&n.set("altitudeMode",r)}const xH=Se(we,{displayName:_e(us),value:_e(us)});function vH(n,t){const e=n.getAttribute("name");bu(xH,n,t);const i=t[t.length-1];e&&i.displayName?i[e]={value:i.value,displayName:i.displayName,toString:function(){return i.value}}:e!==null?i[e]=i.value:i.displayName!==null&&(i[i.displayName]=i.value),delete i.value}const wH=Se(we,{Data:vH,SchemaData:TH});function $A(n,t){bu(wH,n,t)}function YA(n,t){bu(IA,n,t)}const bH=Se(we,{Style:_e(Zv),key:_e(us),styleUrl:_e(OA)});function MH(n,t){const e=zi({},bH,n,t,this);if(!e)return;const i=e.key;if(i&&i=="normal"){const s=e.styleUrl;s&&(t[t.length-1]=s);const r=e.Style;r&&(t[t.length-1]=r)}}function EH(n,t){const e=FA.call(this,n,t);if(!e)return;const i=t[t.length-1];if(Array.isArray(e))i.Style=e;else if(typeof e=="string")i.styleUrl=e;else throw new Error("`styleMapValue` has an unknown type")}const SH=Se(we,{SimpleData:CH});function TH(n,t){bu(SH,n,t)}function CH(n,t){const e=n.getAttribute("name");if(e!==null){const i=us(n),s=t[t.length-1];s[e]=i}}const AH=Se(we,{altitudeMode:_e(us),minAltitude:_e(Ji),maxAltitude:_e(Ji),north:_e(Ji),south:_e(Ji),east:_e(Ji),west:_e(Ji)});function RH(n,t){const e=zi({},AH,n,t);if(!e)return;const i=t[t.length-1],s=[parseFloat(e.west),parseFloat(e.south),parseFloat(e.east),parseFloat(e.north)];i.extent=s,i.altitudeMode=e.altitudeMode,i.minAltitude=parseFloat(e.minAltitude),i.maxAltitude=parseFloat(e.maxAltitude)}const IH=Se(we,{minLodPixels:_e(Ji),maxLodPixels:_e(Ji),minFadeExtent:_e(Ji),maxFadeExtent:_e(Ji)});function NH(n,t){const e=zi({},IH,n,t);if(!e)return;const i=t[t.length-1];i.minLodPixels=parseFloat(e.minLodPixels),i.maxLodPixels=parseFloat(e.maxLodPixels),i.minFadeExtent=parseFloat(e.minFadeExtent),i.maxFadeExtent=parseFloat(e.maxFadeExtent)}const kH=Se(we,{LinearRing:Jo(DA)});function LH(n,t){const e=zi([],kH,n,t);e.length>0&&t[t.length-1].push(...e)}const OH=Se(we,{LinearRing:qv(DA)});function PH(n,t){const e=zi(void 0,OH,n,t);if(e){const i=t[t.length-1];i[0]=e}}function FH(n,t){bu(WY,n,t)}function DH(n,t){const i=t[t.length-1].whens,s=To(n,!1),r=Date.parse(s);i.push(isNaN(r)?0:r)}function _g(n,t){const e=gh(t),s=[(e.length==4?e[3]:1)*255,e[2],e[1],e[0]];for(let r=0;r<4;++r){const a=Math.floor(s[r]).toString(16);s[r]=a.length==1?"0"+a:a}Br(n,s.join(""))}function zH(n,t,e){const i=e[e.length-1],s=i.layout,r=i.stride;let a;if(s=="XY"||s=="XYM")a=2;else if(s=="XYZ"||s=="XYZM")a=3;else throw new Error("Invalid geometry layout");const o=t.length;let h="";if(o>0){h+=t[0];for(let l=1;l<a;++l)h+=","+t[l];for(let l=r;l<o;l+=r){h+=" "+t[l];for(let u=1;u<a;++u)h+=","+t[l+u]}}Br(n,h)}const Tp=Se(we,{Data:Ie(BH),value:Ie(GH),displayName:Ie(UH)});function BH(n,t,e){n.setAttribute("name",t.name);const i={node:n},s=t.value;typeof s=="object"?(s!==null&&s.displayName&&cn(i,Tp,xr,[s.displayName],e,["displayName"]),s!==null&&s.value&&cn(i,Tp,xr,[s.value],e,["value"])):cn(i,Tp,xr,[s],e,["value"])}function UH(n,t){BY(n,t)}function GH(n,t){Br(n,t)}const VH=Se(we,{Placemark:Ie(XA)}),WH=function(n,t,e){const i=t[t.length-1].node;return zf(i.namespaceURI,"Placemark")};function $H(n,t,e){cn({node:n},VH,WH,t,e,void 0,this)}const YH=Co("Data");function HH(n,t,e){const i={node:n},s=t.names,r=t.values,a=s.length;for(let o=0;o<a;o++)cn(i,Tp,YH,[{name:s[o],value:r[o]}],e)}const oE=Se(we,["href"],Se(Ao,["x","y","w","h"])),hE=Se(we,{href:Ie(Br)},Se(Ao,{x:Ie(Qh),y:Ie(Qh),w:Ie(Qh),h:Ie(Qh)})),qH=function(n,t,e){return zf(Ao[0],"gx:"+e)};function XH(n,t,e){const i={node:n},s=e[e.length-1].node;let r=oE[s.namespaceURI],a=ta(t,r);cn(i,hE,xr,a,e,r),r=oE[Ao[0]],a=ta(t,r),cn(i,hE,qH,a,e,r)}const jH=Se(we,["scale","heading","Icon","color","hotSpot"]),ZH=Se(we,{Icon:Ie(XH),color:Ie(_g),heading:Ie(Qh),hotSpot:Ie(Mq),scale:Ie(ZA)});function KH(n,t,e){const i={node:n},s={},r=t.getSrc(),a=t.getSize(),o=t.getImageSize(),h={href:r};if(a){h.w=a[0],h.h=a[1];const w=t.getAnchor(),M=t.getOrigin();if(M&&o&&M[0]!==0&&M[1]!==a[1]&&(h.x=M[0],h.y=o[1]-(M[1]+a[1])),w&&(w[0]!==a[0]/2||w[1]!==a[1]/2)){const T={x:w[0],xunits:"pixels",y:a[1]-w[1],yunits:"pixels"};s.hotSpot=T}}s.Icon=h;let l=t.getScaleArray()[0],u=a;if(u===null&&(u=Od),u.length==2){const w=ym(u);l=l/w}l!==1&&(s.scale=l);const f=t.getRotation();f!==0&&(s.heading=f);const m=t.getColor();m&&(s.color=m);const g=e[e.length-1].node,y=jH[g.namespaceURI],_=ta(s,y);cn(i,ZH,xr,_,e,y)}const JH=Se(we,["color","scale"]),QH=Se(we,{color:Ie(_g),scale:Ie(ZA)});function tq(n,t,e){const i={node:n},s={},r=t.getFill();r&&(s.color=r.getColor());const a=t.getScale();a&&a!==1&&(s.scale=a);const o=e[e.length-1].node,h=JH[o.namespaceURI],l=ta(s,h);cn(i,QH,xr,l,e,h)}const eq=Se(we,["color","width"]),iq=Se(we,{color:Ie(_g),width:Ie(Qh)});function nq(n,t,e){const i={node:n},s={color:t.getColor(),width:Number(t.getWidth())||1},r=e[e.length-1].node,a=eq[r.namespaceURI],o=ta(s,a);cn(i,iq,xr,o,e,a)}const sq={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},HA=function(n,t,e){if(n){const i=t[t.length-1].node;return zf(i.namespaceURI,sq[n.getType()])}},rq=Co("Point"),aq=Co("LineString"),oq=Co("LinearRing"),hq=Co("Polygon"),lq=Se(we,{LineString:Ie(Bc),Point:Ie(Bc),Polygon:Ie(jA),GeometryCollection:Ie(qA)});function qA(n,t,e){const i={node:n},s=t.getType();let r=[],a;if(s==="GeometryCollection")t.getGeometriesArrayRecursive().forEach(function(o){const h=o.getType();if(h==="MultiPoint")r=r.concat(o.getPoints());else if(h==="MultiLineString")r=r.concat(o.getLineStrings());else if(h==="MultiPolygon")r=r.concat(o.getPolygons());else if(h==="Point"||h==="LineString"||h==="Polygon")r.push(o);else throw new Error("Unknown geometry type")}),a=HA;else if(s==="MultiPoint")r=t.getPoints(),a=rq;else if(s==="MultiLineString")r=t.getLineStrings(),a=aq;else if(s==="MultiPolygon")r=t.getPolygons(),a=hq;else throw new Error("Unknown geometry type");cn(i,lq,a,r,e)}const cq=Se(we,{LinearRing:Ie(Bc)});function lE(n,t,e){cn({node:n},cq,oq,[t],e)}const Qy=Se(we,{ExtendedData:Ie(HH),MultiGeometry:Ie(qA),LineString:Ie(Bc),LinearRing:Ie(Bc),Point:Ie(Bc),Polygon:Ie(jA),Style:Ie(bq),address:Ie(Br),description:Ie(Br),name:Ie(Br),open:Ie(hu),phoneNumber:Ie(Br),styleUrl:Ie(Br),visibility:Ie(hu)}),uq=Se(we,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),dq=Co("ExtendedData");function XA(n,t,e){const i={node:n};t.getId()&&n.setAttribute("id",t.getId());const s=t.getProperties(),r={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};r[t.getGeometryName()]=1;const a=Object.keys(s||{}).sort().filter(function(g){return!r[g]}),o=t.getStyleFunction();if(o){const g=o(t,0);if(g){const y=Array.isArray(g)?g:[g];let _=y;if(t.getGeometry()&&(_=y.filter(function(w){const M=w.getGeometryFunction()(t);if(M){const T=M.getType();return T==="GeometryCollection"?M.getGeometriesArrayRecursive().filter(function(A){const R=A.getType();return R==="Point"||R==="MultiPoint"}).length:T==="Point"||T==="MultiPoint"}})),this.writeStyles_){let w=y,M=y;t.getGeometry()&&(w=y.filter(function(T){const A=T.getGeometryFunction()(t);if(A){const R=A.getType();return R==="GeometryCollection"?A.getGeometriesArrayRecursive().filter(function(I){const L=I.getType();return L==="LineString"||L==="MultiLineString"}).length:R==="LineString"||R==="MultiLineString"}}),M=y.filter(function(T){const A=T.getGeometryFunction()(t);if(A){const R=A.getType();return R==="GeometryCollection"?A.getGeometriesArrayRecursive().filter(function(I){const L=I.getType();return L==="Polygon"||L==="MultiPolygon"}).length:R==="Polygon"||R==="MultiPolygon"}})),s.Style={pointStyles:_,lineStyles:w,polyStyles:M}}if(_.length&&s.name===void 0){const w=_[0].getText();w&&(s.name=w.getText())}}}const h=e[e.length-1].node,l=uq[h.namespaceURI],u=ta(s,l);if(cn(i,Qy,xr,u,e,l),a.length>0){const g=ta(s,a);cn(i,Qy,dq,[{names:a,values:g}],e)}const f=e[0];let m=t.getGeometry();m&&(m=Df(m,!0,f)),cn(i,Qy,HA,[m],e)}const fq=Se(we,["extrude","tessellate","altitudeMode","coordinates"]),pq=Se(we,{extrude:Ie(hu),tessellate:Ie(hu),altitudeMode:Ie(Br),coordinates:Ie(zH)});function Bc(n,t,e){const i=t.getFlatCoordinates(),s={node:n};s.layout=t.getLayout(),s.stride=t.getStride();const r=t.getProperties();r.coordinates=i;const a=e[e.length-1].node,o=fq[a.namespaceURI],h=ta(r,o);cn(s,pq,xr,h,e,o)}const mq=Se(we,["color","fill","outline"]),cE=Se(we,{outerBoundaryIs:Ie(lE),innerBoundaryIs:Ie(lE)}),gq=Co("innerBoundaryIs"),yq=Co("outerBoundaryIs");function jA(n,t,e){const i=t.getLinearRings(),s=i.shift(),r={node:n};cn(r,cE,gq,i,e),cn(r,cE,yq,[s],e)}const _q=Se(we,{color:Ie(_g),fill:Ie(hu),outline:Ie(hu)});function xq(n,t,e){const i={node:n},s=t.getFill(),r=t.getStroke(),a={color:s?s.getColor():void 0,fill:s?void 0:!1,outline:r?void 0:!1},o=e[e.length-1].node,h=mq[o.namespaceURI],l=ta(a,h);cn(i,_q,xr,l,e,h)}function ZA(n,t){Qh(n,Math.round(t*1e6)/1e6)}const vq=Se(we,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),wq=Se(we,{IconStyle:Ie(KH),LabelStyle:Ie(tq),LineStyle:Ie(nq),PolyStyle:Ie(xq)});function bq(n,t,e){const i={node:n},s={};if(t.pointStyles.length){const h=t.pointStyles[0].getText();h&&(s.LabelStyle=h);const l=t.pointStyles[0].getImage();l&&typeof l.getSrc=="function"&&(s.IconStyle=l)}if(t.lineStyles.length){const h=t.lineStyles[0].getStroke();h&&(s.LineStyle=h)}if(t.polyStyles.length){const h=t.polyStyles[0].getStroke();h&&!s.LineStyle&&(s.LineStyle=h),s.PolyStyle=t.polyStyles[0]}const r=e[e.length-1].node,a=vq[r.namespaceURI],o=ta(s,a);cn(i,wq,xr,o,e,a)}function Mq(n,t){n.setAttribute("x",String(t.x)),n.setAttribute("y",String(t.y)),n.setAttribute("xunits",t.xunits),n.setAttribute("yunits",t.yunits)}const Eq=jY;function KA(n,t){return function(){return n.apply(t,arguments)}}const{toString:Sq}=Object.prototype,{getPrototypeOf:Kv}=Object,xg=(n=>t=>{const e=Sq.call(t);return n[e]||(n[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),ra=n=>(n=n.toLowerCase(),t=>xg(t)===n),vg=n=>t=>typeof t===n,{isArray:Mu}=Array,af=vg("undefined");function Tq(n){return n!==null&&!af(n)&&n.constructor!==null&&!af(n.constructor)&&vr(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const JA=ra("ArrayBuffer");function Cq(n){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(n):t=n&&n.buffer&&JA(n.buffer),t}const Aq=vg("string"),vr=vg("function"),QA=vg("number"),wg=n=>n!==null&&typeof n=="object",Rq=n=>n===!0||n===!1,Cp=n=>{if(xg(n)!=="object")return!1;const t=Kv(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Iq=ra("Date"),Nq=ra("File"),kq=ra("Blob"),Lq=ra("FileList"),Oq=n=>wg(n)&&vr(n.pipe),Pq=n=>{let t;return n&&(typeof FormData=="function"&&n instanceof FormData||vr(n.append)&&((t=xg(n))==="formdata"||t==="object"&&vr(n.toString)&&n.toString()==="[object FormData]"))},Fq=ra("URLSearchParams"),[Dq,zq,Bq,Uq]=["ReadableStream","Request","Response","Headers"].map(ra),Gq=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Bf(n,t,{allOwnKeys:e=!1}={}){if(n===null||typeof n>"u")return;let i,s;if(typeof n!="object"&&(n=[n]),Mu(n))for(i=0,s=n.length;i<s;i++)t.call(null,n[i],i,n);else{const r=e?Object.getOwnPropertyNames(n):Object.keys(n),a=r.length;let o;for(i=0;i<a;i++)o=r[i],t.call(null,n[o],o,n)}}function t3(n,t){t=t.toLowerCase();const e=Object.keys(n);let i=e.length,s;for(;i-- >0;)if(s=e[i],t===s.toLowerCase())return s;return null}const e3=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),i3=n=>!af(n)&&n!==e3;function T_(){const{caseless:n}=i3(this)&&this||{},t={},e=(i,s)=>{const r=n&&t3(t,s)||s;Cp(t[r])&&Cp(i)?t[r]=T_(t[r],i):Cp(i)?t[r]=T_({},i):Mu(i)?t[r]=i.slice():t[r]=i};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&Bf(arguments[i],e);return t}const Vq=(n,t,e,{allOwnKeys:i}={})=>(Bf(t,(s,r)=>{e&&vr(s)?n[r]=KA(s,e):n[r]=s},{allOwnKeys:i}),n),Wq=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),$q=(n,t,e,i)=>{n.prototype=Object.create(t.prototype,i),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:t.prototype}),e&&Object.assign(n.prototype,e)},Yq=(n,t,e,i)=>{let s,r,a;const o={};if(t=t||{},n==null)return t;do{for(s=Object.getOwnPropertyNames(n),r=s.length;r-- >0;)a=s[r],(!i||i(a,n,t))&&!o[a]&&(t[a]=n[a],o[a]=!0);n=e!==!1&&Kv(n)}while(n&&(!e||e(n,t))&&n!==Object.prototype);return t},Hq=(n,t,e)=>{n=String(n),(e===void 0||e>n.length)&&(e=n.length),e-=t.length;const i=n.indexOf(t,e);return i!==-1&&i===e},qq=n=>{if(!n)return null;if(Mu(n))return n;let t=n.length;if(!QA(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=n[t];return e},Xq=(n=>t=>n&&t instanceof n)(typeof Uint8Array<"u"&&Kv(Uint8Array)),jq=(n,t)=>{const i=(n&&n[Symbol.iterator]).call(n);let s;for(;(s=i.next())&&!s.done;){const r=s.value;t.call(n,r[0],r[1])}},Zq=(n,t)=>{let e;const i=[];for(;(e=n.exec(t))!==null;)i.push(e);return i},Kq=ra("HTMLFormElement"),Jq=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,i,s){return i.toUpperCase()+s}),uE=(({hasOwnProperty:n})=>(t,e)=>n.call(t,e))(Object.prototype),Qq=ra("RegExp"),n3=(n,t)=>{const e=Object.getOwnPropertyDescriptors(n),i={};Bf(e,(s,r)=>{let a;(a=t(s,r,n))!==!1&&(i[r]=a||s)}),Object.defineProperties(n,i)},tX=n=>{n3(n,(t,e)=>{if(vr(n)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const i=n[e];if(!!vr(i)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},eX=(n,t)=>{const e={},i=s=>{s.forEach(r=>{e[r]=!0})};return Mu(n)?i(n):i(String(n).split(t)),e},iX=()=>{},nX=(n,t)=>n!=null&&Number.isFinite(n=+n)?n:t,t1="abcdefghijklmnopqrstuvwxyz",dE="0123456789",s3={DIGIT:dE,ALPHA:t1,ALPHA_DIGIT:t1+t1.toUpperCase()+dE},sX=(n=16,t=s3.ALPHA_DIGIT)=>{let e="";const{length:i}=t;for(;n--;)e+=t[Math.random()*i|0];return e};function rX(n){return!!(n&&vr(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const aX=n=>{const t=new Array(10),e=(i,s)=>{if(wg(i)){if(t.indexOf(i)>=0)return;if(!("toJSON"in i)){t[s]=i;const r=Mu(i)?[]:{};return Bf(i,(a,o)=>{const h=e(a,s+1);!af(h)&&(r[o]=h)}),t[s]=void 0,r}}return i};return e(n,0)},oX=ra("AsyncFunction"),hX=n=>n&&(wg(n)||vr(n))&&vr(n.then)&&vr(n.catch),Ot={isArray:Mu,isArrayBuffer:JA,isBuffer:Tq,isFormData:Pq,isArrayBufferView:Cq,isString:Aq,isNumber:QA,isBoolean:Rq,isObject:wg,isPlainObject:Cp,isReadableStream:Dq,isRequest:zq,isResponse:Bq,isHeaders:Uq,isUndefined:af,isDate:Iq,isFile:Nq,isBlob:kq,isRegExp:Qq,isFunction:vr,isStream:Oq,isURLSearchParams:Fq,isTypedArray:Xq,isFileList:Lq,forEach:Bf,merge:T_,extend:Vq,trim:Gq,stripBOM:Wq,inherits:$q,toFlatObject:Yq,kindOf:xg,kindOfTest:ra,endsWith:Hq,toArray:qq,forEachEntry:jq,matchAll:Zq,isHTMLForm:Kq,hasOwnProperty:uE,hasOwnProp:uE,reduceDescriptors:n3,freezeMethods:tX,toObjectSet:eX,toCamelCase:Jq,noop:iX,toFiniteNumber:nX,findKey:t3,global:e3,isContextDefined:i3,ALPHABET:s3,generateString:sX,isSpecCompliantForm:rX,toJSONObject:aX,isAsyncFn:oX,isThenable:hX};function We(n,t,e,i,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),i&&(this.request=i),s&&(this.response=s)}Ot.inherits(We,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ot.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const r3=We.prototype,a3={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{a3[n]={value:n}});Object.defineProperties(We,a3);Object.defineProperty(r3,"isAxiosError",{value:!0});We.from=(n,t,e,i,s,r)=>{const a=Object.create(r3);return Ot.toFlatObject(n,a,function(h){return h!==Error.prototype},o=>o!=="isAxiosError"),We.call(a,n.message,t,e,i,s),a.cause=n,a.name=n.name,r&&Object.assign(a,r),a};const lX=null;function C_(n){return Ot.isPlainObject(n)||Ot.isArray(n)}function o3(n){return Ot.endsWith(n,"[]")?n.slice(0,-2):n}function fE(n,t,e){return n?n.concat(t).map(function(s,r){return s=o3(s),!e&&r?"["+s+"]":s}).join(e?".":""):t}function cX(n){return Ot.isArray(n)&&!n.some(C_)}const uX=Ot.toFlatObject(Ot,{},null,function(t){return/^is[A-Z]/.test(t)});function bg(n,t,e){if(!Ot.isObject(n))throw new TypeError("target must be an object");t=t||new FormData,e=Ot.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(_,w){return!Ot.isUndefined(w[_])});const i=e.metaTokens,s=e.visitor||u,r=e.dots,a=e.indexes,h=(e.Blob||typeof Blob<"u"&&Blob)&&Ot.isSpecCompliantForm(t);if(!Ot.isFunction(s))throw new TypeError("visitor must be a function");function l(y){if(y===null)return"";if(Ot.isDate(y))return y.toISOString();if(!h&&Ot.isBlob(y))throw new We("Blob is not supported. Use a Buffer instead.");return Ot.isArrayBuffer(y)||Ot.isTypedArray(y)?h&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function u(y,_,w){let M=y;if(y&&!w&&typeof y=="object"){if(Ot.endsWith(_,"{}"))_=i?_:_.slice(0,-2),y=JSON.stringify(y);else if(Ot.isArray(y)&&cX(y)||(Ot.isFileList(y)||Ot.endsWith(_,"[]"))&&(M=Ot.toArray(y)))return _=o3(_),M.forEach(function(A,R){!(Ot.isUndefined(A)||A===null)&&t.append(a===!0?fE([_],R,r):a===null?_:_+"[]",l(A))}),!1}return C_(y)?!0:(t.append(fE(w,_,r),l(y)),!1)}const f=[],m=Object.assign(uX,{defaultVisitor:u,convertValue:l,isVisitable:C_});function g(y,_){if(!Ot.isUndefined(y)){if(f.indexOf(y)!==-1)throw Error("Circular reference detected in "+_.join("."));f.push(y),Ot.forEach(y,function(M,T){(!(Ot.isUndefined(M)||M===null)&&s.call(t,M,Ot.isString(T)?T.trim():T,_,m))===!0&&g(M,_?_.concat(T):[T])}),f.pop()}}if(!Ot.isObject(n))throw new TypeError("data must be an object");return g(n),t}function pE(n){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(i){return t[i]})}function Jv(n,t){this._pairs=[],n&&bg(n,this,t)}const h3=Jv.prototype;h3.append=function(t,e){this._pairs.push([t,e])};h3.toString=function(t){const e=t?function(i){return t.call(this,i,pE)}:pE;return this._pairs.map(function(s){return e(s[0])+"="+e(s[1])},"").join("&")};function dX(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function l3(n,t,e){if(!t)return n;const i=e&&e.encode||dX,s=e&&e.serialize;let r;if(s?r=s(t,e):r=Ot.isURLSearchParams(t)?t.toString():new Jv(t,e).toString(i),r){const a=n.indexOf("#");a!==-1&&(n=n.slice(0,a)),n+=(n.indexOf("?")===-1?"?":"&")+r}return n}class fX{constructor(){this.handlers=[]}use(t,e,i){return this.handlers.push({fulfilled:t,rejected:e,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){Ot.forEach(this.handlers,function(i){i!==null&&t(i)})}}const mE=fX,c3={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},pX=typeof URLSearchParams<"u"?URLSearchParams:Jv,mX=typeof FormData<"u"?FormData:null,gX=typeof Blob<"u"?Blob:null,yX={isBrowser:!0,classes:{URLSearchParams:pX,FormData:mX,Blob:gX},protocols:["http","https","file","blob","url","data"]},Qv=typeof window<"u"&&typeof document<"u",_X=(n=>Qv&&["ReactNative","NativeScript","NS"].indexOf(n)<0)(typeof navigator<"u"&&navigator.product),xX=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),vX=Qv&&window.location.href||"http://localhost",wX=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Qv,hasStandardBrowserWebWorkerEnv:xX,hasStandardBrowserEnv:_X,origin:vX},Symbol.toStringTag,{value:"Module"})),Hr={...wX,...yX};function bX(n,t){return bg(n,new Hr.classes.URLSearchParams,Object.assign({visitor:function(e,i,s,r){return Hr.isNode&&Ot.isBuffer(e)?(this.append(i,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}function MX(n){return Ot.matchAll(/\w+|\[(\w*)]/g,n).map(t=>t[0]==="[]"?"":t[1]||t[0])}function EX(n){const t={},e=Object.keys(n);let i;const s=e.length;let r;for(i=0;i<s;i++)r=e[i],t[r]=n[r];return t}function u3(n){function t(e,i,s,r){let a=e[r++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),h=r>=e.length;return a=!a&&Ot.isArray(s)?s.length:a,h?(Ot.hasOwnProp(s,a)?s[a]=[s[a],i]:s[a]=i,!o):((!s[a]||!Ot.isObject(s[a]))&&(s[a]=[]),t(e,i,s[a],r)&&Ot.isArray(s[a])&&(s[a]=EX(s[a])),!o)}if(Ot.isFormData(n)&&Ot.isFunction(n.entries)){const e={};return Ot.forEachEntry(n,(i,s)=>{t(MX(i),s,e,0)}),e}return null}function SX(n,t,e){if(Ot.isString(n))try{return(t||JSON.parse)(n),Ot.trim(n)}catch(i){if(i.name!=="SyntaxError")throw i}return(e||JSON.stringify)(n)}const tw={transitional:c3,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const i=e.getContentType()||"",s=i.indexOf("application/json")>-1,r=Ot.isObject(t);if(r&&Ot.isHTMLForm(t)&&(t=new FormData(t)),Ot.isFormData(t))return s?JSON.stringify(u3(t)):t;if(Ot.isArrayBuffer(t)||Ot.isBuffer(t)||Ot.isStream(t)||Ot.isFile(t)||Ot.isBlob(t)||Ot.isReadableStream(t))return t;if(Ot.isArrayBufferView(t))return t.buffer;if(Ot.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let o;if(r){if(i.indexOf("application/x-www-form-urlencoded")>-1)return bX(t,this.formSerializer).toString();if((o=Ot.isFileList(t))||i.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return bg(o?{"files[]":t}:t,h&&new h,this.formSerializer)}}return r||s?(e.setContentType("application/json",!1),SX(t)):t}],transformResponse:[function(t){const e=this.transitional||tw.transitional,i=e&&e.forcedJSONParsing,s=this.responseType==="json";if(Ot.isResponse(t)||Ot.isReadableStream(t))return t;if(t&&Ot.isString(t)&&(i&&!this.responseType||s)){const a=!(e&&e.silentJSONParsing)&&s;try{return JSON.parse(t)}catch(o){if(a)throw o.name==="SyntaxError"?We.from(o,We.ERR_BAD_RESPONSE,this,null,this.response):o}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Hr.classes.FormData,Blob:Hr.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ot.forEach(["delete","get","head","post","put","patch"],n=>{tw.headers[n]={}});const ew=tw,TX=Ot.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),CX=n=>{const t={};let e,i,s;return n&&n.split(`
`).forEach(function(a){s=a.indexOf(":"),e=a.substring(0,s).trim().toLowerCase(),i=a.substring(s+1).trim(),!(!e||t[e]&&TX[e])&&(e==="set-cookie"?t[e]?t[e].push(i):t[e]=[i]:t[e]=t[e]?t[e]+", "+i:i)}),t},gE=Symbol("internals");function ed(n){return n&&String(n).trim().toLowerCase()}function Ap(n){return n===!1||n==null?n:Ot.isArray(n)?n.map(Ap):String(n)}function AX(n){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=e.exec(n);)t[i[1]]=i[2];return t}const RX=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function e1(n,t,e,i,s){if(Ot.isFunction(i))return i.call(this,t,e);if(s&&(t=e),!!Ot.isString(t)){if(Ot.isString(i))return t.indexOf(i)!==-1;if(Ot.isRegExp(i))return i.test(t)}}function IX(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,i)=>e.toUpperCase()+i)}function NX(n,t){const e=Ot.toCamelCase(" "+t);["get","set","has"].forEach(i=>{Object.defineProperty(n,i+e,{value:function(s,r,a){return this[i].call(this,t,s,r,a)},configurable:!0})})}class Mg{constructor(t){t&&this.set(t)}set(t,e,i){const s=this;function r(o,h,l){const u=ed(h);if(!u)throw new Error("header name must be a non-empty string");const f=Ot.findKey(s,u);(!f||s[f]===void 0||l===!0||l===void 0&&s[f]!==!1)&&(s[f||h]=Ap(o))}const a=(o,h)=>Ot.forEach(o,(l,u)=>r(l,u,h));if(Ot.isPlainObject(t)||t instanceof this.constructor)a(t,e);else if(Ot.isString(t)&&(t=t.trim())&&!RX(t))a(CX(t),e);else if(Ot.isHeaders(t))for(const[o,h]of t.entries())r(h,o,i);else t!=null&&r(e,t,i);return this}get(t,e){if(t=ed(t),t){const i=Ot.findKey(this,t);if(i){const s=this[i];if(!e)return s;if(e===!0)return AX(s);if(Ot.isFunction(e))return e.call(this,s,i);if(Ot.isRegExp(e))return e.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=ed(t),t){const i=Ot.findKey(this,t);return!!(i&&this[i]!==void 0&&(!e||e1(this,this[i],i,e)))}return!1}delete(t,e){const i=this;let s=!1;function r(a){if(a=ed(a),a){const o=Ot.findKey(i,a);o&&(!e||e1(i,i[o],o,e))&&(delete i[o],s=!0)}}return Ot.isArray(t)?t.forEach(r):r(t),s}clear(t){const e=Object.keys(this);let i=e.length,s=!1;for(;i--;){const r=e[i];(!t||e1(this,this[r],r,t,!0))&&(delete this[r],s=!0)}return s}normalize(t){const e=this,i={};return Ot.forEach(this,(s,r)=>{const a=Ot.findKey(i,r);if(a){e[a]=Ap(s),delete e[r];return}const o=t?IX(r):String(r).trim();o!==r&&delete e[r],e[o]=Ap(s),i[o]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return Ot.forEach(this,(i,s)=>{i!=null&&i!==!1&&(e[s]=t&&Ot.isArray(i)?i.join(", "):i)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const i=new this(t);return e.forEach(s=>i.set(s)),i}static accessor(t){const i=(this[gE]=this[gE]={accessors:{}}).accessors,s=this.prototype;function r(a){const o=ed(a);i[o]||(NX(s,a),i[o]=!0)}return Ot.isArray(t)?t.forEach(r):r(t),this}}Mg.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ot.reduceDescriptors(Mg.prototype,({value:n},t)=>{let e=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(i){this[e]=i}}});Ot.freezeMethods(Mg);const qr=Mg;function i1(n,t){const e=this||ew,i=t||e,s=qr.from(i.headers);let r=i.data;return Ot.forEach(n,function(o){r=o.call(e,r,s.normalize(),t?t.status:void 0)}),s.normalize(),r}function d3(n){return!!(n&&n.__CANCEL__)}function Eu(n,t,e){We.call(this,n==null?"canceled":n,We.ERR_CANCELED,t,e),this.name="CanceledError"}Ot.inherits(Eu,We,{__CANCEL__:!0});function f3(n,t,e){const i=e.config.validateStatus;!e.status||!i||i(e.status)?n(e):t(new We("Request failed with status code "+e.status,[We.ERR_BAD_REQUEST,We.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function kX(n){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return t&&t[1]||""}function LX(n,t){n=n||10;const e=new Array(n),i=new Array(n);let s=0,r=0,a;return t=t!==void 0?t:1e3,function(h){const l=Date.now(),u=i[r];a||(a=l),e[s]=h,i[s]=l;let f=r,m=0;for(;f!==s;)m+=e[f++],f=f%n;if(s=(s+1)%n,s===r&&(r=(r+1)%n),l-a<t)return;const g=u&&l-u;return g?Math.round(m*1e3/g):void 0}}function OX(n,t){let e=0;const i=1e3/t;let s=null;return function(){const a=this===!0,o=Date.now();if(a||o-e>i)return s&&(clearTimeout(s),s=null),e=o,n.apply(null,arguments);s||(s=setTimeout(()=>(s=null,e=Date.now(),n.apply(null,arguments)),i-(o-e)))}}const _m=(n,t,e=3)=>{let i=0;const s=LX(50,250);return OX(r=>{const a=r.loaded,o=r.lengthComputable?r.total:void 0,h=a-i,l=s(h),u=a<=o;i=a;const f={loaded:a,total:o,progress:o?a/o:void 0,bytes:h,rate:l||void 0,estimated:l&&o&&u?(o-a)/l:void 0,event:r,lengthComputable:o!=null};f[t?"download":"upload"]=!0,n(f)},e)},PX=Hr.hasStandardBrowserEnv?function(){const t=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let i;function s(r){let a=r;return t&&(e.setAttribute("href",a),a=e.href),e.setAttribute("href",a),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return i=s(window.location.href),function(a){const o=Ot.isString(a)?s(a):a;return o.protocol===i.protocol&&o.host===i.host}}():function(){return function(){return!0}}(),FX=Hr.hasStandardBrowserEnv?{write(n,t,e,i,s,r){const a=[n+"="+encodeURIComponent(t)];Ot.isNumber(e)&&a.push("expires="+new Date(e).toGMTString()),Ot.isString(i)&&a.push("path="+i),Ot.isString(s)&&a.push("domain="+s),r===!0&&a.push("secure"),document.cookie=a.join("; ")},read(n){const t=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function DX(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function zX(n,t){return t?n.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):n}function p3(n,t){return n&&!DX(t)?zX(n,t):t}const yE=n=>n instanceof qr?{...n}:n;function cl(n,t){t=t||{};const e={};function i(l,u,f){return Ot.isPlainObject(l)&&Ot.isPlainObject(u)?Ot.merge.call({caseless:f},l,u):Ot.isPlainObject(u)?Ot.merge({},u):Ot.isArray(u)?u.slice():u}function s(l,u,f){if(Ot.isUndefined(u)){if(!Ot.isUndefined(l))return i(void 0,l,f)}else return i(l,u,f)}function r(l,u){if(!Ot.isUndefined(u))return i(void 0,u)}function a(l,u){if(Ot.isUndefined(u)){if(!Ot.isUndefined(l))return i(void 0,l)}else return i(void 0,u)}function o(l,u,f){if(f in t)return i(l,u);if(f in n)return i(void 0,l)}const h={url:r,method:r,data:r,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(l,u)=>s(yE(l),yE(u),!0)};return Ot.forEach(Object.keys(Object.assign({},n,t)),function(u){const f=h[u]||s,m=f(n[u],t[u],u);Ot.isUndefined(m)&&f!==o||(e[u]=m)}),e}const m3=n=>{const t=cl({},n);let{data:e,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:r,headers:a,auth:o}=t;t.headers=a=qr.from(a),t.url=l3(p3(t.baseURL,t.url),n.params,n.paramsSerializer),o&&a.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let h;if(Ot.isFormData(e)){if(Hr.hasStandardBrowserEnv||Hr.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((h=a.getContentType())!==!1){const[l,...u]=h?h.split(";").map(f=>f.trim()).filter(Boolean):[];a.setContentType([l||"multipart/form-data",...u].join("; "))}}if(Hr.hasStandardBrowserEnv&&(i&&Ot.isFunction(i)&&(i=i(t)),i||i!==!1&&PX(t.url))){const l=s&&r&&FX.read(r);l&&a.set(s,l)}return t},BX=typeof XMLHttpRequest<"u",UX=BX&&function(n){return new Promise(function(e,i){const s=m3(n);let r=s.data;const a=qr.from(s.headers).normalize();let{responseType:o}=s,h;function l(){s.cancelToken&&s.cancelToken.unsubscribe(h),s.signal&&s.signal.removeEventListener("abort",h)}let u=new XMLHttpRequest;u.open(s.method.toUpperCase(),s.url,!0),u.timeout=s.timeout;function f(){if(!u)return;const g=qr.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders()),_={data:!o||o==="text"||o==="json"?u.responseText:u.response,status:u.status,statusText:u.statusText,headers:g,config:n,request:u};f3(function(M){e(M),l()},function(M){i(M),l()},_),u=null}"onloadend"in u?u.onloadend=f:u.onreadystatechange=function(){!u||u.readyState!==4||u.status===0&&!(u.responseURL&&u.responseURL.indexOf("file:")===0)||setTimeout(f)},u.onabort=function(){!u||(i(new We("Request aborted",We.ECONNABORTED,s,u)),u=null)},u.onerror=function(){i(new We("Network Error",We.ERR_NETWORK,s,u)),u=null},u.ontimeout=function(){let y=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const _=s.transitional||c3;s.timeoutErrorMessage&&(y=s.timeoutErrorMessage),i(new We(y,_.clarifyTimeoutError?We.ETIMEDOUT:We.ECONNABORTED,s,u)),u=null},r===void 0&&a.setContentType(null),"setRequestHeader"in u&&Ot.forEach(a.toJSON(),function(y,_){u.setRequestHeader(_,y)}),Ot.isUndefined(s.withCredentials)||(u.withCredentials=!!s.withCredentials),o&&o!=="json"&&(u.responseType=s.responseType),typeof s.onDownloadProgress=="function"&&u.addEventListener("progress",_m(s.onDownloadProgress,!0)),typeof s.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",_m(s.onUploadProgress)),(s.cancelToken||s.signal)&&(h=g=>{!u||(i(!g||g.type?new Eu(null,n,u):g),u.abort(),u=null)},s.cancelToken&&s.cancelToken.subscribe(h),s.signal&&(s.signal.aborted?h():s.signal.addEventListener("abort",h)));const m=kX(s.url);if(m&&Hr.protocols.indexOf(m)===-1){i(new We("Unsupported protocol "+m+":",We.ERR_BAD_REQUEST,n));return}u.send(r||null)})},GX=(n,t)=>{let e=new AbortController,i;const s=function(h){if(!i){i=!0,a();const l=h instanceof Error?h:this.reason;e.abort(l instanceof We?l:new Eu(l instanceof Error?l.message:l))}};let r=t&&setTimeout(()=>{s(new We(`timeout ${t} of ms exceeded`,We.ETIMEDOUT))},t);const a=()=>{n&&(r&&clearTimeout(r),r=null,n.forEach(h=>{h&&(h.removeEventListener?h.removeEventListener("abort",s):h.unsubscribe(s))}),n=null)};n.forEach(h=>h&&h.addEventListener&&h.addEventListener("abort",s));const{signal:o}=e;return o.unsubscribe=a,[o,()=>{r&&clearTimeout(r),r=null}]},VX=GX,WX=function*(n,t){let e=n.byteLength;if(!t||e<t){yield n;return}let i=0,s;for(;i<e;)s=i+t,yield n.slice(i,s),i=s},$X=async function*(n,t,e){for await(const i of n)yield*WX(ArrayBuffer.isView(i)?i:await e(String(i)),t)},_E=(n,t,e,i,s)=>{const r=$X(n,t,s);let a=0;return new ReadableStream({type:"bytes",async pull(o){const{done:h,value:l}=await r.next();if(h){o.close(),i();return}let u=l.byteLength;e&&e(a+=u),o.enqueue(new Uint8Array(l))},cancel(o){return i(o),r.return()}},{highWaterMark:2})},xE=(n,t)=>{const e=n!=null;return i=>setTimeout(()=>t({lengthComputable:e,total:n,loaded:i}))},Eg=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",g3=Eg&&typeof ReadableStream=="function",A_=Eg&&(typeof TextEncoder=="function"?(n=>t=>n.encode(t))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),YX=g3&&(()=>{let n=!1;const t=new Request(Hr.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!t})(),vE=64*1024,R_=g3&&!!(()=>{try{return Ot.isReadableStream(new Response("").body)}catch{}})(),xm={stream:R_&&(n=>n.body)};Eg&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!xm[t]&&(xm[t]=Ot.isFunction(n[t])?e=>e[t]():(e,i)=>{throw new We(`Response type '${t}' is not supported`,We.ERR_NOT_SUPPORT,i)})})})(new Response);const HX=async n=>{if(n==null)return 0;if(Ot.isBlob(n))return n.size;if(Ot.isSpecCompliantForm(n))return(await new Request(n).arrayBuffer()).byteLength;if(Ot.isArrayBufferView(n))return n.byteLength;if(Ot.isURLSearchParams(n)&&(n=n+""),Ot.isString(n))return(await A_(n)).byteLength},qX=async(n,t)=>{const e=Ot.toFiniteNumber(n.getContentLength());return e==null?HX(t):e},XX=Eg&&(async n=>{let{url:t,method:e,data:i,signal:s,cancelToken:r,timeout:a,onDownloadProgress:o,onUploadProgress:h,responseType:l,headers:u,withCredentials:f="same-origin",fetchOptions:m}=m3(n);l=l?(l+"").toLowerCase():"text";let[g,y]=s||r||a?VX([s,r],a):[],_,w;const M=()=>{!_&&setTimeout(()=>{g&&g.unsubscribe()}),_=!0};let T;try{if(h&&YX&&e!=="get"&&e!=="head"&&(T=await qX(u,i))!==0){let L=new Request(t,{method:"POST",body:i,duplex:"half"}),k;Ot.isFormData(i)&&(k=L.headers.get("content-type"))&&u.setContentType(k),L.body&&(i=_E(L.body,vE,xE(T,_m(h)),null,A_))}Ot.isString(f)||(f=f?"cors":"omit"),w=new Request(t,{...m,signal:g,method:e.toUpperCase(),headers:u.normalize().toJSON(),body:i,duplex:"half",withCredentials:f});let A=await fetch(w);const R=R_&&(l==="stream"||l==="response");if(R_&&(o||R)){const L={};["status","statusText","headers"].forEach(Y=>{L[Y]=A[Y]});const k=Ot.toFiniteNumber(A.headers.get("content-length"));A=new Response(_E(A.body,vE,o&&xE(k,_m(o,!0)),R&&M,A_),L)}l=l||"text";let I=await xm[Ot.findKey(xm,l)||"text"](A,n);return!R&&M(),y&&y(),await new Promise((L,k)=>{f3(L,k,{data:I,headers:qr.from(A.headers),status:A.status,statusText:A.statusText,config:n,request:w})})}catch(A){throw M(),A&&A.name==="TypeError"&&/fetch/i.test(A.message)?Object.assign(new We("Network Error",We.ERR_NETWORK,n,w),{cause:A.cause||A}):We.from(A,A&&A.code,n,w)}}),I_={http:lX,xhr:UX,fetch:XX};Ot.forEach(I_,(n,t)=>{if(n){try{Object.defineProperty(n,"name",{value:t})}catch{}Object.defineProperty(n,"adapterName",{value:t})}});const wE=n=>`- ${n}`,jX=n=>Ot.isFunction(n)||n===null||n===!1,y3={getAdapter:n=>{n=Ot.isArray(n)?n:[n];const{length:t}=n;let e,i;const s={};for(let r=0;r<t;r++){e=n[r];let a;if(i=e,!jX(e)&&(i=I_[(a=String(e)).toLowerCase()],i===void 0))throw new We(`Unknown adapter '${a}'`);if(i)break;s[a||"#"+r]=i}if(!i){const r=Object.entries(s).map(([o,h])=>`adapter ${o} `+(h===!1?"is not supported by the environment":"is not available in the build"));let a=t?r.length>1?`since :
`+r.map(wE).join(`
`):" "+wE(r[0]):"as no adapter specified";throw new We("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return i},adapters:I_};function n1(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Eu(null,n)}function bE(n){return n1(n),n.headers=qr.from(n.headers),n.data=i1.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),y3.getAdapter(n.adapter||ew.adapter)(n).then(function(i){return n1(n),i.data=i1.call(n,n.transformResponse,i),i.headers=qr.from(i.headers),i},function(i){return d3(i)||(n1(n),i&&i.response&&(i.response.data=i1.call(n,n.transformResponse,i.response),i.response.headers=qr.from(i.response.headers))),Promise.reject(i)})}const _3="1.7.2",iw={};["object","boolean","number","function","string","symbol"].forEach((n,t)=>{iw[n]=function(i){return typeof i===n||"a"+(t<1?"n ":" ")+n}});const ME={};iw.transitional=function(t,e,i){function s(r,a){return"[Axios v"+_3+"] Transitional option '"+r+"'"+a+(i?". "+i:"")}return(r,a,o)=>{if(t===!1)throw new We(s(a," has been removed"+(e?" in "+e:"")),We.ERR_DEPRECATED);return e&&!ME[a]&&(ME[a]=!0,console.warn(s(a," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(r,a,o):!0}};function ZX(n,t,e){if(typeof n!="object")throw new We("options must be an object",We.ERR_BAD_OPTION_VALUE);const i=Object.keys(n);let s=i.length;for(;s-- >0;){const r=i[s],a=t[r];if(a){const o=n[r],h=o===void 0||a(o,r,n);if(h!==!0)throw new We("option "+r+" must be "+h,We.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new We("Unknown option "+r,We.ERR_BAD_OPTION)}}const N_={assertOptions:ZX,validators:iw},Wo=N_.validators;class vm{constructor(t){this.defaults=t,this.interceptors={request:new mE,response:new mE}}async request(t,e){try{return await this._request(t,e)}catch(i){if(i instanceof Error){let s;Error.captureStackTrace?Error.captureStackTrace(s={}):s=new Error;const r=s.stack?s.stack.replace(/^.+\n/,""):"";try{i.stack?r&&!String(i.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+r):i.stack=r}catch{}}throw i}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=cl(this.defaults,e);const{transitional:i,paramsSerializer:s,headers:r}=e;i!==void 0&&N_.assertOptions(i,{silentJSONParsing:Wo.transitional(Wo.boolean),forcedJSONParsing:Wo.transitional(Wo.boolean),clarifyTimeoutError:Wo.transitional(Wo.boolean)},!1),s!=null&&(Ot.isFunction(s)?e.paramsSerializer={serialize:s}:N_.assertOptions(s,{encode:Wo.function,serialize:Wo.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();let a=r&&Ot.merge(r.common,r[e.method]);r&&Ot.forEach(["delete","get","head","post","put","patch","common"],y=>{delete r[y]}),e.headers=qr.concat(a,r);const o=[];let h=!0;this.interceptors.request.forEach(function(_){typeof _.runWhen=="function"&&_.runWhen(e)===!1||(h=h&&_.synchronous,o.unshift(_.fulfilled,_.rejected))});const l=[];this.interceptors.response.forEach(function(_){l.push(_.fulfilled,_.rejected)});let u,f=0,m;if(!h){const y=[bE.bind(this),void 0];for(y.unshift.apply(y,o),y.push.apply(y,l),m=y.length,u=Promise.resolve(e);f<m;)u=u.then(y[f++],y[f++]);return u}m=o.length;let g=e;for(f=0;f<m;){const y=o[f++],_=o[f++];try{g=y(g)}catch(w){_.call(this,w);break}}try{u=bE.call(this,g)}catch(y){return Promise.reject(y)}for(f=0,m=l.length;f<m;)u=u.then(l[f++],l[f++]);return u}getUri(t){t=cl(this.defaults,t);const e=p3(t.baseURL,t.url);return l3(e,t.params,t.paramsSerializer)}}Ot.forEach(["delete","get","head","options"],function(t){vm.prototype[t]=function(e,i){return this.request(cl(i||{},{method:t,url:e,data:(i||{}).data}))}});Ot.forEach(["post","put","patch"],function(t){function e(i){return function(r,a,o){return this.request(cl(o||{},{method:t,headers:i?{"Content-Type":"multipart/form-data"}:{},url:r,data:a}))}}vm.prototype[t]=e(),vm.prototype[t+"Form"]=e(!0)});const Rp=vm;class nw{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(r){e=r});const i=this;this.promise.then(s=>{if(!i._listeners)return;let r=i._listeners.length;for(;r-- >0;)i._listeners[r](s);i._listeners=null}),this.promise.then=s=>{let r;const a=new Promise(o=>{i.subscribe(o),r=o}).then(s);return a.cancel=function(){i.unsubscribe(r)},a},t(function(r,a,o){i.reason||(i.reason=new Eu(r,a,o),e(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}static source(){let t;return{token:new nw(function(s){t=s}),cancel:t}}}const KX=nw;function JX(n){return function(e){return n.apply(null,e)}}function QX(n){return Ot.isObject(n)&&n.isAxiosError===!0}const k_={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(k_).forEach(([n,t])=>{k_[t]=n});const tj=k_;function x3(n){const t=new Rp(n),e=KA(Rp.prototype.request,t);return Ot.extend(e,Rp.prototype,t,{allOwnKeys:!0}),Ot.extend(e,t,null,{allOwnKeys:!0}),e.create=function(s){return x3(cl(n,s))},e}const xn=x3(ew);xn.Axios=Rp;xn.CanceledError=Eu;xn.CancelToken=KX;xn.isCancel=d3;xn.VERSION=_3;xn.toFormData=bg;xn.AxiosError=We;xn.Cancel=xn.CanceledError;xn.all=function(t){return Promise.all(t)};xn.spread=JX;xn.isAxiosError=QX;xn.mergeConfig=cl;xn.AxiosHeaders=qr;xn.formToJSON=n=>u3(Ot.isHTMLForm(n)?new FormData(n):n);xn.getAdapter=y3.getAdapter;xn.HttpStatusCode=tj;xn.default=xn;const El=xn,Sl="http://13.127.65.143:4000/api/";//! moment.js
//! version : 2.30.1
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
var v3;function ue(){return v3.apply(null,arguments)}function ej(n){v3=n}function ea(n){return n instanceof Array||Object.prototype.toString.call(n)==="[object Array]"}function sl(n){return n!=null&&Object.prototype.toString.call(n)==="[object Object]"}function _i(n,t){return Object.prototype.hasOwnProperty.call(n,t)}function sw(n){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(n).length===0;var t;for(t in n)if(_i(n,t))return!1;return!0}function zs(n){return n===void 0}function bo(n){return typeof n=="number"||Object.prototype.toString.call(n)==="[object Number]"}function Uf(n){return n instanceof Date||Object.prototype.toString.call(n)==="[object Date]"}function w3(n,t){var e=[],i,s=n.length;for(i=0;i<s;++i)e.push(t(n[i],i));return e}function rh(n,t){for(var e in t)_i(t,e)&&(n[e]=t[e]);return _i(t,"toString")&&(n.toString=t.toString),_i(t,"valueOf")&&(n.valueOf=t.valueOf),n}function za(n,t,e,i){return $3(n,t,e,i,!0).utc()}function ij(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function qe(n){return n._pf==null&&(n._pf=ij()),n._pf}var L_;Array.prototype.some?L_=Array.prototype.some:L_=function(n){var t=Object(this),e=t.length>>>0,i;for(i=0;i<e;i++)if(i in t&&n.call(this,t[i],i,t))return!0;return!1};function rw(n){var t=null,e=!1,i=n._d&&!isNaN(n._d.getTime());if(i&&(t=qe(n),e=L_.call(t.parsedDateParts,function(s){return s!=null}),i=t.overflow<0&&!t.empty&&!t.invalidEra&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&e),n._strict&&(i=i&&t.charsLeftOver===0&&t.unusedTokens.length===0&&t.bigHour===void 0)),Object.isFrozen==null||!Object.isFrozen(n))n._isValid=i;else return i;return n._isValid}function Sg(n){var t=za(NaN);return n!=null?rh(qe(t),n):qe(t).userInvalidated=!0,t}var EE=ue.momentProperties=[],s1=!1;function aw(n,t){var e,i,s,r=EE.length;if(zs(t._isAMomentObject)||(n._isAMomentObject=t._isAMomentObject),zs(t._i)||(n._i=t._i),zs(t._f)||(n._f=t._f),zs(t._l)||(n._l=t._l),zs(t._strict)||(n._strict=t._strict),zs(t._tzm)||(n._tzm=t._tzm),zs(t._isUTC)||(n._isUTC=t._isUTC),zs(t._offset)||(n._offset=t._offset),zs(t._pf)||(n._pf=qe(t)),zs(t._locale)||(n._locale=t._locale),r>0)for(e=0;e<r;e++)i=EE[e],s=t[i],zs(s)||(n[i]=s);return n}function Gf(n){aw(this,n),this._d=new Date(n._d!=null?n._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),s1===!1&&(s1=!0,ue.updateOffset(this),s1=!1)}function ia(n){return n instanceof Gf||n!=null&&n._isAMomentObject!=null}function b3(n){ue.suppressDeprecationWarnings===!1&&typeof console<"u"&&console.warn&&console.warn("Deprecation warning: "+n)}function Mr(n,t){var e=!0;return rh(function(){if(ue.deprecationHandler!=null&&ue.deprecationHandler(null,n),e){var i=[],s,r,a,o=arguments.length;for(r=0;r<o;r++){if(s="",typeof arguments[r]=="object"){s+=`
[`+r+"] ";for(a in arguments[0])_i(arguments[0],a)&&(s+=a+": "+arguments[0][a]+", ");s=s.slice(0,-2)}else s=arguments[r];i.push(s)}b3(n+`
Arguments: `+Array.prototype.slice.call(i).join("")+`
`+new Error().stack),e=!1}return t.apply(this,arguments)},t)}var SE={};function M3(n,t){ue.deprecationHandler!=null&&ue.deprecationHandler(n,t),SE[n]||(b3(t),SE[n]=!0)}ue.suppressDeprecationWarnings=!1;ue.deprecationHandler=null;function Ba(n){return typeof Function<"u"&&n instanceof Function||Object.prototype.toString.call(n)==="[object Function]"}function nj(n){var t,e;for(e in n)_i(n,e)&&(t=n[e],Ba(t)?this[e]=t:this["_"+e]=t);this._config=n,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function O_(n,t){var e=rh({},n),i;for(i in t)_i(t,i)&&(sl(n[i])&&sl(t[i])?(e[i]={},rh(e[i],n[i]),rh(e[i],t[i])):t[i]!=null?e[i]=t[i]:delete e[i]);for(i in n)_i(n,i)&&!_i(t,i)&&sl(n[i])&&(e[i]=rh({},e[i]));return e}function ow(n){n!=null&&this.set(n)}var P_;Object.keys?P_=Object.keys:P_=function(n){var t,e=[];for(t in n)_i(n,t)&&e.push(t);return e};var sj={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function rj(n,t,e){var i=this._calendar[n]||this._calendar.sameElse;return Ba(i)?i.call(t,e):i}function Oa(n,t,e){var i=""+Math.abs(n),s=t-i.length,r=n>=0;return(r?e?"+":"":"-")+Math.pow(10,Math.max(0,s)).toString().substr(1)+i}var hw=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,K0=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,r1={},Uc={};function Ce(n,t,e,i){var s=i;typeof i=="string"&&(s=function(){return this[i]()}),n&&(Uc[n]=s),t&&(Uc[t[0]]=function(){return Oa(s.apply(this,arguments),t[1],t[2])}),e&&(Uc[e]=function(){return this.localeData().ordinal(s.apply(this,arguments),n)})}function aj(n){return n.match(/\[[\s\S]/)?n.replace(/^\[|\]$/g,""):n.replace(/\\/g,"")}function oj(n){var t=n.match(hw),e,i;for(e=0,i=t.length;e<i;e++)Uc[t[e]]?t[e]=Uc[t[e]]:t[e]=aj(t[e]);return function(s){var r="",a;for(a=0;a<i;a++)r+=Ba(t[a])?t[a].call(s,n):t[a];return r}}function Ip(n,t){return n.isValid()?(t=E3(t,n.localeData()),r1[t]=r1[t]||oj(t),r1[t](n)):n.localeData().invalidDate()}function E3(n,t){var e=5;function i(s){return t.longDateFormat(s)||s}for(K0.lastIndex=0;e>=0&&K0.test(n);)n=n.replace(K0,i),K0.lastIndex=0,e-=1;return n}var hj={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function lj(n){var t=this._longDateFormat[n],e=this._longDateFormat[n.toUpperCase()];return t||!e?t:(this._longDateFormat[n]=e.match(hw).map(function(i){return i==="MMMM"||i==="MM"||i==="DD"||i==="dddd"?i.slice(1):i}).join(""),this._longDateFormat[n])}var cj="Invalid date";function uj(){return this._invalidDate}var dj="%d",fj=/\d{1,2}/;function pj(n){return this._ordinal.replace("%d",n)}var mj={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function gj(n,t,e,i){var s=this._relativeTime[e];return Ba(s)?s(n,t,e,i):s.replace(/%d/i,n)}function yj(n,t){var e=this._relativeTime[n>0?"future":"past"];return Ba(e)?e(t):e.replace(/%s/i,t)}var TE={D:"date",dates:"date",date:"date",d:"day",days:"day",day:"day",e:"weekday",weekdays:"weekday",weekday:"weekday",E:"isoWeekday",isoweekdays:"isoWeekday",isoweekday:"isoWeekday",DDD:"dayOfYear",dayofyears:"dayOfYear",dayofyear:"dayOfYear",h:"hour",hours:"hour",hour:"hour",ms:"millisecond",milliseconds:"millisecond",millisecond:"millisecond",m:"minute",minutes:"minute",minute:"minute",M:"month",months:"month",month:"month",Q:"quarter",quarters:"quarter",quarter:"quarter",s:"second",seconds:"second",second:"second",gg:"weekYear",weekyears:"weekYear",weekyear:"weekYear",GG:"isoWeekYear",isoweekyears:"isoWeekYear",isoweekyear:"isoWeekYear",w:"week",weeks:"week",week:"week",W:"isoWeek",isoweeks:"isoWeek",isoweek:"isoWeek",y:"year",years:"year",year:"year"};function Er(n){return typeof n=="string"?TE[n]||TE[n.toLowerCase()]:void 0}function lw(n){var t={},e,i;for(i in n)_i(n,i)&&(e=Er(i),e&&(t[e]=n[i]));return t}var _j={date:9,day:11,weekday:11,isoWeekday:11,dayOfYear:4,hour:13,millisecond:16,minute:14,month:8,quarter:7,second:15,weekYear:1,isoWeekYear:1,week:5,isoWeek:5,year:1};function xj(n){var t=[],e;for(e in n)_i(n,e)&&t.push({unit:e,priority:_j[e]});return t.sort(function(i,s){return i.priority-s.priority}),t}var S3=/\d/,nr=/\d\d/,T3=/\d{3}/,cw=/\d{4}/,Tg=/[+-]?\d{6}/,Wi=/\d\d?/,C3=/\d\d\d\d?/,A3=/\d\d\d\d\d\d?/,Cg=/\d{1,3}/,uw=/\d{1,4}/,Ag=/[+-]?\d{1,6}/,Su=/\d+/,Rg=/[+-]?\d+/,vj=/Z|[+-]\d\d:?\d\d/gi,Ig=/Z|[+-]\d\d(?::?\d\d)?/gi,wj=/[+-]?\d+(\.\d{1,3})?/,Vf=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,Tu=/^[1-9]\d?/,dw=/^([1-9]\d|\d)/,wm;wm={};function ye(n,t,e){wm[n]=Ba(t)?t:function(i,s){return i&&e?e:t}}function bj(n,t){return _i(wm,n)?wm[n](t._strict,t._locale):new RegExp(Mj(n))}function Mj(n){return go(n.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(t,e,i,s,r){return e||i||s||r}))}function go(n){return n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function fr(n){return n<0?Math.ceil(n)||0:Math.floor(n)}function si(n){var t=+n,e=0;return t!==0&&isFinite(t)&&(e=fr(t)),e}var F_={};function Pi(n,t){var e,i=t,s;for(typeof n=="string"&&(n=[n]),bo(t)&&(i=function(r,a){a[t]=si(r)}),s=n.length,e=0;e<s;e++)F_[n[e]]=i}function Wf(n,t){Pi(n,function(e,i,s,r){s._w=s._w||{},t(e,s._w,s,r)})}function Ej(n,t,e){t!=null&&_i(F_,n)&&F_[n](t,e._a,e,n)}function Ng(n){return n%4===0&&n%100!==0||n%400===0}var ds=0,ho=1,Ea=2,Cn=3,Gr=4,lo=5,el=6,Sj=7,Tj=8;Ce("Y",0,0,function(){var n=this.year();return n<=9999?Oa(n,4):"+"+n});Ce(0,["YY",2],0,function(){return this.year()%100});Ce(0,["YYYY",4],0,"year");Ce(0,["YYYYY",5],0,"year");Ce(0,["YYYYYY",6,!0],0,"year");ye("Y",Rg);ye("YY",Wi,nr);ye("YYYY",uw,cw);ye("YYYYY",Ag,Tg);ye("YYYYYY",Ag,Tg);Pi(["YYYYY","YYYYYY"],ds);Pi("YYYY",function(n,t){t[ds]=n.length===2?ue.parseTwoDigitYear(n):si(n)});Pi("YY",function(n,t){t[ds]=ue.parseTwoDigitYear(n)});Pi("Y",function(n,t){t[ds]=parseInt(n,10)});function Pd(n){return Ng(n)?366:365}ue.parseTwoDigitYear=function(n){return si(n)+(si(n)>68?1900:2e3)};var R3=Cu("FullYear",!0);function Cj(){return Ng(this.year())}function Cu(n,t){return function(e){return e!=null?(I3(this,n,e),ue.updateOffset(this,t),this):of(this,n)}}function of(n,t){if(!n.isValid())return NaN;var e=n._d,i=n._isUTC;switch(t){case"Milliseconds":return i?e.getUTCMilliseconds():e.getMilliseconds();case"Seconds":return i?e.getUTCSeconds():e.getSeconds();case"Minutes":return i?e.getUTCMinutes():e.getMinutes();case"Hours":return i?e.getUTCHours():e.getHours();case"Date":return i?e.getUTCDate():e.getDate();case"Day":return i?e.getUTCDay():e.getDay();case"Month":return i?e.getUTCMonth():e.getMonth();case"FullYear":return i?e.getUTCFullYear():e.getFullYear();default:return NaN}}function I3(n,t,e){var i,s,r,a,o;if(!(!n.isValid()||isNaN(e))){switch(i=n._d,s=n._isUTC,t){case"Milliseconds":return void(s?i.setUTCMilliseconds(e):i.setMilliseconds(e));case"Seconds":return void(s?i.setUTCSeconds(e):i.setSeconds(e));case"Minutes":return void(s?i.setUTCMinutes(e):i.setMinutes(e));case"Hours":return void(s?i.setUTCHours(e):i.setHours(e));case"Date":return void(s?i.setUTCDate(e):i.setDate(e));case"FullYear":break;default:return}r=e,a=n.month(),o=n.date(),o=o===29&&a===1&&!Ng(r)?28:o,s?i.setUTCFullYear(r,a,o):i.setFullYear(r,a,o)}}function Aj(n){return n=Er(n),Ba(this[n])?this[n]():this}function Rj(n,t){if(typeof n=="object"){n=lw(n);var e=xj(n),i,s=e.length;for(i=0;i<s;i++)this[e[i].unit](n[e[i].unit])}else if(n=Er(n),Ba(this[n]))return this[n](t);return this}function Ij(n,t){return(n%t+t)%t}var an;Array.prototype.indexOf?an=Array.prototype.indexOf:an=function(n){var t;for(t=0;t<this.length;++t)if(this[t]===n)return t;return-1};function fw(n,t){if(isNaN(n)||isNaN(t))return NaN;var e=Ij(t,12);return n+=(t-e)/12,e===1?Ng(n)?29:28:31-e%7%2}Ce("M",["MM",2],"Mo",function(){return this.month()+1});Ce("MMM",0,0,function(n){return this.localeData().monthsShort(this,n)});Ce("MMMM",0,0,function(n){return this.localeData().months(this,n)});ye("M",Wi,Tu);ye("MM",Wi,nr);ye("MMM",function(n,t){return t.monthsShortRegex(n)});ye("MMMM",function(n,t){return t.monthsRegex(n)});Pi(["M","MM"],function(n,t){t[ho]=si(n)-1});Pi(["MMM","MMMM"],function(n,t,e,i){var s=e._locale.monthsParse(n,i,e._strict);s!=null?t[ho]=s:qe(e).invalidMonth=n});var Nj="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),N3="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),k3=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,kj=Vf,Lj=Vf;function Oj(n,t){return n?ea(this._months)?this._months[n.month()]:this._months[(this._months.isFormat||k3).test(t)?"format":"standalone"][n.month()]:ea(this._months)?this._months:this._months.standalone}function Pj(n,t){return n?ea(this._monthsShort)?this._monthsShort[n.month()]:this._monthsShort[k3.test(t)?"format":"standalone"][n.month()]:ea(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function Fj(n,t,e){var i,s,r,a=n.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],i=0;i<12;++i)r=za([2e3,i]),this._shortMonthsParse[i]=this.monthsShort(r,"").toLocaleLowerCase(),this._longMonthsParse[i]=this.months(r,"").toLocaleLowerCase();return e?t==="MMM"?(s=an.call(this._shortMonthsParse,a),s!==-1?s:null):(s=an.call(this._longMonthsParse,a),s!==-1?s:null):t==="MMM"?(s=an.call(this._shortMonthsParse,a),s!==-1?s:(s=an.call(this._longMonthsParse,a),s!==-1?s:null)):(s=an.call(this._longMonthsParse,a),s!==-1?s:(s=an.call(this._shortMonthsParse,a),s!==-1?s:null))}function Dj(n,t,e){var i,s,r;if(this._monthsParseExact)return Fj.call(this,n,t,e);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),i=0;i<12;i++){if(s=za([2e3,i]),e&&!this._longMonthsParse[i]&&(this._longMonthsParse[i]=new RegExp("^"+this.months(s,"").replace(".","")+"$","i"),this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(s,"").replace(".","")+"$","i")),!e&&!this._monthsParse[i]&&(r="^"+this.months(s,"")+"|^"+this.monthsShort(s,""),this._monthsParse[i]=new RegExp(r.replace(".",""),"i")),e&&t==="MMMM"&&this._longMonthsParse[i].test(n))return i;if(e&&t==="MMM"&&this._shortMonthsParse[i].test(n))return i;if(!e&&this._monthsParse[i].test(n))return i}}function L3(n,t){if(!n.isValid())return n;if(typeof t=="string"){if(/^\d+$/.test(t))t=si(t);else if(t=n.localeData().monthsParse(t),!bo(t))return n}var e=t,i=n.date();return i=i<29?i:Math.min(i,fw(n.year(),e)),n._isUTC?n._d.setUTCMonth(e,i):n._d.setMonth(e,i),n}function O3(n){return n!=null?(L3(this,n),ue.updateOffset(this,!0),this):of(this,"Month")}function zj(){return fw(this.year(),this.month())}function Bj(n){return this._monthsParseExact?(_i(this,"_monthsRegex")||P3.call(this),n?this._monthsShortStrictRegex:this._monthsShortRegex):(_i(this,"_monthsShortRegex")||(this._monthsShortRegex=kj),this._monthsShortStrictRegex&&n?this._monthsShortStrictRegex:this._monthsShortRegex)}function Uj(n){return this._monthsParseExact?(_i(this,"_monthsRegex")||P3.call(this),n?this._monthsStrictRegex:this._monthsRegex):(_i(this,"_monthsRegex")||(this._monthsRegex=Lj),this._monthsStrictRegex&&n?this._monthsStrictRegex:this._monthsRegex)}function P3(){function n(h,l){return l.length-h.length}var t=[],e=[],i=[],s,r,a,o;for(s=0;s<12;s++)r=za([2e3,s]),a=go(this.monthsShort(r,"")),o=go(this.months(r,"")),t.push(a),e.push(o),i.push(o),i.push(a);t.sort(n),e.sort(n),i.sort(n),this._monthsRegex=new RegExp("^("+i.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+e.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+t.join("|")+")","i")}function Gj(n,t,e,i,s,r,a){var o;return n<100&&n>=0?(o=new Date(n+400,t,e,i,s,r,a),isFinite(o.getFullYear())&&o.setFullYear(n)):o=new Date(n,t,e,i,s,r,a),o}function hf(n){var t,e;return n<100&&n>=0?(e=Array.prototype.slice.call(arguments),e[0]=n+400,t=new Date(Date.UTC.apply(null,e)),isFinite(t.getUTCFullYear())&&t.setUTCFullYear(n)):t=new Date(Date.UTC.apply(null,arguments)),t}function bm(n,t,e){var i=7+t-e,s=(7+hf(n,0,i).getUTCDay()-t)%7;return-s+i-1}function F3(n,t,e,i,s){var r=(7+e-i)%7,a=bm(n,i,s),o=1+7*(t-1)+r+a,h,l;return o<=0?(h=n-1,l=Pd(h)+o):o>Pd(n)?(h=n+1,l=o-Pd(n)):(h=n,l=o),{year:h,dayOfYear:l}}function lf(n,t,e){var i=bm(n.year(),t,e),s=Math.floor((n.dayOfYear()-i-1)/7)+1,r,a;return s<1?(a=n.year()-1,r=s+yo(a,t,e)):s>yo(n.year(),t,e)?(r=s-yo(n.year(),t,e),a=n.year()+1):(a=n.year(),r=s),{week:r,year:a}}function yo(n,t,e){var i=bm(n,t,e),s=bm(n+1,t,e);return(Pd(n)-i+s)/7}Ce("w",["ww",2],"wo","week");Ce("W",["WW",2],"Wo","isoWeek");ye("w",Wi,Tu);ye("ww",Wi,nr);ye("W",Wi,Tu);ye("WW",Wi,nr);Wf(["w","ww","W","WW"],function(n,t,e,i){t[i.substr(0,1)]=si(n)});function Vj(n){return lf(n,this._week.dow,this._week.doy).week}var Wj={dow:0,doy:6};function $j(){return this._week.dow}function Yj(){return this._week.doy}function Hj(n){var t=this.localeData().week(this);return n==null?t:this.add((n-t)*7,"d")}function qj(n){var t=lf(this,1,4).week;return n==null?t:this.add((n-t)*7,"d")}Ce("d",0,"do","day");Ce("dd",0,0,function(n){return this.localeData().weekdaysMin(this,n)});Ce("ddd",0,0,function(n){return this.localeData().weekdaysShort(this,n)});Ce("dddd",0,0,function(n){return this.localeData().weekdays(this,n)});Ce("e",0,0,"weekday");Ce("E",0,0,"isoWeekday");ye("d",Wi);ye("e",Wi);ye("E",Wi);ye("dd",function(n,t){return t.weekdaysMinRegex(n)});ye("ddd",function(n,t){return t.weekdaysShortRegex(n)});ye("dddd",function(n,t){return t.weekdaysRegex(n)});Wf(["dd","ddd","dddd"],function(n,t,e,i){var s=e._locale.weekdaysParse(n,i,e._strict);s!=null?t.d=s:qe(e).invalidWeekday=n});Wf(["d","e","E"],function(n,t,e,i){t[i]=si(n)});function Xj(n,t){return typeof n!="string"?n:isNaN(n)?(n=t.weekdaysParse(n),typeof n=="number"?n:null):parseInt(n,10)}function jj(n,t){return typeof n=="string"?t.weekdaysParse(n)%7||7:isNaN(n)?null:n}function pw(n,t){return n.slice(t,7).concat(n.slice(0,t))}var Zj="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),D3="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Kj="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),Jj=Vf,Qj=Vf,tZ=Vf;function eZ(n,t){var e=ea(this._weekdays)?this._weekdays:this._weekdays[n&&n!==!0&&this._weekdays.isFormat.test(t)?"format":"standalone"];return n===!0?pw(e,this._week.dow):n?e[n.day()]:e}function iZ(n){return n===!0?pw(this._weekdaysShort,this._week.dow):n?this._weekdaysShort[n.day()]:this._weekdaysShort}function nZ(n){return n===!0?pw(this._weekdaysMin,this._week.dow):n?this._weekdaysMin[n.day()]:this._weekdaysMin}function sZ(n,t,e){var i,s,r,a=n.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],i=0;i<7;++i)r=za([2e3,1]).day(i),this._minWeekdaysParse[i]=this.weekdaysMin(r,"").toLocaleLowerCase(),this._shortWeekdaysParse[i]=this.weekdaysShort(r,"").toLocaleLowerCase(),this._weekdaysParse[i]=this.weekdays(r,"").toLocaleLowerCase();return e?t==="dddd"?(s=an.call(this._weekdaysParse,a),s!==-1?s:null):t==="ddd"?(s=an.call(this._shortWeekdaysParse,a),s!==-1?s:null):(s=an.call(this._minWeekdaysParse,a),s!==-1?s:null):t==="dddd"?(s=an.call(this._weekdaysParse,a),s!==-1||(s=an.call(this._shortWeekdaysParse,a),s!==-1)?s:(s=an.call(this._minWeekdaysParse,a),s!==-1?s:null)):t==="ddd"?(s=an.call(this._shortWeekdaysParse,a),s!==-1||(s=an.call(this._weekdaysParse,a),s!==-1)?s:(s=an.call(this._minWeekdaysParse,a),s!==-1?s:null)):(s=an.call(this._minWeekdaysParse,a),s!==-1||(s=an.call(this._weekdaysParse,a),s!==-1)?s:(s=an.call(this._shortWeekdaysParse,a),s!==-1?s:null))}function rZ(n,t,e){var i,s,r;if(this._weekdaysParseExact)return sZ.call(this,n,t,e);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),i=0;i<7;i++){if(s=za([2e3,1]).day(i),e&&!this._fullWeekdaysParse[i]&&(this._fullWeekdaysParse[i]=new RegExp("^"+this.weekdays(s,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[i]=new RegExp("^"+this.weekdaysShort(s,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[i]=new RegExp("^"+this.weekdaysMin(s,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[i]||(r="^"+this.weekdays(s,"")+"|^"+this.weekdaysShort(s,"")+"|^"+this.weekdaysMin(s,""),this._weekdaysParse[i]=new RegExp(r.replace(".",""),"i")),e&&t==="dddd"&&this._fullWeekdaysParse[i].test(n))return i;if(e&&t==="ddd"&&this._shortWeekdaysParse[i].test(n))return i;if(e&&t==="dd"&&this._minWeekdaysParse[i].test(n))return i;if(!e&&this._weekdaysParse[i].test(n))return i}}function aZ(n){if(!this.isValid())return n!=null?this:NaN;var t=of(this,"Day");return n!=null?(n=Xj(n,this.localeData()),this.add(n-t,"d")):t}function oZ(n){if(!this.isValid())return n!=null?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return n==null?t:this.add(n-t,"d")}function hZ(n){if(!this.isValid())return n!=null?this:NaN;if(n!=null){var t=jj(n,this.localeData());return this.day(this.day()%7?t:t-7)}else return this.day()||7}function lZ(n){return this._weekdaysParseExact?(_i(this,"_weekdaysRegex")||mw.call(this),n?this._weekdaysStrictRegex:this._weekdaysRegex):(_i(this,"_weekdaysRegex")||(this._weekdaysRegex=Jj),this._weekdaysStrictRegex&&n?this._weekdaysStrictRegex:this._weekdaysRegex)}function cZ(n){return this._weekdaysParseExact?(_i(this,"_weekdaysRegex")||mw.call(this),n?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(_i(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=Qj),this._weekdaysShortStrictRegex&&n?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function uZ(n){return this._weekdaysParseExact?(_i(this,"_weekdaysRegex")||mw.call(this),n?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(_i(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=tZ),this._weekdaysMinStrictRegex&&n?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function mw(){function n(u,f){return f.length-u.length}var t=[],e=[],i=[],s=[],r,a,o,h,l;for(r=0;r<7;r++)a=za([2e3,1]).day(r),o=go(this.weekdaysMin(a,"")),h=go(this.weekdaysShort(a,"")),l=go(this.weekdays(a,"")),t.push(o),e.push(h),i.push(l),s.push(o),s.push(h),s.push(l);t.sort(n),e.sort(n),i.sort(n),s.sort(n),this._weekdaysRegex=new RegExp("^("+s.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+i.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+e.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+t.join("|")+")","i")}function gw(){return this.hours()%12||12}function dZ(){return this.hours()||24}Ce("H",["HH",2],0,"hour");Ce("h",["hh",2],0,gw);Ce("k",["kk",2],0,dZ);Ce("hmm",0,0,function(){return""+gw.apply(this)+Oa(this.minutes(),2)});Ce("hmmss",0,0,function(){return""+gw.apply(this)+Oa(this.minutes(),2)+Oa(this.seconds(),2)});Ce("Hmm",0,0,function(){return""+this.hours()+Oa(this.minutes(),2)});Ce("Hmmss",0,0,function(){return""+this.hours()+Oa(this.minutes(),2)+Oa(this.seconds(),2)});function z3(n,t){Ce(n,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}z3("a",!0);z3("A",!1);function B3(n,t){return t._meridiemParse}ye("a",B3);ye("A",B3);ye("H",Wi,dw);ye("h",Wi,Tu);ye("k",Wi,Tu);ye("HH",Wi,nr);ye("hh",Wi,nr);ye("kk",Wi,nr);ye("hmm",C3);ye("hmmss",A3);ye("Hmm",C3);ye("Hmmss",A3);Pi(["H","HH"],Cn);Pi(["k","kk"],function(n,t,e){var i=si(n);t[Cn]=i===24?0:i});Pi(["a","A"],function(n,t,e){e._isPm=e._locale.isPM(n),e._meridiem=n});Pi(["h","hh"],function(n,t,e){t[Cn]=si(n),qe(e).bigHour=!0});Pi("hmm",function(n,t,e){var i=n.length-2;t[Cn]=si(n.substr(0,i)),t[Gr]=si(n.substr(i)),qe(e).bigHour=!0});Pi("hmmss",function(n,t,e){var i=n.length-4,s=n.length-2;t[Cn]=si(n.substr(0,i)),t[Gr]=si(n.substr(i,2)),t[lo]=si(n.substr(s)),qe(e).bigHour=!0});Pi("Hmm",function(n,t,e){var i=n.length-2;t[Cn]=si(n.substr(0,i)),t[Gr]=si(n.substr(i))});Pi("Hmmss",function(n,t,e){var i=n.length-4,s=n.length-2;t[Cn]=si(n.substr(0,i)),t[Gr]=si(n.substr(i,2)),t[lo]=si(n.substr(s))});function fZ(n){return(n+"").toLowerCase().charAt(0)==="p"}var pZ=/[ap]\.?m?\.?/i,mZ=Cu("Hours",!0);function gZ(n,t,e){return n>11?e?"pm":"PM":e?"am":"AM"}var U3={calendar:sj,longDateFormat:hj,invalidDate:cj,ordinal:dj,dayOfMonthOrdinalParse:fj,relativeTime:mj,months:Nj,monthsShort:N3,week:Wj,weekdays:Zj,weekdaysMin:Kj,weekdaysShort:D3,meridiemParse:pZ},Yi={},id={},cf;function yZ(n,t){var e,i=Math.min(n.length,t.length);for(e=0;e<i;e+=1)if(n[e]!==t[e])return e;return i}function CE(n){return n&&n.toLowerCase().replace("_","-")}function _Z(n){for(var t=0,e,i,s,r;t<n.length;){for(r=CE(n[t]).split("-"),e=r.length,i=CE(n[t+1]),i=i?i.split("-"):null;e>0;){if(s=kg(r.slice(0,e).join("-")),s)return s;if(i&&i.length>=e&&yZ(r,i)>=e-1)break;e--}t++}return cf}function xZ(n){return!!(n&&n.match("^[^/\\\\]*$"))}function kg(n){var t=null,e;if(Yi[n]===void 0&&typeof module<"u"&&module&&module.exports&&xZ(n))try{t=cf._abbr,e=require,e("./locale/"+n),uh(t)}catch{Yi[n]=null}return Yi[n]}function uh(n,t){var e;return n&&(zs(t)?e=Ro(n):e=yw(n,t),e?cf=e:typeof console<"u"&&console.warn&&console.warn("Locale "+n+" not found. Did you forget to load it?")),cf._abbr}function yw(n,t){if(t!==null){var e,i=U3;if(t.abbr=n,Yi[n]!=null)M3("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),i=Yi[n]._config;else if(t.parentLocale!=null)if(Yi[t.parentLocale]!=null)i=Yi[t.parentLocale]._config;else if(e=kg(t.parentLocale),e!=null)i=e._config;else return id[t.parentLocale]||(id[t.parentLocale]=[]),id[t.parentLocale].push({name:n,config:t}),null;return Yi[n]=new ow(O_(i,t)),id[n]&&id[n].forEach(function(s){yw(s.name,s.config)}),uh(n),Yi[n]}else return delete Yi[n],null}function vZ(n,t){if(t!=null){var e,i,s=U3;Yi[n]!=null&&Yi[n].parentLocale!=null?Yi[n].set(O_(Yi[n]._config,t)):(i=kg(n),i!=null&&(s=i._config),t=O_(s,t),i==null&&(t.abbr=n),e=new ow(t),e.parentLocale=Yi[n],Yi[n]=e),uh(n)}else Yi[n]!=null&&(Yi[n].parentLocale!=null?(Yi[n]=Yi[n].parentLocale,n===uh()&&uh(n)):Yi[n]!=null&&delete Yi[n]);return Yi[n]}function Ro(n){var t;if(n&&n._locale&&n._locale._abbr&&(n=n._locale._abbr),!n)return cf;if(!ea(n)){if(t=kg(n),t)return t;n=[n]}return _Z(n)}function wZ(){return P_(Yi)}function _w(n){var t,e=n._a;return e&&qe(n).overflow===-2&&(t=e[ho]<0||e[ho]>11?ho:e[Ea]<1||e[Ea]>fw(e[ds],e[ho])?Ea:e[Cn]<0||e[Cn]>24||e[Cn]===24&&(e[Gr]!==0||e[lo]!==0||e[el]!==0)?Cn:e[Gr]<0||e[Gr]>59?Gr:e[lo]<0||e[lo]>59?lo:e[el]<0||e[el]>999?el:-1,qe(n)._overflowDayOfYear&&(t<ds||t>Ea)&&(t=Ea),qe(n)._overflowWeeks&&t===-1&&(t=Sj),qe(n)._overflowWeekday&&t===-1&&(t=Tj),qe(n).overflow=t),n}var bZ=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,MZ=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,EZ=/Z|[+-]\d\d(?::?\d\d)?/,J0=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],a1=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],SZ=/^\/?Date\((-?\d+)/i,TZ=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,CZ={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function G3(n){var t,e,i=n._i,s=bZ.exec(i)||MZ.exec(i),r,a,o,h,l=J0.length,u=a1.length;if(s){for(qe(n).iso=!0,t=0,e=l;t<e;t++)if(J0[t][1].exec(s[1])){a=J0[t][0],r=J0[t][2]!==!1;break}if(a==null){n._isValid=!1;return}if(s[3]){for(t=0,e=u;t<e;t++)if(a1[t][1].exec(s[3])){o=(s[2]||" ")+a1[t][0];break}if(o==null){n._isValid=!1;return}}if(!r&&o!=null){n._isValid=!1;return}if(s[4])if(EZ.exec(s[4]))h="Z";else{n._isValid=!1;return}n._f=a+(o||"")+(h||""),vw(n)}else n._isValid=!1}function AZ(n,t,e,i,s,r){var a=[RZ(n),N3.indexOf(t),parseInt(e,10),parseInt(i,10),parseInt(s,10)];return r&&a.push(parseInt(r,10)),a}function RZ(n){var t=parseInt(n,10);return t<=49?2e3+t:t<=999?1900+t:t}function IZ(n){return n.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function NZ(n,t,e){if(n){var i=D3.indexOf(n),s=new Date(t[0],t[1],t[2]).getDay();if(i!==s)return qe(e).weekdayMismatch=!0,e._isValid=!1,!1}return!0}function kZ(n,t,e){if(n)return CZ[n];if(t)return 0;var i=parseInt(e,10),s=i%100,r=(i-s)/100;return r*60+s}function V3(n){var t=TZ.exec(IZ(n._i)),e;if(t){if(e=AZ(t[4],t[3],t[2],t[5],t[6],t[7]),!NZ(t[1],e,n))return;n._a=e,n._tzm=kZ(t[8],t[9],t[10]),n._d=hf.apply(null,n._a),n._d.setUTCMinutes(n._d.getUTCMinutes()-n._tzm),qe(n).rfc2822=!0}else n._isValid=!1}function LZ(n){var t=SZ.exec(n._i);if(t!==null){n._d=new Date(+t[1]);return}if(G3(n),n._isValid===!1)delete n._isValid;else return;if(V3(n),n._isValid===!1)delete n._isValid;else return;n._strict?n._isValid=!1:ue.createFromInputFallback(n)}ue.createFromInputFallback=Mr("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(n){n._d=new Date(n._i+(n._useUTC?" UTC":""))});function gc(n,t,e){return n!=null?n:t!=null?t:e}function OZ(n){var t=new Date(ue.now());return n._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function xw(n){var t,e,i=[],s,r,a;if(!n._d){for(s=OZ(n),n._w&&n._a[Ea]==null&&n._a[ho]==null&&PZ(n),n._dayOfYear!=null&&(a=gc(n._a[ds],s[ds]),(n._dayOfYear>Pd(a)||n._dayOfYear===0)&&(qe(n)._overflowDayOfYear=!0),e=hf(a,0,n._dayOfYear),n._a[ho]=e.getUTCMonth(),n._a[Ea]=e.getUTCDate()),t=0;t<3&&n._a[t]==null;++t)n._a[t]=i[t]=s[t];for(;t<7;t++)n._a[t]=i[t]=n._a[t]==null?t===2?1:0:n._a[t];n._a[Cn]===24&&n._a[Gr]===0&&n._a[lo]===0&&n._a[el]===0&&(n._nextDay=!0,n._a[Cn]=0),n._d=(n._useUTC?hf:Gj).apply(null,i),r=n._useUTC?n._d.getUTCDay():n._d.getDay(),n._tzm!=null&&n._d.setUTCMinutes(n._d.getUTCMinutes()-n._tzm),n._nextDay&&(n._a[Cn]=24),n._w&&typeof n._w.d<"u"&&n._w.d!==r&&(qe(n).weekdayMismatch=!0)}}function PZ(n){var t,e,i,s,r,a,o,h,l;t=n._w,t.GG!=null||t.W!=null||t.E!=null?(r=1,a=4,e=gc(t.GG,n._a[ds],lf(Vi(),1,4).year),i=gc(t.W,1),s=gc(t.E,1),(s<1||s>7)&&(h=!0)):(r=n._locale._week.dow,a=n._locale._week.doy,l=lf(Vi(),r,a),e=gc(t.gg,n._a[ds],l.year),i=gc(t.w,l.week),t.d!=null?(s=t.d,(s<0||s>6)&&(h=!0)):t.e!=null?(s=t.e+r,(t.e<0||t.e>6)&&(h=!0)):s=r),i<1||i>yo(e,r,a)?qe(n)._overflowWeeks=!0:h!=null?qe(n)._overflowWeekday=!0:(o=F3(e,i,s,r,a),n._a[ds]=o.year,n._dayOfYear=o.dayOfYear)}ue.ISO_8601=function(){};ue.RFC_2822=function(){};function vw(n){if(n._f===ue.ISO_8601){G3(n);return}if(n._f===ue.RFC_2822){V3(n);return}n._a=[],qe(n).empty=!0;var t=""+n._i,e,i,s,r,a,o=t.length,h=0,l,u;for(s=E3(n._f,n._locale).match(hw)||[],u=s.length,e=0;e<u;e++)r=s[e],i=(t.match(bj(r,n))||[])[0],i&&(a=t.substr(0,t.indexOf(i)),a.length>0&&qe(n).unusedInput.push(a),t=t.slice(t.indexOf(i)+i.length),h+=i.length),Uc[r]?(i?qe(n).empty=!1:qe(n).unusedTokens.push(r),Ej(r,i,n)):n._strict&&!i&&qe(n).unusedTokens.push(r);qe(n).charsLeftOver=o-h,t.length>0&&qe(n).unusedInput.push(t),n._a[Cn]<=12&&qe(n).bigHour===!0&&n._a[Cn]>0&&(qe(n).bigHour=void 0),qe(n).parsedDateParts=n._a.slice(0),qe(n).meridiem=n._meridiem,n._a[Cn]=FZ(n._locale,n._a[Cn],n._meridiem),l=qe(n).era,l!==null&&(n._a[ds]=n._locale.erasConvertYear(l,n._a[ds])),xw(n),_w(n)}function FZ(n,t,e){var i;return e==null?t:n.meridiemHour!=null?n.meridiemHour(t,e):(n.isPM!=null&&(i=n.isPM(e),i&&t<12&&(t+=12),!i&&t===12&&(t=0)),t)}function DZ(n){var t,e,i,s,r,a,o=!1,h=n._f.length;if(h===0){qe(n).invalidFormat=!0,n._d=new Date(NaN);return}for(s=0;s<h;s++)r=0,a=!1,t=aw({},n),n._useUTC!=null&&(t._useUTC=n._useUTC),t._f=n._f[s],vw(t),rw(t)&&(a=!0),r+=qe(t).charsLeftOver,r+=qe(t).unusedTokens.length*10,qe(t).score=r,o?r<i&&(i=r,e=t):(i==null||r<i||a)&&(i=r,e=t,a&&(o=!0));rh(n,e||t)}function zZ(n){if(!n._d){var t=lw(n._i),e=t.day===void 0?t.date:t.day;n._a=w3([t.year,t.month,e,t.hour,t.minute,t.second,t.millisecond],function(i){return i&&parseInt(i,10)}),xw(n)}}function BZ(n){var t=new Gf(_w(W3(n)));return t._nextDay&&(t.add(1,"d"),t._nextDay=void 0),t}function W3(n){var t=n._i,e=n._f;return n._locale=n._locale||Ro(n._l),t===null||e===void 0&&t===""?Sg({nullInput:!0}):(typeof t=="string"&&(n._i=t=n._locale.preparse(t)),ia(t)?new Gf(_w(t)):(Uf(t)?n._d=t:ea(e)?DZ(n):e?vw(n):UZ(n),rw(n)||(n._d=null),n))}function UZ(n){var t=n._i;zs(t)?n._d=new Date(ue.now()):Uf(t)?n._d=new Date(t.valueOf()):typeof t=="string"?LZ(n):ea(t)?(n._a=w3(t.slice(0),function(e){return parseInt(e,10)}),xw(n)):sl(t)?zZ(n):bo(t)?n._d=new Date(t):ue.createFromInputFallback(n)}function $3(n,t,e,i,s){var r={};return(t===!0||t===!1)&&(i=t,t=void 0),(e===!0||e===!1)&&(i=e,e=void 0),(sl(n)&&sw(n)||ea(n)&&n.length===0)&&(n=void 0),r._isAMomentObject=!0,r._useUTC=r._isUTC=s,r._l=e,r._i=n,r._f=t,r._strict=i,BZ(r)}function Vi(n,t,e,i){return $3(n,t,e,i,!1)}var GZ=Mr("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var n=Vi.apply(null,arguments);return this.isValid()&&n.isValid()?n<this?this:n:Sg()}),VZ=Mr("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var n=Vi.apply(null,arguments);return this.isValid()&&n.isValid()?n>this?this:n:Sg()});function Y3(n,t){var e,i;if(t.length===1&&ea(t[0])&&(t=t[0]),!t.length)return Vi();for(e=t[0],i=1;i<t.length;++i)(!t[i].isValid()||t[i][n](e))&&(e=t[i]);return e}function WZ(){var n=[].slice.call(arguments,0);return Y3("isBefore",n)}function $Z(){var n=[].slice.call(arguments,0);return Y3("isAfter",n)}var YZ=function(){return Date.now?Date.now():+new Date},nd=["year","quarter","month","week","day","hour","minute","second","millisecond"];function HZ(n){var t,e=!1,i,s=nd.length;for(t in n)if(_i(n,t)&&!(an.call(nd,t)!==-1&&(n[t]==null||!isNaN(n[t]))))return!1;for(i=0;i<s;++i)if(n[nd[i]]){if(e)return!1;parseFloat(n[nd[i]])!==si(n[nd[i]])&&(e=!0)}return!0}function qZ(){return this._isValid}function XZ(){return aa(NaN)}function Lg(n){var t=lw(n),e=t.year||0,i=t.quarter||0,s=t.month||0,r=t.week||t.isoWeek||0,a=t.day||0,o=t.hour||0,h=t.minute||0,l=t.second||0,u=t.millisecond||0;this._isValid=HZ(t),this._milliseconds=+u+l*1e3+h*6e4+o*1e3*60*60,this._days=+a+r*7,this._months=+s+i*3+e*12,this._data={},this._locale=Ro(),this._bubble()}function Np(n){return n instanceof Lg}function D_(n){return n<0?Math.round(-1*n)*-1:Math.round(n)}function jZ(n,t,e){var i=Math.min(n.length,t.length),s=Math.abs(n.length-t.length),r=0,a;for(a=0;a<i;a++)(e&&n[a]!==t[a]||!e&&si(n[a])!==si(t[a]))&&r++;return r+s}function H3(n,t){Ce(n,0,0,function(){var e=this.utcOffset(),i="+";return e<0&&(e=-e,i="-"),i+Oa(~~(e/60),2)+t+Oa(~~e%60,2)})}H3("Z",":");H3("ZZ","");ye("Z",Ig);ye("ZZ",Ig);Pi(["Z","ZZ"],function(n,t,e){e._useUTC=!0,e._tzm=ww(Ig,n)});var ZZ=/([\+\-]|\d\d)/gi;function ww(n,t){var e=(t||"").match(n),i,s,r;return e===null?null:(i=e[e.length-1]||[],s=(i+"").match(ZZ)||["-",0,0],r=+(s[1]*60)+si(s[2]),r===0?0:s[0]==="+"?r:-r)}function bw(n,t){var e,i;return t._isUTC?(e=t.clone(),i=(ia(n)||Uf(n)?n.valueOf():Vi(n).valueOf())-e.valueOf(),e._d.setTime(e._d.valueOf()+i),ue.updateOffset(e,!1),e):Vi(n).local()}function z_(n){return-Math.round(n._d.getTimezoneOffset())}ue.updateOffset=function(){};function KZ(n,t,e){var i=this._offset||0,s;if(!this.isValid())return n!=null?this:NaN;if(n!=null){if(typeof n=="string"){if(n=ww(Ig,n),n===null)return this}else Math.abs(n)<16&&!e&&(n=n*60);return!this._isUTC&&t&&(s=z_(this)),this._offset=n,this._isUTC=!0,s!=null&&this.add(s,"m"),i!==n&&(!t||this._changeInProgress?j3(this,aa(n-i,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,ue.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?i:z_(this)}function JZ(n,t){return n!=null?(typeof n!="string"&&(n=-n),this.utcOffset(n,t),this):-this.utcOffset()}function QZ(n){return this.utcOffset(0,n)}function tK(n){return this._isUTC&&(this.utcOffset(0,n),this._isUTC=!1,n&&this.subtract(z_(this),"m")),this}function eK(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var n=ww(vj,this._i);n!=null?this.utcOffset(n):this.utcOffset(0,!0)}return this}function iK(n){return this.isValid()?(n=n?Vi(n).utcOffset():0,(this.utcOffset()-n)%60===0):!1}function nK(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function sK(){if(!zs(this._isDSTShifted))return this._isDSTShifted;var n={},t;return aw(n,this),n=W3(n),n._a?(t=n._isUTC?za(n._a):Vi(n._a),this._isDSTShifted=this.isValid()&&jZ(n._a,t.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function rK(){return this.isValid()?!this._isUTC:!1}function aK(){return this.isValid()?this._isUTC:!1}function q3(){return this.isValid()?this._isUTC&&this._offset===0:!1}var oK=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,hK=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function aa(n,t){var e=n,i=null,s,r,a;return Np(n)?e={ms:n._milliseconds,d:n._days,M:n._months}:bo(n)||!isNaN(+n)?(e={},t?e[t]=+n:e.milliseconds=+n):(i=oK.exec(n))?(s=i[1]==="-"?-1:1,e={y:0,d:si(i[Ea])*s,h:si(i[Cn])*s,m:si(i[Gr])*s,s:si(i[lo])*s,ms:si(D_(i[el]*1e3))*s}):(i=hK.exec(n))?(s=i[1]==="-"?-1:1,e={y:Bh(i[2],s),M:Bh(i[3],s),w:Bh(i[4],s),d:Bh(i[5],s),h:Bh(i[6],s),m:Bh(i[7],s),s:Bh(i[8],s)}):e==null?e={}:typeof e=="object"&&("from"in e||"to"in e)&&(a=lK(Vi(e.from),Vi(e.to)),e={},e.ms=a.milliseconds,e.M=a.months),r=new Lg(e),Np(n)&&_i(n,"_locale")&&(r._locale=n._locale),Np(n)&&_i(n,"_isValid")&&(r._isValid=n._isValid),r}aa.fn=Lg.prototype;aa.invalid=XZ;function Bh(n,t){var e=n&&parseFloat(n.replace(",","."));return(isNaN(e)?0:e)*t}function AE(n,t){var e={};return e.months=t.month()-n.month()+(t.year()-n.year())*12,n.clone().add(e.months,"M").isAfter(t)&&--e.months,e.milliseconds=+t-+n.clone().add(e.months,"M"),e}function lK(n,t){var e;return n.isValid()&&t.isValid()?(t=bw(t,n),n.isBefore(t)?e=AE(n,t):(e=AE(t,n),e.milliseconds=-e.milliseconds,e.months=-e.months),e):{milliseconds:0,months:0}}function X3(n,t){return function(e,i){var s,r;return i!==null&&!isNaN(+i)&&(M3(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),r=e,e=i,i=r),s=aa(e,i),j3(this,s,n),this}}function j3(n,t,e,i){var s=t._milliseconds,r=D_(t._days),a=D_(t._months);!n.isValid()||(i=i==null?!0:i,a&&L3(n,of(n,"Month")+a*e),r&&I3(n,"Date",of(n,"Date")+r*e),s&&n._d.setTime(n._d.valueOf()+s*e),i&&ue.updateOffset(n,r||a))}var cK=X3(1,"add"),uK=X3(-1,"subtract");function Z3(n){return typeof n=="string"||n instanceof String}function dK(n){return ia(n)||Uf(n)||Z3(n)||bo(n)||pK(n)||fK(n)||n===null||n===void 0}function fK(n){var t=sl(n)&&!sw(n),e=!1,i=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],s,r,a=i.length;for(s=0;s<a;s+=1)r=i[s],e=e||_i(n,r);return t&&e}function pK(n){var t=ea(n),e=!1;return t&&(e=n.filter(function(i){return!bo(i)&&Z3(n)}).length===0),t&&e}function mK(n){var t=sl(n)&&!sw(n),e=!1,i=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],s,r;for(s=0;s<i.length;s+=1)r=i[s],e=e||_i(n,r);return t&&e}function gK(n,t){var e=n.diff(t,"days",!0);return e<-6?"sameElse":e<-1?"lastWeek":e<0?"lastDay":e<1?"sameDay":e<2?"nextDay":e<7?"nextWeek":"sameElse"}function yK(n,t){arguments.length===1&&(arguments[0]?dK(arguments[0])?(n=arguments[0],t=void 0):mK(arguments[0])&&(t=arguments[0],n=void 0):(n=void 0,t=void 0));var e=n||Vi(),i=bw(e,this).startOf("day"),s=ue.calendarFormat(this,i)||"sameElse",r=t&&(Ba(t[s])?t[s].call(this,e):t[s]);return this.format(r||this.localeData().calendar(s,this,Vi(e)))}function _K(){return new Gf(this)}function xK(n,t){var e=ia(n)?n:Vi(n);return this.isValid()&&e.isValid()?(t=Er(t)||"millisecond",t==="millisecond"?this.valueOf()>e.valueOf():e.valueOf()<this.clone().startOf(t).valueOf()):!1}function vK(n,t){var e=ia(n)?n:Vi(n);return this.isValid()&&e.isValid()?(t=Er(t)||"millisecond",t==="millisecond"?this.valueOf()<e.valueOf():this.clone().endOf(t).valueOf()<e.valueOf()):!1}function wK(n,t,e,i){var s=ia(n)?n:Vi(n),r=ia(t)?t:Vi(t);return this.isValid()&&s.isValid()&&r.isValid()?(i=i||"()",(i[0]==="("?this.isAfter(s,e):!this.isBefore(s,e))&&(i[1]===")"?this.isBefore(r,e):!this.isAfter(r,e))):!1}function bK(n,t){var e=ia(n)?n:Vi(n),i;return this.isValid()&&e.isValid()?(t=Er(t)||"millisecond",t==="millisecond"?this.valueOf()===e.valueOf():(i=e.valueOf(),this.clone().startOf(t).valueOf()<=i&&i<=this.clone().endOf(t).valueOf())):!1}function MK(n,t){return this.isSame(n,t)||this.isAfter(n,t)}function EK(n,t){return this.isSame(n,t)||this.isBefore(n,t)}function SK(n,t,e){var i,s,r;if(!this.isValid())return NaN;if(i=bw(n,this),!i.isValid())return NaN;switch(s=(i.utcOffset()-this.utcOffset())*6e4,t=Er(t),t){case"year":r=kp(this,i)/12;break;case"month":r=kp(this,i);break;case"quarter":r=kp(this,i)/3;break;case"second":r=(this-i)/1e3;break;case"minute":r=(this-i)/6e4;break;case"hour":r=(this-i)/36e5;break;case"day":r=(this-i-s)/864e5;break;case"week":r=(this-i-s)/6048e5;break;default:r=this-i}return e?r:fr(r)}function kp(n,t){if(n.date()<t.date())return-kp(t,n);var e=(t.year()-n.year())*12+(t.month()-n.month()),i=n.clone().add(e,"months"),s,r;return t-i<0?(s=n.clone().add(e-1,"months"),r=(t-i)/(i-s)):(s=n.clone().add(e+1,"months"),r=(t-i)/(s-i)),-(e+r)||0}ue.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";ue.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function TK(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function CK(n){if(!this.isValid())return null;var t=n!==!0,e=t?this.clone().utc():this;return e.year()<0||e.year()>9999?Ip(e,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):Ba(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",Ip(e,"Z")):Ip(e,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function AK(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var n="moment",t="",e,i,s,r;return this.isLocal()||(n=this.utcOffset()===0?"moment.utc":"moment.parseZone",t="Z"),e="["+n+'("]',i=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",s="-MM-DD[T]HH:mm:ss.SSS",r=t+'[")]',this.format(e+i+s+r)}function RK(n){n||(n=this.isUtc()?ue.defaultFormatUtc:ue.defaultFormat);var t=Ip(this,n);return this.localeData().postformat(t)}function IK(n,t){return this.isValid()&&(ia(n)&&n.isValid()||Vi(n).isValid())?aa({to:this,from:n}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function NK(n){return this.from(Vi(),n)}function kK(n,t){return this.isValid()&&(ia(n)&&n.isValid()||Vi(n).isValid())?aa({from:this,to:n}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function LK(n){return this.to(Vi(),n)}function K3(n){var t;return n===void 0?this._locale._abbr:(t=Ro(n),t!=null&&(this._locale=t),this)}var J3=Mr("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(n){return n===void 0?this.localeData():this.locale(n)});function Q3(){return this._locale}var Mm=1e3,Gc=60*Mm,Em=60*Gc,tR=(365*400+97)*24*Em;function Vc(n,t){return(n%t+t)%t}function eR(n,t,e){return n<100&&n>=0?new Date(n+400,t,e)-tR:new Date(n,t,e).valueOf()}function iR(n,t,e){return n<100&&n>=0?Date.UTC(n+400,t,e)-tR:Date.UTC(n,t,e)}function OK(n){var t,e;if(n=Er(n),n===void 0||n==="millisecond"||!this.isValid())return this;switch(e=this._isUTC?iR:eR,n){case"year":t=e(this.year(),0,1);break;case"quarter":t=e(this.year(),this.month()-this.month()%3,1);break;case"month":t=e(this.year(),this.month(),1);break;case"week":t=e(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":t=e(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":t=e(this.year(),this.month(),this.date());break;case"hour":t=this._d.valueOf(),t-=Vc(t+(this._isUTC?0:this.utcOffset()*Gc),Em);break;case"minute":t=this._d.valueOf(),t-=Vc(t,Gc);break;case"second":t=this._d.valueOf(),t-=Vc(t,Mm);break}return this._d.setTime(t),ue.updateOffset(this,!0),this}function PK(n){var t,e;if(n=Er(n),n===void 0||n==="millisecond"||!this.isValid())return this;switch(e=this._isUTC?iR:eR,n){case"year":t=e(this.year()+1,0,1)-1;break;case"quarter":t=e(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":t=e(this.year(),this.month()+1,1)-1;break;case"week":t=e(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":t=e(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":t=e(this.year(),this.month(),this.date()+1)-1;break;case"hour":t=this._d.valueOf(),t+=Em-Vc(t+(this._isUTC?0:this.utcOffset()*Gc),Em)-1;break;case"minute":t=this._d.valueOf(),t+=Gc-Vc(t,Gc)-1;break;case"second":t=this._d.valueOf(),t+=Mm-Vc(t,Mm)-1;break}return this._d.setTime(t),ue.updateOffset(this,!0),this}function FK(){return this._d.valueOf()-(this._offset||0)*6e4}function DK(){return Math.floor(this.valueOf()/1e3)}function zK(){return new Date(this.valueOf())}function BK(){var n=this;return[n.year(),n.month(),n.date(),n.hour(),n.minute(),n.second(),n.millisecond()]}function UK(){var n=this;return{years:n.year(),months:n.month(),date:n.date(),hours:n.hours(),minutes:n.minutes(),seconds:n.seconds(),milliseconds:n.milliseconds()}}function GK(){return this.isValid()?this.toISOString():null}function VK(){return rw(this)}function WK(){return rh({},qe(this))}function $K(){return qe(this).overflow}function YK(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}Ce("N",0,0,"eraAbbr");Ce("NN",0,0,"eraAbbr");Ce("NNN",0,0,"eraAbbr");Ce("NNNN",0,0,"eraName");Ce("NNNNN",0,0,"eraNarrow");Ce("y",["y",1],"yo","eraYear");Ce("y",["yy",2],0,"eraYear");Ce("y",["yyy",3],0,"eraYear");Ce("y",["yyyy",4],0,"eraYear");ye("N",Mw);ye("NN",Mw);ye("NNN",Mw);ye("NNNN",iJ);ye("NNNNN",nJ);Pi(["N","NN","NNN","NNNN","NNNNN"],function(n,t,e,i){var s=e._locale.erasParse(n,i,e._strict);s?qe(e).era=s:qe(e).invalidEra=n});ye("y",Su);ye("yy",Su);ye("yyy",Su);ye("yyyy",Su);ye("yo",sJ);Pi(["y","yy","yyy","yyyy"],ds);Pi(["yo"],function(n,t,e,i){var s;e._locale._eraYearOrdinalRegex&&(s=n.match(e._locale._eraYearOrdinalRegex)),e._locale.eraYearOrdinalParse?t[ds]=e._locale.eraYearOrdinalParse(n,s):t[ds]=parseInt(n,10)});function HK(n,t){var e,i,s,r=this._eras||Ro("en")._eras;for(e=0,i=r.length;e<i;++e){switch(typeof r[e].since){case"string":s=ue(r[e].since).startOf("day"),r[e].since=s.valueOf();break}switch(typeof r[e].until){case"undefined":r[e].until=1/0;break;case"string":s=ue(r[e].until).startOf("day").valueOf(),r[e].until=s.valueOf();break}}return r}function qK(n,t,e){var i,s,r=this.eras(),a,o,h;for(n=n.toUpperCase(),i=0,s=r.length;i<s;++i)if(a=r[i].name.toUpperCase(),o=r[i].abbr.toUpperCase(),h=r[i].narrow.toUpperCase(),e)switch(t){case"N":case"NN":case"NNN":if(o===n)return r[i];break;case"NNNN":if(a===n)return r[i];break;case"NNNNN":if(h===n)return r[i];break}else if([a,o,h].indexOf(n)>=0)return r[i]}function XK(n,t){var e=n.since<=n.until?1:-1;return t===void 0?ue(n.since).year():ue(n.since).year()+(t-n.offset)*e}function jK(){var n,t,e,i=this.localeData().eras();for(n=0,t=i.length;n<t;++n)if(e=this.clone().startOf("day").valueOf(),i[n].since<=e&&e<=i[n].until||i[n].until<=e&&e<=i[n].since)return i[n].name;return""}function ZK(){var n,t,e,i=this.localeData().eras();for(n=0,t=i.length;n<t;++n)if(e=this.clone().startOf("day").valueOf(),i[n].since<=e&&e<=i[n].until||i[n].until<=e&&e<=i[n].since)return i[n].narrow;return""}function KK(){var n,t,e,i=this.localeData().eras();for(n=0,t=i.length;n<t;++n)if(e=this.clone().startOf("day").valueOf(),i[n].since<=e&&e<=i[n].until||i[n].until<=e&&e<=i[n].since)return i[n].abbr;return""}function JK(){var n,t,e,i,s=this.localeData().eras();for(n=0,t=s.length;n<t;++n)if(e=s[n].since<=s[n].until?1:-1,i=this.clone().startOf("day").valueOf(),s[n].since<=i&&i<=s[n].until||s[n].until<=i&&i<=s[n].since)return(this.year()-ue(s[n].since).year())*e+s[n].offset;return this.year()}function QK(n){return _i(this,"_erasNameRegex")||Ew.call(this),n?this._erasNameRegex:this._erasRegex}function tJ(n){return _i(this,"_erasAbbrRegex")||Ew.call(this),n?this._erasAbbrRegex:this._erasRegex}function eJ(n){return _i(this,"_erasNarrowRegex")||Ew.call(this),n?this._erasNarrowRegex:this._erasRegex}function Mw(n,t){return t.erasAbbrRegex(n)}function iJ(n,t){return t.erasNameRegex(n)}function nJ(n,t){return t.erasNarrowRegex(n)}function sJ(n,t){return t._eraYearOrdinalRegex||Su}function Ew(){var n=[],t=[],e=[],i=[],s,r,a,o,h,l=this.eras();for(s=0,r=l.length;s<r;++s)a=go(l[s].name),o=go(l[s].abbr),h=go(l[s].narrow),t.push(a),n.push(o),e.push(h),i.push(a),i.push(o),i.push(h);this._erasRegex=new RegExp("^("+i.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+t.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+n.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+e.join("|")+")","i")}Ce(0,["gg",2],0,function(){return this.weekYear()%100});Ce(0,["GG",2],0,function(){return this.isoWeekYear()%100});function Og(n,t){Ce(0,[n,n.length],0,t)}Og("gggg","weekYear");Og("ggggg","weekYear");Og("GGGG","isoWeekYear");Og("GGGGG","isoWeekYear");ye("G",Rg);ye("g",Rg);ye("GG",Wi,nr);ye("gg",Wi,nr);ye("GGGG",uw,cw);ye("gggg",uw,cw);ye("GGGGG",Ag,Tg);ye("ggggg",Ag,Tg);Wf(["gggg","ggggg","GGGG","GGGGG"],function(n,t,e,i){t[i.substr(0,2)]=si(n)});Wf(["gg","GG"],function(n,t,e,i){t[i]=ue.parseTwoDigitYear(n)});function rJ(n){return nR.call(this,n,this.week(),this.weekday()+this.localeData()._week.dow,this.localeData()._week.dow,this.localeData()._week.doy)}function aJ(n){return nR.call(this,n,this.isoWeek(),this.isoWeekday(),1,4)}function oJ(){return yo(this.year(),1,4)}function hJ(){return yo(this.isoWeekYear(),1,4)}function lJ(){var n=this.localeData()._week;return yo(this.year(),n.dow,n.doy)}function cJ(){var n=this.localeData()._week;return yo(this.weekYear(),n.dow,n.doy)}function nR(n,t,e,i,s){var r;return n==null?lf(this,i,s).year:(r=yo(n,i,s),t>r&&(t=r),uJ.call(this,n,t,e,i,s))}function uJ(n,t,e,i,s){var r=F3(n,t,e,i,s),a=hf(r.year,0,r.dayOfYear);return this.year(a.getUTCFullYear()),this.month(a.getUTCMonth()),this.date(a.getUTCDate()),this}Ce("Q",0,"Qo","quarter");ye("Q",S3);Pi("Q",function(n,t){t[ho]=(si(n)-1)*3});function dJ(n){return n==null?Math.ceil((this.month()+1)/3):this.month((n-1)*3+this.month()%3)}Ce("D",["DD",2],"Do","date");ye("D",Wi,Tu);ye("DD",Wi,nr);ye("Do",function(n,t){return n?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient});Pi(["D","DD"],Ea);Pi("Do",function(n,t){t[Ea]=si(n.match(Wi)[0])});var sR=Cu("Date",!0);Ce("DDD",["DDDD",3],"DDDo","dayOfYear");ye("DDD",Cg);ye("DDDD",T3);Pi(["DDD","DDDD"],function(n,t,e){e._dayOfYear=si(n)});function fJ(n){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return n==null?t:this.add(n-t,"d")}Ce("m",["mm",2],0,"minute");ye("m",Wi,dw);ye("mm",Wi,nr);Pi(["m","mm"],Gr);var pJ=Cu("Minutes",!1);Ce("s",["ss",2],0,"second");ye("s",Wi,dw);ye("ss",Wi,nr);Pi(["s","ss"],lo);var mJ=Cu("Seconds",!1);Ce("S",0,0,function(){return~~(this.millisecond()/100)});Ce(0,["SS",2],0,function(){return~~(this.millisecond()/10)});Ce(0,["SSS",3],0,"millisecond");Ce(0,["SSSS",4],0,function(){return this.millisecond()*10});Ce(0,["SSSSS",5],0,function(){return this.millisecond()*100});Ce(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3});Ce(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4});Ce(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5});Ce(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6});ye("S",Cg,S3);ye("SS",Cg,nr);ye("SSS",Cg,T3);var ah,rR;for(ah="SSSS";ah.length<=9;ah+="S")ye(ah,Su);function gJ(n,t){t[el]=si(("0."+n)*1e3)}for(ah="S";ah.length<=9;ah+="S")Pi(ah,gJ);rR=Cu("Milliseconds",!1);Ce("z",0,0,"zoneAbbr");Ce("zz",0,0,"zoneName");function yJ(){return this._isUTC?"UTC":""}function _J(){return this._isUTC?"Coordinated Universal Time":""}var se=Gf.prototype;se.add=cK;se.calendar=yK;se.clone=_K;se.diff=SK;se.endOf=PK;se.format=RK;se.from=IK;se.fromNow=NK;se.to=kK;se.toNow=LK;se.get=Aj;se.invalidAt=$K;se.isAfter=xK;se.isBefore=vK;se.isBetween=wK;se.isSame=bK;se.isSameOrAfter=MK;se.isSameOrBefore=EK;se.isValid=VK;se.lang=J3;se.locale=K3;se.localeData=Q3;se.max=VZ;se.min=GZ;se.parsingFlags=WK;se.set=Rj;se.startOf=OK;se.subtract=uK;se.toArray=BK;se.toObject=UK;se.toDate=zK;se.toISOString=CK;se.inspect=AK;typeof Symbol<"u"&&Symbol.for!=null&&(se[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"});se.toJSON=GK;se.toString=TK;se.unix=DK;se.valueOf=FK;se.creationData=YK;se.eraName=jK;se.eraNarrow=ZK;se.eraAbbr=KK;se.eraYear=JK;se.year=R3;se.isLeapYear=Cj;se.weekYear=rJ;se.isoWeekYear=aJ;se.quarter=se.quarters=dJ;se.month=O3;se.daysInMonth=zj;se.week=se.weeks=Hj;se.isoWeek=se.isoWeeks=qj;se.weeksInYear=lJ;se.weeksInWeekYear=cJ;se.isoWeeksInYear=oJ;se.isoWeeksInISOWeekYear=hJ;se.date=sR;se.day=se.days=aZ;se.weekday=oZ;se.isoWeekday=hZ;se.dayOfYear=fJ;se.hour=se.hours=mZ;se.minute=se.minutes=pJ;se.second=se.seconds=mJ;se.millisecond=se.milliseconds=rR;se.utcOffset=KZ;se.utc=QZ;se.local=tK;se.parseZone=eK;se.hasAlignedHourOffset=iK;se.isDST=nK;se.isLocal=rK;se.isUtcOffset=aK;se.isUtc=q3;se.isUTC=q3;se.zoneAbbr=yJ;se.zoneName=_J;se.dates=Mr("dates accessor is deprecated. Use date instead.",sR);se.months=Mr("months accessor is deprecated. Use month instead",O3);se.years=Mr("years accessor is deprecated. Use year instead",R3);se.zone=Mr("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",JZ);se.isDSTShifted=Mr("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",sK);function xJ(n){return Vi(n*1e3)}function vJ(){return Vi.apply(null,arguments).parseZone()}function aR(n){return n}var xi=ow.prototype;xi.calendar=rj;xi.longDateFormat=lj;xi.invalidDate=uj;xi.ordinal=pj;xi.preparse=aR;xi.postformat=aR;xi.relativeTime=gj;xi.pastFuture=yj;xi.set=nj;xi.eras=HK;xi.erasParse=qK;xi.erasConvertYear=XK;xi.erasAbbrRegex=tJ;xi.erasNameRegex=QK;xi.erasNarrowRegex=eJ;xi.months=Oj;xi.monthsShort=Pj;xi.monthsParse=Dj;xi.monthsRegex=Uj;xi.monthsShortRegex=Bj;xi.week=Vj;xi.firstDayOfYear=Yj;xi.firstDayOfWeek=$j;xi.weekdays=eZ;xi.weekdaysMin=nZ;xi.weekdaysShort=iZ;xi.weekdaysParse=rZ;xi.weekdaysRegex=lZ;xi.weekdaysShortRegex=cZ;xi.weekdaysMinRegex=uZ;xi.isPM=fZ;xi.meridiem=gZ;function Sm(n,t,e,i){var s=Ro(),r=za().set(i,t);return s[e](r,n)}function oR(n,t,e){if(bo(n)&&(t=n,n=void 0),n=n||"",t!=null)return Sm(n,t,e,"month");var i,s=[];for(i=0;i<12;i++)s[i]=Sm(n,i,e,"month");return s}function Sw(n,t,e,i){typeof n=="boolean"?(bo(t)&&(e=t,t=void 0),t=t||""):(t=n,e=t,n=!1,bo(t)&&(e=t,t=void 0),t=t||"");var s=Ro(),r=n?s._week.dow:0,a,o=[];if(e!=null)return Sm(t,(e+r)%7,i,"day");for(a=0;a<7;a++)o[a]=Sm(t,(a+r)%7,i,"day");return o}function wJ(n,t){return oR(n,t,"months")}function bJ(n,t){return oR(n,t,"monthsShort")}function MJ(n,t,e){return Sw(n,t,e,"weekdays")}function EJ(n,t,e){return Sw(n,t,e,"weekdaysShort")}function SJ(n,t,e){return Sw(n,t,e,"weekdaysMin")}uh("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(n){var t=n%10,e=si(n%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th";return n+e}});ue.lang=Mr("moment.lang is deprecated. Use moment.locale instead.",uh);ue.langData=Mr("moment.langData is deprecated. Use moment.localeData instead.",Ro);var qa=Math.abs;function TJ(){var n=this._data;return this._milliseconds=qa(this._milliseconds),this._days=qa(this._days),this._months=qa(this._months),n.milliseconds=qa(n.milliseconds),n.seconds=qa(n.seconds),n.minutes=qa(n.minutes),n.hours=qa(n.hours),n.months=qa(n.months),n.years=qa(n.years),this}function hR(n,t,e,i){var s=aa(t,e);return n._milliseconds+=i*s._milliseconds,n._days+=i*s._days,n._months+=i*s._months,n._bubble()}function CJ(n,t){return hR(this,n,t,1)}function AJ(n,t){return hR(this,n,t,-1)}function RE(n){return n<0?Math.floor(n):Math.ceil(n)}function RJ(){var n=this._milliseconds,t=this._days,e=this._months,i=this._data,s,r,a,o,h;return n>=0&&t>=0&&e>=0||n<=0&&t<=0&&e<=0||(n+=RE(B_(e)+t)*864e5,t=0,e=0),i.milliseconds=n%1e3,s=fr(n/1e3),i.seconds=s%60,r=fr(s/60),i.minutes=r%60,a=fr(r/60),i.hours=a%24,t+=fr(a/24),h=fr(lR(t)),e+=h,t-=RE(B_(h)),o=fr(e/12),e%=12,i.days=t,i.months=e,i.years=o,this}function lR(n){return n*4800/146097}function B_(n){return n*146097/4800}function IJ(n){if(!this.isValid())return NaN;var t,e,i=this._milliseconds;if(n=Er(n),n==="month"||n==="quarter"||n==="year")switch(t=this._days+i/864e5,e=this._months+lR(t),n){case"month":return e;case"quarter":return e/3;case"year":return e/12}else switch(t=this._days+Math.round(B_(this._months)),n){case"week":return t/7+i/6048e5;case"day":return t+i/864e5;case"hour":return t*24+i/36e5;case"minute":return t*1440+i/6e4;case"second":return t*86400+i/1e3;case"millisecond":return Math.floor(t*864e5)+i;default:throw new Error("Unknown unit "+n)}}function Io(n){return function(){return this.as(n)}}var cR=Io("ms"),NJ=Io("s"),kJ=Io("m"),LJ=Io("h"),OJ=Io("d"),PJ=Io("w"),FJ=Io("M"),DJ=Io("Q"),zJ=Io("y"),BJ=cR;function UJ(){return aa(this)}function GJ(n){return n=Er(n),this.isValid()?this[n+"s"]():NaN}function Tl(n){return function(){return this.isValid()?this._data[n]:NaN}}var VJ=Tl("milliseconds"),WJ=Tl("seconds"),$J=Tl("minutes"),YJ=Tl("hours"),HJ=Tl("days"),qJ=Tl("months"),XJ=Tl("years");function jJ(){return fr(this.days()/7)}var so=Math.round,Cc={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function ZJ(n,t,e,i,s){return s.relativeTime(t||1,!!e,n,i)}function KJ(n,t,e,i){var s=aa(n).abs(),r=so(s.as("s")),a=so(s.as("m")),o=so(s.as("h")),h=so(s.as("d")),l=so(s.as("M")),u=so(s.as("w")),f=so(s.as("y")),m=r<=e.ss&&["s",r]||r<e.s&&["ss",r]||a<=1&&["m"]||a<e.m&&["mm",a]||o<=1&&["h"]||o<e.h&&["hh",o]||h<=1&&["d"]||h<e.d&&["dd",h];return e.w!=null&&(m=m||u<=1&&["w"]||u<e.w&&["ww",u]),m=m||l<=1&&["M"]||l<e.M&&["MM",l]||f<=1&&["y"]||["yy",f],m[2]=t,m[3]=+n>0,m[4]=i,ZJ.apply(null,m)}function JJ(n){return n===void 0?so:typeof n=="function"?(so=n,!0):!1}function QJ(n,t){return Cc[n]===void 0?!1:t===void 0?Cc[n]:(Cc[n]=t,n==="s"&&(Cc.ss=t-1),!0)}function tQ(n,t){if(!this.isValid())return this.localeData().invalidDate();var e=!1,i=Cc,s,r;return typeof n=="object"&&(t=n,n=!1),typeof n=="boolean"&&(e=n),typeof t=="object"&&(i=Object.assign({},Cc,t),t.s!=null&&t.ss==null&&(i.ss=t.s-1)),s=this.localeData(),r=KJ(this,!e,i,s),e&&(r=s.pastFuture(+this,r)),s.postformat(r)}var o1=Math.abs;function Xl(n){return(n>0)-(n<0)||+n}function Pg(){if(!this.isValid())return this.localeData().invalidDate();var n=o1(this._milliseconds)/1e3,t=o1(this._days),e=o1(this._months),i,s,r,a,o=this.asSeconds(),h,l,u,f;return o?(i=fr(n/60),s=fr(i/60),n%=60,i%=60,r=fr(e/12),e%=12,a=n?n.toFixed(3).replace(/\.?0+$/,""):"",h=o<0?"-":"",l=Xl(this._months)!==Xl(o)?"-":"",u=Xl(this._days)!==Xl(o)?"-":"",f=Xl(this._milliseconds)!==Xl(o)?"-":"",h+"P"+(r?l+r+"Y":"")+(e?l+e+"M":"")+(t?u+t+"D":"")+(s||i||n?"T":"")+(s?f+s+"H":"")+(i?f+i+"M":"")+(n?f+a+"S":"")):"P0D"}var ui=Lg.prototype;ui.isValid=qZ;ui.abs=TJ;ui.add=CJ;ui.subtract=AJ;ui.as=IJ;ui.asMilliseconds=cR;ui.asSeconds=NJ;ui.asMinutes=kJ;ui.asHours=LJ;ui.asDays=OJ;ui.asWeeks=PJ;ui.asMonths=FJ;ui.asQuarters=DJ;ui.asYears=zJ;ui.valueOf=BJ;ui._bubble=RJ;ui.clone=UJ;ui.get=GJ;ui.milliseconds=VJ;ui.seconds=WJ;ui.minutes=$J;ui.hours=YJ;ui.days=HJ;ui.weeks=jJ;ui.months=qJ;ui.years=XJ;ui.humanize=tQ;ui.toISOString=Pg;ui.toString=Pg;ui.toJSON=Pg;ui.locale=K3;ui.localeData=Q3;ui.toIsoString=Mr("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Pg);ui.lang=J3;Ce("X",0,0,"unix");Ce("x",0,0,"valueOf");ye("x",Rg);ye("X",wj);Pi("X",function(n,t,e){e._d=new Date(parseFloat(n)*1e3)});Pi("x",function(n,t,e){e._d=new Date(si(n))});//! moment.js
ue.version="2.30.1";ej(Vi);ue.fn=se;ue.min=WZ;ue.max=$Z;ue.now=YZ;ue.utc=za;ue.unix=xJ;ue.months=wJ;ue.isDate=Uf;ue.locale=uh;ue.invalid=Sg;ue.duration=aa;ue.isMoment=ia;ue.weekdays=MJ;ue.parseZone=vJ;ue.localeData=Ro;ue.isDuration=Np;ue.monthsShort=bJ;ue.weekdaysMin=SJ;ue.defineLocale=yw;ue.updateLocale=vZ;ue.locales=wZ;ue.weekdaysShort=EJ;ue.normalizeUnits=Er;ue.relativeTimeRounding=JJ;ue.relativeTimeThreshold=QJ;ue.calendarFormat=gK;ue.prototype=se;ue.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"};function uR(n){return n.getGeometry()instanceof Ra?new Hi({image:new vl({src:"https://cdn-icons-png.flaticon.com/512/684/684908.png",scale:.04})}):new Hi({stroke:new Xn({color:"#ffcc33",width:2}),fill:new _n({color:"rgba(255, 255, 255, 0.3)"})})}const Tw=n=>n.split(".").pop().toLowerCase(),$f=async(n,t)=>{const e=localStorage.getItem("orhtoId");try{const{data:i}=await El.put(`${Sl}update-annotations/${e}`,t)}catch(i){alert(i.message),console.log(i)}},Cw=async n=>{try{const{data:t}=await El.delete(`${Sl}deleteMeasurementByfeatureId/${n}`)}catch{}},dR=async n=>{try{const{data:t}=await El.get(`${Sl}arthouses/${n}`,{});return t}catch(t){console.log(t)}};function eQ(n){return n.map(e=>new Date(e)).sort((e,i)=>e-i)}function iQ(n){return n.map(i=>new Date(i)).map(i=>ue(i).format("YYYY-MM-DD"))}function nQ(n,t){var e=n.getTime(),i=t.getTime(),s=Math.abs(e-i);return Math.floor(s/(1e3*60*60*24))}const U_=n=>(n==null?void 0:n.length)>20?n.substring(0,20)+"..":n;function fR(n,t,e,i){const s=new Nf({features:new AA().readFeatures(n,{featureProjection:e.getView().getProjection()})}),r=new vu({source:s});r.set("id","file"),e.addLayer(r),Aw(r,t,e,i),e.getView().fit(s.getExtent(),{padding:[50,50,50,50],duration:1e3})}function IE(n,t,e,i,s){const a=new Eq({extractStyles:!0,extractAttributes:!0}).readFeatures(n,{featureProjection:e.getView().getProjection()}),o=new Nf({features:a}),h=new vu({source:o});h.set("id","file"),e.addLayer(h),e.once("rendercomplete",()=>{const l=o.getExtent(),u=[(l[0]+l[2])/2,(l[1]+l[3])/2];e.getView().setCenter(u),e.getView().fit(l),i&&Aw(h,t,e,s)})}function Aw(n,t,e,i){const s=document.getElementById("measurements"),r="layer-"+Date.now();n.set("id",r);const a=rQ(r,t,s.children.length);s.appendChild(a),sQ(a,n,t,r,e,i)}function sQ(n,t,e,i,s,r){const a=n.querySelector('input[type="checkbox"]'),o=n.querySelector("button"),h=n.querySelector(`#sidenav-list-item-r1${n.getAttribute("id").slice(7)}`);a.addEventListener("change",()=>t.setVisible(a.checked)),o.addEventListener("click",async()=>{await Cw(r),s.removeLayer(t),n.remove(),document.getElementById("edit-options").innerHTML=""}),h.addEventListener("click",()=>{document.querySelectorAll("#measurements li").forEach(l=>l.style.backgroundColor=""),n.style.backgroundColor="#636363",s.getView().setCenter(t.getSource().getExtent()),aQ(t,e,i,r)})}function rQ(n,t,e){const i=document.createElement("li");return i.setAttribute("id","li-item"+e),i.setAttribute("data-feature-id",n),console.log({fileName:U_(t)}),i.innerHTML=`
      <div class='flex'>
        <i class="fa-solid fa-layer-group"></i>
        <input type="checkbox" class="measurement-checkbox" data-index="${e}" checked>
        <div id="sidenav-list-item-r1${e}" style="min-width:200px">
          <span>${U_(t)}</span>
        </div>
      </div>
      <button>
        <i class="fas fa-trash" style="font-size:15px;"></i>
      </button>
    `,i}function aQ(n,t,e,i){const s=document.getElementById("edit-options"),r=n.getSource(),a=r.getFeatures(),o=a[0],h=o.getGeometry().getType(),l=Object.keys(o.getProperties()).filter(f=>f!=="geometry"),u=r.getExtent();s.innerHTML=`
      <div class='close-btn-div'>
        <button class='close-btn' id='close-btn'><i class="fa-solid fa-x"></i></button>
      </div>
      <div class='flex align'>
        ${oQ("Layer Name","name",t)}
      </div>
      <div class='shp-details'>
        <h3>File Details</h3>
        <p><strong>Feature Count:</strong> ${a.length}</p>
        <p><strong>Geometry Type:</strong> ${h}</p>
        <p><strong>Extent:</strong> ${u.map(f=>f.toFixed(2)).join(", ")}</p>
      </div>
      <div id="featureDataContainer" style="display: none;"></div>
    `,hQ(n,e,i),lQ(a,l)}function oQ(n,t,e,i="text",s="",r="",a=""){return`
      <div>
        <label for='${t}'>${n}</label>
        <input id='${t}' type="${i}" value="${e}" class='edit-${t}'
          ${s?`min="${s}"`:""} ${r?`max="${r}"`:""} ${a?`step="${a}"`:""}>
      </div>
    `}function hQ(n,t,e){const i=document.getElementById("name"),s=document.getElementById("stroke"),r=document.getElementById("fillColor"),a=document.getElementById("fillOpacity"),o=document.getElementById("close-btn");i.addEventListener("change",h),[s,r,a].forEach(f=>f.addEventListener("input",l)),o.addEventListener("click",u);async function h(){const f=document.querySelector(`li[data-feature-id="${t}"]`);await El.put(`${Sl}updateMeasurementByFeatureId/${e}`,{lable:i.value}),f&&(f.querySelector("span").textContent=i.value)}function l(){const f=new Hi({stroke:new Xn({color:s.value,width:2}),fill:new _n({color:`${r.value}${Math.round(a.value*255).toString(16).padStart(2,"0")}`})});n.setStyle(f)}function u(){document.getElementById("edit-options").innerHTML=""}}function lQ(n,t){const e=document.getElementById("toggleDataBtn"),i=document.getElementById("featureDataContainer");let s=!1;e.addEventListener("click",r);function r(){s=!s,i.style.display=s?"block":"none",e.textContent=s?"Hide Feature Data":"View Feature Data",s&&i.innerHTML===""&&a()}function a(){i.innerHTML="<h4>Feature Data (first 5 features):</h4>";const l=o();i.appendChild(l)}function o(){const l=document.createElement("table");l.style.borderCollapse="collapse",l.style.width="100%";const u=h(t,"th");return l.appendChild(u),n.slice(0,5).forEach(f=>{const m=h(t.map(g=>f.get(g)),"td");l.appendChild(m)}),l}function h(l,u){const f=document.createElement("tr");return l.forEach(m=>{const g=document.createElement(u);g.textContent=m,g.style.border="1px solid black",g.style.padding="5px",f.appendChild(g)}),f}}async function Rw(n){const t=await fetch(n);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.blob()}async function pR(n,t,e=null){let i;e?i=[await Rw(e)]:i=n.target.files;for(let s of i)try{const r=await mR(s);let a,o;s.name.endsWith(".zip")?(a=await gR(r),o="zip"):(a=await yR(r),o="shp");const h="feature-"+Date.now(),l=new FormData,u={id:h,name:s.name};l.append("data",u),l.append("id",h),l.append("lable",s.name),l.append("file",s),l.append("type",o),await $f("",l),fR(a,s.name,t,h)}catch(r){console.error(`Error processing ${s.name}:`,r),alert(`Error processing ${s.name}: ${r.message}`)}}async function cQ(n,t,e,i){const s=[await Rw(t)];for(let r of s)try{const a=await mR(r);let o,h;console.log(t),t.endsWith(".zip")?(o=await gR(a),h="zip"):(o=await yR(a),h="shp"),console.log(i),fR(o,i,n,e)}catch(a){console.error(`Error processing ${i}:`,a),alert(`Error processing ${i}: ${a.message}`)}}function mR(n){return new Promise((t,e)=>{const i=new FileReader;i.onload=s=>t(s.target.result),i.onerror=s=>e(s),i.readAsArrayBuffer(n)})}async function gR(n){const t=await SA.loadAsync(n),e=t.file(/.shp$/i)[0],i=t.file(/.dbf$/i)[0];if(!e||!i)throw new Error("Required files not found in the zip");const s=await e.async("arraybuffer"),r=await i.async("arraybuffer"),a=await mm.exports.parseShp(s),o=await mm.exports.parseDbf(r);return uQ(a,o)}async function yR(n){return{type:"FeatureCollection",features:(await mm.exports.parseShp(n)).map(e=>({type:"Feature",properties:{},geometry:e}))}}function uQ(n,t){return{type:"FeatureCollection",features:n.map((e,i)=>({type:"Feature",properties:t[i],geometry:e}))}}async function Fg(n,t=null,e,i=!0,s=null,r=null){if(t)try{const a=t.split(".").pop().toLowerCase();let o;if(a==="kmz"){const h=await Rw(t);o=await NE(h)}else if(a==="kml")o=await dQ(t);else throw new Error("Unsupported file type");console.log(r),IE(o,r,e,i,s)}catch(a){console.error("Error processing presigned KML:",a)}else if(n&&n.target.files){const a=n.target.files;for(let o of a)try{let h,l;o.name.toLowerCase().endsWith(".kmz")?(h=await NE(o),l="kmz"):(h=await fQ(o),l="kml");const u=new FormData,f="feature-"+Date.now(),m={id:f,name:o.name};u.append("data",m),u.append("file",o),u.append("id",f),u.append("label",o.name),u.append("type",l),await $f("",u),console.log(o.name),IE(h,o.name,e,i,f)}catch(h){console.error(`Error processing ${o.name}:`,h)}}}async function dQ(n){try{const t=await fetch(n);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.text()}catch(t){throw console.error("Error fetching KML from presigned URL:",t),t}}function fQ(n){return new Promise((t,e)=>{const i=new FileReader;i.onload=s=>t(s.target.result),i.onerror=s=>e(s),i.readAsText(n)})}async function NE(n){const e=await new SA().loadAsync(n),i=Object.values(e.files).find(s=>s.name.toLowerCase().endsWith(".kml"));if(!i)throw new Error("No KML file found in KMZ");return await i.async("text")}function pQ(n,t,e,i,s,r,a,o,h){const l=document.getElementById("edit-options"),u=e.extent_,f=o,m=[(u[0]+u[2])/2,(u[1]+u[3])/2],g=mu(m,r.getView().getProjection(),"EPSG:32643"),y=typeof g[1]=="number"?g[1].toFixed(6):"N/A",_=typeof g[0]=="number"?g[0].toFixed(6):"N/A";l.innerHTML=`
      <div class='close-btn-div'>
        <button class='close-btn' id='close-btn'>
          <i class="fa-solid fa-x"></i>
        </button>
      </div>
      <div class='flex align'>
        <div>
          <label for='name'>Name</label>
          <input type="text" value="${n}" class='edit-name' id='name'>
        </div>
        <div>
          <label for='stroke'>Stroke</label>
          <input id='stroke' type="color" value="#636363" class='edit-stroke'>
        </div>
        ${s?`
        <div>
          <label for="fillColor">Fill</label>
          <input type="color" id="fillColor" value="#636363" class='edit-fill'>
        </div>
        `:""}
      </div>
      ${s?`
      <div class='opacity-div'>
        <label for="fillOpacity">Fill Opacity:</label>
        <input type="range" id="fillOpacity" min="0" max="1" step="0.01" value="0.2" class='edit-opacity'>
      </div>
      `:""}
      <br>
      <h3>Measurement: ${t}</h3>
      <h4>Center Coordinates: ${y}, ${_}</h4>
      <div class='conversions'>
        ${s?`
        <p>meters: ${Wn(q0(f,"meters"),"meters",!0)}</p>
        <p>hectares: ${Wn(q0(f,"hectares"),"hectares",!0)}</p>
        <p>acres: ${Wn(q0(f,"acres"),"acres",!0)}</p>
        <p>square kilometers: ${Wn(q0(f,"kilometers"),"square kilometers",!0)}</p>
        `:`
        <p>meters: ${Wn(H0(f,"meters"),"meters",!1)}</p>
        <p>Kilometers: ${Wn(H0(f,"kilometers"),"kilometers",!1)}</p>
        <p>feet: ${Wn(H0(f,"feet"),"feet",!1)}</p>
        <p>miles: ${Wn(H0(f,"miles"),"miles",!1)}</p>
        `}
      </div>
      <button id="save-btn-line">Save</button>
    `;const w=l.querySelector("input[type='text']"),M=l.querySelector("#stroke"),T=document.getElementById("save-btn-line");T.style.display="none";let A,R;s&&(A=l.querySelector("#fillColor"),R=l.querySelector("#fillOpacity"));const I=a.getFeatureById(i),L=()=>{if(T.style.display=="none"&&(T.style.display="block"),I){const Y=new Hi({stroke:new Xn({color:M.value,width:2}),...s&&{fill:new _n({color:`${A.value}${Math.round(R.value*255).toString(16).padStart(2,"0")}`})}});I.setStyle(Y),I.set("storedStyle",Y)}};w.addEventListener("change",function(){T.style.display="block";const Y=document.querySelector(`li[data-feature-id="${i}"]`);Y.querySelector("span").textContent=`${this.value}: ${t}`}),M.addEventListener("input",L),s&&(A.addEventListener("input",L),R.addEventListener("input",L)),document.getElementById("close-btn").addEventListener("click",()=>{l.innerHTML=""});const k=M.value==h.style.strokeColor?h.style.strokeColor:M.value;T.addEventListener("click",()=>{var Y;_R(i,w.value,k,A?A.value:h.style.fillColor,R?R.value:(Y=h==null?void 0:h.style)==null?void 0:Y.fillOpacity,I)})}function mQ(n,t,e,i,s,r,a,o){const h=document.getElementById("edit-options"),l=e.getExtent(),u=[(l[0]+l[2])/2,(l[1]+l[3])/2],f=mu(u,r.getView().getProjection(),"EPSG:4326"),m=typeof f[1]=="number"?f[1].toFixed(6):"N/A",g=typeof f[0]=="number"?f[0].toFixed(6):"N/A";h.innerHTML=`
      <div class='close-btn-div'>
        <button class='close-btn' id='close-btn'>
          <i class="fa-solid fa-x"></i>
        </button>
      </div>
      <div class='flex align'>
        <div>
          <label for='name'>Name</label>
          <input type="text" value="${n}" class='edit-name' id='name'>
        </div>
        <div>
          <label for='stroke'>Stroke</label>
          <input id='stroke' type="color" value="#636363" class='edit-stroke'>
        </div>
        ${s?`
        <div>
          <label for="fillColor">Fill Color:</label>
          <input type="color" id="fillColor" value="#636363" class='edit-fill'>
        </div>
        `:""}
      </div>
      ${s?`
      <div class='opacity-div'>
        <label for="fillOpacity">Fill Opacity:</label>
        <input type="range" id="fillOpacity" min="0" max="1" step="0.01" value="0.2" class='edit-opacity'>
      </div>
      `:""}
      <br>
      <h3>Measurement: ${t}</h3>
      <h4>Center Coordinates: ${m}, ${g}</h4>
      <div class='conversions'>
        ${s?`
        <p>meters: ${Wn(Tc(e,"meters"),"meters",!0)}</p>
        <p>hectares: ${Wn(Tc(e,"hectares"),"hectares",!0)}</p>
        <p>acres: ${Wn(Tc(e,"acres"),"acres",!0)}</p>
        <p>square kilometers: ${Wn(Tc(e,"kilometers"),"square kilometers",!0)}</p>
        `:`
        <p>meters: ${Wn(Sc(e,"meters"),"meters",!1)}</p>
        <p>Kilometers: ${Wn(Sc(e,"kilometers"),"kilometers",!1)}</p>
        <p>feet: ${Wn(Sc(e,"feet"),"feet",!1)}</p>
        <p>miles: ${Wn(Sc(e,"miles"),"miles",!1)}</p>
        `}
      </div>
            <button id="save-btn">Save</button>
    `;const y=h.querySelector("input[type='text']"),_=h.querySelector("#stroke");let w,M;const T=document.getElementById("save-btn");T.style.display="none",s&&(w=h.querySelector("#fillColor"),M=h.querySelector("#fillOpacity"));const A=()=>{T.style.display="block";const L=a.getFeatureById(i);if(L){const k=new Hi({stroke:new Xn({color:_.value,width:2}),...s&&{fill:new _n({color:`${w.value}${Math.round(M.value*255).toString(16).padStart(2,"0")}`})}});L.setStyle(k),L.set("storedStyle",k)}};y.addEventListener("change",function(){T.style.display="block";const L=document.querySelector(`li[data-feature-id="${i}"]`);L.querySelector("span").textContent=`${this.value}: ${t}`}),_.addEventListener("input",A),s&&(w.addEventListener("input",A),M.addEventListener("input",A)),document.getElementById("close-btn").addEventListener("click",()=>{h.innerHTML=""});const R=a.getFeatureById(i),I=_.value==o.style.strokeColor?o.style.strokeColor:_.value;T.addEventListener("click",()=>{var L;_R(i,y.value,I,w?w.value:o.style.fillColor,M?M.value:(L=o==null?void 0:o.style)==null?void 0:L.fillOpacity,R)})}function h1(n,t){n=n.replace(/^#/,"");let e=parseInt(n,16),i=e>>16&255,s=e>>8&255,r=e&255;return`rgba(${i}, ${s}, ${r}, ${t})`}async function _R(n,t,e,i,s,r){try{if(r){const a=r.getGeometry();r.set("name",t),r.set("strokeColor",e),i!==null&&(r.set("fillColor",h1(i,s)),r.set("fillOpacity",s)),console.log({id:n,type:a.getType(),label:t,coordinates:a.getCoordinates(),style:{strokeColor:e,fillColor:h1(i,s),fillOpacity:s},properties:r.getProperties()}),console.log(r);const o=await El.put(`${Sl}updateMeasurementByFeatureId/${n}`,{id:n,type:a.getType(),label:t,coordinates:a.getCoordinates(),style:{strokeColor:e,fillColor:h1(i,s),fillOpacity:s},properties:r.getProperties()});document.getElementById("save-btn-line").style.display="none"}}catch(a){console.log(a)}}function Tm(n,t,e){const i=e.getFeatureById(n);if(!!i)if(t.checked){const s=i.get("storedStyle")||null;i.setStyle(s)}else i.set("storedStyle",i.getStyle()),i.setStyle(new Hi)}function gQ(n){const t=n.getGeometry(),e=new Hi({fill:new _n({color:"rgba(255, 255, 255, 0.3)"}),stroke:new Xn({color:"#ffcc33",width:1}),image:new _u({radius:7,fill:new _n({color:"#ffcc33"})})}),i="feature-"+Date.now();return n.setId(i),{id:i,type:t.getType(),coordinates:t.getCoordinates(),style:{strokeColor:e.getStroke().getColor(),strokeWidth:e.getStroke().getWidth(),fillOpacity:.3,fillColor:e.getFill()?e.getFill().getColor():null},properties:n.getProperties()}}async function xR(n,t,e,i,s,r,a,o,h){e.className="tooltip tooltip-static",i.setOffset([0,-7]),r.innerHTML="";const l=gQ(n.feature),u=n.feature.getGeometry(),f=document.getElementById("unitConversion").value,m=t?xx(u):_x(u),g=t?Tc(u,f):Sc(u,f),y=Wn(g,f,t);document.getElementById("edit-options");const _=document.getElementById("measurements"),w=document.getElementById("labelInput").value||"Unnamed",M=_.children.length,T="feature-"+Date.now(),A={...l,label:document.getElementById("labelInput").value||"Unnamed",measurement:y,orthoId:h,measurmentValue:m},R=vR(w,y,M,T,t),I=R.querySelector("input[type='checkbox']"),L=R.querySelector("button"),k=R.querySelector(`#sidenav-list-item-r1${M}`);I.addEventListener("change",()=>Tm(T,I,a)),L.addEventListener("click",()=>wR(R,T,a)),k.addEventListener("click",()=>LE(R,u,w,y,T,t,a,o,l)),_.appendChild(R),LE(R,u,w,y,T,t,a,o,l),document.querySelectorAll(".measurement-checkbox").forEach(K=>{const rt=K.closest("li").getAttribute("data-feature-id");Tm(rt,K,a)}),await $f(h,{data:A,type:t?"polygon":"line"})}function yQ(n,t){var r,a,o,h;let e;if(console.log(n),n.type==="Polygon")e=new ir(n.coordinates);else if(n.type==="LineString")e=new Ia(n.coordinates);else throw new Error("Unsupported geometry type: "+n.type);const i=new mr(e);i.setId(n.id);const s=new Hi({stroke:new Xn({color:(r=n.style)==null?void 0:r.strokeColor,width:1}),fill:(a=n.style)!=null&&a.fillColor?new _n({color:(o=n.style)==null?void 0:o.fillColor}):null});return console.log(`${(h=n.style)==null?void 0:h.fillColor}`),i.setStyle(s),i.set("storedStyle",s),n.properties&&i.setProperties(n.properties.geometry),i}async function kE(n,t,e,i){const s=document.getElementById("measurements"),r=document.getElementById("labelInput").value||n.label,a=s.children.length,o=vR(n.label,n.measurement,a,n.id,t),h=yQ(n);e.addFeature(h);const l=o.querySelector("input[type='checkbox']"),u=o.querySelector("button"),f=o.querySelector(`#sidenav-list-item-r1${a}`);l.addEventListener("change",()=>Tm(n.id,l,e)),u.addEventListener("click",()=>wR(o,n.id,e)),f.addEventListener("click",()=>{xQ(o,n.properties.geometry,r,n.measurement,n.id,t,e,i,n.measurmentValue,n)}),s.appendChild(o),document.querySelectorAll(".measurement-checkbox").forEach(g=>{const y=g.closest("li").getAttribute("data-feature-id");Tm(y,g,e)})}function vR(n,t,e,i,s){const r=document.createElement("li");return r.setAttribute("id","li-item"+e),r.setAttribute("data-feature-id",i),r.innerHTML=`
    <div class='flex'>
      <i class="fa-solid ${s?"fa-draw-polygon":"fa-grip-lines-vertical"}"></i>
      <input type="checkbox" class="measurement-checkbox" data-index="${e}" checked>
      <div id="sidenav-list-item-r1${e}" style="min-width:200px">
        <span>${U_(n)}</span>
      </div>
    </div>
    <button>
      <i class="fas fa-trash" style="font-size:15px;"></i>
    </button>
  `,r}async function wR(n,t,e){const i=document.getElementById("edit-options"),s=document.getElementById("measurements");i.innerHTML="",s.removeChild(n);const r=e.getFeatureById(t);r&&e.removeFeature(r),await Cw(t),_Q()}function _Q(){document.getElementById("measurements").querySelectorAll("li").forEach((e,i)=>{e.querySelector("input[type='checkbox']").setAttribute("data-index",i),e.setAttribute("value",i)})}function LE(n,t,e,i,s,r,a,o,h){bR(n,s,a),mQ(e,i,t,s,r,o,a,h),wQ(t,o)}function xQ(n,t,e,i,s,r,a,o,h,l){bR(n,s,a),pQ(e,i,t,s,r,o,a,h,l),vQ(t,o)}function bR(n,t,e){document.getElementById("measurements").querySelectorAll("li").forEach(a=>{a.style.backgroundColor="";const o=a.getAttribute("data-feature-id"),h=e.getFeatureById(o);if(h){const l=h.get("storedStyle")||null;h.setStyle(l)}}),n.style.backgroundColor="#636363";const r=e.getFeatureById(t);if(r){const a=new Hi({stroke:new Xn({color:"black",width:3}),fill:new _n({color:"rgba(0, 255, 0, 0.2)"}),image:new _u({radius:7,fill:new _n({color:"black"})})});r.setStyle(a)}}function vQ(n,t){const e=n.extent_,i=[(e[0]+e[2])/2,(e[1]+e[3])/2];t.getView().setCenter(i),t.getView().fit(e)}function wQ(n,t){const e=n.getExtent(),i=[(e[0]+e[2])/2,(e[1]+e[3])/2];t.getView().setCenter(i),t.getView().fit(e)}const OE={VERTEX:"vertex",FRAGMENT:"fragment"},gn={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Iw=["x","y","z","w"];/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const MR="160",G_=0,bQ=1,PE=1,FE=100,DE=204,zE=205,BE=3,Nw=0,V_=0,MQ=1,EQ=2,SQ=3,TQ=4;const ER=300;const UE=1e3,bd=1001,GE=1002,vh=1003,CQ=1004;const SR=1006;const TR=1008,AQ=1009,CR=1014,kw=1015,RQ=1016,IQ=1020,NQ=1023,Lp=1026,VE=1027,Cm=2300,Am=2301,l1=2302,WE=2400,$E=2401,YE=2402;const kQ=3e3,Op=3001,LQ=3200,wh=0,OQ=1,Wc="",tr="srgb",Cl="srgb-linear",PQ="display-p3",AR="display-p3-linear",W_="linear",HE="srgb",qE="rec709",XE="p3",jl=7680,jE=519,FQ=513,DQ=515,Rm=35044,RR=35048,il=2e3,Im=2001;class Al{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const s=this._listeners[t];if(s!==void 0){const r=s.indexOf(e);r!==-1&&s.splice(r,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const i=this._listeners[t.type];if(i!==void 0){t.target=this;const s=i.slice(0);for(let r=0,a=s.length;r<a;r++)s[r].call(this,t);t.target=null}}}const es=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let ZE=1234567;const Fd=Math.PI/180,uf=180/Math.PI;function _o(){const n=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(es[n&255]+es[n>>8&255]+es[n>>16&255]+es[n>>24&255]+"-"+es[t&255]+es[t>>8&255]+"-"+es[t>>16&15|64]+es[t>>24&255]+"-"+es[e&63|128]+es[e>>8&255]+"-"+es[e>>16&255]+es[e>>24&255]+es[i&255]+es[i>>8&255]+es[i>>16&255]+es[i>>24&255]).toLowerCase()}function hs(n,t,e){return Math.max(t,Math.min(e,n))}function Lw(n,t){return(n%t+t)%t}function zQ(n,t,e,i,s){return i+(n-t)*(s-i)/(e-t)}function BQ(n,t,e){return n!==t?(e-n)/(t-n):0}function Dd(n,t,e){return(1-e)*n+e*t}function UQ(n,t,e,i){return Dd(n,t,1-Math.exp(-e*i))}function GQ(n,t=1){return t-Math.abs(Lw(n,t*2)-t)}function VQ(n,t,e){return n<=t?0:n>=e?1:(n=(n-t)/(e-t),n*n*(3-2*n))}function WQ(n,t,e){return n<=t?0:n>=e?1:(n=(n-t)/(e-t),n*n*n*(n*(n*6-15)+10))}function $Q(n,t){return n+Math.floor(Math.random()*(t-n+1))}function YQ(n,t){return n+Math.random()*(t-n)}function HQ(n){return n*(.5-Math.random())}function qQ(n){n!==void 0&&(ZE=n);let t=ZE+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function XQ(n){return n*Fd}function jQ(n){return n*uf}function ZQ(n){return(n&n-1)===0&&n!==0}function KQ(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function JQ(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function QQ(n,t,e,i,s){const r=Math.cos,a=Math.sin,o=r(e/2),h=a(e/2),l=r((t+i)/2),u=a((t+i)/2),f=r((t-i)/2),m=a((t-i)/2),g=r((i-t)/2),y=a((i-t)/2);switch(s){case"XYX":n.set(o*u,h*f,h*m,o*l);break;case"YZY":n.set(h*m,o*u,h*f,o*l);break;case"ZXZ":n.set(h*f,h*m,o*u,o*l);break;case"XZX":n.set(o*u,h*y,h*g,o*l);break;case"YXY":n.set(h*g,o*u,h*y,o*l);break;case"ZYZ":n.set(h*y,h*g,o*u,o*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Sa(n,t){switch(t.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function ki(n,t){switch(t.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const IR={DEG2RAD:Fd,RAD2DEG:uf,generateUUID:_o,clamp:hs,euclideanModulo:Lw,mapLinear:zQ,inverseLerp:BQ,lerp:Dd,damp:UQ,pingpong:GQ,smoothstep:VQ,smootherstep:WQ,randInt:$Q,randFloat:YQ,randFloatSpread:HQ,seededRandom:qQ,degToRad:XQ,radToDeg:jQ,isPowerOfTwo:ZQ,ceilPowerOfTwo:KQ,floorPowerOfTwo:JQ,setQuaternionFromProperEuler:QQ,normalize:ki,denormalize:Sa};class hi{constructor(t=0,e=0){hi.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6],this.y=s[1]*e+s[4]*i+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(hs(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),s=Math.sin(e),r=this.x-t.x,a=this.y-t.y;return this.x=r*i-a*s+t.x,this.y=r*s+a*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class oa{constructor(t,e,i,s,r,a,o,h,l){oa.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,i,s,r,a,o,h,l)}set(t,e,i,s,r,a,o,h,l){const u=this.elements;return u[0]=t,u[1]=s,u[2]=o,u[3]=e,u[4]=r,u[5]=h,u[6]=i,u[7]=a,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,r=this.elements,a=i[0],o=i[3],h=i[6],l=i[1],u=i[4],f=i[7],m=i[2],g=i[5],y=i[8],_=s[0],w=s[3],M=s[6],T=s[1],A=s[4],R=s[7],I=s[2],L=s[5],k=s[8];return r[0]=a*_+o*T+h*I,r[3]=a*w+o*A+h*L,r[6]=a*M+o*R+h*k,r[1]=l*_+u*T+f*I,r[4]=l*w+u*A+f*L,r[7]=l*M+u*R+f*k,r[2]=m*_+g*T+y*I,r[5]=m*w+g*A+y*L,r[8]=m*M+g*R+y*k,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=t[8];return e*a*u-e*o*l-i*r*u+i*o*h+s*r*l-s*a*h}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=t[8],f=u*a-o*l,m=o*h-u*r,g=l*r-a*h,y=e*f+i*m+s*g;if(y===0)return this.set(0,0,0,0,0,0,0,0,0);const _=1/y;return t[0]=f*_,t[1]=(s*l-u*i)*_,t[2]=(o*i-s*a)*_,t[3]=m*_,t[4]=(u*e-s*h)*_,t[5]=(s*r-o*e)*_,t[6]=g*_,t[7]=(i*h-l*e)*_,t[8]=(a*e-i*r)*_,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,s,r,a,o){const h=Math.cos(r),l=Math.sin(r);return this.set(i*h,i*l,-i*(h*a+l*o)+a+t,-s*l,s*h,-s*(-l*a+h*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(c1.makeScale(t,e)),this}rotate(t){return this.premultiply(c1.makeRotation(-t)),this}translate(t,e){return this.premultiply(c1.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,i=t.elements;for(let s=0;s<9;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const c1=new oa;function ttt(n){for(let t=n.length-1;t>=0;--t)if(n[t]>=65535)return!0;return!1}function KE(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}const JE={};function Pp(n){n in JE||(JE[n]=!0,console.warn(n))}const QE=new oa().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),tS=new oa().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Q0={[Cl]:{transfer:W_,primaries:qE,toReference:n=>n,fromReference:n=>n},[tr]:{transfer:HE,primaries:qE,toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[AR]:{transfer:W_,primaries:XE,toReference:n=>n.applyMatrix3(tS),fromReference:n=>n.applyMatrix3(QE)},[PQ]:{transfer:HE,primaries:XE,toReference:n=>n.convertSRGBToLinear().applyMatrix3(tS),fromReference:n=>n.applyMatrix3(QE).convertLinearToSRGB()}},ett=new Set([Cl,AR]),kr={enabled:!0,_workingColorSpace:Cl,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!ett.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,t,e){if(this.enabled===!1||t===e||!t||!e)return n;const i=Q0[t].toReference,s=Q0[e].fromReference;return s(i(n))},fromWorkingColorSpace:function(n,t){return this.convert(n,this._workingColorSpace,t)},toWorkingColorSpace:function(n,t){return this.convert(n,t,this._workingColorSpace)},getPrimaries:function(n){return Q0[n].primaries},getTransfer:function(n){return n===Wc?W_:Q0[n].transfer}};function $c(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function u1(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Zl;class itt{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{Zl===void 0&&(Zl=KE("canvas")),Zl.width=t.width,Zl.height=t.height;const i=Zl.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=Zl}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=KE("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const s=i.getImageData(0,0,t.width,t.height),r=s.data;for(let a=0;a<r.length;a++)r[a]=$c(r[a]/255)*255;return i.putImageData(s,0,0),e}else if(t.data){const e=t.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor($c(e[i]/255)*255):e[i]=$c(e[i]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let ntt=0;class NR{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:ntt++}),this.uuid=_o(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let a=0,o=s.length;a<o;a++)s[a].isDataTexture?r.push(d1(s[a].image)):r.push(d1(s[a]))}else r=d1(s);i.url=r}return e||(t.images[this.uuid]=i),i}}function d1(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?itt.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let stt=0;class Xr extends Al{constructor(t=Xr.DEFAULT_IMAGE,e=Xr.DEFAULT_MAPPING,i=bd,s=bd,r=SR,a=TR,o=NQ,h=AQ,l=Xr.DEFAULT_ANISOTROPY,u=Wc){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:stt++}),this.uuid=_o(),this.name="",this.source=new NR(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=r,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=h,this.offset=new hi(0,0),this.repeat=new hi(1,1),this.center=new hi(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new oa,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof u=="string"?this.colorSpace=u:(Pp("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=u===Op?tr:Wc),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==ER)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case UE:t.x=t.x-Math.floor(t.x);break;case bd:t.x=t.x<0?0:1;break;case GE:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case UE:t.y=t.y-Math.floor(t.y);break;case bd:t.y=t.y<0?0:1;break;case GE:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return Pp("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===tr?Op:kQ}set encoding(t){Pp("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===Op?tr:Wc}}Xr.DEFAULT_IMAGE=null;Xr.DEFAULT_MAPPING=ER;Xr.DEFAULT_ANISOTROPY=1;class $n{constructor(t=0,e=0,i=0,s=1){$n.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=s}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,s){return this.x=t,this.y=e,this.z=i,this.w=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,r=this.w,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*s+a[12]*r,this.y=a[1]*e+a[5]*i+a[9]*s+a[13]*r,this.z=a[2]*e+a[6]*i+a[10]*s+a[14]*r,this.w=a[3]*e+a[7]*i+a[11]*s+a[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,s,r;const h=t.elements,l=h[0],u=h[4],f=h[8],m=h[1],g=h[5],y=h[9],_=h[2],w=h[6],M=h[10];if(Math.abs(u-m)<.01&&Math.abs(f-_)<.01&&Math.abs(y-w)<.01){if(Math.abs(u+m)<.1&&Math.abs(f+_)<.1&&Math.abs(y+w)<.1&&Math.abs(l+g+M-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const A=(l+1)/2,R=(g+1)/2,I=(M+1)/2,L=(u+m)/4,k=(f+_)/4,Y=(y+w)/4;return A>R&&A>I?A<.01?(i=0,s=.707106781,r=.707106781):(i=Math.sqrt(A),s=L/i,r=k/i):R>I?R<.01?(i=.707106781,s=0,r=.707106781):(s=Math.sqrt(R),i=L/s,r=Y/s):I<.01?(i=.707106781,s=.707106781,r=0):(r=Math.sqrt(I),i=k/r,s=Y/r),this.set(i,s,r,e),this}let T=Math.sqrt((w-y)*(w-y)+(f-_)*(f-_)+(m-u)*(m-u));return Math.abs(T)<.001&&(T=1),this.x=(w-y)/T,this.y=(f-_)/T,this.z=(m-u)/T,this.w=Math.acos((l+g+M-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class $_ extends Al{constructor(t=1,e=1,i={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new $n(0,0,t,e),this.scissorTest=!1,this.viewport=new $n(0,0,t,e);const s={width:t,height:e,depth:1};i.encoding!==void 0&&(Pp("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=i.encoding===Op?tr:Wc),i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:SR,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},i),this.texture=new Xr(s,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps,this.texture.internalFormat=i.internalFormat,this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}setSize(t,e,i=1){(this.width!==t||this.height!==e||this.depth!==i)&&(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new NR(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class rtt extends Xr{constructor(t=null,e=1,i=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:s},this.magFilter=vh,this.minFilter=vh,this.wrapR=bd,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Au{constructor(t=0,e=0,i=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=s}static slerpFlat(t,e,i,s,r,a,o){let h=i[s+0],l=i[s+1],u=i[s+2],f=i[s+3];const m=r[a+0],g=r[a+1],y=r[a+2],_=r[a+3];if(o===0){t[e+0]=h,t[e+1]=l,t[e+2]=u,t[e+3]=f;return}if(o===1){t[e+0]=m,t[e+1]=g,t[e+2]=y,t[e+3]=_;return}if(f!==_||h!==m||l!==g||u!==y){let w=1-o;const M=h*m+l*g+u*y+f*_,T=M>=0?1:-1,A=1-M*M;if(A>Number.EPSILON){const I=Math.sqrt(A),L=Math.atan2(I,M*T);w=Math.sin(w*L)/I,o=Math.sin(o*L)/I}const R=o*T;if(h=h*w+m*R,l=l*w+g*R,u=u*w+y*R,f=f*w+_*R,w===1-o){const I=1/Math.sqrt(h*h+l*l+u*u+f*f);h*=I,l*=I,u*=I,f*=I}}t[e]=h,t[e+1]=l,t[e+2]=u,t[e+3]=f}static multiplyQuaternionsFlat(t,e,i,s,r,a){const o=i[s],h=i[s+1],l=i[s+2],u=i[s+3],f=r[a],m=r[a+1],g=r[a+2],y=r[a+3];return t[e]=o*y+u*f+h*g-l*m,t[e+1]=h*y+u*m+l*f-o*g,t[e+2]=l*y+u*g+o*m-h*f,t[e+3]=u*y-o*f-h*m-l*g,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,s){return this._x=t,this._y=e,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const i=t._x,s=t._y,r=t._z,a=t._order,o=Math.cos,h=Math.sin,l=o(i/2),u=o(s/2),f=o(r/2),m=h(i/2),g=h(s/2),y=h(r/2);switch(a){case"XYZ":this._x=m*u*f+l*g*y,this._y=l*g*f-m*u*y,this._z=l*u*y+m*g*f,this._w=l*u*f-m*g*y;break;case"YXZ":this._x=m*u*f+l*g*y,this._y=l*g*f-m*u*y,this._z=l*u*y-m*g*f,this._w=l*u*f+m*g*y;break;case"ZXY":this._x=m*u*f-l*g*y,this._y=l*g*f+m*u*y,this._z=l*u*y+m*g*f,this._w=l*u*f-m*g*y;break;case"ZYX":this._x=m*u*f-l*g*y,this._y=l*g*f+m*u*y,this._z=l*u*y-m*g*f,this._w=l*u*f+m*g*y;break;case"YZX":this._x=m*u*f+l*g*y,this._y=l*g*f+m*u*y,this._z=l*u*y-m*g*f,this._w=l*u*f-m*g*y;break;case"XZY":this._x=m*u*f-l*g*y,this._y=l*g*f-m*u*y,this._z=l*u*y+m*g*f,this._w=l*u*f+m*g*y;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],r=e[8],a=e[1],o=e[5],h=e[9],l=e[2],u=e[6],f=e[10],m=i+o+f;if(m>0){const g=.5/Math.sqrt(m+1);this._w=.25/g,this._x=(u-h)*g,this._y=(r-l)*g,this._z=(a-s)*g}else if(i>o&&i>f){const g=2*Math.sqrt(1+i-o-f);this._w=(u-h)/g,this._x=.25*g,this._y=(s+a)/g,this._z=(r+l)/g}else if(o>f){const g=2*Math.sqrt(1+o-i-f);this._w=(r-l)/g,this._x=(s+a)/g,this._y=.25*g,this._z=(h+u)/g}else{const g=2*Math.sqrt(1+f-i-o);this._w=(a-s)/g,this._x=(r+l)/g,this._y=(h+u)/g,this._z=.25*g}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(hs(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(i===0)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,r=t._z,a=t._w,o=e._x,h=e._y,l=e._z,u=e._w;return this._x=i*u+a*o+s*l-r*h,this._y=s*u+a*h+r*o-i*l,this._z=r*u+a*l+i*h-s*o,this._w=a*u-i*o-s*h-r*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const i=this._x,s=this._y,r=this._z,a=this._w;let o=a*t._w+i*t._x+s*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=i,this._y=s,this._z=r,this;const h=1-o*o;if(h<=Number.EPSILON){const g=1-e;return this._w=g*a+e*this._w,this._x=g*i+e*this._x,this._y=g*s+e*this._y,this._z=g*r+e*this._z,this.normalize(),this}const l=Math.sqrt(h),u=Math.atan2(l,o),f=Math.sin((1-e)*u)/l,m=Math.sin(e*u)/l;return this._w=a*f+this._w*m,this._x=i*f+this._x*m,this._y=s*f+this._y*m,this._z=r*f+this._z*m,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),s=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(s),i*Math.sin(r),i*Math.cos(r),e*Math.sin(s))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Lt{constructor(t=0,e=0,i=0){Lt.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(eS.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(eS.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*s,this.y=r[1]*e+r[4]*i+r[7]*s,this.z=r[2]*e+r[5]*i+r[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,r=t.elements,a=1/(r[3]*e+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*s+r[12])*a,this.y=(r[1]*e+r[5]*i+r[9]*s+r[13])*a,this.z=(r[2]*e+r[6]*i+r[10]*s+r[14])*a,this}applyQuaternion(t){const e=this.x,i=this.y,s=this.z,r=t.x,a=t.y,o=t.z,h=t.w,l=2*(a*s-o*i),u=2*(o*e-r*s),f=2*(r*i-a*e);return this.x=e+h*l+a*f-o*u,this.y=i+h*u+o*l-r*f,this.z=s+h*f+r*u-a*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*s,this.y=r[1]*e+r[5]*i+r[9]*s,this.z=r[2]*e+r[6]*i+r[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,r=t.z,a=e.x,o=e.y,h=e.z;return this.x=s*h-r*o,this.y=r*a-i*h,this.z=i*o-s*a,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return f1.copy(this).projectOnVector(t),this.sub(f1)}reflect(t){return this.sub(f1.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(hs(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this.x=s*Math.sin(i),this.y=Math.cos(e)*t,this.z=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const f1=new Lt,eS=new Au;class Yf{constructor(t=new Lt(1/0,1/0,1/0),e=new Lt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e+=3)this.expandByPoint(Lr.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,i=t.count;e<i;e++)this.expandByPoint(Lr.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=Lr.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(i!==void 0){const r=i.getAttribute("position");if(e===!0&&r!==void 0&&t.isInstancedMesh!==!0)for(let a=0,o=r.count;a<o;a++)t.isMesh===!0?t.getVertexPosition(a,Lr):Lr.fromBufferAttribute(r,a),Lr.applyMatrix4(t.matrixWorld),this.expandByPoint(Lr);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),tp.copy(t.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),tp.copy(i.boundingBox)),tp.applyMatrix4(t.matrixWorld),this.union(tp)}const s=t.children;for(let r=0,a=s.length;r<a;r++)this.expandByObject(s[r],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Lr),Lr.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(sd),ep.subVectors(this.max,sd),Kl.subVectors(t.a,sd),Jl.subVectors(t.b,sd),Ql.subVectors(t.c,sd),$o.subVectors(Jl,Kl),Yo.subVectors(Ql,Jl),Uh.subVectors(Kl,Ql);let e=[0,-$o.z,$o.y,0,-Yo.z,Yo.y,0,-Uh.z,Uh.y,$o.z,0,-$o.x,Yo.z,0,-Yo.x,Uh.z,0,-Uh.x,-$o.y,$o.x,0,-Yo.y,Yo.x,0,-Uh.y,Uh.x,0];return!p1(e,Kl,Jl,Ql,ep)||(e=[1,0,0,0,1,0,0,0,1],!p1(e,Kl,Jl,Ql,ep))?!1:(ip.crossVectors($o,Yo),e=[ip.x,ip.y,ip.z],p1(e,Kl,Jl,Ql,ep))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Lr).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(Lr).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(Xa[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Xa[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Xa[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Xa[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Xa[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Xa[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Xa[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Xa[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Xa),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Xa=[new Lt,new Lt,new Lt,new Lt,new Lt,new Lt,new Lt,new Lt],Lr=new Lt,tp=new Yf,Kl=new Lt,Jl=new Lt,Ql=new Lt,$o=new Lt,Yo=new Lt,Uh=new Lt,sd=new Lt,ep=new Lt,ip=new Lt,Gh=new Lt;function p1(n,t,e,i,s){for(let r=0,a=n.length-3;r<=a;r+=3){Gh.fromArray(n,r);const o=s.x*Math.abs(Gh.x)+s.y*Math.abs(Gh.y)+s.z*Math.abs(Gh.z),h=t.dot(Gh),l=e.dot(Gh),u=i.dot(Gh);if(Math.max(-Math.max(h,l,u),Math.min(h,l,u))>o)return!1}return!0}const att=new Yf,rd=new Lt,m1=new Lt;class Ow{constructor(t=new Lt,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;e!==void 0?i.copy(e):att.setFromPoints(t).getCenter(i);let s=0;for(let r=0,a=t.length;r<a;r++)s=Math.max(s,i.distanceToSquared(t[r]));return this.radius=Math.sqrt(s),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;rd.subVectors(t,this.center);const e=rd.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),s=(i-this.radius)*.5;this.center.addScaledVector(rd,s/i),this.radius+=s}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(m1.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(rd.copy(t.center).add(m1)),this.expandByPoint(rd.copy(t.center).sub(m1))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const ja=new Lt,g1=new Lt,np=new Lt,Ho=new Lt,y1=new Lt,sp=new Lt,_1=new Lt;class ott{constructor(t=new Lt,e=new Lt(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,ja)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=ja.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(ja.copy(this.origin).addScaledVector(this.direction,e),ja.distanceToSquared(t))}distanceSqToSegment(t,e,i,s){g1.copy(t).add(e).multiplyScalar(.5),np.copy(e).sub(t).normalize(),Ho.copy(this.origin).sub(g1);const r=t.distanceTo(e)*.5,a=-this.direction.dot(np),o=Ho.dot(this.direction),h=-Ho.dot(np),l=Ho.lengthSq(),u=Math.abs(1-a*a);let f,m,g,y;if(u>0)if(f=a*h-o,m=a*o-h,y=r*u,f>=0)if(m>=-y)if(m<=y){const _=1/u;f*=_,m*=_,g=f*(f+a*m+2*o)+m*(a*f+m+2*h)+l}else m=r,f=Math.max(0,-(a*m+o)),g=-f*f+m*(m+2*h)+l;else m=-r,f=Math.max(0,-(a*m+o)),g=-f*f+m*(m+2*h)+l;else m<=-y?(f=Math.max(0,-(-a*r+o)),m=f>0?-r:Math.min(Math.max(-r,-h),r),g=-f*f+m*(m+2*h)+l):m<=y?(f=0,m=Math.min(Math.max(-r,-h),r),g=m*(m+2*h)+l):(f=Math.max(0,-(a*r+o)),m=f>0?r:Math.min(Math.max(-r,-h),r),g=-f*f+m*(m+2*h)+l);else m=a>0?-r:r,f=Math.max(0,-(a*m+o)),g=-f*f+m*(m+2*h)+l;return i&&i.copy(this.origin).addScaledVector(this.direction,f),s&&s.copy(g1).addScaledVector(np,m),g}intersectSphere(t,e){ja.subVectors(t.center,this.origin);const i=ja.dot(this.direction),s=ja.dot(ja)-i*i,r=t.radius*t.radius;if(s>r)return null;const a=Math.sqrt(r-s),o=i-a,h=i+a;return h<0?null:o<0?this.at(h,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return i===null?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,s,r,a,o,h;const l=1/this.direction.x,u=1/this.direction.y,f=1/this.direction.z,m=this.origin;return l>=0?(i=(t.min.x-m.x)*l,s=(t.max.x-m.x)*l):(i=(t.max.x-m.x)*l,s=(t.min.x-m.x)*l),u>=0?(r=(t.min.y-m.y)*u,a=(t.max.y-m.y)*u):(r=(t.max.y-m.y)*u,a=(t.min.y-m.y)*u),i>a||r>s||((r>i||isNaN(i))&&(i=r),(a<s||isNaN(s))&&(s=a),f>=0?(o=(t.min.z-m.z)*f,h=(t.max.z-m.z)*f):(o=(t.max.z-m.z)*f,h=(t.min.z-m.z)*f),i>h||o>s)||((o>i||i!==i)&&(i=o),(h<s||s!==s)&&(s=h),s<0)?null:this.at(i>=0?i:s,e)}intersectsBox(t){return this.intersectBox(t,ja)!==null}intersectTriangle(t,e,i,s,r){y1.subVectors(e,t),sp.subVectors(i,t),_1.crossVectors(y1,sp);let a=this.direction.dot(_1),o;if(a>0){if(s)return null;o=1}else if(a<0)o=-1,a=-a;else return null;Ho.subVectors(this.origin,t);const h=o*this.direction.dot(sp.crossVectors(Ho,sp));if(h<0)return null;const l=o*this.direction.dot(y1.cross(Ho));if(l<0||h+l>a)return null;const u=-o*Ho.dot(_1);return u<0?null:this.at(u/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Rn{constructor(t,e,i,s,r,a,o,h,l,u,f,m,g,y,_,w){Rn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,i,s,r,a,o,h,l,u,f,m,g,y,_,w)}set(t,e,i,s,r,a,o,h,l,u,f,m,g,y,_,w){const M=this.elements;return M[0]=t,M[4]=e,M[8]=i,M[12]=s,M[1]=r,M[5]=a,M[9]=o,M[13]=h,M[2]=l,M[6]=u,M[10]=f,M[14]=m,M[3]=g,M[7]=y,M[11]=_,M[15]=w,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Rn().fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,s=1/tc.setFromMatrixColumn(t,0).length(),r=1/tc.setFromMatrixColumn(t,1).length(),a=1/tc.setFromMatrixColumn(t,2).length();return e[0]=i[0]*s,e[1]=i[1]*s,e[2]=i[2]*s,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*a,e[9]=i[9]*a,e[10]=i[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,s=t.y,r=t.z,a=Math.cos(i),o=Math.sin(i),h=Math.cos(s),l=Math.sin(s),u=Math.cos(r),f=Math.sin(r);if(t.order==="XYZ"){const m=a*u,g=a*f,y=o*u,_=o*f;e[0]=h*u,e[4]=-h*f,e[8]=l,e[1]=g+y*l,e[5]=m-_*l,e[9]=-o*h,e[2]=_-m*l,e[6]=y+g*l,e[10]=a*h}else if(t.order==="YXZ"){const m=h*u,g=h*f,y=l*u,_=l*f;e[0]=m+_*o,e[4]=y*o-g,e[8]=a*l,e[1]=a*f,e[5]=a*u,e[9]=-o,e[2]=g*o-y,e[6]=_+m*o,e[10]=a*h}else if(t.order==="ZXY"){const m=h*u,g=h*f,y=l*u,_=l*f;e[0]=m-_*o,e[4]=-a*f,e[8]=y+g*o,e[1]=g+y*o,e[5]=a*u,e[9]=_-m*o,e[2]=-a*l,e[6]=o,e[10]=a*h}else if(t.order==="ZYX"){const m=a*u,g=a*f,y=o*u,_=o*f;e[0]=h*u,e[4]=y*l-g,e[8]=m*l+_,e[1]=h*f,e[5]=_*l+m,e[9]=g*l-y,e[2]=-l,e[6]=o*h,e[10]=a*h}else if(t.order==="YZX"){const m=a*h,g=a*l,y=o*h,_=o*l;e[0]=h*u,e[4]=_-m*f,e[8]=y*f+g,e[1]=f,e[5]=a*u,e[9]=-o*u,e[2]=-l*u,e[6]=g*f+y,e[10]=m-_*f}else if(t.order==="XZY"){const m=a*h,g=a*l,y=o*h,_=o*l;e[0]=h*u,e[4]=-f,e[8]=l*u,e[1]=m*f+_,e[5]=a*u,e[9]=g*f-y,e[2]=y*f-g,e[6]=o*u,e[10]=_*f+m}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(htt,t,ltt)}lookAt(t,e,i){const s=this.elements;return Ks.subVectors(t,e),Ks.lengthSq()===0&&(Ks.z=1),Ks.normalize(),qo.crossVectors(i,Ks),qo.lengthSq()===0&&(Math.abs(i.z)===1?Ks.x+=1e-4:Ks.z+=1e-4,Ks.normalize(),qo.crossVectors(i,Ks)),qo.normalize(),rp.crossVectors(Ks,qo),s[0]=qo.x,s[4]=rp.x,s[8]=Ks.x,s[1]=qo.y,s[5]=rp.y,s[9]=Ks.y,s[2]=qo.z,s[6]=rp.z,s[10]=Ks.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,r=this.elements,a=i[0],o=i[4],h=i[8],l=i[12],u=i[1],f=i[5],m=i[9],g=i[13],y=i[2],_=i[6],w=i[10],M=i[14],T=i[3],A=i[7],R=i[11],I=i[15],L=s[0],k=s[4],Y=s[8],K=s[12],rt=s[1],ut=s[5],Z=s[9],ht=s[13],O=s[2],pt=s[6],Gt=s[10],Ft=s[14],oe=s[3],Dt=s[7],re=s[11],yt=s[15];return r[0]=a*L+o*rt+h*O+l*oe,r[4]=a*k+o*ut+h*pt+l*Dt,r[8]=a*Y+o*Z+h*Gt+l*re,r[12]=a*K+o*ht+h*Ft+l*yt,r[1]=u*L+f*rt+m*O+g*oe,r[5]=u*k+f*ut+m*pt+g*Dt,r[9]=u*Y+f*Z+m*Gt+g*re,r[13]=u*K+f*ht+m*Ft+g*yt,r[2]=y*L+_*rt+w*O+M*oe,r[6]=y*k+_*ut+w*pt+M*Dt,r[10]=y*Y+_*Z+w*Gt+M*re,r[14]=y*K+_*ht+w*Ft+M*yt,r[3]=T*L+A*rt+R*O+I*oe,r[7]=T*k+A*ut+R*pt+I*Dt,r[11]=T*Y+A*Z+R*Gt+I*re,r[15]=T*K+A*ht+R*Ft+I*yt,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],s=t[8],r=t[12],a=t[1],o=t[5],h=t[9],l=t[13],u=t[2],f=t[6],m=t[10],g=t[14],y=t[3],_=t[7],w=t[11],M=t[15];return y*(+r*h*f-s*l*f-r*o*m+i*l*m+s*o*g-i*h*g)+_*(+e*h*g-e*l*m+r*a*m-s*a*g+s*l*u-r*h*u)+w*(+e*l*f-e*o*g-r*a*f+i*a*g+r*o*u-i*l*u)+M*(-s*o*u-e*h*f+e*o*m+s*a*f-i*a*m+i*h*u)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=t[8],f=t[9],m=t[10],g=t[11],y=t[12],_=t[13],w=t[14],M=t[15],T=f*w*l-_*m*l+_*h*g-o*w*g-f*h*M+o*m*M,A=y*m*l-u*w*l-y*h*g+a*w*g+u*h*M-a*m*M,R=u*_*l-y*f*l+y*o*g-a*_*g-u*o*M+a*f*M,I=y*f*h-u*_*h-y*o*m+a*_*m+u*o*w-a*f*w,L=e*T+i*A+s*R+r*I;if(L===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const k=1/L;return t[0]=T*k,t[1]=(_*m*r-f*w*r-_*s*g+i*w*g+f*s*M-i*m*M)*k,t[2]=(o*w*r-_*h*r+_*s*l-i*w*l-o*s*M+i*h*M)*k,t[3]=(f*h*r-o*m*r-f*s*l+i*m*l+o*s*g-i*h*g)*k,t[4]=A*k,t[5]=(u*w*r-y*m*r+y*s*g-e*w*g-u*s*M+e*m*M)*k,t[6]=(y*h*r-a*w*r-y*s*l+e*w*l+a*s*M-e*h*M)*k,t[7]=(a*m*r-u*h*r+u*s*l-e*m*l-a*s*g+e*h*g)*k,t[8]=R*k,t[9]=(y*f*r-u*_*r-y*i*g+e*_*g+u*i*M-e*f*M)*k,t[10]=(a*_*r-y*o*r+y*i*l-e*_*l-a*i*M+e*o*M)*k,t[11]=(u*o*r-a*f*r-u*i*l+e*f*l+a*i*g-e*o*g)*k,t[12]=I*k,t[13]=(u*_*s-y*f*s+y*i*m-e*_*m-u*i*w+e*f*w)*k,t[14]=(y*o*s-a*_*s-y*i*h+e*_*h+a*i*w-e*o*w)*k,t[15]=(a*f*s-u*o*s+u*i*h-e*f*h-a*i*m+e*o*m)*k,this}scale(t){const e=this.elements,i=t.x,s=t.y,r=t.z;return e[0]*=i,e[4]*=s,e[8]*=r,e[1]*=i,e[5]*=s,e[9]*=r,e[2]*=i,e[6]*=s,e[10]*=r,e[3]*=i,e[7]*=s,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,s))}makeTranslation(t,e,i){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),s=Math.sin(e),r=1-i,a=t.x,o=t.y,h=t.z,l=r*a,u=r*o;return this.set(l*a+i,l*o-s*h,l*h+s*o,0,l*o+s*h,u*o+i,u*h-s*a,0,l*h-s*o,u*h+s*a,r*h*h+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,s,r,a){return this.set(1,i,r,0,t,1,a,0,e,s,1,0,0,0,0,1),this}compose(t,e,i){const s=this.elements,r=e._x,a=e._y,o=e._z,h=e._w,l=r+r,u=a+a,f=o+o,m=r*l,g=r*u,y=r*f,_=a*u,w=a*f,M=o*f,T=h*l,A=h*u,R=h*f,I=i.x,L=i.y,k=i.z;return s[0]=(1-(_+M))*I,s[1]=(g+R)*I,s[2]=(y-A)*I,s[3]=0,s[4]=(g-R)*L,s[5]=(1-(m+M))*L,s[6]=(w+T)*L,s[7]=0,s[8]=(y+A)*k,s[9]=(w-T)*k,s[10]=(1-(m+_))*k,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,i){const s=this.elements;let r=tc.set(s[0],s[1],s[2]).length();const a=tc.set(s[4],s[5],s[6]).length(),o=tc.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),t.x=s[12],t.y=s[13],t.z=s[14],Or.copy(this);const l=1/r,u=1/a,f=1/o;return Or.elements[0]*=l,Or.elements[1]*=l,Or.elements[2]*=l,Or.elements[4]*=u,Or.elements[5]*=u,Or.elements[6]*=u,Or.elements[8]*=f,Or.elements[9]*=f,Or.elements[10]*=f,e.setFromRotationMatrix(Or),i.x=r,i.y=a,i.z=o,this}makePerspective(t,e,i,s,r,a,o=il){const h=this.elements,l=2*r/(e-t),u=2*r/(i-s),f=(e+t)/(e-t),m=(i+s)/(i-s);let g,y;if(o===il)g=-(a+r)/(a-r),y=-2*a*r/(a-r);else if(o===Im)g=-a/(a-r),y=-a*r/(a-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return h[0]=l,h[4]=0,h[8]=f,h[12]=0,h[1]=0,h[5]=u,h[9]=m,h[13]=0,h[2]=0,h[6]=0,h[10]=g,h[14]=y,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(t,e,i,s,r,a,o=il){const h=this.elements,l=1/(e-t),u=1/(i-s),f=1/(a-r),m=(e+t)*l,g=(i+s)*u;let y,_;if(o===il)y=(a+r)*f,_=-2*f;else if(o===Im)y=r*f,_=-1*f;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return h[0]=2*l,h[4]=0,h[8]=0,h[12]=-m,h[1]=0,h[5]=2*u,h[9]=0,h[13]=-g,h[2]=0,h[6]=0,h[10]=_,h[14]=-y,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let s=0;s<16;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const tc=new Lt,Or=new Rn,htt=new Lt(0,0,0),ltt=new Lt(1,1,1),qo=new Lt,rp=new Lt,Ks=new Lt,iS=new Rn,nS=new Au;class Dg{constructor(t=0,e=0,i=0,s=Dg.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,s=this._order){return this._x=t,this._y=e,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const s=t.elements,r=s[0],a=s[4],o=s[8],h=s[1],l=s[5],u=s[9],f=s[2],m=s[6],g=s[10];switch(e){case"XYZ":this._y=Math.asin(hs(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,g),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(m,l),this._z=0);break;case"YXZ":this._x=Math.asin(-hs(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,g),this._z=Math.atan2(h,l)):(this._y=Math.atan2(-f,r),this._z=0);break;case"ZXY":this._x=Math.asin(hs(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-f,g),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(h,r));break;case"ZYX":this._y=Math.asin(-hs(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(m,g),this._z=Math.atan2(h,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(hs(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-f,r)):(this._x=0,this._y=Math.atan2(o,g));break;case"XZY":this._z=Math.asin(-hs(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(m,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-u,g),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return iS.makeRotationFromQuaternion(t),this.setFromRotationMatrix(iS,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return nS.setFromEuler(this),this.setFromQuaternion(nS,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Dg.DEFAULT_ORDER="XYZ";class ctt{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let utt=0;const sS=new Lt,ec=new Au,Za=new Rn,ap=new Lt,ad=new Lt,dtt=new Lt,ftt=new Au,rS=new Lt(1,0,0),aS=new Lt(0,1,0),oS=new Lt(0,0,1),ptt={type:"added"},mtt={type:"removed"};class fs extends Al{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:utt++}),this.uuid=_o(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=fs.DEFAULT_UP.clone();const t=new Lt,e=new Dg,i=new Au,s=new Lt(1,1,1);function r(){i.setFromEuler(e,!1)}function a(){e.setFromQuaternion(i,void 0,!1)}e._onChange(r),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Rn},normalMatrix:{value:new oa}}),this.matrix=new Rn,this.matrixWorld=new Rn,this.matrixAutoUpdate=fs.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=fs.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new ctt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return ec.setFromAxisAngle(t,e),this.quaternion.multiply(ec),this}rotateOnWorldAxis(t,e){return ec.setFromAxisAngle(t,e),this.quaternion.premultiply(ec),this}rotateX(t){return this.rotateOnAxis(rS,t)}rotateY(t){return this.rotateOnAxis(aS,t)}rotateZ(t){return this.rotateOnAxis(oS,t)}translateOnAxis(t,e){return sS.copy(t).applyQuaternion(this.quaternion),this.position.add(sS.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(rS,t)}translateY(t){return this.translateOnAxis(aS,t)}translateZ(t){return this.translateOnAxis(oS,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Za.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?ap.copy(t):ap.set(t,e,i);const s=this.parent;this.updateWorldMatrix(!0,!1),ad.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Za.lookAt(ad,ap,this.up):Za.lookAt(ap,ad,this.up),this.quaternion.setFromRotationMatrix(Za),s&&(Za.extractRotation(s.matrixWorld),ec.setFromRotationMatrix(Za),this.quaternion.premultiply(ec.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(ptt)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(mtt)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Za.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Za.multiply(t.parent.matrixWorld)),t.applyMatrix4(Za),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,s=this.children.length;i<s;i++){const a=this.children[i].getObjectByProperty(t,e);if(a!==void 0)return a}}getObjectsByProperty(t,e,i=[]){this[t]===e&&i.push(this);const s=this.children;for(let r=0,a=s.length;r<a;r++)s[r].getObjectsByProperty(t,e,i);return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ad,t,dtt),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ad,ftt,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,s=e.length;i<s;i++){const r=e[i];(r.matrixWorldAutoUpdate===!0||t===!0)&&r.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const i=this.parent;if(t===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const s=this.children;for(let r=0,a=s.length;r<a;r++){const o=s[r];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),s.maxGeometryCount=this._maxGeometryCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(t),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function r(o,h){return o[h.uuid]===void 0&&(o[h.uuid]=h.toJSON(t)),h.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const h=o.shapes;if(Array.isArray(h))for(let l=0,u=h.length;l<u;l++){const f=h[l];r(t.shapes,f)}else r(t.shapes,h)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let h=0,l=this.material.length;h<l;h++)o.push(r(t.materials,this.material[h]));s.material=o}else s.material=r(t.materials,this.material);if(this.children.length>0){s.children=[];for(let o=0;o<this.children.length;o++)s.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let o=0;o<this.animations.length;o++){const h=this.animations[o];s.animations.push(r(t.animations,h))}}if(e){const o=a(t.geometries),h=a(t.materials),l=a(t.textures),u=a(t.images),f=a(t.shapes),m=a(t.skeletons),g=a(t.animations),y=a(t.nodes);o.length>0&&(i.geometries=o),h.length>0&&(i.materials=h),l.length>0&&(i.textures=l),u.length>0&&(i.images=u),f.length>0&&(i.shapes=f),m.length>0&&(i.skeletons=m),g.length>0&&(i.animations=g),y.length>0&&(i.nodes=y)}return i.object=s,i;function a(o){const h=[];for(const l in o){const u=o[l];delete u.metadata,h.push(u)}return h}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){const s=t.children[i];this.add(s.clone())}return this}}fs.DEFAULT_UP=new Lt(0,1,0);fs.DEFAULT_MATRIX_AUTO_UPDATE=!0;fs.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Pr=new Lt,Ka=new Lt,x1=new Lt,Ja=new Lt,ic=new Lt,nc=new Lt,hS=new Lt,v1=new Lt,w1=new Lt,b1=new Lt;let op=!1;class Dr{constructor(t=new Lt,e=new Lt,i=new Lt){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,s){s.subVectors(i,e),Pr.subVectors(t,e),s.cross(Pr);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(t,e,i,s,r){Pr.subVectors(s,e),Ka.subVectors(i,e),x1.subVectors(t,e);const a=Pr.dot(Pr),o=Pr.dot(Ka),h=Pr.dot(x1),l=Ka.dot(Ka),u=Ka.dot(x1),f=a*l-o*o;if(f===0)return r.set(0,0,0),null;const m=1/f,g=(l*h-o*u)*m,y=(a*u-o*h)*m;return r.set(1-g-y,y,g)}static containsPoint(t,e,i,s){return this.getBarycoord(t,e,i,s,Ja)===null?!1:Ja.x>=0&&Ja.y>=0&&Ja.x+Ja.y<=1}static getUV(t,e,i,s,r,a,o,h){return op===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),op=!0),this.getInterpolation(t,e,i,s,r,a,o,h)}static getInterpolation(t,e,i,s,r,a,o,h){return this.getBarycoord(t,e,i,s,Ja)===null?(h.x=0,h.y=0,"z"in h&&(h.z=0),"w"in h&&(h.w=0),null):(h.setScalar(0),h.addScaledVector(r,Ja.x),h.addScaledVector(a,Ja.y),h.addScaledVector(o,Ja.z),h)}static isFrontFacing(t,e,i,s){return Pr.subVectors(i,e),Ka.subVectors(t,e),Pr.cross(Ka).dot(s)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,s){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[s]),this}setFromAttributeAndIndices(t,e,i,s){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,s),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Pr.subVectors(this.c,this.b),Ka.subVectors(this.a,this.b),Pr.cross(Ka).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Dr.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Dr.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,s,r){return op===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),op=!0),Dr.getInterpolation(t,this.a,this.b,this.c,e,i,s,r)}getInterpolation(t,e,i,s,r){return Dr.getInterpolation(t,this.a,this.b,this.c,e,i,s,r)}containsPoint(t){return Dr.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Dr.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,s=this.b,r=this.c;let a,o;ic.subVectors(s,i),nc.subVectors(r,i),v1.subVectors(t,i);const h=ic.dot(v1),l=nc.dot(v1);if(h<=0&&l<=0)return e.copy(i);w1.subVectors(t,s);const u=ic.dot(w1),f=nc.dot(w1);if(u>=0&&f<=u)return e.copy(s);const m=h*f-u*l;if(m<=0&&h>=0&&u<=0)return a=h/(h-u),e.copy(i).addScaledVector(ic,a);b1.subVectors(t,r);const g=ic.dot(b1),y=nc.dot(b1);if(y>=0&&g<=y)return e.copy(r);const _=g*l-h*y;if(_<=0&&l>=0&&y<=0)return o=l/(l-y),e.copy(i).addScaledVector(nc,o);const w=u*y-g*f;if(w<=0&&f-u>=0&&g-y>=0)return hS.subVectors(r,s),o=(f-u)/(f-u+(g-y)),e.copy(s).addScaledVector(hS,o);const M=1/(w+_+m);return a=_*M,o=m*M,e.copy(i).addScaledVector(ic,a).addScaledVector(nc,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const kR={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Xo={h:0,s:0,l:0},hp={h:0,s:0,l:0};function M1(n,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?n+(t-n)*6*e:e<1/2?t:e<2/3?n+(t-n)*6*(2/3-e):n}class Oi{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,i)}set(t,e,i){if(e===void 0&&i===void 0){const s=t;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(t,e,i);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=tr){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,kr.toWorkingColorSpace(this,e),this}setRGB(t,e,i,s=kr.workingColorSpace){return this.r=t,this.g=e,this.b=i,kr.toWorkingColorSpace(this,s),this}setHSL(t,e,i,s=kr.workingColorSpace){if(t=Lw(t,1),e=hs(e,0,1),i=hs(i,0,1),e===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+e):i+e-i*e,a=2*i-r;this.r=M1(a,r,t+1/3),this.g=M1(a,r,t),this.b=M1(a,r,t-1/3)}return kr.toWorkingColorSpace(this,s),this}setStyle(t,e=tr){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(t)){let r;const a=s[1],o=s[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,e);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,e);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(t)){const r=s[1],a=r.length;if(a===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,e);if(a===6)return this.setHex(parseInt(r,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=tr){const i=kR[t.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=$c(t.r),this.g=$c(t.g),this.b=$c(t.b),this}copyLinearToSRGB(t){return this.r=u1(t.r),this.g=u1(t.g),this.b=u1(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=tr){return kr.fromWorkingColorSpace(is.copy(this),t),Math.round(hs(is.r*255,0,255))*65536+Math.round(hs(is.g*255,0,255))*256+Math.round(hs(is.b*255,0,255))}getHexString(t=tr){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=kr.workingColorSpace){kr.fromWorkingColorSpace(is.copy(this),e);const i=is.r,s=is.g,r=is.b,a=Math.max(i,s,r),o=Math.min(i,s,r);let h,l;const u=(o+a)/2;if(o===a)h=0,l=0;else{const f=a-o;switch(l=u<=.5?f/(a+o):f/(2-a-o),a){case i:h=(s-r)/f+(s<r?6:0);break;case s:h=(r-i)/f+2;break;case r:h=(i-s)/f+4;break}h/=6}return t.h=h,t.s=l,t.l=u,t}getRGB(t,e=kr.workingColorSpace){return kr.fromWorkingColorSpace(is.copy(this),e),t.r=is.r,t.g=is.g,t.b=is.b,t}getStyle(t=tr){kr.fromWorkingColorSpace(is.copy(this),t);const e=is.r,i=is.g,s=is.b;return t!==tr?`color(${t} ${e.toFixed(3)} ${i.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(i*255)},${Math.round(s*255)})`}offsetHSL(t,e,i){return this.getHSL(Xo),this.setHSL(Xo.h+t,Xo.s+e,Xo.l+i)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(Xo),t.getHSL(hp);const i=Dd(Xo.h,hp.h,e),s=Dd(Xo.s,hp.s,e),r=Dd(Xo.l,hp.l,e);return this.setHSL(i,s,r),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,i=this.g,s=this.b,r=t.elements;return this.r=r[0]*e+r[3]*i+r[6]*s,this.g=r[1]*e+r[4]*i+r[7]*s,this.b=r[2]*e+r[5]*i+r[8]*s,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const is=new Oi;Oi.NAMES=kR;let gtt=0;class ps extends Al{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:gtt++}),this.uuid=_o(),this.name="",this.type="Material",this.blending=PE,this.side=G_,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=DE,this.blendDst=zE,this.blendEquation=FE,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Oi(0,0,0),this.blendAlpha=0,this.depthFunc=BE,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=jE,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=jl,this.stencilZFail=jl,this.stencilZPass=jl,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const i=t[e];if(i===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const s=this[e];if(s===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[e]=i}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==PE&&(i.blending=this.blending),this.side!==G_&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==DE&&(i.blendSrc=this.blendSrc),this.blendDst!==zE&&(i.blendDst=this.blendDst),this.blendEquation!==FE&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==BE&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==jE&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==jl&&(i.stencilFail=this.stencilFail),this.stencilZFail!==jl&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==jl&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function s(r){const a=[];for(const o in r){const h=r[o];delete h.metadata,a.push(h)}return a}if(e){const r=s(t.textures),a=s(t.images);r.length>0&&(i.textures=r),a.length>0&&(i.images=a)}return i}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(e!==null){const s=e.length;i=new Array(s);for(let r=0;r!==s;++r)i[r]=e[r].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}class Pw extends ps{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Oi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Nw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const dn=new Lt,lp=new hi;class rl{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=i,this.usage=Rm,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=kw,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}get updateRange(){return console.warn("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[t+s]=e.array[i+s];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)lp.fromBufferAttribute(this,e),lp.applyMatrix3(t),this.setXY(e,lp.x,lp.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)dn.fromBufferAttribute(this,e),dn.applyMatrix3(t),this.setXYZ(e,dn.x,dn.y,dn.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)dn.fromBufferAttribute(this,e),dn.applyMatrix4(t),this.setXYZ(e,dn.x,dn.y,dn.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)dn.fromBufferAttribute(this,e),dn.applyNormalMatrix(t),this.setXYZ(e,dn.x,dn.y,dn.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)dn.fromBufferAttribute(this,e),dn.transformDirection(t),this.setXYZ(e,dn.x,dn.y,dn.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let i=this.array[t*this.itemSize+e];return this.normalized&&(i=Sa(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=ki(i,this.array)),this.array[t*this.itemSize+e]=i,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Sa(e,this.array)),e}setX(t,e){return this.normalized&&(e=ki(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Sa(e,this.array)),e}setY(t,e){return this.normalized&&(e=ki(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Sa(e,this.array)),e}setZ(t,e){return this.normalized&&(e=ki(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Sa(e,this.array)),e}setW(t,e){return this.normalized&&(e=ki(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=ki(e,this.array),i=ki(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,s){return t*=this.itemSize,this.normalized&&(e=ki(e,this.array),i=ki(i,this.array),s=ki(s,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this}setXYZW(t,e,i,s,r){return t*=this.itemSize,this.normalized&&(e=ki(e,this.array),i=ki(i,this.array),s=ki(s,this.array),r=ki(r,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==Rm&&(t.usage=this.usage),t}}class ytt extends rl{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class _tt extends rl{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class Y_ extends rl{constructor(t,e,i){super(new Float32Array(t),e,i)}}let xtt=0;const lr=new Rn,E1=new fs,sc=new Lt,Js=new Yf,od=new Yf,Ln=new Lt;class zg extends Al{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:xtt++}),this.uuid=_o(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(ttt(t)?_tt:ytt)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const r=new oa().getNormalMatrix(t);i.applyNormalMatrix(r),i.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(t),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return lr.makeRotationFromQuaternion(t),this.applyMatrix4(lr),this}rotateX(t){return lr.makeRotationX(t),this.applyMatrix4(lr),this}rotateY(t){return lr.makeRotationY(t),this.applyMatrix4(lr),this}rotateZ(t){return lr.makeRotationZ(t),this.applyMatrix4(lr),this}translate(t,e,i){return lr.makeTranslation(t,e,i),this.applyMatrix4(lr),this}scale(t,e,i){return lr.makeScale(t,e,i),this.applyMatrix4(lr),this}lookAt(t){return E1.lookAt(t),E1.updateMatrix(),this.applyMatrix4(E1.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(sc).negate(),this.translate(sc.x,sc.y,sc.z),this}setFromPoints(t){const e=[];for(let i=0,s=t.length;i<s;i++){const r=t[i];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Y_(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Yf);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Lt(-1/0,-1/0,-1/0),new Lt(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,s=e.length;i<s;i++){const r=e[i];Js.setFromBufferAttribute(r),this.morphTargetsRelative?(Ln.addVectors(this.boundingBox.min,Js.min),this.boundingBox.expandByPoint(Ln),Ln.addVectors(this.boundingBox.max,Js.max),this.boundingBox.expandByPoint(Ln)):(this.boundingBox.expandByPoint(Js.min),this.boundingBox.expandByPoint(Js.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ow);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Lt,1/0);return}if(t){const i=this.boundingSphere.center;if(Js.setFromBufferAttribute(t),e)for(let r=0,a=e.length;r<a;r++){const o=e[r];od.setFromBufferAttribute(o),this.morphTargetsRelative?(Ln.addVectors(Js.min,od.min),Js.expandByPoint(Ln),Ln.addVectors(Js.max,od.max),Js.expandByPoint(Ln)):(Js.expandByPoint(od.min),Js.expandByPoint(od.max))}Js.getCenter(i);let s=0;for(let r=0,a=t.count;r<a;r++)Ln.fromBufferAttribute(t,r),s=Math.max(s,i.distanceToSquared(Ln));if(e)for(let r=0,a=e.length;r<a;r++){const o=e[r],h=this.morphTargetsRelative;for(let l=0,u=o.count;l<u;l++)Ln.fromBufferAttribute(o,l),h&&(sc.fromBufferAttribute(t,l),Ln.add(sc)),s=Math.max(s,i.distanceToSquared(Ln))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.array,s=e.position.array,r=e.normal.array,a=e.uv.array,o=s.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new rl(new Float32Array(4*o),4));const h=this.getAttribute("tangent").array,l=[],u=[];for(let rt=0;rt<o;rt++)l[rt]=new Lt,u[rt]=new Lt;const f=new Lt,m=new Lt,g=new Lt,y=new hi,_=new hi,w=new hi,M=new Lt,T=new Lt;function A(rt,ut,Z){f.fromArray(s,rt*3),m.fromArray(s,ut*3),g.fromArray(s,Z*3),y.fromArray(a,rt*2),_.fromArray(a,ut*2),w.fromArray(a,Z*2),m.sub(f),g.sub(f),_.sub(y),w.sub(y);const ht=1/(_.x*w.y-w.x*_.y);!isFinite(ht)||(M.copy(m).multiplyScalar(w.y).addScaledVector(g,-_.y).multiplyScalar(ht),T.copy(g).multiplyScalar(_.x).addScaledVector(m,-w.x).multiplyScalar(ht),l[rt].add(M),l[ut].add(M),l[Z].add(M),u[rt].add(T),u[ut].add(T),u[Z].add(T))}let R=this.groups;R.length===0&&(R=[{start:0,count:i.length}]);for(let rt=0,ut=R.length;rt<ut;++rt){const Z=R[rt],ht=Z.start,O=Z.count;for(let pt=ht,Gt=ht+O;pt<Gt;pt+=3)A(i[pt+0],i[pt+1],i[pt+2])}const I=new Lt,L=new Lt,k=new Lt,Y=new Lt;function K(rt){k.fromArray(r,rt*3),Y.copy(k);const ut=l[rt];I.copy(ut),I.sub(k.multiplyScalar(k.dot(ut))).normalize(),L.crossVectors(Y,ut);const ht=L.dot(u[rt])<0?-1:1;h[rt*4]=I.x,h[rt*4+1]=I.y,h[rt*4+2]=I.z,h[rt*4+3]=ht}for(let rt=0,ut=R.length;rt<ut;++rt){const Z=R[rt],ht=Z.start,O=Z.count;for(let pt=ht,Gt=ht+O;pt<Gt;pt+=3)K(i[pt+0]),K(i[pt+1]),K(i[pt+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new rl(new Float32Array(e.count*3),3),this.setAttribute("normal",i);else for(let m=0,g=i.count;m<g;m++)i.setXYZ(m,0,0,0);const s=new Lt,r=new Lt,a=new Lt,o=new Lt,h=new Lt,l=new Lt,u=new Lt,f=new Lt;if(t)for(let m=0,g=t.count;m<g;m+=3){const y=t.getX(m+0),_=t.getX(m+1),w=t.getX(m+2);s.fromBufferAttribute(e,y),r.fromBufferAttribute(e,_),a.fromBufferAttribute(e,w),u.subVectors(a,r),f.subVectors(s,r),u.cross(f),o.fromBufferAttribute(i,y),h.fromBufferAttribute(i,_),l.fromBufferAttribute(i,w),o.add(u),h.add(u),l.add(u),i.setXYZ(y,o.x,o.y,o.z),i.setXYZ(_,h.x,h.y,h.z),i.setXYZ(w,l.x,l.y,l.z)}else for(let m=0,g=e.count;m<g;m+=3)s.fromBufferAttribute(e,m+0),r.fromBufferAttribute(e,m+1),a.fromBufferAttribute(e,m+2),u.subVectors(a,r),f.subVectors(s,r),u.cross(f),i.setXYZ(m+0,u.x,u.y,u.z),i.setXYZ(m+1,u.x,u.y,u.z),i.setXYZ(m+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)Ln.fromBufferAttribute(t,e),Ln.normalize(),t.setXYZ(e,Ln.x,Ln.y,Ln.z)}toNonIndexed(){function t(o,h){const l=o.array,u=o.itemSize,f=o.normalized,m=new l.constructor(h.length*u);let g=0,y=0;for(let _=0,w=h.length;_<w;_++){o.isInterleavedBufferAttribute?g=h[_]*o.data.stride+o.offset:g=h[_]*u;for(let M=0;M<u;M++)m[y++]=l[g++]}return new rl(m,u,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new zg,i=this.index.array,s=this.attributes;for(const o in s){const h=s[o],l=t(h,i);e.setAttribute(o,l)}const r=this.morphAttributes;for(const o in r){const h=[],l=r[o];for(let u=0,f=l.length;u<f;u++){const m=l[u],g=t(m,i);h.push(g)}e.morphAttributes[o]=h}e.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,h=a.length;o<h;o++){const l=a[o];e.addGroup(l.start,l.count,l.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const h=this.parameters;for(const l in h)h[l]!==void 0&&(t[l]=h[l]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const h in i){const l=i[h];t.data.attributes[h]=l.toJSON(t.data)}const s={};let r=!1;for(const h in this.morphAttributes){const l=this.morphAttributes[h],u=[];for(let f=0,m=l.length;f<m;f++){const g=l[f];u.push(g.toJSON(t.data))}u.length>0&&(s[h]=u,r=!0)}r&&(t.data.morphAttributes=s,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;i!==null&&this.setIndex(i.clone(e));const s=t.attributes;for(const l in s){const u=s[l];this.setAttribute(l,u.clone(e))}const r=t.morphAttributes;for(const l in r){const u=[],f=r[l];for(let m=0,g=f.length;m<g;m++)u.push(f[m].clone(e));this.morphAttributes[l]=u}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let l=0,u=a.length;l<u;l++){const f=a[l];this.addGroup(f.start,f.count,f.materialIndex)}const o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());const h=t.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const lS=new Rn,Vh=new ott,cp=new Ow,cS=new Lt,rc=new Lt,ac=new Lt,oc=new Lt,S1=new Lt,up=new Lt,dp=new hi,fp=new hi,pp=new hi,uS=new Lt,dS=new Lt,fS=new Lt,mp=new Lt,gp=new Lt;class vtt extends fs{constructor(t=new zg,e=new Pw){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){const o=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}getVertexPosition(t,e){const i=this.geometry,s=i.attributes.position,r=i.morphAttributes.position,a=i.morphTargetsRelative;e.fromBufferAttribute(s,t);const o=this.morphTargetInfluences;if(r&&o){up.set(0,0,0);for(let h=0,l=r.length;h<l;h++){const u=o[h],f=r[h];u!==0&&(S1.fromBufferAttribute(f,t),a?up.addScaledVector(S1,u):up.addScaledVector(S1.sub(e),u))}e.add(up)}return e}raycast(t,e){const i=this.geometry,s=this.material,r=this.matrixWorld;s!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),cp.copy(i.boundingSphere),cp.applyMatrix4(r),Vh.copy(t.ray).recast(t.near),!(cp.containsPoint(Vh.origin)===!1&&(Vh.intersectSphere(cp,cS)===null||Vh.origin.distanceToSquared(cS)>(t.far-t.near)**2))&&(lS.copy(r).invert(),Vh.copy(t.ray).applyMatrix4(lS),!(i.boundingBox!==null&&Vh.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(t,e,Vh)))}_computeIntersections(t,e,i){let s;const r=this.geometry,a=this.material,o=r.index,h=r.attributes.position,l=r.attributes.uv,u=r.attributes.uv1,f=r.attributes.normal,m=r.groups,g=r.drawRange;if(o!==null)if(Array.isArray(a))for(let y=0,_=m.length;y<_;y++){const w=m[y],M=a[w.materialIndex],T=Math.max(w.start,g.start),A=Math.min(o.count,Math.min(w.start+w.count,g.start+g.count));for(let R=T,I=A;R<I;R+=3){const L=o.getX(R),k=o.getX(R+1),Y=o.getX(R+2);s=yp(this,M,t,i,l,u,f,L,k,Y),s&&(s.faceIndex=Math.floor(R/3),s.face.materialIndex=w.materialIndex,e.push(s))}}else{const y=Math.max(0,g.start),_=Math.min(o.count,g.start+g.count);for(let w=y,M=_;w<M;w+=3){const T=o.getX(w),A=o.getX(w+1),R=o.getX(w+2);s=yp(this,a,t,i,l,u,f,T,A,R),s&&(s.faceIndex=Math.floor(w/3),e.push(s))}}else if(h!==void 0)if(Array.isArray(a))for(let y=0,_=m.length;y<_;y++){const w=m[y],M=a[w.materialIndex],T=Math.max(w.start,g.start),A=Math.min(h.count,Math.min(w.start+w.count,g.start+g.count));for(let R=T,I=A;R<I;R+=3){const L=R,k=R+1,Y=R+2;s=yp(this,M,t,i,l,u,f,L,k,Y),s&&(s.faceIndex=Math.floor(R/3),s.face.materialIndex=w.materialIndex,e.push(s))}}else{const y=Math.max(0,g.start),_=Math.min(h.count,g.start+g.count);for(let w=y,M=_;w<M;w+=3){const T=w,A=w+1,R=w+2;s=yp(this,a,t,i,l,u,f,T,A,R),s&&(s.faceIndex=Math.floor(w/3),e.push(s))}}}}function wtt(n,t,e,i,s,r,a,o){let h;if(t.side===bQ?h=i.intersectTriangle(a,r,s,!0,o):h=i.intersectTriangle(s,r,a,t.side===G_,o),h===null)return null;gp.copy(o),gp.applyMatrix4(n.matrixWorld);const l=e.ray.origin.distanceTo(gp);return l<e.near||l>e.far?null:{distance:l,point:gp.clone(),object:n}}function yp(n,t,e,i,s,r,a,o,h,l){n.getVertexPosition(o,rc),n.getVertexPosition(h,ac),n.getVertexPosition(l,oc);const u=wtt(n,t,e,i,rc,ac,oc,mp);if(u){s&&(dp.fromBufferAttribute(s,o),fp.fromBufferAttribute(s,h),pp.fromBufferAttribute(s,l),u.uv=Dr.getInterpolation(mp,rc,ac,oc,dp,fp,pp,new hi)),r&&(dp.fromBufferAttribute(r,o),fp.fromBufferAttribute(r,h),pp.fromBufferAttribute(r,l),u.uv1=Dr.getInterpolation(mp,rc,ac,oc,dp,fp,pp,new hi),u.uv2=u.uv1),a&&(uS.fromBufferAttribute(a,o),dS.fromBufferAttribute(a,h),fS.fromBufferAttribute(a,l),u.normal=Dr.getInterpolation(mp,rc,ac,oc,uS,dS,fS,new Lt),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const f={a:o,b:h,c:l,normal:new Lt,materialIndex:0};Dr.getNormal(rc,ac,oc,f.normal),u.face=f}return u}function btt(n){const t={};for(const e in n){t[e]={};for(const i in n[e]){const s=n[e][i];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[e][i]=null):t[e][i]=s.clone():Array.isArray(s)?t[e][i]=s.slice():t[e][i]=s}}return t}function Mtt(n){const t=[];for(let e=0;e<n.length;e++)t.push(n[e].clone());return t}var Ett=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Stt=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Fw extends ps{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Ett,this.fragmentShader=Stt,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=btt(t.uniforms),this.uniformsGroups=Mtt(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const s in this.uniforms){const a=this.uniforms[s].value;a&&a.isTexture?e.uniforms[s]={type:"t",value:a.toJSON(t).uuid}:a&&a.isColor?e.uniforms[s]={type:"c",value:a.getHex()}:a&&a.isVector2?e.uniforms[s]={type:"v2",value:a.toArray()}:a&&a.isVector3?e.uniforms[s]={type:"v3",value:a.toArray()}:a&&a.isVector4?e.uniforms[s]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?e.uniforms[s]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?e.uniforms[s]={type:"m4",value:a.toArray()}:e.uniforms[s]={value:a}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const i={};for(const s in this.extensions)this.extensions[s]===!0&&(i[s]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}class LR extends fs{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Rn,this.projectionMatrix=new Rn,this.projectionMatrixInverse=new Rn,this.coordinateSystem=il}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class OR extends LR{constructor(t=50,e=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=uf*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(Fd*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return uf*2*Math.atan(Math.tan(Fd*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,s,r,a){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(Fd*.5*this.fov)/this.zoom,i=2*e,s=this.aspect*i,r=-.5*s;const a=this.view;if(this.view!==null&&this.view.enabled){const h=a.fullWidth,l=a.fullHeight;r+=a.offsetX*s/h,e-=a.offsetY*i/l,s*=a.width/h,i*=a.height/l}const o=this.filmOffset;o!==0&&(r+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,e,e-i,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const T1=new Lt,Ttt=new Lt,Ctt=new oa;class hc{constructor(t=new Lt(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,s){return this.normal.set(t,e,i),this.constant=s,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const s=T1.subVectors(i,e).cross(Ttt.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(s,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const i=t.delta(T1),s=this.normal.dot(i);if(s===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:e.copy(t.start).addScaledVector(i,r)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||Ctt.getNormalMatrix(t),s=this.coplanarPoint(T1).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Wh=new Ow,_p=new Lt;class Att{constructor(t=new hc,e=new hc,i=new hc,s=new hc,r=new hc,a=new hc){this.planes=[t,e,i,s,r,a]}set(t,e,i,s,r,a){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(s),o[4].copy(r),o[5].copy(a),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t,e=il){const i=this.planes,s=t.elements,r=s[0],a=s[1],o=s[2],h=s[3],l=s[4],u=s[5],f=s[6],m=s[7],g=s[8],y=s[9],_=s[10],w=s[11],M=s[12],T=s[13],A=s[14],R=s[15];if(i[0].setComponents(h-r,m-l,w-g,R-M).normalize(),i[1].setComponents(h+r,m+l,w+g,R+M).normalize(),i[2].setComponents(h+a,m+u,w+y,R+T).normalize(),i[3].setComponents(h-a,m-u,w-y,R-T).normalize(),i[4].setComponents(h-o,m-f,w-_,R-A).normalize(),e===il)i[5].setComponents(h+o,m+f,w+_,R+A).normalize();else if(e===Im)i[5].setComponents(o,f,_,A).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),Wh.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),Wh.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(Wh)}intersectsSprite(t){return Wh.center.set(0,0,0),Wh.radius=.7071067811865476,Wh.applyMatrix4(t.matrixWorld),this.intersectsSphere(Wh)}intersectsSphere(t){const e=this.planes,i=t.center,s=-t.radius;for(let r=0;r<6;r++)if(e[r].distanceToPoint(i)<s)return!1;return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const s=e[i];if(_p.x=s.normal.x>0?t.max.x:t.min.x,_p.y=s.normal.y>0?t.max.y:t.min.y,_p.z=s.normal.z>0?t.max.z:t.min.z,s.distanceToPoint(_p)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class PR extends LR{constructor(t=-1,e=1,i=1,s=-1,r=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=s,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,i,s,r,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-t,a=i+t,o=s+e,h=s-e;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=l*this.view.offsetX,a=r+l*this.view.width,o-=u*this.view.offsetY,h=o-u*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,h,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}class Bg extends Xr{constructor(t,e,i,s,r,a,o,h,l,u){if(u=u!==void 0?u:Lp,u!==Lp&&u!==VE)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&u===Lp&&(i=CR),i===void 0&&u===VE&&(i=IQ),super(null,s,r,a,o,h,u,i,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=o!==void 0?o:vh,this.minFilter=h!==void 0?h:vh,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}const Rtt=new Bg(1,1);Rtt.compareFunction=DQ;class Itt extends ps{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=LQ,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class Ntt extends ps{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}class FR{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=Rm,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=_o()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}get updateRange(){return console.warn("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let s=0,r=this.stride;s<r;s++)this.array[t+s]=e.array[i+s];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=_o()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=_o()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ws=new Lt;class Dw{constructor(t,e,i,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)ws.fromBufferAttribute(this,e),ws.applyMatrix4(t),this.setXYZ(e,ws.x,ws.y,ws.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)ws.fromBufferAttribute(this,e),ws.applyNormalMatrix(t),this.setXYZ(e,ws.x,ws.y,ws.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)ws.fromBufferAttribute(this,e),ws.transformDirection(t),this.setXYZ(e,ws.x,ws.y,ws.z);return this}setX(t,e){return this.normalized&&(e=ki(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=ki(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=ki(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=ki(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=Sa(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=Sa(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=Sa(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=Sa(e,this.array)),e}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=ki(e,this.array),i=ki(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=ki(e,this.array),i=ki(i,this.array),s=ki(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=s,this}setXYZW(t,e,i,s,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=ki(e,this.array),i=ki(i,this.array),s=ki(s,this.array),r=ki(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=s,this.data.array[t+3]=r,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)e.push(this.data.array[s+r])}return new rl(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Dw(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)e.push(this.data.array[s+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class DR extends ps{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Oi(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}class zw extends ps{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Oi(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}class Bw extends ps{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Oi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}class zR extends Xr{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=vh,this.minFilter=vh,this.generateMipmaps=!1,this.needsUpdate=!0}}class ktt extends ps{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Oi(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class Ltt extends Fw{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Uw extends ps{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Oi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Oi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wh,this.normalScale=new hi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class BR extends Uw{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new hi(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return hs(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Oi(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Oi(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Oi(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class UR extends ps{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Oi(16777215),this.specular=new Oi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Oi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wh,this.normalScale=new hi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Nw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Ott extends ps{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Oi(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Oi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wh,this.normalScale=new hi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class GR extends ps{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wh,this.normalScale=new hi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class VR extends ps{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Oi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Oi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wh,this.normalScale=new hi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Nw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Ptt extends ps{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Oi(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wh,this.normalScale=new hi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Gw extends zw{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function xp(n,t,e){return!n||!e&&n.constructor===t?n:typeof t.BYTES_PER_ELEMENT=="number"?new t(n):Array.prototype.slice.call(n)}function Ftt(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}class Ug{constructor(t,e,i,s){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,s=e[i],r=e[i-1];t:{e:{let a;i:{n:if(!(t<s)){for(let o=i+2;;){if(s===void 0){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===o)break;if(r=s,s=e[++i],t<s)break e}a=e.length;break i}if(!(t>=r)){const o=e[1];t<o&&(i=2,r=o);for(let h=i-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===h)break;if(s=r,r=e[--i-1],t>=r)break e}a=i,i=0;break i}break t}for(;i<a;){const o=i+a>>>1;t<e[o]?a=o:i=o+1}if(s=e[i],r=e[i-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,s)}return this.interpolate_(i,r,t,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=t*s;for(let a=0;a!==s;++a)e[a]=i[r+a];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Dtt extends Ug{constructor(t,e,i,s){super(t,e,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:WE,endingEnd:WE}}intervalChanged_(t,e,i){const s=this.parameterPositions;let r=t-2,a=t+1,o=s[r],h=s[a];if(o===void 0)switch(this.getSettings_().endingStart){case $E:r=t,o=2*e-i;break;case YE:r=s.length-2,o=e+s[r]-s[r+1];break;default:r=t,o=i}if(h===void 0)switch(this.getSettings_().endingEnd){case $E:a=t,h=2*i-e;break;case YE:a=1,h=i+s[1]-s[0];break;default:a=t-1,h=e}const l=(i-e)*.5,u=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(h-i),this._offsetPrev=r*u,this._offsetNext=a*u}interpolate_(t,e,i,s){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,h=t*o,l=h-o,u=this._offsetPrev,f=this._offsetNext,m=this._weightPrev,g=this._weightNext,y=(i-e)/(s-e),_=y*y,w=_*y,M=-m*w+2*m*_-m*y,T=(1+m)*w+(-1.5-2*m)*_+(-.5+m)*y+1,A=(-1-g)*w+(1.5+g)*_+.5*y,R=g*w-g*_;for(let I=0;I!==o;++I)r[I]=M*a[u+I]+T*a[l+I]+A*a[h+I]+R*a[f+I];return r}}class ztt extends Ug{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t,e,i,s){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,h=t*o,l=h-o,u=(i-e)/(s-e),f=1-u;for(let m=0;m!==o;++m)r[m]=a[l+m]*f+a[h+m]*u;return r}}class Btt extends Ug{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t){return this.copySampleValue_(t-1)}}class No{constructor(t,e,i,s){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=xp(e,this.TimeBufferType),this.values=xp(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:xp(t.times,Array),values:xp(t.values,Array)};const s=t.getInterpolation();s!==t.DefaultInterpolation&&(i.interpolation=s)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new Btt(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new ztt(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Dtt(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Cm:e=this.InterpolantFactoryMethodDiscrete;break;case Am:e=this.InterpolantFactoryMethodLinear;break;case l1:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Cm;case this.InterpolantFactoryMethodLinear:return Am;case this.InterpolantFactoryMethodSmooth:return l1}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const e=this.times;for(let i=0,s=e.length;i!==s;++i)e[i]+=t}return this}scale(t){if(t!==1){const e=this.times;for(let i=0,s=e.length;i!==s;++i)e[i]*=t}return this}trim(t,e){const i=this.times,s=i.length;let r=0,a=s-1;for(;r!==s&&i[r]<t;)++r;for(;a!==-1&&i[a]>e;)--a;if(++a,r!==0||a!==s){r>=a&&(a=Math.max(a,1),r=a-1);const o=this.getValueSize();this.times=i.slice(r,a),this.values=this.values.slice(r*o,a*o)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,s=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let a=null;for(let o=0;o!==r;o++){const h=i[o];if(typeof h=="number"&&isNaN(h)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,h),t=!1;break}if(a!==null&&a>h){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,h,a),t=!1;break}a=h}if(s!==void 0&&Ftt(s))for(let o=0,h=s.length;o!==h;++o){const l=s[o];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,l),t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),i=this.getValueSize(),s=this.getInterpolation()===l1,r=t.length-1;let a=1;for(let o=1;o<r;++o){let h=!1;const l=t[o],u=t[o+1];if(l!==u&&(o!==1||l!==t[0]))if(s)h=!0;else{const f=o*i,m=f-i,g=f+i;for(let y=0;y!==i;++y){const _=e[f+y];if(_!==e[m+y]||_!==e[g+y]){h=!0;break}}}if(h){if(o!==a){t[a]=t[o];const f=o*i,m=a*i;for(let g=0;g!==i;++g)e[m+g]=e[f+g]}++a}}if(r>0){t[a]=t[r];for(let o=r*i,h=a*i,l=0;l!==i;++l)e[h+l]=e[o+l];++a}return a!==t.length?(this.times=t.slice(0,a),this.values=e.slice(0,a*i)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),i=this.constructor,s=new i(this.name,t,e);return s.createInterpolant=this.createInterpolant,s}}No.prototype.TimeBufferType=Float32Array;No.prototype.ValueBufferType=Float32Array;No.prototype.DefaultInterpolation=Am;class Hf extends No{}Hf.prototype.ValueTypeName="bool";Hf.prototype.ValueBufferType=Array;Hf.prototype.DefaultInterpolation=Cm;Hf.prototype.InterpolantFactoryMethodLinear=void 0;Hf.prototype.InterpolantFactoryMethodSmooth=void 0;class Utt extends No{}Utt.prototype.ValueTypeName="color";class Gtt extends No{}Gtt.prototype.ValueTypeName="number";class Vtt extends Ug{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t,e,i,s){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,h=(i-e)/(s-e);let l=t*o;for(let u=l+o;l!==u;l+=4)Au.slerpFlat(r,0,a,l-o,a,l,h);return r}}class Vw extends No{InterpolantFactoryMethodLinear(t){return new Vtt(this.times,this.values,this.getValueSize(),t)}}Vw.prototype.ValueTypeName="quaternion";Vw.prototype.DefaultInterpolation=Am;Vw.prototype.InterpolantFactoryMethodSmooth=void 0;class qf extends No{}qf.prototype.ValueTypeName="string";qf.prototype.ValueBufferType=Array;qf.prototype.DefaultInterpolation=Cm;qf.prototype.InterpolantFactoryMethodLinear=void 0;qf.prototype.InterpolantFactoryMethodSmooth=void 0;class Wtt extends No{}Wtt.prototype.ValueTypeName="vector";const pS={enabled:!1,files:{},add:function(n,t){this.enabled!==!1&&(this.files[n]=t)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class $tt{constructor(t,e,i){const s=this;let r=!1,a=0,o=0,h;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(u){o++,r===!1&&s.onStart!==void 0&&s.onStart(u,a,o),r=!0},this.itemEnd=function(u){a++,s.onProgress!==void 0&&s.onProgress(u,a,o),a===o&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(u){s.onError!==void 0&&s.onError(u)},this.resolveURL=function(u){return h?h(u):u},this.setURLModifier=function(u){return h=u,this},this.addHandler=function(u,f){return l.push(u,f),this},this.removeHandler=function(u){const f=l.indexOf(u);return f!==-1&&l.splice(f,2),this},this.getHandler=function(u){for(let f=0,m=l.length;f<m;f+=2){const g=l[f],y=l[f+1];if(g.global&&(g.lastIndex=0),g.test(u))return y}return null}}}const Ytt=new $tt;class Ww{constructor(t){this.manager=t!==void 0?t:Ytt,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise(function(s,r){i.load(t,s,e,r)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}Ww.DEFAULT_MATERIAL_NAME="__DEFAULT";const Qa={};class Htt extends Error{constructor(t,e){super(t),this.response=e}}class qtt extends Ww{constructor(t){super(t)}load(t,e,i,s){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const r=pS.get(t);if(r!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(r),this.manager.itemEnd(t)},0),r;if(Qa[t]!==void 0){Qa[t].push({onLoad:e,onProgress:i,onError:s});return}Qa[t]=[],Qa[t].push({onLoad:e,onProgress:i,onError:s});const a=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,h=this.responseType;fetch(a).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;const u=Qa[t],f=l.body.getReader(),m=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),g=m?parseInt(m):0,y=g!==0;let _=0;const w=new ReadableStream({start(M){T();function T(){f.read().then(({done:A,value:R})=>{if(A)M.close();else{_+=R.byteLength;const I=new ProgressEvent("progress",{lengthComputable:y,loaded:_,total:g});for(let L=0,k=u.length;L<k;L++){const Y=u[L];Y.onProgress&&Y.onProgress(I)}M.enqueue(R),T()}})}}});return new Response(w)}else throw new Htt(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(h){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(u=>new DOMParser().parseFromString(u,o));case"json":return l.json();default:if(o===void 0)return l.text();{const f=/charset="?([^;"\s]*)"?/i.exec(o),m=f&&f[1]?f[1].toLowerCase():void 0,g=new TextDecoder(m);return l.arrayBuffer().then(y=>g.decode(y))}}}).then(l=>{pS.add(t,l);const u=Qa[t];delete Qa[t];for(let f=0,m=u.length;f<m;f++){const g=u[f];g.onLoad&&g.onLoad(l)}}).catch(l=>{const u=Qa[t];if(u===void 0)throw this.manager.itemError(t),l;delete Qa[t];for(let f=0,m=u.length;f<m;f++){const g=u[f];g.onError&&g.onError(l)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class Xf extends fs{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Oi(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}}class Xtt extends Xf{constructor(t,e,i){super(t,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(fs.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Oi(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const C1=new Rn,mS=new Lt,gS=new Lt;class $w{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new hi(512,512),this.map=null,this.mapPass=null,this.matrix=new Rn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Att,this._frameExtents=new hi(1,1),this._viewportCount=1,this._viewports=[new $n(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;mS.setFromMatrixPosition(t.matrixWorld),e.position.copy(mS),gS.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(gS),e.updateMatrixWorld(),C1.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(C1),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(C1)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class jtt extends $w{constructor(){super(new OR(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,i=uf*2*t.angle*this.focus,s=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;(i!==e.fov||s!==e.aspect||r!==e.far)&&(e.fov=i,e.aspect=s,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class WR extends Xf{constructor(t,e,i=0,s=Math.PI/3,r=0,a=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(fs.DEFAULT_UP),this.updateMatrix(),this.target=new fs,this.distance=i,this.angle=s,this.penumbra=r,this.decay=a,this.map=null,this.shadow=new jtt}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const yS=new Rn,hd=new Lt,A1=new Lt;class Ztt extends $w{constructor(){super(new OR(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new hi(4,2),this._viewportCount=6,this._viewports=[new $n(2,1,1,1),new $n(0,1,1,1),new $n(3,1,1,1),new $n(1,1,1,1),new $n(3,0,1,1),new $n(1,0,1,1)],this._cubeDirections=[new Lt(1,0,0),new Lt(-1,0,0),new Lt(0,0,1),new Lt(0,0,-1),new Lt(0,1,0),new Lt(0,-1,0)],this._cubeUps=[new Lt(0,1,0),new Lt(0,1,0),new Lt(0,1,0),new Lt(0,1,0),new Lt(0,0,1),new Lt(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,s=this.matrix,r=t.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),hd.setFromMatrixPosition(t.matrixWorld),i.position.copy(hd),A1.copy(i.position),A1.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(A1),i.updateMatrixWorld(),s.makeTranslation(-hd.x,-hd.y,-hd.z),yS.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(yS)}}class Ktt extends Xf{constructor(t,e,i=0,s=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=s,this.shadow=new Ztt}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class Jtt extends $w{constructor(){super(new PR(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Qtt extends Xf{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(fs.DEFAULT_UP),this.updateMatrix(),this.target=new fs,this.shadow=new Jtt}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class tet extends Xf{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class Gg extends Ww{constructor(t){super(t),this.textures={}}load(t,e,i,s){const r=this,a=new qtt(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(t,function(o){try{e(r.parse(JSON.parse(o)))}catch(h){s?s(h):console.error(h),r.manager.itemError(t)}},i,s)}parse(t){const e=this.textures;function i(r){return e[r]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",r),e[r]}const s=Gg.createMaterialFromType(t.type);if(t.uuid!==void 0&&(s.uuid=t.uuid),t.name!==void 0&&(s.name=t.name),t.color!==void 0&&s.color!==void 0&&s.color.setHex(t.color),t.roughness!==void 0&&(s.roughness=t.roughness),t.metalness!==void 0&&(s.metalness=t.metalness),t.sheen!==void 0&&(s.sheen=t.sheen),t.sheenColor!==void 0&&(s.sheenColor=new Oi().setHex(t.sheenColor)),t.sheenRoughness!==void 0&&(s.sheenRoughness=t.sheenRoughness),t.emissive!==void 0&&s.emissive!==void 0&&s.emissive.setHex(t.emissive),t.specular!==void 0&&s.specular!==void 0&&s.specular.setHex(t.specular),t.specularIntensity!==void 0&&(s.specularIntensity=t.specularIntensity),t.specularColor!==void 0&&s.specularColor!==void 0&&s.specularColor.setHex(t.specularColor),t.shininess!==void 0&&(s.shininess=t.shininess),t.clearcoat!==void 0&&(s.clearcoat=t.clearcoat),t.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=t.clearcoatRoughness),t.iridescence!==void 0&&(s.iridescence=t.iridescence),t.iridescenceIOR!==void 0&&(s.iridescenceIOR=t.iridescenceIOR),t.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=t.iridescenceThicknessRange),t.transmission!==void 0&&(s.transmission=t.transmission),t.thickness!==void 0&&(s.thickness=t.thickness),t.attenuationDistance!==void 0&&(s.attenuationDistance=t.attenuationDistance),t.attenuationColor!==void 0&&s.attenuationColor!==void 0&&s.attenuationColor.setHex(t.attenuationColor),t.anisotropy!==void 0&&(s.anisotropy=t.anisotropy),t.anisotropyRotation!==void 0&&(s.anisotropyRotation=t.anisotropyRotation),t.fog!==void 0&&(s.fog=t.fog),t.flatShading!==void 0&&(s.flatShading=t.flatShading),t.blending!==void 0&&(s.blending=t.blending),t.combine!==void 0&&(s.combine=t.combine),t.side!==void 0&&(s.side=t.side),t.shadowSide!==void 0&&(s.shadowSide=t.shadowSide),t.opacity!==void 0&&(s.opacity=t.opacity),t.transparent!==void 0&&(s.transparent=t.transparent),t.alphaTest!==void 0&&(s.alphaTest=t.alphaTest),t.alphaHash!==void 0&&(s.alphaHash=t.alphaHash),t.depthFunc!==void 0&&(s.depthFunc=t.depthFunc),t.depthTest!==void 0&&(s.depthTest=t.depthTest),t.depthWrite!==void 0&&(s.depthWrite=t.depthWrite),t.colorWrite!==void 0&&(s.colorWrite=t.colorWrite),t.blendSrc!==void 0&&(s.blendSrc=t.blendSrc),t.blendDst!==void 0&&(s.blendDst=t.blendDst),t.blendEquation!==void 0&&(s.blendEquation=t.blendEquation),t.blendSrcAlpha!==void 0&&(s.blendSrcAlpha=t.blendSrcAlpha),t.blendDstAlpha!==void 0&&(s.blendDstAlpha=t.blendDstAlpha),t.blendEquationAlpha!==void 0&&(s.blendEquationAlpha=t.blendEquationAlpha),t.blendColor!==void 0&&s.blendColor!==void 0&&s.blendColor.setHex(t.blendColor),t.blendAlpha!==void 0&&(s.blendAlpha=t.blendAlpha),t.stencilWriteMask!==void 0&&(s.stencilWriteMask=t.stencilWriteMask),t.stencilFunc!==void 0&&(s.stencilFunc=t.stencilFunc),t.stencilRef!==void 0&&(s.stencilRef=t.stencilRef),t.stencilFuncMask!==void 0&&(s.stencilFuncMask=t.stencilFuncMask),t.stencilFail!==void 0&&(s.stencilFail=t.stencilFail),t.stencilZFail!==void 0&&(s.stencilZFail=t.stencilZFail),t.stencilZPass!==void 0&&(s.stencilZPass=t.stencilZPass),t.stencilWrite!==void 0&&(s.stencilWrite=t.stencilWrite),t.wireframe!==void 0&&(s.wireframe=t.wireframe),t.wireframeLinewidth!==void 0&&(s.wireframeLinewidth=t.wireframeLinewidth),t.wireframeLinecap!==void 0&&(s.wireframeLinecap=t.wireframeLinecap),t.wireframeLinejoin!==void 0&&(s.wireframeLinejoin=t.wireframeLinejoin),t.rotation!==void 0&&(s.rotation=t.rotation),t.linewidth!==void 0&&(s.linewidth=t.linewidth),t.dashSize!==void 0&&(s.dashSize=t.dashSize),t.gapSize!==void 0&&(s.gapSize=t.gapSize),t.scale!==void 0&&(s.scale=t.scale),t.polygonOffset!==void 0&&(s.polygonOffset=t.polygonOffset),t.polygonOffsetFactor!==void 0&&(s.polygonOffsetFactor=t.polygonOffsetFactor),t.polygonOffsetUnits!==void 0&&(s.polygonOffsetUnits=t.polygonOffsetUnits),t.dithering!==void 0&&(s.dithering=t.dithering),t.alphaToCoverage!==void 0&&(s.alphaToCoverage=t.alphaToCoverage),t.premultipliedAlpha!==void 0&&(s.premultipliedAlpha=t.premultipliedAlpha),t.forceSinglePass!==void 0&&(s.forceSinglePass=t.forceSinglePass),t.visible!==void 0&&(s.visible=t.visible),t.toneMapped!==void 0&&(s.toneMapped=t.toneMapped),t.userData!==void 0&&(s.userData=t.userData),t.vertexColors!==void 0&&(typeof t.vertexColors=="number"?s.vertexColors=t.vertexColors>0:s.vertexColors=t.vertexColors),t.uniforms!==void 0)for(const r in t.uniforms){const a=t.uniforms[r];switch(s.uniforms[r]={},a.type){case"t":s.uniforms[r].value=i(a.value);break;case"c":s.uniforms[r].value=new Oi().setHex(a.value);break;case"v2":s.uniforms[r].value=new hi().fromArray(a.value);break;case"v3":s.uniforms[r].value=new Lt().fromArray(a.value);break;case"v4":s.uniforms[r].value=new $n().fromArray(a.value);break;case"m3":s.uniforms[r].value=new oa().fromArray(a.value);break;case"m4":s.uniforms[r].value=new Rn().fromArray(a.value);break;default:s.uniforms[r].value=a.value}}if(t.defines!==void 0&&(s.defines=t.defines),t.vertexShader!==void 0&&(s.vertexShader=t.vertexShader),t.fragmentShader!==void 0&&(s.fragmentShader=t.fragmentShader),t.glslVersion!==void 0&&(s.glslVersion=t.glslVersion),t.extensions!==void 0)for(const r in t.extensions)s.extensions[r]=t.extensions[r];if(t.lights!==void 0&&(s.lights=t.lights),t.clipping!==void 0&&(s.clipping=t.clipping),t.size!==void 0&&(s.size=t.size),t.sizeAttenuation!==void 0&&(s.sizeAttenuation=t.sizeAttenuation),t.map!==void 0&&(s.map=i(t.map)),t.matcap!==void 0&&(s.matcap=i(t.matcap)),t.alphaMap!==void 0&&(s.alphaMap=i(t.alphaMap)),t.bumpMap!==void 0&&(s.bumpMap=i(t.bumpMap)),t.bumpScale!==void 0&&(s.bumpScale=t.bumpScale),t.normalMap!==void 0&&(s.normalMap=i(t.normalMap)),t.normalMapType!==void 0&&(s.normalMapType=t.normalMapType),t.normalScale!==void 0){let r=t.normalScale;Array.isArray(r)===!1&&(r=[r,r]),s.normalScale=new hi().fromArray(r)}return t.displacementMap!==void 0&&(s.displacementMap=i(t.displacementMap)),t.displacementScale!==void 0&&(s.displacementScale=t.displacementScale),t.displacementBias!==void 0&&(s.displacementBias=t.displacementBias),t.roughnessMap!==void 0&&(s.roughnessMap=i(t.roughnessMap)),t.metalnessMap!==void 0&&(s.metalnessMap=i(t.metalnessMap)),t.emissiveMap!==void 0&&(s.emissiveMap=i(t.emissiveMap)),t.emissiveIntensity!==void 0&&(s.emissiveIntensity=t.emissiveIntensity),t.specularMap!==void 0&&(s.specularMap=i(t.specularMap)),t.specularIntensityMap!==void 0&&(s.specularIntensityMap=i(t.specularIntensityMap)),t.specularColorMap!==void 0&&(s.specularColorMap=i(t.specularColorMap)),t.envMap!==void 0&&(s.envMap=i(t.envMap)),t.envMapIntensity!==void 0&&(s.envMapIntensity=t.envMapIntensity),t.reflectivity!==void 0&&(s.reflectivity=t.reflectivity),t.refractionRatio!==void 0&&(s.refractionRatio=t.refractionRatio),t.lightMap!==void 0&&(s.lightMap=i(t.lightMap)),t.lightMapIntensity!==void 0&&(s.lightMapIntensity=t.lightMapIntensity),t.aoMap!==void 0&&(s.aoMap=i(t.aoMap)),t.aoMapIntensity!==void 0&&(s.aoMapIntensity=t.aoMapIntensity),t.gradientMap!==void 0&&(s.gradientMap=i(t.gradientMap)),t.clearcoatMap!==void 0&&(s.clearcoatMap=i(t.clearcoatMap)),t.clearcoatRoughnessMap!==void 0&&(s.clearcoatRoughnessMap=i(t.clearcoatRoughnessMap)),t.clearcoatNormalMap!==void 0&&(s.clearcoatNormalMap=i(t.clearcoatNormalMap)),t.clearcoatNormalScale!==void 0&&(s.clearcoatNormalScale=new hi().fromArray(t.clearcoatNormalScale)),t.iridescenceMap!==void 0&&(s.iridescenceMap=i(t.iridescenceMap)),t.iridescenceThicknessMap!==void 0&&(s.iridescenceThicknessMap=i(t.iridescenceThicknessMap)),t.transmissionMap!==void 0&&(s.transmissionMap=i(t.transmissionMap)),t.thicknessMap!==void 0&&(s.thicknessMap=i(t.thicknessMap)),t.anisotropyMap!==void 0&&(s.anisotropyMap=i(t.anisotropyMap)),t.sheenColorMap!==void 0&&(s.sheenColorMap=i(t.sheenColorMap)),t.sheenRoughnessMap!==void 0&&(s.sheenRoughnessMap=i(t.sheenRoughnessMap)),s}setTextures(t){return this.textures=t,this}static createMaterialFromType(t){const e={ShadowMaterial:ktt,SpriteMaterial:DR,RawShaderMaterial:Ltt,ShaderMaterial:Fw,PointsMaterial:Bw,MeshPhysicalMaterial:BR,MeshStandardMaterial:Uw,MeshPhongMaterial:UR,MeshToonMaterial:Ott,MeshNormalMaterial:GR,MeshLambertMaterial:VR,MeshDepthMaterial:Itt,MeshDistanceMaterial:Ntt,MeshBasicMaterial:Pw,MeshMatcapMaterial:Ptt,LineDashedMaterial:Gw,LineBasicMaterial:zw,Material:ps};return new e[t]}}class eet extends FR{constructor(t,e,i=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:MR}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=MR);function $R(n){let t="{";n.isNode===!0&&(t+=n.id);for(const{property:e,childNode:i}of Nm(n))t+=","+e.slice(0,-4)+":"+i.getCacheKey();return t+="}",t}function*Nm(n,t=!1){for(const e in n){if(e.startsWith("_")===!0)continue;const i=n[e];if(Array.isArray(i)===!0)for(let s=0;s<i.length;s++){const r=i[s];r&&(r.isNode===!0||t&&typeof r.toJSON=="function")&&(yield{property:e,index:s,childNode:r})}else if(i&&i.isNode===!0)yield{property:e,childNode:i};else if(typeof i=="object")for(const s in i){const r=i[s];r&&(r.isNode===!0||t&&typeof r.toJSON=="function")&&(yield{property:e,index:s,childNode:r})}}}function nl(n){if(n==null)return null;const t=typeof n;return n.isNode===!0?"node":t==="number"?"float":t==="boolean"?"bool":t==="string"?"string":t==="function"?"shader":n.isVector2===!0?"vec2":n.isVector3===!0?"vec3":n.isVector4===!0?"vec4":n.isMatrix3===!0?"mat3":n.isMatrix4===!0?"mat4":n.isColor===!0?"color":n instanceof ArrayBuffer?"ArrayBuffer":null}function YR(n,...t){const e=n?n.slice(-4):void 0;return t.length===1&&(e==="vec2"?t=[t[0],t[0]]:e==="vec3"?t=[t[0],t[0],t[0]]:e==="vec4"&&(t=[t[0],t[0],t[0],t[0]])),n==="color"?new Oi(...t):e==="vec2"?new hi(...t):e==="vec3"?new Lt(...t):e==="vec4"?new $n(...t):e==="mat3"?new oa(...t):e==="mat4"?new Rn(...t):n==="bool"?t[0]||!1:n==="float"||n==="int"||n==="uint"?t[0]||0:n==="string"?t[0]||"":n==="ArrayBuffer"?qR(t[0]):null}function HR(n){let t="";const e=new Uint8Array(n);for(let i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);return btoa(t)}function qR(n){return Uint8Array.from(atob(n),t=>t.charCodeAt(0)).buffer}const _S=new Map;let iet=0;class Ae extends Al{constructor(t=null){super(),this.nodeType=t,this.updateType=gn.NONE,this.updateBeforeType=gn.NONE,this.uuid=IR.generateUUID(),this.isNode=!0,Object.defineProperty(this,"id",{value:iet++})}get type(){return this.constructor.type}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return!1}*getChildren(){for(const{childNode:t}of Nm(this))yield t}dispose(){this.dispatchEvent({type:"dispose"})}traverse(t){t(this);for(const e of this.getChildren())e.traverse(t)}getCacheKey(){return $R(this)}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getNodeType(t){const e=t.getNodeProperties(this);return e.outputNode?e.outputNode.getNodeType(t):this.nodeType}getShared(t){const e=this.getHash(t);return t.getNodeFromHash(e)||this}setup(t){const e=t.getNodeProperties(this);for(const i of this.getChildren())e["_node"+i.id]=i;return null}construct(t){return console.warn("THREE.Node: construct() is deprecated. Use setup() instead."),this.setup(t)}analyze(t){const e=t.getDataFromNode(this);if(e.dependenciesCount=e.dependenciesCount===void 0?1:e.dependenciesCount+1,e.dependenciesCount===1){const i=t.getNodeProperties(this);for(const s of Object.values(i))s&&s.isNode===!0&&s.build(t)}}generate(t,e){const{outputNode:i}=t.getNodeProperties(this);if(i&&i.isNode===!0)return i.build(t,e)}updateBefore(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(t,e=null){const i=this.getShared(t);if(this!==i)return i.build(t,e);t.addNode(this),t.addChain(this);let s=null;const r=t.getBuildStage();if(r==="setup"){const a=t.getNodeProperties(this);if(a.initialized!==!0||t.context.tempRead===!1){const o=t.stack.nodes.length;a.initialized=!0,a.outputNode=this.setup(t),a.outputNode!==null&&t.stack.nodes.length!==o&&(a.outputNode=t.stack);for(const h of Object.values(a))h&&h.isNode===!0&&h.build(t)}}else if(r==="analyze")this.analyze(t);else if(r==="generate")if(this.generate.length===1){const o=this.getNodeType(t),h=t.getDataFromNode(this);s=h.snippet,s===void 0&&(s=this.generate(t)||"",h.snippet=s),s=t.format(s,o,e)}else s=this.generate(t,e)||"";return t.removeChain(this),s}getSerializeChildren(){return Nm(this)}serialize(t){const e=this.getSerializeChildren(),i={};for(const{property:s,index:r,childNode:a}of e)r!==void 0?(i[s]===void 0&&(i[s]=Number.isInteger(r)?[]:{}),i[s][r]=a.toJSON(t.meta).uuid):i[s]=a.toJSON(t.meta).uuid;Object.keys(i).length>0&&(t.inputNodes=i)}deserialize(t){if(t.inputNodes!==void 0){const e=t.meta.nodes;for(const i in t.inputNodes)if(Array.isArray(t.inputNodes[i])){const s=[];for(const r of t.inputNodes[i])s.push(e[r]);this[i]=s}else if(typeof t.inputNodes[i]=="object"){const s={};for(const r in t.inputNodes[i]){const a=t.inputNodes[i][r];s[r]=e[a]}this[i]=s}else{const s=t.inputNodes[i];this[i]=e[s]}}}toJSON(t){const{uuid:e,type:i}=this,s=t===void 0||typeof t=="string";s&&(t={textures:{},images:{},nodes:{}});let r=t.nodes[e];r===void 0&&(r={uuid:e,type:i,meta:t,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},s!==!0&&(t.nodes[r.uuid]=r),this.serialize(r),delete r.meta);function a(o){const h=[];for(const l in o){const u=o[l];delete u.metadata,h.push(u)}return h}if(s){const o=a(t.textures),h=a(t.images),l=a(t.nodes);o.length>0&&(r.textures=o),h.length>0&&(r.images=h),l.length>0&&(r.nodes=l)}return r}}function qt(n,t){if(typeof t!="function"||!n)throw new Error(`Node class ${n} is not a class`);if(_S.has(n)){console.warn(`Redefinition of node class ${n}`);return}_S.set(n,t),t.type=n}class Vg extends Ae{constructor(t,e=null){super(e),this.isInputNode=!0,this.value=t,this.precision=null}getNodeType(){return this.nodeType===null?nl(this.value):this.nodeType}getInputType(t){return this.getNodeType(t)}setPrecision(t){return this.precision=t,this}serialize(t){super.serialize(t),t.value=this.value,this.value&&this.value.toArray&&(t.value=this.value.toArray()),t.valueType=nl(this.value),t.nodeType=this.nodeType,t.valueType==="ArrayBuffer"&&(t.value=HR(t.value)),t.precision=this.precision}deserialize(t){super.deserialize(t),this.nodeType=t.nodeType,this.value=Array.isArray(t.value)?YR(t.valueType,...t.value):t.value,this.precision=t.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(t.value))}generate(){console.warn("Abstract function.")}}qt("InputNode",Vg);class Yw extends Ae{constructor(t,e=!1){super("string"),this.name=t,this.version=0,this.shared=e,this.isUniformGroup=!0}set needsUpdate(t){t===!0&&this.version++}}const net=n=>new Yw(n),XR=n=>new Yw(n,!0);XR("frame");XR("render");const set=net("object");qt("UniformGroupNode",Yw);class Hw extends Ae{constructor(t,e){super(),this.node=t,this.indexNode=e,this.isArrayElementNode=!0}getNodeType(t){return this.node.getNodeType(t)}generate(t){const e=this.node.build(t),i=this.indexNode.build(t,"uint");return`${e}[ ${i} ]`}}qt("ArrayElementNode",Hw);class qw extends Ae{constructor(t,e){super(),this.node=t,this.convertTo=e}getNodeType(t){const e=this.node.getNodeType(t);let i=null;for(const s of this.convertTo.split("|"))(i===null||t.getTypeLength(e)===t.getTypeLength(s))&&(i=s);return i}serialize(t){super.serialize(t),t.convertTo=this.convertTo}deserialize(t){super.deserialize(t),this.convertTo=t.convertTo}generate(t,e){const i=this.node,s=this.getNodeType(t),r=i.build(t,s);return t.format(r,s,e)}}qt("ConvertNode",qw);class Qi extends Ae{constructor(t){super(t),this.isTempNode=!0}hasDependencies(t){return t.getDataFromNode(this).dependenciesCount>1}build(t,e){if(t.getBuildStage()==="generate"){const s=t.getVectorType(this.getNodeType(t,e)),r=t.getDataFromNode(this);if(t.context.tempRead!==!1&&r.propertyName!==void 0)return t.format(r.propertyName,s,e);if(t.context.tempWrite!==!1&&s!=="void"&&e!=="void"&&this.hasDependencies(t)){const a=super.build(t,s),o=t.getVarFromNode(this,null,s),h=t.getPropertyName(o);return t.addLineFlowCode(`${h} = ${a}`),r.snippet=a,r.propertyName=h,t.format(r.propertyName,s,e)}}return super.build(t,e)}}qt("TempNode",Qi);class jR extends Qi{constructor(t=[],e=null){super(e),this.nodes=t}getNodeType(t){return this.nodeType!==null?t.getVectorType(this.nodeType):t.getTypeFromLength(this.nodes.reduce((e,i)=>e+t.getTypeLength(i.getNodeType(t)),0))}generate(t,e){const i=this.getNodeType(t),s=this.nodes,r=t.getPrimitiveType(i),a=[];for(const h of s){let l=h.build(t);const u=t.getPrimitiveType(h.getNodeType(t));u!==r&&(l=t.format(l,u,r)),a.push(l)}const o=`${t.getType(i)}( ${a.join(", ")} )`;return t.format(o,i,e)}}qt("JoinNode",jR);const ret=Iw.join("");class H_ extends Ae{constructor(t,e="x"){super(),this.node=t,this.components=e,this.isSplitNode=!0}getVectorLength(){let t=this.components.length;for(const e of this.components)t=Math.max(Iw.indexOf(e)+1,t);return t}getPrimitiveType(t){return t.getPrimitiveType(this.node.getNodeType(t))}getNodeType(t){return t.getTypeFromLength(this.components.length,this.getPrimitiveType(t))}generate(t,e){const i=this.node,s=t.getTypeLength(i.getNodeType(t));let r=null;if(s>1){let a=null;this.getVectorLength()>=s&&(a=t.getTypeFromLength(this.getVectorLength(),this.getPrimitiveType(t)));const h=i.build(t,a);this.components.length===s&&this.components===ret.slice(0,this.components.length)?r=t.format(h,a,e):r=t.format(`${h}.${this.components}`,this.getNodeType(t),e)}else r=i.build(t,e);return r}serialize(t){super.serialize(t),t.components=this.components}deserialize(t){super.deserialize(t),this.components=t.components}}qt("SplitNode",H_);class ZR extends Qi{constructor(t,e,i){super(),this.sourceNode=t,this.components=e,this.targetNode=i}getNodeType(t){return this.sourceNode.getNodeType(t)}generate(t){const{sourceNode:e,components:i,targetNode:s}=this,r=this.getNodeType(t),a=t.getTypeFromLength(i.length),o=s.build(t,a),h=e.build(t,r),l=t.getTypeLength(r),u=[];for(let f=0;f<l;f++){const m=Iw[f];m===i[0]?(u.push(o),f+=i.length-1):u.push(h+"."+m)}return`${t.getType(r)}( ${u.join(", ")} )`}}qt("SetNode",ZR);class Sr extends Vg{constructor(t,e=null){super(t,e),this.isConstNode=!0}generateConst(t){return t.generateConst(this.getNodeType(t),this.value)}generate(t,e){const i=this.getNodeType(t);return t.format(this.generateConst(t),i,e)}}qt("ConstNode",Sr);let lu=null;const Ac=new Map;function Mt(n,t){if(Ac.has(n)){console.warn(`Redefinition of node element ${n}`);return}if(typeof t!="function")throw new Error(`Node element ${n} is not a function`);Ac.set(n,t)}const xS=n=>n.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),KR={setup(n,t){const e=t.shift();return n(Yg(e),...t)},get(n,t,e){if(typeof t=="string"&&n[t]===void 0){if(n.isStackNode!==!0&&t==="assign")return(...i)=>(lu.assign(e,...i),e);if(Ac.has(t)){const i=Ac.get(t);return n.isStackNode?(...s)=>e.add(i(...s)):(...s)=>i(e,...s)}else{if(t==="self")return n;if(t.endsWith("Assign")&&Ac.has(t.slice(0,t.length-6))){const i=Ac.get(t.slice(0,t.length-6));return n.isStackNode?(...s)=>e.assign(s[0],i(...s)):(...s)=>e.assign(i(e,...s))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(t)===!0)return t=xS(t),Me(new H_(e,t));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(t)===!0)return t=xS(t.slice(3).toLowerCase()),t=t.split("").sort().join(""),i=>Me(new ZR(n,t,i));if(t==="width"||t==="height"||t==="depth")return t==="width"?t="x":t==="height"?t="y":t==="depth"&&(t="z"),Me(new H_(n,t));if(/^\d+$/.test(t)===!0)return Me(new Hw(e,new Sr(Number(t),"uint")))}}}return Reflect.get(n,t,e)},set(n,t,e,i){return typeof t=="string"&&n[t]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(t)===!0||t==="width"||t==="height"||t==="depth"||/^\d+$/.test(t)===!0)?(i[t].assign(e),!0):Reflect.set(n,t,e,i)}},R1=new WeakMap,vS=new WeakMap,aet=function(n,t=null){const e=nl(n);if(e==="node"){let i=R1.get(n);return i===void 0&&(i=new Proxy(n,KR),R1.set(n,i),R1.set(i,i)),i}else{if(t===null&&(e==="float"||e==="boolean")||e&&e!=="shader"&&e!=="string")return Me(q_(n,t));if(e==="shader")return Zt(n)}return n},oet=function(n,t=null){for(const e in n)n[e]=Me(n[e],t);return n},het=function(n,t=null){const e=n.length;for(let i=0;i<e;i++)n[i]=Me(n[i],t);return n},cet=function(n,t=null,e=null,i=null){const s=r=>Me(i!==null?Object.assign(r,i):r);return t===null?(...r)=>s(new n(...Yc(r))):e!==null?(e=Me(e),(...r)=>s(new n(t,...Yc(r),e))):(...r)=>s(new n(t,...Yc(r)))},uet=function(n,...t){return Me(new n(...Yc(t)))};class det extends Ae{constructor(t,e){super(),this.shaderNode=t,this.inputNodes=e}getNodeType(t){const{outputNode:e}=t.getNodeProperties(this);return e?e.getNodeType(t):super.getNodeType(t)}call(t){const{shaderNode:e,inputNodes:i}=this;if(e.layout){let a=vS.get(t.constructor);a===void 0&&(a=new WeakMap,vS.set(t.constructor,a));let o=a.get(e);return o===void 0&&(o=Me(t.buildFunctionNode(e)),a.set(e,o)),t.currentFunctionNode!==null&&t.currentFunctionNode.includes.push(o),Me(o.call(i))}const s=e.jsFunc,r=i!==null?s(i,t.stack,t):s(t.stack,t);return Me(r)}setup(t){return t.addStack(),t.stack.outputNode=this.call(t),t.removeStack()}generate(t,e){const{outputNode:i}=t.getNodeProperties(this);return i===null?this.call(t).build(t,e):super.generate(t,e)}}class fet extends Ae{constructor(t){super(),this.jsFunc=t,this.layout=null}get isArrayInput(){return/^\(\s+?\[/.test(this.jsFunc.toString())}setLayout(t){return this.layout=t,this}call(t=null){return Yg(t),Me(new det(this,t))}setup(){return this.call()}}const pet=[!1,!0],met=[0,1,2,3],get=[-1,-2],JR=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],Xw=new Map;for(const n of pet)Xw.set(n,new Sr(n));const jw=new Map;for(const n of met)jw.set(n,new Sr(n,"uint"));const Zw=new Map([...jw].map(n=>new Sr(n.value,"int")));for(const n of get)Zw.set(n,new Sr(n,"int"));const Wg=new Map([...Zw].map(n=>new Sr(n.value)));for(const n of JR)Wg.set(n,new Sr(n));for(const n of JR)Wg.set(-n,new Sr(-n));const $g={bool:Xw,uint:jw,ints:Zw,float:Wg},wS=new Map([...Xw,...Wg]),q_=(n,t)=>wS.has(n)?wS.get(n):n.isNode===!0?n:new Sr(n,t),yet=n=>{try{return n.getNodeType()}catch{return}},$i=function(n,t=null){return(...e)=>{if((e.length===0||!["bool","float","int","uint"].includes(n)&&e.every(s=>typeof s!="object"))&&(e=[YR(n,...e)]),e.length===1&&t!==null&&t.has(e[0]))return Me(t.get(e[0]));if(e.length===1){const s=q_(e[0],n);return yet(s)===n?Me(s):Me(new qw(s,n))}const i=e.map(s=>q_(s));return Me(new jR(i,n))}},_et=n=>n!=null?n.nodeType||n.convertTo||(typeof n=="string"?n:null):null;function zd(n){return new Proxy(new fet(n),KR)}const Me=(n,t=null)=>aet(n,t),Yg=(n,t=null)=>new oet(n,t),Yc=(n,t=null)=>new het(n,t),Tt=(...n)=>new cet(...n),ne=(...n)=>new uet(...n),Zt=n=>{const t=new zd(n),e=(...i)=>{let s;return Yg(i),i[0]&&i[0].isNode?s=[...i]:s=i[0],t.call(s)};return e.shaderNode=t,e.setLayout=i=>(t.setLayout(i),e),e};qt("ShaderNode",zd);const bS=n=>{lu=n},xet=()=>lu,Bi=(...n)=>lu.if(...n);function vet(n){return lu&&lu.add(n),n}Mt("append",vet);const wet=new $i("color"),ct=new $i("float",$g.float),ot=new $i("int",$g.int),ce=new $i("uint",$g.uint),ul=new $i("bool",$g.bool),Pe=new $i("vec2"),QR=new $i("ivec2"),bet=new $i("uvec2"),Met=new $i("bvec2"),Pt=new $i("vec3"),Eet=new $i("ivec3"),jf=new $i("uvec3"),tI=new $i("bvec3"),li=new $i("vec4"),Tet=new $i("ivec4"),Cet=new $i("uvec4"),Aet=new $i("bvec4"),cu=new $i("mat3"),Ret=new $i("imat3"),Iet=new $i("umat3"),Net=new $i("bmat3"),eI=new $i("mat4"),ket=new $i("imat4"),Let=new $i("umat4"),Oet=new $i("bmat4"),Pet=(n="")=>Me(new Sr(n,"string")),Fet=n=>Me(new Sr(n,"ArrayBuffer"));Mt("color",wet);Mt("float",ct);Mt("int",ot);Mt("uint",ce);Mt("bool",ul);Mt("vec2",Pe);Mt("ivec2",QR);Mt("uvec2",bet);Mt("bvec2",Met);Mt("vec3",Pt);Mt("ivec3",Eet);Mt("uvec3",jf);Mt("bvec3",tI);Mt("vec4",li);Mt("ivec4",Tet);Mt("uvec4",Cet);Mt("bvec4",Aet);Mt("mat3",cu);Mt("imat3",Ret);Mt("umat3",Iet);Mt("bmat3",Net);Mt("mat4",eI);Mt("imat4",ket);Mt("umat4",Let);Mt("bmat4",Oet);Mt("string",Pet);Mt("arrayBuffer",Fet);const Det=Tt(Hw),zet=(n,t)=>Me(new qw(Me(n),t));Mt("element",Det);Mt("convert",zet);class Ch extends Vg{constructor(t,e=null){super(t,e),this.isUniformNode=!0,this.groupNode=set}setGroup(t){return this.groupNode=t,this}getGroup(){return this.groupNode}getUniformHash(t){return this.getHash(t)}generate(t,e){const i=this.getNodeType(t),s=this.getUniformHash(t);let r=t.getNodeFromHash(s);r===void 0&&(t.setHashNode(this,s),r=this);const a=r.getInputType(t),o=t.getUniformFromNode(r,a,t.shaderStage,t.context.label),h=t.getPropertyName(o);return t.context.label!==void 0&&delete t.context.label,t.format(h,i,e)}}const ln=(n,t)=>{const e=_et(t||n),i=n&&n.isNode===!0?n.node&&n.node.value||n.value:n;return Me(new Ch(i,e))};qt("UniformNode",Ch);class Bet extends Ch{constructor(t=[]){super(),this.isArrayUniformNode=!0,this.nodes=t}getNodeType(t){return this.nodes[0].getNodeType(t)}}qt("ArrayUniformNode",Bet);class iI extends Qi{constructor(t,e){super(),this.targetNode=t,this.sourceNode=e}hasDependencies(){return!1}getNodeType(t,e){return e!=="void"?this.targetNode.getNodeType(t):"void"}generate(t,e){const i=this.targetNode,s=this.sourceNode,r=i.getNodeType(t),a=i.build(t),o=s.build(t,r),h=`${a} = ${o}`;if(e==="void"){t.addLineFlowCode(h);return}else return s.getNodeType(t)==="void"?(t.addLineFlowCode(h),a):t.format(h,r,e)}}const Uet=Tt(iI);qt("AssignNode",iI);Mt("assign",Uet);class nI extends Ae{constructor(t,e=null){super(),this.node=t,this.name=e,this.isVaryingNode=!0}isGlobal(){return!0}getHash(t){return this.name||super.getHash(t)}getNodeType(t){return this.node.getNodeType(t)}generate(t){const{name:e,node:i}=this,s=this.getNodeType(t),r=t.getVaryingFromNode(this,e,s);r.needsInterpolation||(r.needsInterpolation=t.shaderStage==="fragment");const a=t.getPropertyName(r,OE.VERTEX);return t.flowNodeFromShaderStage(OE.VERTEX,i,s,a),t.getPropertyName(r)}}const hn=Tt(nI);Mt("varying",hn);qt("VaryingNode",nI);class Kw extends Ae{constructor(t,e=null){super(e),this._attributeName=t}isGlobal(){return!0}getHash(t){return this.getAttributeName(t)}getNodeType(t){let e=super.getNodeType(t);if(e===null){const i=this.getAttributeName(t);if(t.hasGeometryAttribute(i)){const s=t.geometry.getAttribute(i);e=t.getTypeFromAttribute(s)}else e="float"}return e}setAttributeName(t){return this._attributeName=t,this}getAttributeName(){return this._attributeName}generate(t){const e=this.getAttributeName(t),i=this.getNodeType(t);if(t.hasGeometryAttribute(e)===!0){const r=t.geometry.getAttribute(e),a=t.getTypeFromAttribute(r),o=t.getAttribute(e,a);return t.shaderStage==="vertex"?t.format(o.name,a,i):hn(this).build(t,i)}else return console.warn(`AttributeNode: Attribute "${e}" not found.`),t.generateConst(i)}}const Es=(n,t)=>Me(new Kw(n,t));qt("AttributeNode",Kw);class sI extends Ae{constructor(t,e){super(),this.isBypassNode=!0,this.outputNode=t,this.callNode=e}getNodeType(t){return this.outputNode.getNodeType(t)}generate(t){const e=this.callNode.build(t,"void");return e!==""&&t.addLineFlowCode(e),this.outputNode.build(t)}}const rI=Tt(sI);Mt("bypass",rI);qt("BypassNode",sI);let Get=0;class Vet{constructor(){this.id=Get++,this.nodesData=new WeakMap}getNodeData(t){return this.nodesData.get(t)}setNodeData(t,e){this.nodesData.set(t,e)}}class aI extends Ae{constructor(t,e=new Vet){super(),this.isCacheNode=!0,this.node=t,this.cache=e}getNodeType(t){return this.node.getNodeType(t)}build(t,...e){const i=t.getCache(),s=this.cache||t.globalCache;t.setCache(s);const r=this.node.build(t,...e);return t.setCache(i),r}}const km=Tt(aI),Wet=n=>km(n,null);Mt("cache",km);Mt("globalCache",Wet);qt("CacheNode",aI);class Jw extends Ae{constructor(t,e={}){super(),this.isContextNode=!0,this.node=t,this.context=e}getNodeType(t){return this.node.getNodeType(t)}setup(t){const e=t.getContext();t.setContext({...t.context,...this.context});const i=this.node.build(t);return t.setContext(e),i}generate(t,e){const i=t.getContext();t.setContext({...t.context,...this.context});const s=this.node.build(t,e);return t.setContext(i),s}}const xo=Tt(Jw),oI=(n,t)=>xo(n,{label:t});Mt("context",xo);Mt("label",oI);qt("ContextNode",Jw);class Pa extends Ae{constructor(t){super("uint"),this.scope=t,this.isInstanceIndexNode=!0}generate(t){const e=this.getNodeType(t),i=this.scope;let s;if(i===Pa.VERTEX)s=t.getVertexIndex();else if(i===Pa.INSTANCE)s=t.getInstanceIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+i);let r;return t.shaderStage==="vertex"||t.shaderStage==="compute"?r=s:r=hn(this).build(t,e),r}}Pa.VERTEX="vertex";Pa.INSTANCE="instance";const $et=ne(Pa,Pa.VERTEX),Yet=ne(Pa,Pa.INSTANCE);qt("IndexNode",Pa);class hI{start(){}finish(){}direct(){}indirectDiffuse(){}indirectSpecular(){}ambientOcclusion(){}}class lI extends Ae{constructor(t,e=null){super(),this.node=t,this.name=e,this.isVarNode=!0}isGlobal(){return!0}getHash(t){return this.name||super.getHash(t)}getNodeType(t){return this.node.getNodeType(t)}generate(t){const{node:e,name:i}=this,s=t.getVarFromNode(this,i,t.getVectorType(this.getNodeType(t))),r=t.getPropertyName(s),a=e.build(t,s.type);return t.addLineFlowCode(`${r} = ${a}`),r}}const df=Tt(lI);Mt("temp",df);Mt("toVar",(...n)=>df(...n).append());qt("VarNode",lI);class vn extends Ae{constructor(t,e=null,i=!1){super(t),this.name=e,this.varying=i,this.isPropertyNode=!0}getHash(t){return this.name||super.getHash(t)}isGlobal(){return!0}generate(t){let e;return this.varying===!0?(e=t.getVaryingFromNode(this,this.name),e.needsInterpolation=!0):e=t.getVarFromNode(this,this.name),t.getPropertyName(e)}}const yr=(n,t)=>Me(new vn(n,t)),jo=(n,t)=>Me(new vn(n,t,!0)),ls=ne(vn,"vec4","DiffuseColor"),Bd=ne(vn,"float","Roughness"),Het=ne(vn,"float","Metalness"),X_=ne(vn,"float","Clearcoat"),Lm=ne(vn,"float","ClearcoatRoughness"),Rc=ne(vn,"vec3","Sheen"),Qw=ne(vn,"float","SheenRoughness"),t2=ne(vn,"float","Iridescence"),cI=ne(vn,"float","IridescenceIOR"),uI=ne(vn,"float","IridescenceThickness"),ao=ne(vn,"color","SpecularColor"),j_=ne(vn,"float","Shininess"),qet=ne(vn,"vec4","Output"),Hc=ne(vn,"float","dashSize"),Om=ne(vn,"float","gapSize");ne(vn,"float","pointWidth");qt("PropertyNode",vn);class Xet extends vn{constructor(t,e=null){super(t,e),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}qt("ParameterNode",Xet);class e2 extends Ae{constructor(t="",e=[],i=""){super("code"),this.isCodeNode=!0,this.code=t,this.language=i,this.includes=e}setIncludes(t){return this.includes=t,this}getIncludes(){return this.includes}generate(t){const e=this.getIncludes(t);for(const s of e)s.build(t);const i=t.getCodeFromNode(this,this.getNodeType(t));return i.code=this.code,i.code}serialize(t){super.serialize(t),t.code=this.code,t.language=this.language}deserialize(t){super.deserialize(t),this.code=t.code,this.language=t.language}}Tt(e2);qt("CodeNode",e2);class jet extends e2{constructor(t="",e=[],i=""){super(t,e,i),this.keywords={}}getNodeType(t){return this.getNodeFunction(t).type}getInputs(t){return this.getNodeFunction(t).inputs}getNodeFunction(t){const e=t.getDataFromNode(this);let i=e.nodeFunction;return i===void 0&&(i=t.parser.parseFunction(this.code),e.nodeFunction=i),i}generate(t,e){super.generate(t);const i=this.getNodeFunction(t),s=i.name,r=i.type,a=t.getCodeFromNode(this,r);s!==""&&(a.name=s);const o=t.getPropertyName(a);let h=this.getNodeFunction(t).getCode(o);const l=this.keywords,u=Object.keys(l);if(u.length>0)for(const f of u){const m=new RegExp(`\\b${f}\\b`,"g"),g=l[f].build(t,"property");h=h.replace(m,g)}return a.code=h+`
`,e==="property"?o:t.format(`${o}()`,r,e)}}qt("FunctionNode",jet);class dI extends Kw{constructor(t=0){super(null,"vec2"),this.isUVNode=!0,this.index=t}getAttributeName(){const t=this.index;return"uv"+(t>0?t:"")}serialize(t){super.serialize(t),t.index=this.index}deserialize(t){super.deserialize(t),this.index=t.index}}const Ah=(...n)=>Me(new dI(...n));qt("UVNode",dI);class fI extends Ae{constructor(t,e=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=t,this.levelNode=e}generate(t,e){const i=this.textureNode.build(t,"property"),s=this.levelNode.build(t,"int");return t.format(`${t.getMethod("textureDimensions")}( ${i}, ${s} )`,this.getNodeType(t),e)}}const pI=Tt(fI);Mt("textureSize",pI);qt("TextureSizeNode",fI);class nn extends Qi{constructor(t,e,i,...s){if(super(),this.op=t,s.length>0){let r=i;for(let a=0;a<s.length;a++)r=new nn(t,r,s[a]);i=r}this.aNode=e,this.bNode=i}getNodeType(t,e){const i=this.op,s=this.aNode,r=this.bNode,a=s.getNodeType(t),o=r.getNodeType(t);if(a==="void"||o==="void")return"void";if(i==="%")return a;if(i==="&"||i==="|"||i==="^"||i===">>"||i==="<<")return t.getIntegerType(a);if(i==="=="||i==="&&"||i==="||"||i==="^^")return"bool";if(i==="<"||i===">"||i==="<="||i===">="){const h=e?t.getTypeLength(e):Math.max(t.getTypeLength(a),t.getTypeLength(o));return h>1?`bvec${h}`:"bool"}else return a==="float"&&t.isMatrix(o)?o:t.isMatrix(a)&&t.isVector(o)?t.getVectorFromMatrix(a):t.isVector(a)&&t.isMatrix(o)?t.getVectorFromMatrix(o):t.getTypeLength(o)>t.getTypeLength(a)?o:a}generate(t,e){const i=this.op,s=this.aNode,r=this.bNode,a=this.getNodeType(t,e);let o=null,h=null;a!=="void"?(o=s.getNodeType(t),h=r.getNodeType(t),i==="<"||i===">"||i==="<="||i===">="||i==="=="?t.isVector(o)?h=o:o=h="float":i===">>"||i==="<<"?(o=a,h=t.changeComponentType(h,"uint")):t.isMatrix(o)&&t.isVector(h)?h=t.getVectorFromMatrix(o):t.isVector(o)&&t.isMatrix(h)?o=t.getVectorFromMatrix(h):o=h=a):o=h=a;const l=s.build(t,o),u=r.build(t,h),f=t.getTypeLength(e),m=t.getFunctionOperator(i);if(e!=="void")return i==="<"&&f>1?t.format(`${t.getMethod("lessThan")}( ${l}, ${u} )`,a,e):i==="<="&&f>1?t.format(`${t.getMethod("lessThanEqual")}( ${l}, ${u} )`,a,e):i===">"&&f>1?t.format(`${t.getMethod("greaterThan")}( ${l}, ${u} )`,a,e):i===">="&&f>1?t.format(`${t.getMethod("greaterThanEqual")}( ${l}, ${u} )`,a,e):m?t.format(`${m}( ${l}, ${u} )`,a,e):t.format(`( ${l} ${i} ${u} )`,a,e);if(o!=="void")return m?t.format(`${m}( ${l}, ${u} )`,a,e):t.format(`${l} ${i} ${u}`,a,e)}serialize(t){super.serialize(t),t.op=this.op}deserialize(t){super.deserialize(t),this.op=t.op}}const wr=Tt(nn,"+"),Hn=Tt(nn,"-"),tn=Tt(nn,"*"),ff=Tt(nn,"/"),Zet=Tt(nn,"%"),Ket=Tt(nn,"=="),Jet=Tt(nn,"!="),Qet=Tt(nn,"<"),mI=Tt(nn,">"),tit=Tt(nn,"<="),eit=Tt(nn,">="),iit=Tt(nn,"&&"),nit=Tt(nn,"||"),sit=Tt(nn,"^^"),rit=Tt(nn,"&"),ait=Tt(nn,"|"),oit=Tt(nn,"^"),hit=Tt(nn,"<<"),lit=Tt(nn,">>");Mt("add",wr);Mt("sub",Hn);Mt("mul",tn);Mt("div",ff);Mt("remainder",Zet);Mt("equal",Ket);Mt("notEqual",Jet);Mt("lessThan",Qet);Mt("greaterThan",mI);Mt("lessThanEqual",tit);Mt("greaterThanEqual",eit);Mt("and",iit);Mt("or",nit);Mt("xor",sit);Mt("bitAnd",rit);Mt("bitOr",ait);Mt("bitXor",oit);Mt("shiftLeft",hit);Mt("shiftRight",lit);qt("OperatorNode",nn);class xt extends Qi{constructor(t,e,i=null,s=null){super(),this.method=t,this.aNode=e,this.bNode=i,this.cNode=s}getInputType(t){const e=this.aNode.getNodeType(t),i=this.bNode?this.bNode.getNodeType(t):null,s=this.cNode?this.cNode.getNodeType(t):null,r=t.isMatrix(e)?0:t.getTypeLength(e),a=t.isMatrix(i)?0:t.getTypeLength(i),o=t.isMatrix(s)?0:t.getTypeLength(s);return r>a&&r>o?e:a>o?i:o>r?s:e}getNodeType(t){const e=this.method;return e===xt.LENGTH||e===xt.DISTANCE||e===xt.DOT?"float":e===xt.CROSS?"vec3":this.getInputType(t)}generate(t,e){const i=this.method,s=this.getNodeType(t),r=this.getInputType(t),a=this.aNode,o=this.bNode,h=this.cNode,l=t.renderer.isWebGLRenderer===!0;if(i===xt.TRANSFORM_DIRECTION){let u=a,f=o;t.isMatrix(u.getNodeType(t))?f=li(Pt(f),0):u=li(Pt(u),0);const m=tn(u,f).xyz;return br(m).build(t,e)}else{if(i===xt.NEGATE)return t.format("( - "+a.build(t,r)+" )",s,e);if(i===xt.ONE_MINUS)return Hn(1,a).build(t,e);if(i===xt.RECIPROCAL)return ff(1,a).build(t,e);if(i===xt.DIFFERENCE)return pr(Hn(a,o)).build(t,e);{const u=[];return i===xt.CROSS?u.push(a.build(t,s),o.build(t,s)):i===xt.STEP?u.push(a.build(t,t.getTypeLength(a.getNodeType(t))===1?"float":r),o.build(t,r)):l&&(i===xt.MIN||i===xt.MAX)||i===xt.MOD?u.push(a.build(t,r),o.build(t,t.getTypeLength(o.getNodeType(t))===1?"float":r)):i===xt.REFRACT?u.push(a.build(t,r),o.build(t,r),h.build(t,"float")):i===xt.MIX?u.push(a.build(t,r),o.build(t,r),h.build(t,t.getTypeLength(h.getNodeType(t))===1?"float":r)):(u.push(a.build(t,r)),o!==null&&u.push(o.build(t,r)),h!==null&&u.push(h.build(t,r))),t.format(`${t.getMethod(i)}( ${u.join(", ")} )`,s,e)}}}serialize(t){super.serialize(t),t.method=this.method}deserialize(t){super.deserialize(t),this.method=t.method}}xt.RADIANS="radians";xt.DEGREES="degrees";xt.EXP="exp";xt.EXP2="exp2";xt.LOG="log";xt.LOG2="log2";xt.SQRT="sqrt";xt.INVERSE_SQRT="inversesqrt";xt.FLOOR="floor";xt.CEIL="ceil";xt.NORMALIZE="normalize";xt.FRACT="fract";xt.SIN="sin";xt.COS="cos";xt.TAN="tan";xt.ASIN="asin";xt.ACOS="acos";xt.ATAN="atan";xt.ABS="abs";xt.SIGN="sign";xt.LENGTH="length";xt.NEGATE="negate";xt.ONE_MINUS="oneMinus";xt.DFDX="dFdx";xt.DFDY="dFdy";xt.ROUND="round";xt.RECIPROCAL="reciprocal";xt.TRUNC="trunc";xt.FWIDTH="fwidth";xt.BITCAST="bitcast";xt.ATAN2="atan2";xt.MIN="min";xt.MAX="max";xt.MOD="mod";xt.STEP="step";xt.REFLECT="reflect";xt.DISTANCE="distance";xt.DIFFERENCE="difference";xt.DOT="dot";xt.CROSS="cross";xt.POW="pow";xt.TRANSFORM_DIRECTION="transformDirection";xt.MIX="mix";xt.CLAMP="clamp";xt.REFRACT="refract";xt.SMOOTHSTEP="smoothstep";xt.FACEFORWARD="faceforward";const gI=ct(1e-6);ct(1e6);const cit=Tt(xt,xt.RADIANS),uit=Tt(xt,xt.DEGREES),dit=Tt(xt,xt.EXP),fit=Tt(xt,xt.EXP2),pit=Tt(xt,xt.LOG),mit=Tt(xt,xt.LOG2),Rl=Tt(xt,xt.SQRT),git=Tt(xt,xt.INVERSE_SQRT),Zf=Tt(xt,xt.FLOOR),yI=Tt(xt,xt.CEIL),br=Tt(xt,xt.NORMALIZE),i2=Tt(xt,xt.FRACT),yit=Tt(xt,xt.SIN),_it=Tt(xt,xt.COS),xit=Tt(xt,xt.TAN),vit=Tt(xt,xt.ASIN),wit=Tt(xt,xt.ACOS),bit=Tt(xt,xt.ATAN),pr=Tt(xt,xt.ABS),Mit=Tt(xt,xt.SIGN),Eit=Tt(xt,xt.LENGTH),Sit=Tt(xt,xt.NEGATE),Tit=Tt(xt,xt.ONE_MINUS),Cit=Tt(xt,xt.DFDX),Ait=Tt(xt,xt.DFDY),Rit=Tt(xt,xt.ROUND),Iit=Tt(xt,xt.RECIPROCAL),_I=Tt(xt,xt.TRUNC),Nit=Tt(xt,xt.FWIDTH);Tt(xt,xt.BITCAST);const kit=Tt(xt,xt.ATAN2),pf=Tt(xt,xt.MIN),dl=Tt(xt,xt.MAX),Lit=Tt(xt,xt.MOD),Oit=Tt(xt,xt.STEP),Pit=Tt(xt,xt.REFLECT),Fit=Tt(xt,xt.DISTANCE),Dit=Tt(xt,xt.DIFFERENCE),Kf=Tt(xt,xt.DOT),zit=Tt(xt,xt.CROSS),n2=Tt(xt,xt.POW),Bit=Tt(xt,xt.POW,2),Uit=Tt(xt,xt.POW,3),Git=Tt(xt,xt.POW,4),Vit=Tt(xt,xt.TRANSFORM_DIRECTION),Ua=Tt(xt,xt.MIX),xI=(n,t=0,e=1)=>Me(new xt(xt.CLAMP,Me(n),Me(t),Me(e))),Wit=n=>xI(n),$it=Tt(xt,xt.REFRACT),fl=Tt(xt,xt.SMOOTHSTEP),Yit=Tt(xt,xt.FACEFORWARD),Hit=(n,t,e)=>Ua(t,e,n),qit=(n,t,e)=>fl(t,e,n);Mt("radians",cit);Mt("degrees",uit);Mt("exp",dit);Mt("exp2",fit);Mt("log",pit);Mt("log2",mit);Mt("sqrt",Rl);Mt("inverseSqrt",git);Mt("floor",Zf);Mt("ceil",yI);Mt("normalize",br);Mt("fract",i2);Mt("sin",yit);Mt("cos",_it);Mt("tan",xit);Mt("asin",vit);Mt("acos",wit);Mt("atan",bit);Mt("abs",pr);Mt("sign",Mit);Mt("length",Eit);Mt("negate",Sit);Mt("oneMinus",Tit);Mt("dFdx",Cit);Mt("dFdy",Ait);Mt("round",Rit);Mt("reciprocal",Iit);Mt("trunc",_I);Mt("fwidth",Nit);Mt("atan2",kit);Mt("min",pf);Mt("max",dl);Mt("mod",Lit);Mt("step",Oit);Mt("reflect",Pit);Mt("distance",Fit);Mt("dot",Kf);Mt("cross",zit);Mt("pow",n2);Mt("pow2",Bit);Mt("pow3",Uit);Mt("pow4",Git);Mt("transformDirection",Vit);Mt("mix",Hit);Mt("clamp",xI);Mt("refract",$it);Mt("smoothstep",qit);Mt("faceForward",Yit);Mt("difference",Dit);Mt("saturate",Wit);qt("MathNode",xt);const Xit=Zt(n=>{const{value:t}=n,{rgb:e}=t,i=e.mul(.9478672986).add(.0521327014).pow(2.4),s=e.mul(.0773993808),r=e.lessThanEqual(.04045),a=Ua(i,s,r);return li(a,t.a)}),jit=Zt(n=>{const{value:t}=n,{rgb:e}=t,i=e.pow(.41666).mul(1.055).sub(.055),s=e.mul(12.92),r=e.lessThanEqual(.0031308),a=Ua(i,s,r);return li(a,t.a)}),MS=n=>{let t=null;return n===Cl?t="Linear":n===tr&&(t="sRGB"),t},vI=(n,t)=>MS(n)+"To"+MS(t);class qs extends Qi{constructor(t,e){super("vec4"),this.method=t,this.node=e}setup(){const{method:t,node:e}=this;return t===qs.LINEAR_TO_LINEAR?e:Zit[t]({value:e})}}qs.LINEAR_TO_LINEAR="LinearToLinear";qs.LINEAR_TO_sRGB="LinearTosRGB";qs.sRGB_TO_LINEAR="sRGBToLinear";const Zit={[qs.LINEAR_TO_sRGB]:jit,[qs.sRGB_TO_LINEAR]:Xit},Kit=(n,t)=>Me(new qs(vI(Cl,t),Me(n))),wI=(n,t)=>Me(new qs(vI(t,Cl),Me(n))),Jit=Tt(qs,qs.LINEAR_TO_sRGB),Qit=Tt(qs,qs.sRGB_TO_LINEAR);Mt("linearTosRGB",Jit);Mt("sRGBToLinear",Qit);Mt("linearToColorSpace",Kit);Mt("colorSpaceToLinear",wI);qt("ColorSpaceNode",qs);class bI extends Ae{constructor(t="",e="void"){super(e),this.snippet=t}generate(t,e){const i=this.getNodeType(t),s=this.snippet;if(i==="void")t.addLineFlowCode(s);else return t.format(`( ${s} )`,i,e)}}const s2=Tt(bI);qt("ExpressionNode",bI);class MI extends Ch{constructor(t){super(0),this.textureNode=t,this.updateType=gn.FRAME}get texture(){return this.textureNode.value}update(){const t=this.texture,e=t.images,i=e&&e.length>0?e[0]&&e[0].image||e[0]:t.image;if(i&&i.width!==void 0){const{width:s,height:r}=i;this.value=Math.log2(Math.max(s,r))}}}const r2=Tt(MI);qt("MaxMipLevelNode",MI);class Ru extends Ch{constructor(t,e=null,i=null){super(t),this.isTextureNode=!0,this.uvNode=e,this.levelNode=i,this.compareNode=null,this.depthNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=gn.NONE,this.setUpdateMatrix(e===null)}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":"vec4"}getInputType(){return"texture"}getDefaultUV(){return Ah(this.value.channel)}updateReference(){return this.value}getTransformedUV(t){const e=this.value;return ln(e.matrix).mul(Pt(t,1)).xy}setUpdateMatrix(t){return this.updateMatrix=t,this.updateType=t?gn.FRAME:gn.NONE,this}setupUV(t,e){const i=this.value;return t.isFlipY()&&(i.isRenderTargetTexture===!0||i.isFramebufferTexture===!0||i.isDepthTexture===!0)&&(e=e.setY(e.y.oneMinus())),e}setup(t){const e=t.getNodeProperties(this);let i=this.uvNode;(i===null||t.context.forceUVContext===!0)&&t.context.getUV&&(i=t.context.getUV(this)),i||(i=this.getDefaultUV()),this.updateMatrix===!0&&(i=this.getTransformedUV(i)),i=this.setupUV(t,i);let s=this.levelNode;s===null&&t.context.getTextureLevel&&(s=t.context.getTextureLevel(this)),s!==null&&t.context.getTextureLevelAlgorithm!==void 0&&(s=t.context.getTextureLevelAlgorithm(this,s)),e.uvNode=i,e.levelNode=s,e.compareNode=this.compareNode,e.depthNode=this.depthNode}generateUV(t,e){return e.build(t,this.sampler===!0?"vec2":"ivec2")}generateSnippet(t,e,i,s,r,a){const o=this.value;let h;return s?h=t.generateTextureLevel(o,e,i,s,r):a?h=t.generateTextureCompare(o,e,i,a,r):this.sampler===!1?h=t.generateTextureLoad(o,e,i,r):h=t.generateTexture(o,e,i,r),h}generate(t,e){const i=t.getNodeProperties(this),s=this.value;if(!s||s.isTexture!==!0)throw new Error("TextureNode: Need a three.js texture.");const r=super.generate(t,"property");if(e==="sampler")return r+"_sampler";if(t.isReference(e))return r;{const a=t.getDataFromNode(this);let o=a.propertyName;if(o===void 0){const{uvNode:u,levelNode:f,compareNode:m,depthNode:g}=i,y=this.generateUV(t,u),_=f?f.build(t,"float"):null,w=g?g.build(t,"int"):null,M=m?m.build(t,"float"):null,T=t.getVarFromNode(this);o=t.getPropertyName(T);const A=this.generateSnippet(t,r,y,_,w,M);t.addLineFlowCode(`${o} = ${A}`),t.context.tempWrite!==!1&&(a.snippet=A,a.propertyName=o)}let h=o;const l=this.getNodeType(t);return t.needsColorSpaceToLinear(s)&&(h=wI(s2(h,l),s.colorSpace).setup(t).build(t,l)),t.format(h,l,e)}}setSampler(t){return this.sampler=t,this}getSampler(){return this.sampler}uv(t){const e=this.clone();return e.uvNode=t,Me(e)}blur(t){const e=this.clone();return e.levelNode=t.mul(r2(e)),Me(e)}level(t){const e=this.clone();return e.levelNode=t,e}size(t){return pI(this,t)}compare(t){const e=this.clone();return e.compareNode=Me(t),Me(e)}depth(t){const e=this.clone();return e.depthNode=Me(t),Me(e)}serialize(t){super.serialize(t),t.value=this.value.toJSON(t.meta).uuid}deserialize(t){super.deserialize(t),this.value=t.meta.textures[t.value]}update(){const t=this.value;t.matrixAutoUpdate===!0&&t.updateMatrix()}clone(){const t=new this.constructor(this.value,this.uvNode,this.levelNode);return t.sampler=this.sampler,t}}const jr=Tt(Ru),tnt=(...n)=>jr(...n).setSampler(!1);Mt("texture",jr);qt("TextureNode",Ru);class Jf extends Ae{constructor(t,e,i=null){super(),this.property=t,this.index=null,this.uniformType=e,this.object=i,this.reference=null,this.node=null,this.updateType=gn.OBJECT,this.setNodeType(e)}updateReference(t){return this.reference=this.object!==null?this.object:t.object,this.reference}setIndex(t){return this.index=t,this}getIndex(){return this.index}setNodeType(t){let e=null;t==="texture"?e=jr(null):e=ln(t),this.node=e}getNodeType(t){return this.node.getNodeType(t)}update(){let t=this.reference[this.property];this.index!==null&&(t=t[this.index]),this.node.value=t}setup(){return this.node}}const pl=(n,t,e)=>Me(new Jf(n,t,e)),ent=(n,t,e,i)=>Me(new Jf(n,e,i).setIndex(t));qt("ReferenceNode",Jf);class EI extends Jf{constructor(t,e,i=null){super(t,e,i),this.material=i}updateReference(t){return this.reference=this.material!==null?this.material:t.material,this.reference}setup(t){const e=this.material!==null?this.material:t.material;return this.node.value=e[this.property],super.setup(t)}}const int=(n,t,e)=>Me(new EI(n,t,e));qt("MaterialReferenceNode",EI);class Fe extends Ae{constructor(t=Fe.VIEW_MATRIX,e=null){super(),this.scope=t,this.object3d=e,this.updateType=gn.OBJECT,this._uniformNode=new Ch(null)}getNodeType(){const t=this.scope;if(t===Fe.WORLD_MATRIX||t===Fe.VIEW_MATRIX)return"mat4";if(t===Fe.NORMAL_MATRIX)return"mat3";if(t===Fe.POSITION||t===Fe.VIEW_POSITION||t===Fe.DIRECTION||t===Fe.SCALE)return"vec3"}update(t){const e=this.object3d,i=this._uniformNode,s=this.scope;if(s===Fe.VIEW_MATRIX)i.value=e.modelViewMatrix;else if(s===Fe.NORMAL_MATRIX)i.value=e.normalMatrix;else if(s===Fe.WORLD_MATRIX)i.value=e.matrixWorld;else if(s===Fe.POSITION)i.value=i.value||new Lt,i.value.setFromMatrixPosition(e.matrixWorld);else if(s===Fe.SCALE)i.value=i.value||new Lt,i.value.setFromMatrixScale(e.matrixWorld);else if(s===Fe.DIRECTION)i.value=i.value||new Lt,e.getWorldDirection(i.value);else if(s===Fe.VIEW_POSITION){const r=t.camera;i.value=i.value||new Lt,i.value.setFromMatrixPosition(e.matrixWorld),i.value.applyMatrix4(r.matrixWorldInverse)}}generate(t){const e=this.scope;return e===Fe.WORLD_MATRIX||e===Fe.VIEW_MATRIX?this._uniformNode.nodeType="mat4":e===Fe.NORMAL_MATRIX?this._uniformNode.nodeType="mat3":(e===Fe.POSITION||e===Fe.VIEW_POSITION||e===Fe.DIRECTION||e===Fe.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(t)}serialize(t){super.serialize(t),t.scope=this.scope}deserialize(t){super.deserialize(t),this.scope=t.scope}}Fe.VIEW_MATRIX="viewMatrix";Fe.NORMAL_MATRIX="normalMatrix";Fe.WORLD_MATRIX="worldMatrix";Fe.POSITION="position";Fe.SCALE="scale";Fe.VIEW_POSITION="viewPosition";Fe.DIRECTION="direction";Tt(Fe,Fe.DIRECTION);Tt(Fe,Fe.VIEW_MATRIX);Tt(Fe,Fe.NORMAL_MATRIX);Tt(Fe,Fe.WORLD_MATRIX);const Z_=Tt(Fe,Fe.POSITION);Tt(Fe,Fe.SCALE);const SI=Tt(Fe,Fe.VIEW_POSITION);qt("Object3DNode",Fe);class ni extends Fe{constructor(t=ni.POSITION){super(t),this.updateType=gn.RENDER}getNodeType(t){const e=this.scope;return e===ni.PROJECTION_MATRIX?"mat4":e===ni.NEAR||e===ni.FAR||e===ni.LOG_DEPTH?"float":super.getNodeType(t)}update(t){const e=t.camera,i=this._uniformNode,s=this.scope;s===ni.VIEW_MATRIX?i.value=e.matrixWorldInverse:s===ni.PROJECTION_MATRIX?i.value=e.projectionMatrix:s===ni.NEAR?i.value=e.near:s===ni.FAR?i.value=e.far:s===ni.LOG_DEPTH?i.value=2/(Math.log(e.far+1)/Math.LN2):(this.object3d=e,super.update(t))}generate(t){const e=this.scope;return e===ni.PROJECTION_MATRIX?this._uniformNode.nodeType="mat4":(e===ni.NEAR||e===ni.FAR||e===ni.LOG_DEPTH)&&(this._uniformNode.nodeType="float"),super.generate(t)}}ni.PROJECTION_MATRIX="projectionMatrix";ni.NEAR="near";ni.FAR="far";ni.LOG_DEPTH="logDepth";const oo=oI(ne(ni,ni.PROJECTION_MATRIX),"projectionMatrix"),I1=ne(ni,ni.NEAR),N1=ne(ni,ni.FAR),nnt=ne(ni,ni.LOG_DEPTH),Rh=ne(ni,ni.VIEW_MATRIX);ne(ni,ni.NORMAL_MATRIX);ne(ni,ni.WORLD_MATRIX);ne(ni,ni.POSITION);qt("CameraNode",ni);class Zn extends Fe{constructor(t=Zn.VIEW_MATRIX){super(t)}update(t){this.object3d=t.object,super.update(t)}}ne(Zn,Zn.DIRECTION);const ml=ne(Zn,Zn.VIEW_MATRIX).label("modelViewMatrix").temp("ModelViewMatrix"),TI=ne(Zn,Zn.NORMAL_MATRIX),Pm=ne(Zn,Zn.WORLD_MATRIX);ne(Zn,Zn.POSITION);ne(Zn,Zn.SCALE);ne(Zn,Zn.VIEW_POSITION);qt("ModelNode",Zn);class Mn extends Ae{constructor(t=Mn.LOCAL){super("vec3"),this.scope=t}isGlobal(){return!0}getHash(){return`normal-${this.scope}`}generate(t){const e=this.scope;let i=null;if(e===Mn.GEOMETRY)i=Es("normal","vec3");else if(e===Mn.LOCAL)i=hn(Fm);else if(e===Mn.VIEW){const s=TI.mul(Mo);i=br(hn(s))}else if(e===Mn.WORLD){const s=bh.transformDirection(Rh);i=br(hn(s))}return i.build(t,this.getNodeType(t))}serialize(t){super.serialize(t),t.scope=this.scope}deserialize(t){super.deserialize(t),this.scope=t.scope}}Mn.GEOMETRY="geometry";Mn.LOCAL="local";Mn.VIEW="view";Mn.WORLD="world";const Fm=ne(Mn,Mn.GEOMETRY),Mo=ne(Mn,Mn.LOCAL).temp("Normal"),bh=ne(Mn,Mn.VIEW),CI=ne(Mn,Mn.WORLD),mn=yr("vec3","TransformedNormalView"),snt=mn.transformDirection(Rh).normalize(),Ic=yr("vec3","TransformedClearcoatNormalView");qt("NormalNode",Mn);const ES=new Map;class ie extends Ae{constructor(t){super(),this.scope=t}getCache(t,e){let i=ES.get(t);return i===void 0&&(i=int(t,e),ES.set(t,i)),i}getFloat(t){return this.getCache(t,"float")}getColor(t){return this.getCache(t,"color")}getTexture(t){return this.getCache(t==="map"?"map":t+"Map","texture")}setup(t){const e=t.context.material,i=this.scope;let s=null;if(i===ie.COLOR){const r=this.getColor(i);e.map&&e.map.isTexture===!0?s=r.mul(this.getTexture("map")):s=r}else if(i===ie.OPACITY){const r=this.getFloat(i);e.alphaMap&&e.alphaMap.isTexture===!0?s=r.mul(this.getTexture("alpha")):s=r}else if(i===ie.SPECULAR_STRENGTH)e.specularMap&&e.specularMap.isTexture===!0?s=this.getTexture(i).r:s=ct(1);else if(i===ie.ROUGHNESS){const r=this.getFloat(i);e.roughnessMap&&e.roughnessMap.isTexture===!0?s=r.mul(this.getTexture(i).g):s=r}else if(i===ie.METALNESS){const r=this.getFloat(i);e.metalnessMap&&e.metalnessMap.isTexture===!0?s=r.mul(this.getTexture(i).b):s=r}else if(i===ie.EMISSIVE){const r=this.getColor(i);e.emissiveMap&&e.emissiveMap.isTexture===!0?s=r.mul(this.getTexture(i)):s=r}else if(i===ie.NORMAL)e.normalMap?s=this.getTexture("normal").normalMap(this.getCache("normalScale","vec2")):e.bumpMap?s=this.getTexture("bump").r.bumpMap(this.getFloat("bumpScale")):s=bh;else if(i===ie.CLEARCOAT){const r=this.getFloat(i);e.clearcoatMap&&e.clearcoatMap.isTexture===!0?s=r.mul(this.getTexture(i).r):s=r}else if(i===ie.CLEARCOAT_ROUGHNESS){const r=this.getFloat(i);e.clearcoatRoughnessMap&&e.clearcoatRoughnessMap.isTexture===!0?s=r.mul(this.getTexture(i).r):s=r}else if(i===ie.CLEARCOAT_NORMAL)e.clearcoatNormalMap?s=this.getTexture(i).normalMap(this.getCache(i+"Scale","vec2")):s=bh;else if(i===ie.SHEEN){const r=this.getColor("sheenColor").mul(this.getFloat("sheen"));e.sheenColorMap&&e.sheenColorMap.isTexture===!0?s=r.mul(this.getTexture("sheenColor").rgb):s=r}else if(i===ie.SHEEN_ROUGHNESS){const r=this.getFloat(i);e.sheenRoughnessMap&&e.sheenRoughnessMap.isTexture===!0?s=r.mul(this.getTexture(i).a):s=r,s=s.clamp(.07,1)}else if(i===ie.IRIDESCENCE_THICKNESS){const r=pl(1,"float",e.iridescenceThicknessRange);if(e.iridescenceThicknessMap){const a=pl(0,"float",e.iridescenceThicknessRange);s=r.sub(a).mul(this.getTexture(i).g).add(a)}else s=r}else{const r=this.getNodeType(t);s=this.getCache(i,r)}return s}}ie.ALPHA_TEST="alphaTest";ie.COLOR="color";ie.OPACITY="opacity";ie.SHININESS="shininess";ie.SPECULAR_COLOR="specular";ie.SPECULAR_STRENGTH="specularStrength";ie.REFLECTIVITY="reflectivity";ie.ROUGHNESS="roughness";ie.METALNESS="metalness";ie.NORMAL="normal";ie.CLEARCOAT="clearcoat";ie.CLEARCOAT_ROUGHNESS="clearcoatRoughness";ie.CLEARCOAT_NORMAL="clearcoatNormal";ie.EMISSIVE="emissive";ie.ROTATION="rotation";ie.SHEEN="sheen";ie.SHEEN_ROUGHNESS="sheenRoughness";ie.IRIDESCENCE="iridescence";ie.IRIDESCENCE_IOR="iridescenceIOR";ie.IRIDESCENCE_THICKNESS="iridescenceThickness";ie.LINE_SCALE="scale";ie.LINE_DASH_SIZE="dashSize";ie.LINE_GAP_SIZE="gapSize";ie.LINE_WIDTH="linewidth";ie.LINE_DASH_OFFSET="dashOffset";ie.POINT_WIDTH="pointWidth";const rnt=ne(ie,ie.ALPHA_TEST),mf=ne(ie,ie.COLOR),ant=ne(ie,ie.SHININESS),ont=ne(ie,ie.EMISSIVE),AI=ne(ie,ie.OPACITY),hnt=ne(ie,ie.SPECULAR_COLOR),lnt=ne(ie,ie.SPECULAR_STRENGTH);ne(ie,ie.REFLECTIVITY);const cnt=ne(ie,ie.ROUGHNESS),unt=ne(ie,ie.METALNESS),dnt=ne(ie,ie.NORMAL),fnt=ne(ie,ie.CLEARCOAT),pnt=ne(ie,ie.CLEARCOAT_ROUGHNESS),mnt=ne(ie,ie.CLEARCOAT_NORMAL),gnt=ne(ie,ie.ROTATION),ynt=ne(ie,ie.SHEEN),_nt=ne(ie,ie.SHEEN_ROUGHNESS),xnt=ne(ie,ie.IRIDESCENCE),vnt=ne(ie,ie.IRIDESCENCE_IOR),wnt=ne(ie,ie.IRIDESCENCE_THICKNESS),K_=ne(ie,ie.LINE_SCALE),RI=ne(ie,ie.LINE_DASH_SIZE),II=ne(ie,ie.LINE_GAP_SIZE),ld=ne(ie,ie.LINE_WIDTH),SS=ne(ie,ie.LINE_DASH_OFFSET),bnt=ne(ie,ie.POINT_WIDTH);qt("MaterialNode",ie);class Di extends Ae{constructor(t=Di.LOCAL){super("vec3"),this.scope=t}isGlobal(){return!0}getHash(){return`position-${this.scope}`}generate(t){const e=this.scope;let i=null;if(e===Di.GEOMETRY)i=Es("position","vec3");else if(e===Di.LOCAL)i=hn(Ds);else if(e===Di.WORLD){const s=Pm.mul($s);i=hn(s)}else if(e===Di.VIEW){const s=ml.mul($s);i=hn(s)}else if(e===Di.VIEW_DIRECTION){const s=Fa.negate();i=br(hn(s))}else if(e===Di.WORLD_DIRECTION){const s=$s.transformDirection(Pm);i=br(hn(s))}return i.build(t,this.getNodeType(t))}serialize(t){super.serialize(t),t.scope=this.scope}deserialize(t){super.deserialize(t),this.scope=t.scope}}Di.GEOMETRY="geometry";Di.LOCAL="local";Di.WORLD="world";Di.WORLD_DIRECTION="worldDirection";Di.VIEW="view";Di.VIEW_DIRECTION="viewDirection";const Ds=ne(Di,Di.GEOMETRY),$s=ne(Di,Di.LOCAL).temp("Position"),Mnt=ne(Di,Di.WORLD),Ent=ne(Di,Di.WORLD_DIRECTION),Fa=ne(Di,Di.VIEW),zn=ne(Di,Di.VIEW_DIRECTION);qt("PositionNode",Di);class NI extends Qi{constructor(t=null){super("vec4"),this.positionNode=t}setup(t){if(t.shaderStage==="fragment")return hn(t.context.mvp);const e=this.positionNode||$s;return oo.mul(ml).mul(e)}}const TS=Tt(NI);qt("ModelViewProjectionNode",NI);class kI extends Vg{constructor(t,e=null,i=0,s=0){super(t,e),this.isBufferNode=!0,this.bufferType=e,this.bufferStride=i,this.bufferOffset=s,this.usage=Rm,this.instanced=!1,this.attribute=null,t&&t.isBufferAttribute===!0&&(this.attribute=t,this.usage=t.usage,this.instanced=t.isInstancedBufferAttribute)}getNodeType(t){return this.bufferType===null&&(this.bufferType=t.getTypeFromAttribute(this.attribute)),this.bufferType}setup(t){if(this.attribute!==null)return;const e=this.getNodeType(t),i=this.value,s=t.getTypeLength(e),r=this.bufferStride||s,a=this.bufferOffset,o=i.isInterleavedBuffer===!0?i:new FR(i,r),h=new Dw(o,s,a);o.setUsage(this.usage),this.attribute=h,this.attribute.isInstancedBufferAttribute=this.instanced}generate(t){const e=this.getNodeType(t),i=t.getBufferAttributeFromNode(this,e),s=t.getPropertyName(i);let r=null;return t.shaderStage==="vertex"?r=s:r=hn(this).build(t,e),r}getInputType(){return"bufferAttribute"}setUsage(t){return this.usage=t,this}setInstanced(t){return this.instanced=t,this}}const a2=(n,t,e,i)=>Me(new kI(n,t,e,i)),Snt=(n,t,e,i)=>a2(n,t,e,i).setUsage(RR),Tnt=(n,t,e,i)=>a2(n,t,e,i).setInstanced(!0),Cnt=(n,t,e,i)=>Snt(n,t,e,i).setInstanced(!0);Mt("toAttribute",n=>a2(n.value));qt("BufferAttributeNode",kI);class LI extends Ae{constructor(t){super("void"),this.instanceMesh=t,this.instanceMatrixNode=null}setup(){let t=this.instanceMatrixNode;if(t===null){const o=this.instanceMesh.instanceMatrix,h=new eet(o.array,16,1),l=o.usage===RR?Cnt:Tnt,u=[l(h,"vec4",16,0),l(h,"vec4",16,4),l(h,"vec4",16,8),l(h,"vec4",16,12)];t=eI(...u),this.instanceMatrixNode=t}const e=t.mul($s).xyz,i=cu(t[0].xyz,t[1].xyz,t[2].xyz),s=Mo.div(Pt(i[0].dot(i[0]),i[1].dot(i[1]),i[2].dot(i[2]))),r=i.mul(s).xyz;$s.assign(e),Mo.assign(r)}}const Ant=Tt(LI);qt("InstanceNode",LI);class o2 extends Ch{constructor(t,e,i=0){super(t,e),this.isBufferNode=!0,this.bufferType=e,this.bufferCount=i}getInputType(){return"buffer"}}const OI=(n,t,e)=>Me(new o2(n,t,e));qt("BufferNode",o2);class pn extends Ae{constructor(t=pn.LOCAL){super(),this.scope=t}getHash(){return`tangent-${this.scope}`}getNodeType(){return this.scope===pn.GEOMETRY?"vec4":"vec3"}generate(t){const e=this.scope;let i=null;if(e===pn.GEOMETRY)i=Es("tangent","vec4");else if(e===pn.LOCAL)i=hn(Dm.xyz);else if(e===pn.VIEW){const s=ml.mul(h2).xyz;i=br(hn(s))}else if(e===pn.WORLD){const s=Hg.transformDirection(Rh);i=br(hn(s))}return i.build(t,this.getNodeType(t))}serialize(t){super.serialize(t),t.scope=this.scope}deserialize(t){super.deserialize(t),this.scope=t.scope}}pn.GEOMETRY="geometry";pn.LOCAL="local";pn.VIEW="view";pn.WORLD="world";const Dm=ne(pn,pn.GEOMETRY),h2=ne(pn,pn.LOCAL),Hg=ne(pn,pn.VIEW),Rnt=ne(pn,pn.WORLD),PI=df(Hg,"TransformedTangentView");br(PI.transformDirection(Rh));qt("TangentNode",pn);class FI extends Ae{constructor(t){super("void"),this.skinnedMesh=t,this.updateType=gn.OBJECT,this.skinIndexNode=Es("skinIndex","uvec4"),this.skinWeightNode=Es("skinWeight","vec4"),this.bindMatrixNode=ln(t.bindMatrix,"mat4"),this.bindMatrixInverseNode=ln(t.bindMatrixInverse,"mat4"),this.boneMatricesNode=OI(t.skeleton.boneMatrices,"mat4",t.skeleton.bones.length)}setup(t){const{skinIndexNode:e,skinWeightNode:i,bindMatrixNode:s,bindMatrixInverseNode:r,boneMatricesNode:a}=this,o=a.element(e.x),h=a.element(e.y),l=a.element(e.z),u=a.element(e.w),f=s.mul($s),m=wr(o.mul(i.x).mul(f),h.mul(i.y).mul(f),l.mul(i.z).mul(f),u.mul(i.w).mul(f)),g=r.mul(m).xyz;let y=wr(i.x.mul(o),i.y.mul(h),i.z.mul(l),i.w.mul(u));y=r.mul(y).mul(s);const _=y.transformDirection(Mo).xyz;$s.assign(g),Mo.assign(_),t.hasGeometryAttribute("tangent")&&h2.assign(_)}generate(t,e){if(e!=="void")return $s.build(t,e)}update(){this.skinnedMesh.skeleton.update()}}const Int=Tt(FI);qt("SkinningNode",FI);const k1=new WeakMap,Qs=new $n,CS=Zt(({bufferMap:n,influence:t,stride:e,width:i,depth:s,offset:r})=>{const a=ot($et).mul(e).add(r),o=a.div(i),h=a.sub(o.mul(i));return tnt(n,QR(h,o)).depth(s).mul(t)});function Nnt(n){const t=n.morphAttributes.position!==void 0,e=n.morphAttributes.normal!==void 0,i=n.morphAttributes.color!==void 0,s=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,r=s!==void 0?s.length:0;let a=k1.get(n);if(a===void 0||a.count!==r){let M=function(){_.dispose(),k1.delete(n),n.removeEventListener("dispose",M)};a!==void 0&&a.texture.dispose();const o=n.morphAttributes.position||[],h=n.morphAttributes.normal||[],l=n.morphAttributes.color||[];let u=0;t===!0&&(u=1),e===!0&&(u=2),i===!0&&(u=3);let f=n.attributes.position.count*u,m=1;const g=4096;f>g&&(m=Math.ceil(f/g),f=g);const y=new Float32Array(f*m*4*r),_=new rtt(y,f,m,r);_.type=kw,_.needsUpdate=!0;const w=u*4;for(let T=0;T<r;T++){const A=o[T],R=h[T],I=l[T],L=f*m*4*T;for(let k=0;k<A.count;k++){const Y=k*w;t===!0&&(Qs.fromBufferAttribute(A,k),y[L+Y+0]=Qs.x,y[L+Y+1]=Qs.y,y[L+Y+2]=Qs.z,y[L+Y+3]=0),e===!0&&(Qs.fromBufferAttribute(R,k),y[L+Y+4]=Qs.x,y[L+Y+5]=Qs.y,y[L+Y+6]=Qs.z,y[L+Y+7]=0),i===!0&&(Qs.fromBufferAttribute(I,k),y[L+Y+8]=Qs.x,y[L+Y+9]=Qs.y,y[L+Y+10]=Qs.z,y[L+Y+11]=I.itemSize===4?Qs.w:1)}}a={count:r,texture:_,stride:u,size:new hi(f,m)},k1.set(n,a),n.addEventListener("dispose",M)}return a}class DI extends Ae{constructor(t){super("void"),this.mesh=t,this.morphBaseInfluence=ln(1),this.updateType=gn.OBJECT}setup(t){const{geometry:e}=t,i=e.morphAttributes.position!==void 0,s=e.morphAttributes.normal!==void 0,r=e.morphAttributes.position||e.morphAttributes.normal||e.morphAttributes.color,a=r!==void 0?r.length:0,{texture:o,stride:h,size:l}=Nnt(e);i===!0&&$s.mulAssign(this.morphBaseInfluence),s===!0&&Mo.mulAssign(this.morphBaseInfluence);const u=ot(l.width);for(let f=0;f<a;f++){const m=ent("morphTargetInfluences",f,"float"),g=ot(f);i===!0&&$s.addAssign(CS({bufferMap:o,influence:m,stride:h,width:u,depth:g,offset:ot(0)})),s===!0&&Mo.addAssign(CS({bufferMap:o,influence:m,stride:h,width:u,depth:g,offset:ot(1)}))}}update(){const t=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?t.value=1:t.value=1-this.mesh.morphTargetInfluences.reduce((e,i)=>e+i,0)}}const knt=Tt(DI);qt("MorphNode",DI);class zI extends Ae{constructor(){super("vec3")}getHash(){return"reflectVector"}setup(){return zn.negate().reflect(mn).transformDirection(Rh)}}const Lnt=ne(zI);qt("ReflectVectorNode",zI);class BI extends Ru{constructor(t,e=null,i=null){super(t,e,i),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){return Lnt}setUpdateMatrix(){}setupUV(t,e){return Pt(e.x.negate(),e.yz)}generateUV(t,e){return e.build(t,"vec3")}}const l2=Tt(BI);Mt("cubeTexture",l2);qt("CubeTextureNode",BI);class qg extends Ae{constructor(){super("vec3")}generate(){console.warn("Abstract function.")}}qt("LightingNode",qg);let L1=null;class Il extends qg{constructor(t=null){super(),this.updateType=gn.FRAME,this.light=t,this.rtt=null,this.shadowNode=null,this.color=new Oi,this._defaultColorNode=ln(this.color),this.colorNode=this._defaultColorNode,this.isAnalyticLightNode=!0}getCacheKey(){return super.getCacheKey()+"-"+(this.light.id+"-"+(this.light.castShadow?"1":"0"))}getHash(){return this.light.uuid}setupShadow(t){let e=this.shadowNode;if(e===null){L1===null&&(L1=t.createNodeMaterial("MeshBasicNodeMaterial"));const i=this.light.shadow,s=t.getRenderTarget(i.mapSize.width,i.mapSize.height),r=new Bg;r.minFilter=vh,r.magFilter=vh,r.image.width=i.mapSize.width,r.image.height=i.mapSize.height,r.compareFunction=FQ,s.depthTexture=r,i.camera.updateProjectionMatrix();const a=pl("bias","float",i),o=pl("normalBias","float",i);let h=ln(i.matrix).mul(Mnt.add(CI.mul(o)));h=h.xyz.div(h.w);const l=h.x.greaterThanEqual(0).and(h.x.lessThanEqual(1)).and(h.y.greaterThanEqual(0)).and(h.y.lessThanEqual(1)).and(h.z.lessThanEqual(1));let u=h.z.add(a);t.renderer.coordinateSystem===Im&&(u=u.mul(2).sub(1)),h=Pt(h.x,h.y.oneMinus(),u),e=((m,g,y)=>jr(m,g).compare(y))(r,h.xy,h.z),this.rtt=s,this.colorNode=this.colorNode.mul(l.mix(1,e)),this.shadowNode=e,this.updateBeforeType=gn.RENDER}}setup(t){this.light.castShadow?this.setupShadow(t):this.shadowNode!==null&&this.disposeShadow()}updateShadow(t){const{rtt:e,light:i}=this,{renderer:s,scene:r}=t,a=r.overrideMaterial;r.overrideMaterial=L1,e.setSize(i.shadow.mapSize.width,i.shadow.mapSize.height),i.shadow.updateMatrices(i);const o=s.getRenderTarget(),h=s.getRenderObjectFunction();s.setRenderObjectFunction((l,...u)=>{l.castShadow===!0&&s.renderObject(l,...u)}),s.setRenderTarget(e),s.render(r,i.shadow.camera),s.setRenderTarget(o),s.setRenderObjectFunction(h),r.overrideMaterial=a}disposeShadow(){this.rtt.dispose(),this.shadowNode=null,this.rtt=null,this.colorNode=this._defaultColorNode}updateBefore(t){const{light:e}=this;e.castShadow&&this.updateShadow(t)}update(){const{light:t}=this;this.color.copy(t.color).multiplyScalar(t.intensity)}}qt("AnalyticLightNode",Il);const zm=new WeakMap,Ont=n=>n.sort((t,e)=>t.id-e.id);class Pnt extends Ae{constructor(t=[]){super("vec3"),this.totalDiffuseNode=Pt().temp("totalDiffuse"),this.totalSpecularNode=Pt().temp("totalSpecular"),this.outgoingLightNode=Pt().temp("outgoingLight"),this.lightNodes=t,this._hash=null}get hasLight(){return this.lightNodes.length>0}getHash(){if(this._hash===null){const t=[];for(const e of this.lightNodes)t.push(e.getHash());this._hash="lights-"+t.join(",")}return this._hash}setup(t){const e=t.context,i=e.lightingModel;let s=this.outgoingLightNode;if(i){const{lightNodes:r,totalDiffuseNode:a,totalSpecularNode:o}=this;e.outgoingLight=s;const h=t.addStack();i.start(e,h,t);for(const w of r)w.build(t);i.indirectDiffuse(e,h,t),i.indirectSpecular(e,h,t),i.ambientOcclusion(e,h,t);const{backdrop:l,backdropAlpha:u}=e,{directDiffuse:f,directSpecular:m,indirectDiffuse:g,indirectSpecular:y}=e.reflectedLight;let _=f.add(g);l!==null&&(_=Pt(u!==null?u.mix(_,l):l)),a.assign(_),o.assign(m.add(y)),s.assign(a.add(o)),i.finish(e,h,t),s=s.bypass(t.removeStack())}return s}_getLightNodeById(t){for(const e of this.lightNodes)if(e.isAnalyticLightNode&&e.light.id===t)return e;return null}fromLights(t=[]){const e=[];t=Ont(t);for(const i of t){let s=this._getLightNodeById(i.id);if(s===null){const r=i.constructor,a=zm.has(r)?zm.get(r):Il;s=Me(new a(i))}e.push(s)}return this.lightNodes=e,this._hash=null,this}}const Fnt=Tt(Pnt);function Iu(n,t){if(zm.has(n)){console.warn(`Redefinition of light node ${t.type}`);return}if(typeof n!="function")throw new Error(`Light ${n.name} is not a class`);if(typeof t!="function"||!t.type)throw new Error(`Light node ${t.type} is not a class`);zm.set(n,t)}class UI extends qg{constructor(t=null){super(),this.aoNode=t}setup(t){const i=this.aoNode.x.sub(1).mul(1).add(1);t.context.ambientOcclusion.mulAssign(i)}}qt("AONode",UI);class GI extends Jw{constructor(t,e=null,i=null,s=null){super(t),this.lightingModel=e,this.backdropNode=i,this.backdropAlphaNode=s,this._context=null}getContext(){const{backdropNode:t,backdropAlphaNode:e}=this,i=Pt().temp("directDiffuse"),s=Pt().temp("directSpecular"),r=Pt().temp("indirectDiffuse"),a=Pt().temp("indirectSpecular"),o={directDiffuse:i,directSpecular:s,indirectDiffuse:r,indirectSpecular:a};return{radiance:Pt().temp("radiance"),irradiance:Pt().temp("irradiance"),iblIrradiance:Pt().temp("iblIrradiance"),ambientOcclusion:ct(1).temp("ambientOcclusion"),reflectedLight:o,backdrop:t,backdropAlpha:e}}setup(t){return this.context=this._context||(this._context=this.getContext()),this.context.lightingModel=this.lightingModel||t.context.lightingModel,super.setup(t)}}const VI=Tt(GI);Mt("lightingContext",VI);qt("LightingContextNode",GI);class WI extends Qi{constructor(t=Ent){super("vec2"),this.dirNode=t}setup(){const t=this.dirNode,e=t.z.atan2(t.x).mul(1/(Math.PI*2)).add(.5),i=t.y.negate().clamp(-1,1).asin().mul(1/Math.PI).add(.5);return Pe(e,i)}}const $I=Tt(WI);qt("EquirectUVNode",WI);class YI extends Ae{constructor(t,e=null){super("float"),this.textureNode=t,this.roughnessNode=e}setup(){const{textureNode:t,roughnessNode:e}=this,i=r2(t),s=e.mul(e).mul(Math.PI).div(e.add(1));return i.add(s.log2()).clamp(0,i)}}const Dnt=Tt(YI);qt("SpecularMIPLevelNode",YI);const AS=new WeakMap;class HI extends qg{constructor(t=null){super(),this.envNode=t}setup(t){let e=this.envNode;if(e.isTextureNode&&e.value.isCubeTexture!==!0){let h=AS.get(e.value);if(h===void 0){const l=e.value,u=t.renderer,f=t.getCubeRenderTarget(512).fromEquirectangularTexture(u,l);h=l2(f.texture),AS.set(e.value,h)}e=h}const i=pl("envMapIntensity","float",t.material),s=xo(e,RS(Bd,mn)).mul(i),r=xo(e,znt(snt)).mul(Math.PI).mul(i),a=km(s);t.context.radiance.addAssign(a),t.context.iblIrradiance.addAssign(r);const o=t.context.lightingModel.clearcoatRadiance;if(o){const h=xo(e,RS(Lm,Ic)).mul(i),l=km(h);o.addAssign(l)}}}const RS=(n,t)=>{let e=null,i=null;return{getUV:s=>{let r=null;return e===null&&(e=zn.negate().reflect(t),e=n.mul(n).mix(e,t).normalize(),e=e.transformDirection(Rh)),s.isCubeTextureNode?r=e:s.isTextureNode&&(i===null&&(i=$I(e)),r=i),r},getTextureLevel:()=>n,getTextureLevelAlgorithm:(s,r)=>Dnt(s,r)}},znt=n=>{let t=null;return{getUV:e=>{let i=null;return e.isCubeTextureNode?i=n:e.isTextureNode&&(t===null&&(t=$I(n),t=Pe(t.x,t.y.oneMinus())),i=t),i},getTextureLevel:e=>r2(e)}};qt("EnvironmentNode",HI);let O1,P1;class Mi extends Ae{constructor(t){super(),this.scope=t,this.isViewportNode=!0}getNodeType(){return this.scope===Mi.VIEWPORT?"vec4":"vec2"}getUpdateType(){let t=gn.NONE;return(this.scope===Mi.RESOLUTION||this.scope===Mi.VIEWPORT)&&(t=gn.FRAME),this.updateType=t,t}update({renderer:t}){this.scope===Mi.VIEWPORT?t.getViewport(P1):t.getDrawingBufferSize(O1)}setup(){const t=this.scope;if(t===Mi.COORDINATE)return;let e=null;if(t===Mi.RESOLUTION)e=ln(O1||(O1=new hi));else if(t===Mi.VIEWPORT)e=ln(P1||(P1=new $n));else{e=Bnt.div(IS);let i=e.x,s=e.y;/bottom/i.test(t)&&(s=s.oneMinus()),/right/i.test(t)&&(i=i.oneMinus()),e=Pe(i,s)}return e}generate(t){if(this.scope===Mi.COORDINATE){let e=t.getFragCoord();if(t.isFlipY()){const i=t.getNodeProperties(IS).outputNode.build(t);e=`${t.getType("vec2")}( ${e}.x, ${i}.y - ${e}.y )`}return e}return super.generate(t)}}Mi.COORDINATE="coordinate";Mi.RESOLUTION="resolution";Mi.VIEWPORT="viewport";Mi.TOP_LEFT="topLeft";Mi.BOTTOM_LEFT="bottomLeft";Mi.TOP_RIGHT="topRight";Mi.BOTTOM_RIGHT="bottomRight";const Bnt=ne(Mi,Mi.COORDINATE),IS=ne(Mi,Mi.RESOLUTION),qc=ne(Mi,Mi.VIEWPORT),c2=ne(Mi,Mi.TOP_LEFT);ne(Mi,Mi.BOTTOM_LEFT);ne(Mi,Mi.TOP_RIGHT);ne(Mi,Mi.BOTTOM_RIGHT);qt("ViewportNode",Mi);const cd=new hi;class Qf extends Ru{constructor(t=c2,e=null,i=null){i===null&&(i=new zR,i.minFilter=TR),super(i,t,e),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=gn.FRAME}updateBefore(t){const e=t.renderer;e.getDrawingBufferSize(cd);const i=this.value;(i.image.width!==cd.width||i.image.height!==cd.height)&&(i.image.width=cd.width,i.image.height=cd.height,i.needsUpdate=!0);const s=i.generateMipmaps;i.generateMipmaps=this.generateMipmaps,e.copyFramebufferToTexture(i),i.generateMipmaps=s}clone(){return new this.constructor(this.uvNode,this.levelNode,this.value)}}const Unt=Tt(Qf),Gnt=Tt(Qf,null,null,{generateMipmaps:!0});Mt("viewportTexture",Unt);Mt("viewportMipTexture",Gnt);qt("ViewportTextureNode",Qf);let lc=null;class qI extends Qf{constructor(t=c2,e=null){lc===null&&(lc=new Bg,lc.minFilter=CQ,lc.type=CR,lc.format=Lp),super(t,e,lc)}}const XI=Tt(qI);Mt("viewportDepthTexture",XI);qt("ViewportDepthTextureNode",qI);class qn extends Ae{constructor(t,e=null){super("float"),this.scope=t,this.valueNode=e,this.isViewportDepthNode=!0}generate(t){const{scope:e}=this;return e===qn.DEPTH_PIXEL?t.getFragDepth():super.generate(t)}setup(){const{scope:t}=this;let e=null;if(t===qn.DEPTH)e=J_(Fa.z,I1,N1);else if(t===qn.DEPTH_TEXTURE){const i=this.valueNode||XI(),s=jI(i,I1,N1);e=J_(s,I1,N1)}else t===qn.DEPTH_PIXEL&&this.valueNode!==null&&(e=ZI().assign(this.valueNode));return e}}const J_=(n,t,e)=>n.add(t).div(t.sub(e)),jI=(n,t,e)=>t.mul(e).div(e.sub(t).mul(n).sub(e));qn.DEPTH="depth";qn.DEPTH_TEXTURE="depthTexture";qn.DEPTH_PIXEL="depthPixel";const ZI=Tt(qn,qn.DEPTH_PIXEL);ne(qn,qn.DEPTH);Tt(qn,qn.DEPTH_TEXTURE);const KI=ne(qn,qn.DEPTH_PIXEL);KI.assign=n=>ZI(n);qt("ViewportDepthNode",qn);const Q_=new Map;class Tr extends Fw{constructor(){super(),this.isNodeMaterial=!0,this.type=this.constructor.type,this.forceSinglePass=!1,this.fog=!0,this.lights=!0,this.normals=!0,this.colorSpaced=!0,this.lightsNode=null,this.envNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.depthNode=null,this.outputNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+$R(this)}build(t){this.setup(t)}setup(t){t.addStack(),t.stack.outputNode=this.vertexNode||this.setupPosition(t),t.addFlow("vertex",t.removeStack()),t.addStack();let e;if(this.fragmentNode===null){this.depthWrite===!0&&this.setupDepth(t),this.normals===!0&&this.setupNormal(t),this.setupDiffuseColor(t),this.setupVariants(t);const i=this.setupLighting(t);e=this.setupOutput(t,li(i,ls.a)),qet.assign(e),this.outputNode!==null&&(e=this.outputNode)}else e=this.setupOutput(t,this.fragmentNode);t.stack.outputNode=e,t.addFlow("fragment",t.removeStack())}setupDepth(t){const{renderer:e}=t;let i=this.depthNode;i===null&&e.logarithmicDepthBuffer===!0&&(i=TS().w.add(1).log2().mul(nnt).mul(.5)),i!==null&&KI.assign(i).append()}setupPosition(t){const{object:e}=t,i=e.geometry;t.addStack(),(i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color)&&knt(e).append(),e.isSkinnedMesh===!0&&Int(e).append(),e.instanceMatrix&&e.instanceMatrix.isInstancedBufferAttribute===!0&&t.isAvailable("instance")===!0&&Ant(e).append(),this.positionNode!==null&&$s.assign(this.positionNode);const s=TS();return t.context.vertex=t.removeStack(),t.context.mvp=s,s}setupDiffuseColor({geometry:t}){let e=this.colorNode?li(this.colorNode):mf;this.vertexColors===!0&&t.hasAttribute("color")&&(e=li(e.xyz.mul(Es("color","vec3")),e.a)),ls.assign(e);const i=this.opacityNode?ct(this.opacityNode):AI;if(ls.a.assign(ls.a.mul(i)),this.alphaTestNode!==null||this.alphaTest>0){const s=this.alphaTestNode!==null?ct(this.alphaTestNode):rnt;ls.a.lessThanEqual(s).discard()}}setupVariants(){}setupNormal(){if(this.flatShading===!0){const t=Fa.dFdx().cross(Fa.dFdy()).normalize();mn.assign(t)}else{const t=this.normalNode?Pt(this.normalNode):dnt;mn.assign(t)}}getEnvNode(t){let e=null;return this.envNode?e=this.envNode:this.envMap?e=this.envMap.isCubeTexture?l2(this.envMap):jr(this.envMap):t.environmentNode&&(e=t.environmentNode),e}setupLights(t){const e=this.getEnvNode(t),i=[];e&&i.push(new HI(e)),t.material.aoMap&&i.push(new UI(jr(t.material.aoMap)));let s=this.lightsNode||t.lightsNode;return i.length>0&&(s=Fnt([...s.lightNodes,...i])),s}setupLightingModel(){}setupLighting(t){const{material:e}=t,{backdropNode:i,backdropAlphaNode:s,emissiveNode:r}=this,o=this.lights===!0||this.lightsNode!==null?this.setupLights(t):null;let h=ls.rgb;if(o&&o.hasLight!==!1){const l=this.setupLightingModel(t);h=VI(o,l,i,s)}else i!==null&&(h=Pt(s!==null?Ua(h,i,s):i));return(r&&r.isNode===!0||e.emissive&&e.emissive.isColor===!0)&&(h=h.add(Pt(r||ont))),h}setupOutput(t,e){const i=t.renderer,s=t.toneMappingNode;if(this.toneMapped===!0&&s&&(e=li(s.context({color:e.rgb}),e.a)),this.fog===!0){const r=t.fogNode;r&&(e=li(r.mixAssign(e.rgb),e.a))}if(this.colorSpaced===!0){const r=i.currentColorSpace;r!==Cl&&r!==Wc&&(e=e.linearToColorSpace(r))}return e}setDefaultValues(t){for(const i in t){const s=t[i];this[i]===void 0&&(this[i]=s,s&&s.clone&&(this[i]=s.clone()))}Object.assign(this.defines,t.defines);const e=Object.getOwnPropertyDescriptors(t.constructor.prototype);for(const i in e)Object.getOwnPropertyDescriptor(this.constructor.prototype,i)===void 0&&e[i].get!==void 0&&Object.defineProperty(this.constructor.prototype,i,e[i])}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{},nodes:{}});const i=ps.prototype.toJSON.call(this,t),s=Nm(this);i.inputNodes={};for(const{property:a,childNode:o}of s)i.inputNodes[a]=o.toJSON(t).uuid;function r(a){const o=[];for(const h in a){const l=a[h];delete l.metadata,o.push(l)}return o}if(e){const a=r(t.textures),o=r(t.images),h=r(t.nodes);a.length>0&&(i.textures=a),o.length>0&&(i.images=o),h.length>0&&(i.nodes=h)}return i}copy(t){return this.lightsNode=t.lightsNode,this.envNode=t.envNode,this.colorNode=t.colorNode,this.normalNode=t.normalNode,this.opacityNode=t.opacityNode,this.backdropNode=t.backdropNode,this.backdropAlphaNode=t.backdropAlphaNode,this.alphaTestNode=t.alphaTestNode,this.positionNode=t.positionNode,this.depthNode=t.depthNode,this.outputNode=t.outputNode,this.fragmentNode=t.fragmentNode,this.vertexNode=t.vertexNode,super.copy(t)}static fromMaterial(t){if(t.isNodeMaterial===!0)return t;const e=t.type.replace("Material","NodeMaterial"),i=JI(e);if(i===void 0)throw new Error(`NodeMaterial: Material "${t.type}" is not compatible.`);for(const s in t)i[s]=t[s];return i}}function sr(n,t){if(typeof t!="function"||!n)throw new Error(`Node material ${n} is not a class`);if(Q_.has(n)){console.warn(`Redefinition of node material ${n}`);return}Q_.set(n,t),t.type=n}function JI(n){const t=Q_.get(n);if(t!==void 0)return new t}sr("NodeMaterial",Tr);class u2 extends Ae{constructor(t,e,i=null){super(),this.condNode=t,this.ifNode=e,this.elseNode=i}getNodeType(t){const e=this.ifNode.getNodeType(t);if(this.elseNode!==null){const i=this.elseNode.getNodeType(t);if(t.getTypeLength(i)>t.getTypeLength(e))return i}return e}generate(t){const e=this.getNodeType(t),i={tempWrite:!1},{ifNode:s,elseNode:r}=this,a=s.getNodeType(t)!=="void"||r&&r.getNodeType(t)!=="void",o=a?yr(e).build(t):"",h=xo(this.condNode).build(t,"bool");t.addFlowCode(`
${t.tab}if ( ${h} ) {

`).addFlowTab();let l=xo(this.ifNode,i).build(t,e);if(l=a?o+" = "+l+";":l,t.removeFlowTab().addFlowCode(t.tab+"	"+l+`

`+t.tab+"}"),r!==null){t.addFlowCode(` else {

`).addFlowTab();let u=xo(r,i).build(t,e);u=o?o+" = "+u+";":u,t.removeFlowTab().addFlowCode(t.tab+"	"+u+`

`+t.tab+`}

`)}else t.addFlowCode(`

`);return o}}const dh=Tt(u2);Mt("cond",dh);qt("CondNode",u2);class QI extends Ae{constructor(t=null){super(),this.nodes=[],this.outputNode=null,this.parent=t,this._currentCond=null,this.isStackNode=!0}getNodeType(t){return this.outputNode?this.outputNode.getNodeType(t):"void"}add(t){return this.nodes.push(t),this}if(t,e){const i=new zd(e);return this._currentCond=dh(t,i),this.add(this._currentCond)}elseif(t,e){const i=new zd(e),s=dh(t,i);return this._currentCond.elseNode=s,this._currentCond=s,this}else(t){return this._currentCond.elseNode=new zd(t),this}build(t,...e){const i=xet();bS(this);for(const s of this.nodes)s.build(t,"void");return bS(i),this.outputNode?this.outputNode.build(t,...e):super.build(t,...e)}}Tt(QI);qt("StackNode",QI);class tN extends Ae{constructor(t){super(),this.types=t,this.isStructTypeNode=!0}getMemberTypes(){return this.types}}qt("StructTypeNode",tN);class eN extends Ae{constructor(...t){super(),this.isOutputStructNode=!0,this.members=t}setup(t){super.setup(t);const e=this.members,i=[];for(let s=0;s<e.length;s++)i.push(e[s].getNodeType(t));this.nodeType=t.getStructTypeFromNode(new tN(i)).name}generate(t,e){const i=t.getVarFromNode(this);i.isOutputStructVar=!0;const s=t.getPropertyName(i),r=this.members,a=s!==""?s+".":"";for(let o=0;o<r.length;o++){const h=r[o].build(t,e);t.addLineFlowCode(`${a}m${o} = ${h}`)}return s}}Tt(eN);qt("OutputStructNode",eN);class iN extends Ae{constructor(t){super(),this.seedNode=t}setup(){const t=this.seedNode.uint().mul(747796405).add(2891336453),e=t.shiftRight(t.shiftRight(28).add(4)).bitXor(t).mul(277803737);return e.shiftRight(22).bitXor(e).float().mul(1/2**32)}}const Vnt=Tt(iN);Mt("hash",Vnt);qt("HashNode",iN);let F1;class nN extends u2{constructor(t){F1=F1||s2("discard"),super(t,F1)}}const Wnt=Tt(nN),$nt=n=>Wnt(n).append();Mt("discard",$nt);qt("DiscardNode",nN);class sN extends Ae{constructor(t=[],...e){super(),this.functionNodes=t,this.parametersNodes=e,this._candidateFnCall=null}getNodeType(){return this.functionNodes[0].shaderNode.layout.type}setup(t){const e=this.parametersNodes;let i=this._candidateFnCall;if(i===null){let s=null,r=-1;for(const a of this.functionNodes){const h=a.shaderNode.layout;if(h===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const l=h.inputs;if(e.length===l.length){let u=0;for(let f=0;f<e.length;f++){const m=e[f],g=l[f];m.getNodeType(t)===g.type?u++:u=0}u>r&&(s=a,r=u)}}this._candidateFnCall=i=s(...e)}return i}}const Ynt=Tt(sN),Cr=n=>(...t)=>Ynt(n,...t);qt("FunctionOverloadingNode",sN);class rN extends Ae{constructor(t=[]){super(),this.params=t}getVarName(t){return String.fromCharCode("i".charCodeAt()+t)}getProperties(t){const e=t.getNodeProperties(this);if(e.stackNode!==void 0)return e;const i={};for(let s=0,r=this.params.length-1;s<r;s++){const a=this.params[s],o=a.isNode!==!0&&a.name||this.getVarName(s),h=a.isNode!==!0&&a.type||"int";i[o]=s2(o,h)}return e.returnsNode=this.params[this.params.length-1](i,t.addStack(),t),e.stackNode=t.removeStack(),e}getNodeType(t){const{returnsNode:e}=this.getProperties(t);return e?e.getNodeType(t):"void"}setup(t){this.getProperties(t)}generate(t){const e=this.getProperties(t),i={tempWrite:!1},s=this.params,r=e.stackNode;for(let h=0,l=s.length-1;h<l;h++){const u=s[h];let f=null,m=null,g=null,y=null,_=null,w=null;u.isNode?(y="int",g=this.getVarName(h),f="0",m=u.build(t,y),_="<"):(y=u.type||"int",g=u.name||this.getVarName(h),f=u.start,m=u.end,_=u.condition,w=u.update,typeof f=="number"?f=f.toString():f&&f.isNode&&(f=f.build(t,y)),typeof m=="number"?m=m.toString():m&&m.isNode&&(m=m.build(t,y)),f!==void 0&&m===void 0?(f=f+" - 1",m="0",_=">="):m!==void 0&&f===void 0&&(f="0",_="<"),_===void 0&&(Number(f)>Number(m)?_=">=":_="<"));const M={start:f,end:m,condition:_},T=M.start,A=M.end;let R="",I="",L="";w||(y==="int"?_.includes("<")?w="++":w="--":_.includes("<")?w="+= 1":w="-= 1"),R+=t.getVar(y,g)+" = "+T,I+=g+" "+_+" "+A,L+=g+" "+w;const k=`for ( ${R}; ${I}; ${L} )`;t.addFlowCode((h===0?`
`:"")+t.tab+k+` {

`).addFlowTab()}const a=xo(r,i).build(t,"void"),o=e.returnsNode?e.returnsNode.build(t):"";t.removeFlowTab().addFlowCode(`
`+t.tab+a);for(let h=0,l=this.params.length-1;h<l;h++)t.addFlowCode((h===0?"":t.tab)+`}

`).removeFlowTab();return t.addFlowTab(),o}}const Un=(...n)=>Me(new rN(Yc(n,"int"))).append();Mt("loop",(n,...t)=>rI(n,Un(...t)));qt("LoopNode",rN);class aN extends Qi{constructor(){super("vec2")}setup(){const t=Pt(zn.z,0,zn.x.negate()).normalize(),e=zn.cross(t);return Pe(t.dot(mn),e.dot(mn)).mul(.495).add(.5)}}ne(aN);qt("MatcapUVNode",aN);class Ws extends Ch{constructor(t=Ws.LOCAL,e=1,i=0){super(i),this.scope=t,this.scale=e,this.updateType=gn.FRAME}update(t){const e=this.scope,i=this.scale;e===Ws.LOCAL?this.value+=t.deltaTime*i:e===Ws.DELTA?this.value=t.deltaTime*i:e===Ws.FRAME?this.value=t.frameId:this.value=t.time*i}serialize(t){super.serialize(t),t.scope=this.scope,t.scale=this.scale}deserialize(t){super.deserialize(t),this.scope=t.scope,this.scale=t.scale}}Ws.LOCAL="local";Ws.GLOBAL="global";Ws.DELTA="delta";Ws.FRAME="frame";const Hnt=(n,t=0)=>Me(new Ws(Ws.LOCAL,n,t));ne(Ws,Ws.FRAME).uint();qt("TimerNode",Ws);class En extends Ae{constructor(t=En.SINE,e=Hnt()){super(),this.method=t,this.timeNode=e}getNodeType(t){return this.timeNode.getNodeType(t)}setup(){const t=this.method,e=Me(this.timeNode);let i=null;return t===En.SINE?i=e.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5):t===En.SQUARE?i=e.fract().round():t===En.TRIANGLE?i=e.add(.5).fract().mul(2).sub(1).abs():t===En.SAWTOOTH&&(i=e.fract()),i}serialize(t){super.serialize(t),t.method=this.method}deserialize(t){super.deserialize(t),this.method=t.method}}En.SINE="sine";En.SQUARE="square";En.TRIANGLE="triangle";En.SAWTOOTH="sawtooth";Tt(En,En.SINE);Tt(En,En.SQUARE);Tt(En,En.TRIANGLE);Tt(En,En.SAWTOOTH);qt("OscNode",En);class Da extends Qi{constructor(t,e){super(),this.scope=t,this.node=e}getNodeType(t){return this.node.getNodeType(t)}setup(){const{scope:t,node:e}=this;let i=null;return t===Da.DIRECTION_TO_COLOR?i=e.mul(.5).add(.5):t===Da.COLOR_TO_DIRECTION&&(i=e.mul(2).sub(1)),i}}Da.DIRECTION_TO_COLOR="directionToColor";Da.COLOR_TO_DIRECTION="colorToDirection";const oN=Tt(Da,Da.DIRECTION_TO_COLOR),qnt=Tt(Da,Da.COLOR_TO_DIRECTION);Mt("directionToColor",oN);Mt("colorToDirection",qnt);qt("PackingNode",Da);class d2 extends Ae{constructor(t,e,i,s=ct(0),r=ct(1)){super(),this.node=t,this.inLowNode=e,this.inHighNode=i,this.outLowNode=s,this.outHighNode=r,this.doClamp=!0}setup(){const{node:t,inLowNode:e,inHighNode:i,outLowNode:s,outHighNode:r,doClamp:a}=this;let o=t.sub(e).div(i.sub(e));return a===!0&&(o=o.clamp()),o.mul(r.sub(s)).add(s)}}const Xnt=Tt(d2,null,null,{doClamp:!1}),jnt=Tt(d2);Mt("remap",Xnt);Mt("remapClamp",jnt);qt("RemapNode",d2);class hN extends Qi{constructor(t,e,i=Pe(.5)){super("vec2"),this.uvNode=t,this.rotationNode=e,this.centerNode=i}setup(){const{uvNode:t,rotationNode:e,centerNode:i}=this,s=e.cos(),r=e.sin(),a=t.sub(i);return Pe(Pe(s,r).dot(a),Pe(r.negate(),s).dot(a)).add(i)}}const Znt=Tt(hN);Mt("rotateUV",Znt);qt("RotateUVNode",hN);class lN extends Ae{constructor(t,e=Ah(),i=ct(0)){super("vec2"),this.countNode=t,this.uvNode=e,this.frameNode=i}setup(){const{frameNode:t,uvNode:e,countNode:i}=this,{width:s,height:r}=i,a=t.mod(s.mul(r)).floor(),o=a.mod(s),h=r.sub(a.add(1).div(s).ceil()),l=i.reciprocal(),u=Pe(o,h);return e.add(u).mul(l)}}Tt(lN);qt("SpriteSheetUVNode",lN);class cN extends Ae{constructor(t,e=null,i=null,s=ct(1),r=$s,a=Mo){super("vec4"),this.textureXNode=t,this.textureYNode=e,this.textureZNode=i,this.scaleNode=s,this.positionNode=r,this.normalNode=a}setup(){const{textureXNode:t,textureYNode:e,textureZNode:i,scaleNode:s,positionNode:r,normalNode:a}=this;let o=a.abs().normalize();o=o.div(o.dot(Pt(1)));const h=r.yz.mul(s),l=r.zx.mul(s),u=r.xy.mul(s),f=t.value,m=e!==null?e.value:f,g=i!==null?i.value:f,y=jr(f,h).mul(o.x),_=jr(m,l).mul(o.y),w=jr(g,u).mul(o.z);return wr(y,_,w)}}const Knt=Tt(cN),Jnt=(...n)=>Knt(...n);Mt("triplanarTexture",Jnt);qt("TriplanarTexturesNode",cN);class Sn extends Ae{constructor(t=Sn.LOCAL){super("vec3"),this.scope=t}getHash(){return`bitangent-${this.scope}`}generate(t){const e=this.scope;let i;e===Sn.GEOMETRY?i=Fm.cross(Dm):e===Sn.LOCAL?i=Mo.cross(h2):e===Sn.VIEW?i=bh.cross(Hg):e===Sn.WORLD&&(i=CI.cross(Rnt));const s=i.mul(Dm.w).xyz;return br(hn(s)).build(t,this.getNodeType(t))}serialize(t){super.serialize(t),t.scope=this.scope}deserialize(t){super.deserialize(t),this.scope=t.scope}}Sn.GEOMETRY="geometry";Sn.LOCAL="local";Sn.VIEW="view";Sn.WORLD="world";ne(Sn,Sn.GEOMETRY);ne(Sn,Sn.LOCAL);const Qnt=ne(Sn,Sn.VIEW);ne(Sn,Sn.WORLD);const tst=br(mn.cross(PI).mul(Dm.w));br(tst.transformDirection(Rh));qt("BitangentNode",Sn);const Xg=1/6,uN=n=>tn(Xg,tn(n,tn(n,n.negate().add(3)).sub(3)).add(1)),tx=n=>tn(Xg,tn(n,tn(n,tn(3,n).sub(6))).add(4)),dN=n=>tn(Xg,tn(n,tn(n,tn(-3,n).add(3)).add(3)).add(1)),ex=n=>tn(Xg,n2(n,3)),NS=n=>uN(n).add(tx(n)),kS=n=>dN(n).add(ex(n)),LS=n=>wr(-1,tx(n).div(uN(n).add(tx(n)))),OS=n=>wr(1,ex(n).div(dN(n).add(ex(n)))),PS=(n,t,e)=>{const i=n.uvNode,s=tn(i,t.zw).add(.5),r=Zf(s),a=i2(s),o=NS(a.x),h=kS(a.x),l=LS(a.x),u=OS(a.x),f=LS(a.y),m=OS(a.y),g=Pe(r.x.add(l),r.y.add(f)).sub(.5).mul(t.xy),y=Pe(r.x.add(u),r.y.add(f)).sub(.5).mul(t.xy),_=Pe(r.x.add(l),r.y.add(m)).sub(.5).mul(t.xy),w=Pe(r.x.add(u),r.y.add(m)).sub(.5).mul(t.xy),M=NS(a.y).mul(wr(o.mul(n.uv(g).level(e)),h.mul(n.uv(y).level(e)))),T=kS(a.y).mul(wr(o.mul(n.uv(_).level(e)),h.mul(n.uv(w).level(e))));return M.add(T)},est=(n,t)=>{const e=Pe(n.size(ot(t))),i=Pe(n.size(ot(t.add(1)))),s=ff(1,e),r=ff(1,i),a=PS(n,li(s,e),Zf(t)),o=PS(n,li(r,i),yI(t));return i2(t).mix(a,o)};class fN extends Qi{constructor(t,e=ct(3)){super("vec4"),this.textureNode=t,this.blurNode=e}setup(){return est(this.textureNode,this.blurNode)}}const ist=Tt(fN);Mt("bicubic",ist);qt("TextureBicubicNode",fN);class pN extends Ae{constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}ne(pN);qt("PointUVNode",pN);class Zr extends Ae{constructor(t=Zr.BACKGROUND_BLURRINESS,e=null){super(),this.scope=t,this.scene=e}setup(t){const e=this.scope,i=this.scene!==null?this.scene:t.scene;let s;return e===Zr.BACKGROUND_BLURRINESS?s=pl("backgroundBlurriness","float",i):e===Zr.BACKGROUND_INTENSITY?s=pl("backgroundIntensity","float",i):console.error("THREE.SceneNode: Unknown scope:",e),s}}Zr.BACKGROUND_BLURRINESS="backgroundBlurriness";Zr.BACKGROUND_INTENSITY="backgroundIntensity";ne(Zr,Zr.BACKGROUND_BLURRINESS);ne(Zr,Zr.BACKGROUND_INTENSITY);qt("SceneNode",Zr);class nst extends o2{constructor(t,e,i=0){super(t,e,i),this.isStorageBufferNode=!0}getInputType(){return"storageBuffer"}}qt("StorageBufferNode",nst);class mN extends Ru{constructor(t,e,i=null){super(t,e),this.storeNode=i,this.isStoreTextureNode=!0}getNodeType(){return"void"}}Tt(mN);qt("TextureStoreNode",mN);class sst extends Jf{constructor(t,e,i=null){super(t,e,i),this.userData=i}update(t){this.reference=this.userData!==null?this.userData:t.object.userData,super.update(t)}}qt("UserDataNode",sst);const rst=Zt(({base:n,blend:t})=>{const e=i=>t[i].lessThan(gI).cond(t[i],n[i].oneMinus().div(t[i]).oneMinus().max(0));return Pt(e("x"),e("y"),e("z"))}),ast=Zt(({base:n,blend:t})=>{const e=i=>t[i].equal(1).cond(t[i],n[i].div(t[i].oneMinus()).max(0));return Pt(e("x"),e("y"),e("z"))}),ost=Zt(({base:n,blend:t})=>{const e=i=>n[i].oneMinus().mul(t[i].oneMinus()).oneMinus();return Pt(e("x"),e("y"),e("z"))}),hst=Zt(({base:n,blend:t})=>{const e=i=>n[i].lessThan(.5).cond(n[i].mul(t[i],2),n[i].oneMinus().mul(t[i].oneMinus()).oneMinus());return Pt(e("x"),e("y"),e("z"))});class Bn extends Qi{constructor(t,e,i){super(),this.blendMode=t,this.baseNode=e,this.blendNode=i}setup(){const{blendMode:t,baseNode:e,blendNode:i}=this,s={base:e,blend:i};let r=null;return t===Bn.BURN?r=rst(s):t===Bn.DODGE?r=ast(s):t===Bn.SCREEN?r=ost(s):t===Bn.OVERLAY&&(r=hst(s)),r}}Bn.BURN="burn";Bn.DODGE="dodge";Bn.SCREEN="screen";Bn.OVERLAY="overlay";const lst=Tt(Bn,Bn.BURN),cst=Tt(Bn,Bn.DODGE),ust=Tt(Bn,Bn.OVERLAY),dst=Tt(Bn,Bn.SCREEN);Mt("burn",lst);Mt("dodge",cst);Mt("overlay",ust);Mt("screen",dst);qt("BlendModeNode",Bn);class gN extends Ae{constructor(){super("bool"),this.isFrontFacingNode=!0}generate(t){return t.getFrontFacing()}}const fst=ne(gN),yN=ct(fst).mul(2).sub(1);qt("FrontFacingNode",gN);const pst=Zt(({textureNode:n,bumpScale:t})=>{let e=n;if(e.isTextureNode!==!0&&e.traverse(a=>{a.isTextureNode===!0&&(e=a)}),e.isTextureNode!==!0)throw new Error("THREE.TSL: dHdxy_fwd() requires a TextureNode.");const i=ct(n),s=e.uvNode||Ah(),r=a=>n.cache().context({getUV:()=>a,forceUVContext:!0});return Pe(ct(r(s.add(s.dFdx()))).sub(i),ct(r(s.add(s.dFdy()))).sub(i)).mul(t)}),mst=Zt(n=>{const{surf_pos:t,surf_norm:e,dHdxy:i}=n,s=t.dFdx().normalize(),r=t.dFdy().normalize(),a=e,o=r.cross(a),h=a.cross(s),l=s.dot(o).mul(yN),u=l.sign().mul(i.x.mul(o).add(i.y.mul(h)));return l.abs().mul(e).sub(u).normalize()});class _N extends Qi{constructor(t,e=null){super("vec3"),this.textureNode=t,this.scaleNode=e}setup(){const t=this.scaleNode!==null?this.scaleNode:1,e=pst({textureNode:this.textureNode,bumpScale:t});return mst({surf_pos:Fa,surf_norm:bh,dHdxy:e})}}const gst=Tt(_N);Mt("bumpMap",gst);qt("BumpMapNode",_N);const yst=Zt(({color:n,adjustment:t})=>t.mix(Est(n.rgb),n.rgb)),_st=Zt(({color:n,adjustment:t})=>{const e=wr(n.r,n.g,n.b).div(3),i=n.r.max(n.g.max(n.b)),s=i.sub(e).mul(t).mul(-3);return Ua(n.rgb,i,s)}),xst=Zt(({color:n,adjustment:t})=>{const e=Pt(.57735,.57735,.57735),i=t.cos();return Pt(n.rgb.mul(i).add(e.cross(n.rgb).mul(t.sin()).add(e.mul(Kf(e,n.rgb).mul(i.oneMinus())))))});class Ys extends Qi{constructor(t,e,i=ct(1)){super("vec3"),this.method=t,this.colorNode=e,this.adjustmentNode=i}setup(){const{method:t,colorNode:e,adjustmentNode:i}=this,s={color:e,adjustment:i};let r=null;return t===Ys.SATURATION?r=yst(s):t===Ys.VIBRANCE?r=_st(s):t===Ys.HUE?r=xst(s):console.error(`${this.type}: Method "${this.method}" not supported!`),r}}Ys.SATURATION="saturation";Ys.VIBRANCE="vibrance";Ys.HUE="hue";const vst=Tt(Ys,Ys.SATURATION),wst=Tt(Ys,Ys.VIBRANCE),bst=Tt(Ys,Ys.HUE),Mst=Pt(.2125,.7154,.0721),Est=(n,t=Mst)=>Kf(n,t);Mt("saturation",vst);Mt("vibrance",wst);Mt("hue",bst);qt("ColorAdjustmentNode",Ys);const Sst=Zt(n=>{const{eye_pos:t,surf_norm:e,mapN:i,uv:s}=n,r=t.dFdx(),a=t.dFdy(),o=s.dFdx(),h=s.dFdy(),l=e,u=a.cross(l),f=l.cross(r),m=u.mul(o.x).add(f.mul(h.x)),g=u.mul(o.y).add(f.mul(h.y)),y=m.dot(m).max(g.dot(g)),_=yN.mul(y.inverseSqrt());return wr(m.mul(i.x,_),g.mul(i.y,_),l.mul(i.z)).normalize()});class xN extends Qi{constructor(t,e=null){super("vec3"),this.node=t,this.scaleNode=e,this.normalMapType=wh}setup(t){const{normalMapType:e,scaleNode:i}=this;let s=this.node.mul(2).sub(1);i!==null&&(s=Pt(s.xy.mul(i),s.z));let r=null;return e===OQ?r=TI.mul(s).normalize():e===wh&&(t.hasGeometryAttribute("tangent")===!0?r=Cst.mul(s).normalize():r=Sst({eye_pos:Fa,surf_norm:bh,mapN:s,uv:Ah()})),r}}const Tst=Tt(xN),Cst=cu(Hg,Qnt,bh);Mt("normalMap",Tst);qt("NormalMapNode",xN);class vN extends Qi{constructor(t,e){super(),this.sourceNode=t,this.stepsNode=e}setup(){const{sourceNode:t,stepsNode:e}=this;return t.mul(e).floor().div(e)}}const Ast=Tt(vN);Mt("posterize",Ast);qt("PosterizeNode",vN);const Rst=Zt(({color:n,exposure:t})=>n.mul(t).clamp()),Ist=Zt(({color:n,exposure:t})=>(n=n.mul(t),n.div(n.add(1)).clamp())),Nst=Zt(({color:n,exposure:t})=>{n=n.mul(t),n=n.sub(.004).max(0);const e=n.mul(n.mul(6.2).add(.5)),i=n.mul(n.mul(6.2).add(1.7)).add(.06);return e.div(i).pow(2.2)}),kst=Zt(({color:n})=>{const t=n.mul(n.add(.0245786)).sub(90537e-9),e=n.mul(n.add(.432951).mul(.983729)).add(.238081);return t.div(e)}),Lst=Zt(({color:n,exposure:t})=>{const e=cu(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),i=cu(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return n=n.mul(t).div(.6),n=e.mul(n),n=kst({color:n}),n=i.mul(n),n.clamp()}),Ost={[MQ]:Rst,[EQ]:Ist,[SQ]:Nst,[TQ]:Lst};class Pst extends Qi{constructor(t=V_,e=ct(1),i=null){super("vec3"),this.toneMapping=t,this.exposureNode=e,this.colorNode=i}getCacheKey(){let t=super.getCacheKey();return t="{toneMapping:"+this.toneMapping+",nodes:"+t+"}",t}setup(t){const e=this.colorNode||t.context.color,i=this.toneMapping;if(i===V_)return e;const s={exposure:this.exposureNode,color:e},r=Ost[i];let a=null;return r?a=r(s):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",i),a=e),a}}qt("ToneMappingNode",Pst);let D1=null;class wN extends Qf{constructor(t=c2,e=null){D1===null&&(D1=new zR),super(t,e,D1)}}const Fst=Tt(wN);Mt("viewportSharedTexture",Fst);qt("ViewportSharedTextureNode",wN);const Dst=new PR(-1,1,1,-1,0,1);class zst extends zg{constructor(t=!1){super();const e=t===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new Y_([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Y_(e,2))}}const Bst=new zst;class Ust{constructor(t=null){this._mesh=new vtt(Bst,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,Dst)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}const Gst=Ust,z1=new Gst;class Vst extends Qi{constructor(t,e=2){super(t),this.textureNode=t,this.sigma=e,this.directionNode=Pe(1),this._invSize=ln(new hi),this._passDirection=ln(new hi),this._horizontalRT=new $_,this._verticalRT=new $_,this.updateBeforeType=gn.RENDER,this.resolution=new hi(1,1)}setSize(t,e){t=Math.max(Math.round(t*this.resolution.x),1),e=Math.max(Math.round(e*this.resolution.y),1),this._invSize.value.set(1/t,1/e),this._horizontalRT.setSize(t,e),this._verticalRT.setSize(t,e)}updateBefore(t){const{renderer:e}=t,i=this.textureNode,s=i.value,r=e.getRenderTarget(),a=i.value;z1.material=this._material,this.setSize(s.image.width,s.image.height),e.setRenderTarget(this._horizontalRT),this._passDirection.value.set(1,0),z1.render(e),i.value=this._horizontalRT.texture,e.setRenderTarget(this._verticalRT),this._passDirection.value.set(0,1),z1.render(e),e.setRenderTarget(r),i.value=a}setup(t){const e=this.textureNode;if(e.isTextureNode!==!0)return console.error("GaussianBlurNode requires a TextureNode."),li();const i=e.uvNode||Ah(),s=h=>e.cache().context({getUV:()=>h,forceUVContext:!0}),r=Zt(()=>{const h=3+2*this.sigma,l=this._getCoefficients(h),u=this._invSize,f=Pe(this.directionNode).mul(this._passDirection),m=ct(l[0]).toVar(),g=Pt(s(i).mul(m)).toVar();for(let y=1;y<h;y++){const _=ct(y),w=ct(l[y]),M=Pe(f.mul(u.mul(_))).toVar(),T=Pt(s(i.add(M))),A=Pt(s(i.sub(M)));g.addAssign(T.add(A).mul(w)),m.addAssign(tn(2,w))}return li(g.div(m),1)}),a=this._material||(this._material=t.createNodeMaterial("MeshBasicNodeMaterial"));a.fragmentNode=r();const o=t.getNodeProperties(this);return o.textureNode=e,jr(this._verticalRT.texture)}_getCoefficients(t){const e=[];for(let i=0;i<t;i++)e.push(.39894*Math.exp(-.5*i*i/(t*t))/t);return e}}const Wst=(n,t)=>Me(new Vst(Me(n),t));Mt("gaussianBlur",Wst);class FS extends Ru{constructor(t,e){super(e),this.passNode=t,this.setUpdateMatrix(!1)}setup(t){return this.passNode.build(t),super.setup(t)}clone(){return new this.constructor(this.passNode,this.value)}}class t0 extends Qi{constructor(t,e,i){super("vec4"),this.scope=t,this.scene=e,this.camera=i,this._pixelRatio=1,this._width=1,this._height=1;const s=new Bg;s.isRenderTargetTexture=!0,s.type=kw,s.name="PostProcessingDepth";const r=new $_(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:RQ});r.texture.name="PostProcessing",r.depthTexture=s,this.renderTarget=r,this.updateBeforeType=gn.FRAME,this._textureNode=Me(new FS(this,r.texture)),this._depthTextureNode=Me(new FS(this,s)),this._depthNode=null,this._cameraNear=ln(0),this._cameraFar=ln(0),this.isPassNode=!0}isGlobal(){return!0}getTextureNode(){return this._textureNode}getTextureDepthNode(){return this._depthTextureNode}getDepthNode(){if(this._depthNode===null){const t=this._cameraNear,e=this._cameraFar;this._depthNode=J_(jI(this._depthTextureNode,t,e),t,e)}return this._depthNode}setup(){return this.scope===t0.COLOR?this.getTextureNode():this.getDepthNode()}updateBefore(t){const{renderer:e}=t,{scene:i,camera:s}=this;this._pixelRatio=e.getPixelRatio();const r=e.getSize(new hi);this.setSize(r.width,r.height);const a=e.toneMapping,o=e.toneMappingNode,h=e.getRenderTarget();this._cameraNear.value=s.near,this._cameraFar.value=s.far,e.toneMapping=V_,e.toneMappingNode=null,e.setRenderTarget(this.renderTarget),e.render(i,s),e.toneMapping=a,e.toneMappingNode=o,e.setRenderTarget(h)}setSize(t,e){this._width=t,this._height=e;const i=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget.setSize(i,s)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}t0.COLOR="color";t0.DEPTH="depth";qt("PassNode",t0);class bN extends Qi{constructor(t=null,e={}){super(),this.functionNode=t,this.parameters=e}setParameters(t){return this.parameters=t,this}getParameters(){return this.parameters}getNodeType(t){return this.functionNode.getNodeType(t)}generate(t){const e=[],i=this.functionNode,s=i.getInputs(t),r=this.parameters;if(Array.isArray(r))for(let o=0;o<r.length;o++){const h=s[o],l=r[o];e.push(l.build(t,h.type))}else for(const o of s){const h=r[o.name];if(h!==void 0)e.push(h.build(t,o.type));else throw new Error(`FunctionCallNode: Input '${o.name}' not found in FunctionNode.`)}return`${i.build(t,"property")}( ${e.join(", ")} )`}}const $st=(n,...t)=>(t=t.length>1||t[0]&&t[0].isNode===!0?Yc(t):Yg(t[0]),Me(new bN(Me(n),t)));Mt("call",$st);qt("FunctionCallNode",bN);class MN extends Ae{constructor(t=null){super(),this._value=t,this._cache=null,this.inputType=null,this.outpuType=null,this.events=new Al,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(t){this._value!==t&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=t,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const t=this.value;if(t&&this._cache===null&&this.inputType==="URL"&&t.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([t.value]));else if(t&&t.value!==null&&t.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof t.value=="string"||this.inputType==="Number"&&typeof t.value=="number"||this.inputType==="Vector2"&&t.value.isVector2||this.inputType==="Vector3"&&t.value.isVector3||this.inputType==="Vector4"&&t.value.isVector4||this.inputType==="Color"&&t.value.isColor||this.inputType==="Matrix3"&&t.value.isMatrix3||this.inputType==="Matrix4"&&t.value.isMatrix4))return t.value;return this._cache||t}getNodeType(t){return this.value&&this.value.isNode?this.value.getNodeType(t):"float"}setup(){return this.value&&this.value.isNode?this.value:ct()}serialize(t){super.serialize(t),this.value!==null?this.inputType==="ArrayBuffer"?t.value=HR(this.value):t.value=this.value?this.value.toJSON(t.meta).uuid:null:t.value=null,t.inputType=this.inputType,t.outputType=this.outputType}deserialize(t){super.deserialize(t);let e=null;t.value!==null&&(t.inputType==="ArrayBuffer"?e=qR(t.value):t.inputType==="Texture"?e=t.meta.textures[t.value]:e=t.meta.nodes[t.value]||null),this.value=e,this.inputType=t.inputType,this.outputType=t.outputType}}const Fp=Tt(MN);Mt("scriptableValue",Fp);qt("ScriptableValueNode",MN);class EN extends Map{get(t,e=null,...i){if(this.has(t))return super.get(t);if(e!==null){const s=e(...i);return this.set(t,s),s}}}class Yst{constructor(t){this.scriptableNode=t}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(t){return this.scriptableNode.getInputLayout(t)}get(t){const e=this.parameters[t];return e?e.getValue():null}}const B1=new EN;class SN extends Ae{constructor(t=null,e={}){super(),this.codeNode=t,this.parameters=e,this._local=new EN,this._output=Fp(),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(t,e){return this._local.set(t,e)}getLocal(t){return this._local.get(t)}onRefresh(){this._refresh()}getInputLayout(t){for(const e of this.getLayout())if(e.inputType&&(e.id===t||e.name===t))return e}getOutputLayout(t){for(const e of this.getLayout())if(e.outputType&&(e.id===t||e.name===t))return e}setOutput(t,e){const i=this._outputs;return i[t]===void 0?i[t]=Fp(e):i[t].value=e,this}getOutput(t){return this._outputs[t]}getParameter(t){return this.parameters[t]}setParameter(t,e){const i=this.parameters;return e&&e.isScriptableNode?(this.deleteParameter(t),i[t]=e,i[t].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):e&&e.isScriptableValueNode?(this.deleteParameter(t),i[t]=e,i[t].events.addEventListener("refresh",this.onRefresh)):i[t]===void 0?(i[t]=Fp(e),i[t].events.addEventListener("refresh",this.onRefresh)):i[t].value=e,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(t){let e=this.parameters[t];return e&&(e.isScriptableNode&&(e=e.getDefaultOutput()),e.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const t of Object.keys(this.parameters))this.deleteParameter(t);return this.needsUpdate=!0,this}call(t,...e){const s=this.getObject()[t];if(typeof s=="function")return s(...e)}async callAsync(t,...e){const s=this.getObject()[t];if(typeof s=="function")return s.constructor.name==="AsyncFunction"?await s(...e):s(...e)}getNodeType(t){return this.getDefaultOutputNode().getNodeType(t)}refresh(t=null){t!==null?this.getOutput(t).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const t=()=>this.refresh(),e=(l,u)=>this.setOutput(l,u),i=new Yst(this),s=B1.get("THREE"),r=B1.get("TSL"),a=this.getMethod(this.codeNode),o=[i,this._local,B1,t,e,s,r];this._object=a(...o);const h=this._object.layout;if(h&&(h.cache===!1&&this._local.clear(),this._output.outputType=h.outputType||null,Array.isArray(h.elements)))for(const l of h.elements){const u=l.id||l.name;l.inputType&&(this.getParameter(u)===void 0&&this.setParameter(u,null),this.getParameter(u).inputType=l.inputType),l.outputType&&(this.getOutput(u)===void 0&&this.setOutput(u,null),this.getOutput(u).outputType=l.outputType)}return this._object}deserialize(t){super.deserialize(t);for(const e in this.parameters){let i=this.parameters[e];i.isScriptableNode&&(i=i.getDefaultOutput()),i.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const t=this.getDefaultOutput().value;return t&&t.isNode?t:ct()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const t=["parameters","local","global","refresh","setOutput","THREE","TSL"],i=["layout","init","main","dispose"].join(", "),s="var "+i+`; var output = {};
`,r=`
return { ...output, `+i+" };",a=s+this.codeNode.code+r;return this._method=new Function(...t,a),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}set needsUpdate(t){t===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const Hst=Tt(SN);Mt("scriptable",Hst);qt("ScriptableNode",SN);class jg extends Ae{constructor(t,e){super("float"),this.isFogNode=!0,this.colorNode=t,this.factorNode=e}mixAssign(t){return this.mix(t,this.colorNode)}setup(){return this.factorNode}}const qst=Tt(jg);Mt("fog",qst);qt("FogNode",jg);class TN extends jg{constructor(t,e,i){super(t),this.isFogRangeNode=!0,this.nearNode=e,this.farNode=i}setup(){return fl(this.nearNode,this.farNode,Fa.z.negate())}}const Xst=Tt(TN);Mt("rangeFog",Xst);qt("FogRangeNode",TN);class CN extends jg{constructor(t,e){super(t),this.isFogExp2Node=!0,this.densityNode=e}setup(){const t=Fa.z.negate(),e=this.densityNode;return e.mul(e,t,t).negate().exp().oneMinus()}}const jst=Tt(CN);Mt("densityFog",jst);qt("FogExp2Node",CN);let $h=null,Yh=null;class AN extends Ae{constructor(t=ct(),e=ct()){super(),this.minNode=t,this.maxNode=e}getVectorLength(t){const e=t.getTypeLength(nl(this.minNode.value)),i=t.getTypeLength(nl(this.maxNode.value));return e>i?e:i}getNodeType(t){return t.object.isInstancedMesh===!0?t.getTypeFromLength(this.getVectorLength(t)):"float"}setup(t){const e=t.object;let i=null;if(e.isInstancedMesh===!0){const s=this.minNode.value,r=this.maxNode.value,a=t.getTypeLength(nl(s)),o=t.getTypeLength(nl(r));$h=$h||new $n,Yh=Yh||new $n,$h.setScalar(0),Yh.setScalar(0),a===1?$h.setScalar(s):s.isColor?$h.set(s.r,s.g,s.b):$h.set(s.x,s.y,s.z||0,s.w||0),o===1?Yh.setScalar(r):r.isColor?Yh.set(r.r,r.g,r.b):Yh.set(r.x,r.y,r.z||0,r.w||0);const h=4,l=h*e.count,u=new Float32Array(l);for(let m=0;m<l;m++){const g=m%h,y=$h.getComponent(g),_=Yh.getComponent(g);u[m]=IR.lerp(y,_,Math.random())}const f=this.getNodeType(t);i=OI(u,"vec4",e.count).element(Yet).convert(f)}else i=ct(0);return i}}Tt(AN);qt("RangeNode",AN);class RN extends Ae{constructor(t,e,i=[64]){super("void"),this.isComputeNode=!0,this.computeNode=t,this.count=e,this.workgroupSize=i,this.dispatchCount=0,this.version=1,this.updateBeforeType=gn.OBJECT,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}updateDispatchCount(){const{count:t,workgroupSize:e}=this;let i=e[0];for(let s=1;s<e.length;s++)i*=e[s];this.dispatchCount=Math.ceil(t/i)}onInit(){}updateBefore({renderer:t}){t.compute(this)}generate(t){const{shaderStage:e}=t;if(e==="compute"){const i=this.computeNode.build(t,"void");i!==""&&t.addLineFlowCode(i)}}}const Zst=(n,t,e)=>Me(new RN(Me(n),t,e));Mt("compute",Zst);qt("ComputeNode",RN);class gl extends Ae{constructor(t=gl.TARGET_DIRECTION,e=null){super(),this.scope=t,this.light=e}setup(){const{scope:t,light:e}=this;let i=null;return t===gl.TARGET_DIRECTION&&(i=Rh.transformDirection(Z_(e).sub(Z_(e.target)))),i}serialize(t){super.serialize(t),t.scope=this.scope}deserialize(t){super.deserialize(t),this.scope=t.scope}}gl.TARGET_DIRECTION="targetDirection";const IN=Tt(gl,gl.TARGET_DIRECTION);qt("LightNode",gl);const NN=Zt(n=>{const{lightDistance:t,cutoffDistance:e,decayExponent:i}=n,s=t.pow(i).max(.01).reciprocal();return e.greaterThan(0).cond(s.mul(t.div(e).pow4().oneMinus().clamp().pow2()),s)});class kN extends Il{constructor(t=null){super(t),this.cutoffDistanceNode=ln(0),this.decayExponentNode=ln(0)}update(t){const{light:e}=this;super.update(t),this.cutoffDistanceNode.value=e.distance,this.decayExponentNode.value=e.decay}setup(t){const{colorNode:e,cutoffDistanceNode:i,decayExponentNode:s,light:r}=this,a=t.context.lightingModel,o=SI(r).sub(Fa),h=o.normalize(),l=o.length(),u=NN({lightDistance:l,cutoffDistance:i,decayExponent:s}),f=e.mul(u),m=t.context.reflectedLight;a.direct({lightDirection:h,lightColor:f,reflectedLight:m},t.stack,t)}}qt("PointLightNode",kN);Iu(Ktt,kN);class LN extends Il{constructor(t=null){super(t)}setup(t){super.setup(t);const e=t.context.lightingModel,i=this.colorNode,s=IN(this.light),r=t.context.reflectedLight;e.direct({lightDirection:s,lightColor:i,reflectedLight:r},t.stack,t)}}qt("DirectionalLightNode",LN);Iu(Qtt,LN);class f2 extends Il{constructor(t=null){super(t),this.coneCosNode=ln(0),this.penumbraCosNode=ln(0),this.cutoffDistanceNode=ln(0),this.decayExponentNode=ln(0)}update(t){super.update(t);const{light:e}=this;this.coneCosNode.value=Math.cos(e.angle),this.penumbraCosNode.value=Math.cos(e.angle*(1-e.penumbra)),this.cutoffDistanceNode.value=e.distance,this.decayExponentNode.value=e.decay}getSpotAttenuation(t){const{coneCosNode:e,penumbraCosNode:i}=this;return fl(e,i,t)}setup(t){super.setup(t);const e=t.context.lightingModel,{colorNode:i,cutoffDistanceNode:s,decayExponentNode:r,light:a}=this,o=SI(a).sub(Fa),h=o.normalize(),l=h.dot(IN(a)),u=this.getSpotAttenuation(l),f=o.length(),m=NN({lightDistance:f,cutoffDistance:s,decayExponent:r}),g=i.mul(u).mul(m),y=t.context.reflectedLight;e.direct({lightDirection:h,lightColor:g,reflectedLight:y},t.stack,t)}}qt("SpotLightNode",f2);Iu(WR,f2);class Kst extends WR{constructor(t,e,i,s,r,a){super(t,e,i,s,r,a),this.iesMap=null}copy(t,e){return super.copy(t,e),this.iesMap=t.iesMap,this}}const Jst=Kst;class ON extends f2{getSpotAttenuation(t){const e=this.light.iesMap;let i=null;if(e&&e.isTexture===!0){const s=t.acos().mul(1/Math.PI);i=jr(e,Pe(s,0),0).r}else i=super.getSpotAttenuation(t);return i}}qt("IESSpotLightNode",ON);Iu(Jst,ON);class PN extends Il{constructor(t=null){super(t)}setup({context:t}){t.irradiance.addAssign(this.colorNode)}}qt("AmbientLightNode",PN);Iu(tet,PN);class FN extends Il{constructor(t=null){super(t),this.lightPositionNode=Z_(t),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=ln(new Oi)}update(t){const{light:e}=this;super.update(t),this.lightPositionNode.object3d=e,this.groundColorNode.value.copy(e.groundColor).multiplyScalar(e.intensity)}setup(t){const{colorNode:e,groundColorNode:i,lightDirectionNode:s}=this,a=bh.dot(s).mul(.5).add(.5),o=Ua(i,e,a);t.context.irradiance.addAssign(o)}}qt("HemisphereLightNode",FN);Iu(Xtt,FN);const Qst=Zt(n=>{const t=n.uv.mul(2),e=t.x.floor(),i=t.y.floor();return e.add(i).mod(2).sign()});class DN extends Qi{constructor(t=Ah()){super("float"),this.uvNode=t}setup(){return Qst({uv:this.uvNode})}}const trt=Tt(DN);Mt("checker",trt);qt("CheckerNode",DN);const ert=new Bw;class irt extends Tr{constructor(t={}){super(),this.normals=!1,this.lights=!1,this.useAlphaToCoverage=!0,this.useColor=t.vertexColors,this.pointWidth=1,this.pointColorNode=null,this.setDefaultValues(ert),this.setupShaders(),this.setValues(t)}setupShaders(){const t=this.alphaToCoverage,e=this.useColor;this.vertexNode=Zt(()=>{hn(Pe(),"vUv").assign(Ah());const i=Es("instancePosition"),s=yr("vec4","mvPos");s.assign(ml.mul(li(i,1)));const r=qc.z.div(qc.w),a=oo.mul(s),o=yr("vec2","offset");return o.assign(Ds.xy),o.assign(o.mul(bnt)),o.assign(o.div(qc.z)),o.y.assign(o.y.mul(r)),o.assign(o.mul(a.w)),a.assign(a.add(li(o,0,0))),a})(),this.fragmentNode=Zt(()=>{const i=hn(Pe(),"vUv"),s=yr("float","alpha");s.assign(1);const r=i.x,a=i.y,o=r.mul(r).add(a.mul(a));if(t){const l=yr("float","dlen");l.assign(o.fwidth()),s.assign(fl(l.oneMinus(),l.add(1),o).oneMinus())}else o.greaterThan(1).discard();let h;return this.pointColorNode?h=this.pointColorNode:e?h=Es("instanceColor").mul(mf):h=mf,li(h,s)})(),this.needsUpdate=!0}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(t){this.useAlphaToCoverage!==t&&(this.useAlphaToCoverage=t,this.setupShaders())}}sr("InstancedPointsNodeMaterial",irt);const nrt=new zw;class srt extends Tr{constructor(t){super(),this.isLineBasicNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues(nrt),this.setValues(t)}}sr("LineBasicNodeMaterial",srt);const rrt=new Gw;class art extends Tr{constructor(t){super(),this.isLineDashedNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues(rrt),this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(t)}setupVariants(){const t=this.offsetNode,e=this.dashScaleNode?ct(this.dashScaleNode):K_,i=this.dashSizeNode?ct(this.dashSizeNode):RI,s=this.dashSizeNode?ct(this.dashGapNode):II;Hc.assign(i),Om.assign(s);const r=hn(Es("lineDistance").mul(e));(t?r.add(t):r).mod(Hc.add(Om)).greaterThan(Hc).discard()}}sr("LineDashedNodeMaterial",art);const ort=new Gw;class hrt extends Tr{constructor(t={}){super(),this.normals=!1,this.lights=!1,this.setDefaultValues(ort),this.useAlphaToCoverage=!0,this.useColor=t.vertexColors,this.useDash=t.dashed,this.useWorldUnits=!1,this.dashOffset=0,this.lineWidth=1,this.lineColorNode=null,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setupShaders(),this.setValues(t)}setupShaders(){const t=this.alphaToCoverage,e=this.useColor,i=this.dashed,s=this.worldUnits,r=Zt(({start:o,end:h})=>{const l=oo.element(2).element(2),m=oo.element(3).element(2).mul(-.5).div(l).sub(o.z).div(h.z.sub(o.z));return li(Ua(o.xyz,h.xyz,m),h.w)});this.vertexNode=Zt(()=>{jo("vec2","vUv").assign(Ah());const o=Es("instanceStart"),h=Es("instanceEnd"),l=yr("vec4","start"),u=yr("vec4","end");l.assign(ml.mul(li(o,1))),u.assign(ml.mul(li(h,1))),s&&(jo("vec3","worldStart").assign(l.xyz),jo("vec3","worldEnd").assign(u.xyz));const f=qc.z.div(qc.w),m=oo.element(2).element(3).equal(-1);Bi(m,()=>{Bi(l.z.lessThan(0).and(u.z.greaterThan(0)),()=>{u.assign(r({start:l,end:u}))}).elseif(u.z.lessThan(0).and(l.z.greaterThanEqual(0)),()=>{l.assign(r({start:u,end:l}))})});const g=oo.mul(l),y=oo.mul(u),_=g.xyz.div(g.w),w=y.xyz.div(y.w),M=w.xy.sub(_.xy).temp();M.x.assign(M.x.mul(f)),M.assign(M.normalize());const T=df(li());if(s){const A=u.xyz.sub(l.xyz).normalize(),R=Ds.y.lessThan(.5).cond(l.xyz.cross(A).normalize(),u.xyz.cross(A).normalize());R.assign(Ds.x.lessThan(0).cond(R.negate(),R));const I=A.dot(Pt(0,0,1));i||(l.assign(l.sub(li(A.mul(ld).mul(.5),0))),u.assign(u.add(li(A.mul(ld).mul(.5),0))),R.assign(R.sub(Pt(M.mul(I),0))),R.z.assign(R.z.add(.5))),Bi(Ds.y.greaterThan(1).or(Ds.y.lessThan(0)),()=>{R.assign(R.add(Pt(M.mul(2).mul(I),0)))}),R.assign(R.mul(ld).mul(.5));const L=jo("vec4","worldPos");L.assign(Ds.y.lessThan(.5).cond(l,u)),L.assign(L.add(li(R,0))),T.assign(oo.mul(L));const k=df(Pt());k.assign(Ds.y.lessThan(.5).cond(_,w)),T.z.assign(k.z.mul(T.w))}else{const A=yr("vec2","offset");A.assign(Pe(M.y,M.x.negate())),M.x.assign(M.x.div(f)),A.x.assign(A.x.div(f)),A.assign(Ds.x.lessThan(0).cond(A.negate(),A)),Bi(Ds.y.lessThan(0),()=>{A.assign(A.sub(M))}).elseif(Ds.y.greaterThan(1),()=>{A.assign(A.add(M))}),A.assign(A.mul(ld)),A.assign(A.div(qc.w)),T.assign(Ds.y.lessThan(.5).cond(g,y)),A.assign(A.mul(T.w)),T.assign(T.add(li(A,0,0)))}return T})();const a=Zt(({p1:o,p2:h,p3:l,p4:u})=>{const f=o.sub(l),m=u.sub(l),g=h.sub(o),y=f.dot(m),_=m.dot(g),w=f.dot(g),M=m.dot(m),A=g.dot(g).mul(M).sub(_.mul(_)),I=y.mul(_).sub(w.mul(M)).div(A).clamp(),L=y.add(_.mul(I)).div(M).clamp();return Pe(I,L)});this.fragmentNode=Zt(()=>{const o=jo("vec2","vUv");if(i){const u=this.offsetNode?ct(this.offsetNodeNode):SS,f=this.dashScaleNode?ct(this.dashScaleNode):K_,m=this.dashSizeNode?ct(this.dashSizeNode):RI,g=this.dashSizeNode?ct(this.dashGapNode):II;Hc.assign(m),Om.assign(g);const y=Es("instanceDistanceStart"),_=Es("instanceDistanceEnd"),w=Ds.y.lessThan(.5).cond(f.mul(y),K_.mul(_)),M=hn(w.add(SS)),T=u?M.add(u):M;o.y.lessThan(-1).or(o.y.greaterThan(1)).discard(),T.mod(Hc.add(Om)).greaterThan(Hc).discard()}const h=yr("float","alpha");if(h.assign(1),s){const u=jo("vec3","worldStart"),f=jo("vec3","worldEnd"),m=jo("vec4","worldPos").xyz.normalize().mul(1e5),g=f.sub(u),y=a({p1:u,p2:f,p3:Pt(0,0,0),p4:m}),_=u.add(g.mul(y.x)),w=m.mul(y.y),A=_.sub(w).length().div(ld);if(!i)if(t){const R=A.fwidth();h.assign(fl(R.negate().add(.5),R.add(.5),A).oneMinus())}else A.greaterThan(.5).discard()}else if(t){const u=o.x,f=o.y.greaterThan(0).cond(o.y.sub(1),o.y.add(1)),m=u.mul(u).add(f.mul(f)),g=yr("float","dlen");g.assign(m.fwidth()),Bi(o.y.abs().greaterThan(1),()=>{h.assign(fl(g.oneMinus(),g.add(1),m).oneMinus())})}else Bi(o.y.abs().greaterThan(1),()=>{const u=o.x,f=o.y.greaterThan(0).cond(o.y.sub(1),o.y.add(1));u.mul(u).add(f.mul(f)).greaterThan(1).discard()});let l;if(this.lineColorNode)l=this.lineColorNode;else if(e){const u=Es("instanceColorStart"),f=Es("instanceColorEnd");l=Ds.y.lessThan(.5).cond(u,f).mul(mf)}else l=mf;return li(l,h)})(),this.needsUpdate=!0}get worldUnits(){return this.useWorldUnits}set worldUnits(t){this.useWorldUnits!==t&&(this.useWorldUnits=t,this.setupShaders())}get dashed(){return this.useDash}set dashed(t){this.useDash!==t&&(this.useDash=t,this.setupShaders())}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(t){this.useAlphaToCoverage!==t&&(this.useAlphaToCoverage=t,this.setupShaders())}}sr("Line2NodeMaterial",hrt);const lrt=new GR;class crt extends Tr{constructor(t){super(),this.isMeshNormalNodeMaterial=!0,this.colorSpaced=!1,this.setDefaultValues(lrt),this.setValues(t)}setupDiffuseColor(){const t=this.opacityNode?ct(this.opacityNode):AI;ls.assign(li(oN(mn),t))}}sr("MeshNormalNodeMaterial",crt);const urt=new Pw;class drt extends Tr{constructor(t){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!1,this.setDefaultValues(urt),this.setValues(t)}}sr("MeshBasicNodeMaterial",drt);const gf=Zt(({f0:n,f90:t,dotVH:e})=>{const i=e.mul(-5.55473).sub(6.98316).mul(e).exp2();return n.mul(i.oneMinus()).add(t.mul(i))}),Bm=Zt(n=>n.diffuseColor.mul(1/Math.PI)),frt=()=>ct(.25),prt=Zt(({dotNH:n})=>j_.mul(.5/Math.PI).add(1).mul(n.pow(j_))),mrt=Zt(({lightDirection:n})=>{const t=n.add(zn).normalize(),e=mn.dot(t).clamp(),i=zn.dot(t).clamp(),s=gf({f0:ao,f90:1,dotVH:i}),r=frt(),a=prt({dotNH:e});return s.mul(r).mul(a)});class zN extends hI{constructor(t=!0){super(),this.specular=t}direct({lightDirection:t,lightColor:e,reflectedLight:i}){const r=mn.dot(t).clamp().mul(e);i.directDiffuse.addAssign(r.mul(Bm({diffuseColor:ls.rgb}))),this.specular===!0&&i.directSpecular.addAssign(r.mul(mrt({lightDirection:t})).mul(lnt))}indirectDiffuse({irradiance:t,reflectedLight:e}){e.indirectDiffuse.addAssign(t.mul(Bm({diffuseColor:ls})))}}const grt=new VR;class yrt extends Tr{constructor(t){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(grt),this.setValues(t)}setupLightingModel(){return new zN(!1)}}sr("MeshLambertNodeMaterial",yrt);const _rt=new UR;class xrt extends Tr{constructor(t){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(_rt),this.setValues(t)}setupLightingModel(){return new zN}setupVariants(){const t=(this.shininessNode?ct(this.shininessNode):ant).max(1e-4);j_.assign(t);const e=this.specularNode||hnt;ao.assign(e)}copy(t){return this.shininessNode=t.shininessNode,this.specularNode=t.specularNode,super.copy(t)}}sr("MeshPhongNodeMaterial",xrt);const vrt=Zt(()=>{const n=Fm.dFdx().abs().max(Fm.dFdy().abs());return n.x.max(n.y).max(n.z)}),wrt=Zt(n=>{const{roughness:t}=n,e=vrt();let i=t.max(.0525);return i=i.add(e),i=i.min(1),i}),brt=Zt(n=>{const{alpha:t,dotNL:e,dotNV:i}=n,s=t.pow2(),r=e.mul(s.add(s.oneMinus().mul(i.pow2())).sqrt()),a=i.mul(s.add(s.oneMinus().mul(e.pow2())).sqrt());return ff(.5,r.add(a).max(gI))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),Mrt=Zt(({alpha:n,dotNH:t})=>{const e=n.pow2(),i=t.pow2().mul(e.oneMinus()).oneMinus();return e.div(i.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),DS=Zt(n=>{const{lightDirection:t,f0:e,f90:i,roughness:s,iridescenceFresnel:r}=n,a=n.normalView||mn,o=s.pow2(),h=t.add(zn).normalize(),l=a.dot(t).clamp(),u=a.dot(zn).clamp(),f=a.dot(h).clamp(),m=zn.dot(h).clamp();let g=gf({f0:e,f90:i,dotVH:m});r&&(g=t2.mix(g,r));const y=brt({alpha:o,dotNL:l,dotNV:u}),_=Mrt({alpha:o,dotNH:f});return g.mul(y).mul(_)}),BN=Zt(({roughness:n,dotNV:t})=>{const e=li(-1,-.0275,-.572,.022),i=li(1,.0425,1.04,-.04),s=n.mul(e).add(i),r=s.x.mul(s.x).min(t.mul(-9.28).exp2()).mul(s.x).add(s.y);return Pe(-1.04,1.04).mul(r).add(s.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),Ert=Zt(n=>{const{dotNV:t,specularColor:e,specularF90:i,roughness:s}=n,r=BN({dotNV:t,roughness:s});return e.mul(r.x).add(i.mul(r.y))}),Srt=Zt(({f:n,f90:t,dotVH:e})=>{const i=e.oneMinus().saturate(),s=i.mul(i),r=i.mul(s,s).clamp(0,.9999);return n.sub(Pt(t).mul(r)).div(r.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),Trt=Zt(({roughness:n,dotNH:t})=>{const e=n.pow2(),i=ct(1).div(e),r=t.pow2().oneMinus().max(.0078125);return ct(2).add(i).mul(r.pow(i.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),Crt=Zt(({dotNV:n,dotNL:t})=>ct(1).div(ct(4).mul(t.add(n).sub(t.mul(n))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),Art=Zt(({lightDirection:n})=>{const t=n.add(zn).normalize(),e=mn.dot(n).clamp(),i=mn.dot(zn).clamp(),s=mn.dot(t).clamp(),r=Trt({roughness:Qw,dotNH:s}),a=Crt({dotNV:i,dotNL:e});return Rc.mul(r).mul(a)}),Rrt=cu(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),Irt=n=>{const t=n.sqrt();return Pt(1).add(t).div(Pt(1).sub(t))},zS=(n,t)=>n.sub(t).div(n.add(t)).pow2(),Nrt=(n,t)=>{const e=n.mul(2*Math.PI*1e-9),i=Pt(54856e-17,44201e-17,52481e-17),s=Pt(1681e3,1795300,2208400),r=Pt(43278e5,93046e5,66121e5),a=ct(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(e.mul(2239900).add(t.x).cos()).mul(e.pow2().mul(-45282e5).exp());let o=i.mul(r.mul(2*Math.PI).sqrt()).mul(s.mul(e).add(t).cos()).mul(e.pow2().negate().mul(r).exp());return o=Pt(o.x.add(a),o.y,o.z).div(10685e-11),Rrt.mul(o)},krt=Zt(({outsideIOR:n,eta2:t,cosTheta1:e,thinFilmThickness:i,baseF0:s})=>{const r=Ua(n,t,fl(0,.03,i)),a=n.div(r).pow2().mul(ct(1).sub(e.pow2())),h=ct(1).sub(a).sqrt(),l=zS(r,n),u=gf({f0:l,f90:1,dotVH:e}),f=u.oneMinus(),m=r.lessThan(n).cond(Math.PI,0),g=ct(Math.PI).sub(m),y=Irt(s.clamp(0,.9999)),_=zS(y,r.vec3()),w=gf({f0:_,f90:1,dotVH:h}),M=Pt(y.x.lessThan(r).cond(Math.PI,0),y.y.lessThan(r).cond(Math.PI,0),y.z.lessThan(r).cond(Math.PI,0)),T=r.mul(i,h,2),A=Pt(g).add(M),R=u.mul(w).clamp(1e-5,.9999),I=R.sqrt(),L=f.pow2().mul(w).div(Pt(1).sub(R));let Y=u.add(L),K=L.sub(f);for(let rt=1;rt<=2;++rt){K=K.mul(I);const ut=Nrt(ct(rt).mul(T),ct(rt).mul(A)).mul(2);Y=Y.add(K.mul(ut))}return Y.max(Pt(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),Lrt=Zt(({normal:n,viewDir:t,roughness:e})=>{const i=n.dot(t).saturate(),s=e.pow2(),r=dh(e.lessThan(.25),ct(-339.2).mul(s).add(ct(161.4).mul(e)).sub(25.9),ct(-8.48).mul(s).add(ct(14.3).mul(e)).sub(9.95)),a=dh(e.lessThan(.25),ct(44).mul(s).sub(ct(23.7).mul(e)).add(3.26),ct(1.97).mul(s).sub(ct(3.27).mul(e)).add(.72));return dh(e.lessThan(.25),0,ct(.1).mul(e).sub(.025)).add(r.mul(i).add(a).exp()).mul(1/Math.PI).saturate()}),U1=Pt(.04),G1=Pt(1);class UN extends hI{constructor(t=!1,e=!1,i=!1){super(),this.clearcoat=t,this.sheen=e,this.iridescence=i,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(){if(this.clearcoat===!0&&(this.clearcoatRadiance=Pt().temp("clearcoatRadiance"),this.clearcoatSpecularDirect=Pt().temp("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=Pt().temp("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=Pt().temp("sheenSpecularDirect"),this.sheenSpecularIndirect=Pt().temp("sheenSpecularIndirect")),this.iridescence===!0){const t=mn.dot(zn).clamp();this.iridescenceFresnel=krt({outsideIOR:ct(1),eta2:cI,cosTheta1:t,thinFilmThickness:uI,baseF0:ao}),this.iridescenceF0=Srt({f:this.iridescenceFresnel,f90:1,dotVH:t})}}computeMultiscattering(t,e,i=ct(1)){const s=mn.dot(zn).clamp(),r=BN({roughness:Bd,dotNV:s}),o=(this.iridescenceF0?t2.mix(ao,this.iridescenceF0):ao).mul(r.x).add(i.mul(r.y)),l=r.x.add(r.y).oneMinus(),u=ao.add(ao.oneMinus().mul(.047619)),f=o.mul(u).div(l.mul(u).oneMinus());t.addAssign(o),e.addAssign(f.mul(l))}direct({lightDirection:t,lightColor:e,reflectedLight:i}){const r=mn.dot(t).clamp().mul(e);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(r.mul(Art({lightDirection:t}))),this.clearcoat===!0){const o=Ic.dot(t).clamp().mul(e);this.clearcoatSpecularDirect.addAssign(o.mul(DS({lightDirection:t,f0:U1,f90:G1,roughness:Lm,normalView:Ic})))}i.directDiffuse.addAssign(r.mul(Bm({diffuseColor:ls.rgb}))),i.directSpecular.addAssign(r.mul(DS({lightDirection:t,f0:ao,f90:1,roughness:Bd,iridescence:this.iridescence,iridescenceFresnel:this.iridescenceFresnel})))}indirectDiffuse({irradiance:t,reflectedLight:e}){e.indirectDiffuse.addAssign(t.mul(Bm({diffuseColor:ls})))}indirectSpecular({radiance:t,iblIrradiance:e,reflectedLight:i}){if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(e.mul(Rc,Lrt({normal:mn,viewDir:zn,roughness:Qw}))),this.clearcoat===!0){const l=Ic.dot(zn).clamp(),u=Ert({dotNV:l,specularColor:U1,specularF90:G1,roughness:Lm});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(u))}const s=Pt().temp("singleScattering"),r=Pt().temp("multiScattering"),a=e.mul(1/Math.PI);this.computeMultiscattering(s,r);const o=s.add(r),h=ls.mul(o.r.max(o.g).max(o.b).oneMinus());i.indirectSpecular.addAssign(t.mul(s)),i.indirectSpecular.addAssign(r.mul(a)),i.indirectDiffuse.addAssign(h.mul(a))}ambientOcclusion({ambientOcclusion:t,reflectedLight:e}){const s=mn.dot(zn).clamp().add(t),r=Bd.mul(-16).oneMinus().negate().exp2(),a=t.sub(s.pow(r).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),e.indirectDiffuse.mulAssign(t),e.indirectSpecular.mulAssign(a)}finish(t){const{outgoingLight:e}=t;if(this.clearcoat===!0){const i=Ic.dot(zn).clamp(),s=gf({dotVH:i,f0:U1,f90:G1}),r=e.mul(X_.mul(s).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(X_));e.assign(r)}if(this.sheen===!0){const i=Rc.r.max(Rc.g).max(Rc.b).mul(.157).oneMinus(),s=e.mul(i).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);e.assign(s)}}}const Ort=new Uw;class GN extends Tr{constructor(t){super(),this.isMeshStandardNodeMaterial=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(Ort),this.setValues(t)}setupLightingModel(){return new UN}setupVariants(){const t=this.metalnessNode?ct(this.metalnessNode):unt;Het.assign(t);let e=this.roughnessNode?ct(this.roughnessNode):cnt;e=wrt({roughness:e}),Bd.assign(e);const i=Ua(Pt(.04),ls.rgb,t);ao.assign(i),ls.assign(li(ls.rgb.mul(t.oneMinus()),ls.a))}copy(t){return this.emissiveNode=t.emissiveNode,this.metalnessNode=t.metalnessNode,this.roughnessNode=t.roughnessNode,super.copy(t)}}sr("MeshStandardNodeMaterial",GN);const Prt=new BR;class Frt extends GN{constructor(t){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.setDefaultValues(Prt),this.setValues(t)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}setupLightingModel(){return new UN(this.useClearcoat,this.useSheen,this.useIridescence)}setupVariants(t){if(super.setupVariants(t),this.useClearcoat){const e=this.clearcoatNode?ct(this.clearcoatNode):fnt,i=this.clearcoatRoughnessNode?ct(this.clearcoatRoughnessNode):pnt;X_.assign(e),Lm.assign(i)}if(this.useSheen){const e=this.sheenNode?Pt(this.sheenNode):ynt,i=this.sheenRoughnessNode?ct(this.sheenRoughnessNode):_nt;Rc.assign(e),Qw.assign(i)}if(this.useIridescence){const e=this.iridescenceNode?ct(this.iridescenceNode):xnt,i=this.iridescenceIORNode?ct(this.iridescenceIORNode):vnt,s=this.iridescenceThicknessNode?ct(this.iridescenceThicknessNode):wnt;t2.assign(e),cI.assign(i),uI.assign(s)}}setupNormal(t){super.setupNormal(t);const e=this.clearcoatNormalNode?Pt(this.clearcoatNormalNode):mnt;Ic.assign(e)}copy(t){return this.clearcoatNode=t.clearcoatNode,this.clearcoatRoughnessNode=t.clearcoatRoughnessNode,this.clearcoatNormalNode=t.clearcoatNormalNode,this.sheenNode=t.sheenNode,this.sheenRoughnessNode=t.sheenRoughnessNode,this.iridescenceNode=t.iridescenceNode,this.iridescenceIORNode=t.iridescenceIORNode,this.iridescenceThicknessNode=t.iridescenceThicknessNode,this.specularIntensityNode=t.specularIntensityNode,this.specularColorNode=t.specularColorNode,this.transmissionNode=t.transmissionNode,this.thicknessNode=t.thicknessNode,this.attenuationDistanceNode=t.attenuationDistanceNode,this.attenuationColorNode=t.attenuationColorNode,super.copy(t)}}sr("MeshPhysicalNodeMaterial",Frt);const Drt=new Bw;class zrt extends Tr{constructor(t){super(),this.isPointsNodeMaterial=!0,this.lights=!1,this.normals=!1,this.transparent=!0,this.sizeNode=null,this.setDefaultValues(Drt),this.setValues(t)}copy(t){return this.sizeNode=t.sizeNode,super.copy(t)}}sr("PointsNodeMaterial",zrt);const Brt=new DR;class Urt extends Tr{constructor(t){super(),this.isSpriteNodeMaterial=!0,this.lights=!1,this.normals=!1,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(Brt),this.setValues(t)}setupPosition({object:t,context:e}){const{positionNode:i,rotationNode:s,scaleNode:r}=this,a=$s;let o=ml.mul(Pt(i||0)),h=Pe(Pm[0].xyz.length(),Pm[1].xyz.length());r!==null&&(h=h.mul(r));let l=a.xy;t.center&&t.center.isVector2===!0&&(l=l.sub(ln(t.center).sub(.5))),l=l.mul(h);const u=ct(s||gnt),f=u.cos(),m=u.sin(),g=Pe(Pe(f,m.negate()).dot(l),Pe(m,f).dot(l));o=li(o.xy.add(g),o.zw);const y=oo.mul(o);return e.vertex=a,y}copy(t){return this.positionNode=t.positionNode,this.rotationNode=t.rotationNode,this.scaleNode=t.scaleNode,super.copy(t)}}sr("SpriteNodeMaterial",Urt);const Grt=Gg.createMaterialFromType;Gg.createMaterialFromType=function(n){const t=JI(n);return t!==void 0?t:Grt.call(this,n)};const Xc=Zt(([n,t,e])=>{const i=ct(e).toVar(),s=ct(t).toVar(),r=ul(n).toVar();return dh(r,s,i)}),yf=Zt(([n,t])=>{const e=ul(t).toVar(),i=ct(n).toVar();return dh(e,i.negate(),i)}),en=Zt(([n])=>{const t=ct(n).toVar();return ot(Zf(t))}),Gi=Zt(([n,t])=>{const e=ct(n).toVar();return t.assign(en(e)),e.sub(ct(t))}),VN=Zt(([n,t,e,i,s,r])=>{const a=ct(r).toVar(),o=ct(s).toVar(),h=ct(i).toVar(),l=ct(e).toVar(),u=ct(t).toVar(),f=ct(n).toVar(),m=ct(Hn(1,o)).toVar();return Hn(1,a).mul(f.mul(m).add(u.mul(o))).add(a.mul(l.mul(m).add(h.mul(o))))}),WN=Zt(([n,t,e,i,s,r])=>{const a=ct(r).toVar(),o=ct(s).toVar(),h=Pt(i).toVar(),l=Pt(e).toVar(),u=Pt(t).toVar(),f=Pt(n).toVar(),m=ct(Hn(1,o)).toVar();return Hn(1,a).mul(f.mul(m).add(u.mul(o))).add(a.mul(l.mul(m).add(h.mul(o))))}),$N=Cr([VN,WN]),YN=Zt(([n,t,e,i,s,r,a,o,h,l,u])=>{const f=ct(u).toVar(),m=ct(l).toVar(),g=ct(h).toVar(),y=ct(o).toVar(),_=ct(a).toVar(),w=ct(r).toVar(),M=ct(s).toVar(),T=ct(i).toVar(),A=ct(e).toVar(),R=ct(t).toVar(),I=ct(n).toVar(),L=ct(Hn(1,g)).toVar(),k=ct(Hn(1,m)).toVar();return ct(Hn(1,f)).toVar().mul(k.mul(I.mul(L).add(R.mul(g))).add(m.mul(A.mul(L).add(T.mul(g))))).add(f.mul(k.mul(M.mul(L).add(w.mul(g))).add(m.mul(_.mul(L).add(y.mul(g))))))}),HN=Zt(([n,t,e,i,s,r,a,o,h,l,u])=>{const f=ct(u).toVar(),m=ct(l).toVar(),g=ct(h).toVar(),y=Pt(o).toVar(),_=Pt(a).toVar(),w=Pt(r).toVar(),M=Pt(s).toVar(),T=Pt(i).toVar(),A=Pt(e).toVar(),R=Pt(t).toVar(),I=Pt(n).toVar(),L=ct(Hn(1,g)).toVar(),k=ct(Hn(1,m)).toVar();return ct(Hn(1,f)).toVar().mul(k.mul(I.mul(L).add(R.mul(g))).add(m.mul(A.mul(L).add(T.mul(g))))).add(f.mul(k.mul(M.mul(L).add(w.mul(g))).add(m.mul(_.mul(L).add(y.mul(g))))))}),qN=Cr([YN,HN]),XN=Zt(([n,t,e])=>{const i=ct(e).toVar(),s=ct(t).toVar(),r=ce(n).toVar(),a=ce(r.bitAnd(ce(7))).toVar(),o=ct(Xc(a.lessThan(ce(4)),s,i)).toVar(),h=ct(tn(2,Xc(a.lessThan(ce(4)),i,s))).toVar();return yf(o,ul(a.bitAnd(ce(1)))).add(yf(h,ul(a.bitAnd(ce(2)))))}),jN=Zt(([n,t,e,i])=>{const s=ct(i).toVar(),r=ct(e).toVar(),a=ct(t).toVar(),o=ce(n).toVar(),h=ce(o.bitAnd(ce(15))).toVar(),l=ct(Xc(h.lessThan(ce(8)),a,r)).toVar(),u=ct(Xc(h.lessThan(ce(4)),r,Xc(h.equal(ce(12)).or(h.equal(ce(14))),a,s))).toVar();return yf(l,ul(h.bitAnd(ce(1)))).add(yf(u,ul(h.bitAnd(ce(2)))))}),Pn=Cr([XN,jN]),ZN=Zt(([n,t,e])=>{const i=ct(e).toVar(),s=ct(t).toVar(),r=jf(n).toVar();return Pt(Pn(r.x,s,i),Pn(r.y,s,i),Pn(r.z,s,i))}),KN=Zt(([n,t,e,i])=>{const s=ct(i).toVar(),r=ct(e).toVar(),a=ct(t).toVar(),o=jf(n).toVar();return Pt(Pn(o.x,a,r,s),Pn(o.y,a,r,s),Pn(o.z,a,r,s))}),ur=Cr([ZN,KN]),JN=Zt(([n])=>{const t=ct(n).toVar();return tn(.6616,t)}),QN=Zt(([n])=>{const t=ct(n).toVar();return tn(.982,t)}),tk=Zt(([n])=>{const t=Pt(n).toVar();return tn(.6616,t)}),ek=Cr([JN,tk]),ik=Zt(([n])=>{const t=Pt(n).toVar();return tn(.982,t)}),nk=Cr([QN,ik]),Bs=Zt(([n,t])=>{const e=ot(t).toVar(),i=ce(n).toVar();return i.shiftLeft(e).bitOr(i.shiftRight(ot(32).sub(e)))}),sk=Zt(([n,t,e])=>{n.subAssign(e),n.bitXorAssign(Bs(e,ot(4))),e.addAssign(t),t.subAssign(n),t.bitXorAssign(Bs(n,ot(6))),n.addAssign(e),e.subAssign(t),e.bitXorAssign(Bs(t,ot(8))),t.addAssign(n),n.subAssign(e),n.bitXorAssign(Bs(e,ot(16))),e.addAssign(t),t.subAssign(n),t.bitXorAssign(Bs(n,ot(19))),n.addAssign(e),e.subAssign(t),e.bitXorAssign(Bs(t,ot(4))),t.addAssign(n)}),Nu=Zt(([n,t,e])=>{const i=ce(e).toVar(),s=ce(t).toVar(),r=ce(n).toVar();return i.bitXorAssign(s),i.subAssign(Bs(s,ot(14))),r.bitXorAssign(i),r.subAssign(Bs(i,ot(11))),s.bitXorAssign(r),s.subAssign(Bs(r,ot(25))),i.bitXorAssign(s),i.subAssign(Bs(s,ot(16))),r.bitXorAssign(i),r.subAssign(Bs(i,ot(4))),s.bitXorAssign(r),s.subAssign(Bs(r,ot(14))),i.bitXorAssign(s),i.subAssign(Bs(s,ot(24))),i}),jn=Zt(([n])=>{const t=ce(n).toVar();return ct(t).div(ct(ce(ot(4294967295))))}),Kr=Zt(([n])=>{const t=ct(n).toVar();return t.mul(t.mul(t.mul(t.mul(t.mul(6).sub(15)).add(10))))}),rk=Zt(([n])=>{const t=ot(n).toVar(),e=ce(ce(1)).toVar(),i=ce(ce(ot(3735928559)).add(e.shiftLeft(ce(2)).add(ce(13)))).toVar();return Nu(i.add(ce(t)),i,i)}),ak=Zt(([n,t])=>{const e=ot(t).toVar(),i=ot(n).toVar(),s=ce(ce(2)).toVar(),r=ce().toVar(),a=ce().toVar(),o=ce().toVar();return r.assign(a.assign(o.assign(ce(ot(3735928559)).add(s.shiftLeft(ce(2)).add(ce(13)))))),r.addAssign(ce(i)),a.addAssign(ce(e)),Nu(r,a,o)}),ok=Zt(([n,t,e])=>{const i=ot(e).toVar(),s=ot(t).toVar(),r=ot(n).toVar(),a=ce(ce(3)).toVar(),o=ce().toVar(),h=ce().toVar(),l=ce().toVar();return o.assign(h.assign(l.assign(ce(ot(3735928559)).add(a.shiftLeft(ce(2)).add(ce(13)))))),o.addAssign(ce(r)),h.addAssign(ce(s)),l.addAssign(ce(i)),Nu(o,h,l)}),hk=Zt(([n,t,e,i])=>{const s=ot(i).toVar(),r=ot(e).toVar(),a=ot(t).toVar(),o=ot(n).toVar(),h=ce(ce(4)).toVar(),l=ce().toVar(),u=ce().toVar(),f=ce().toVar();return l.assign(u.assign(f.assign(ce(ot(3735928559)).add(h.shiftLeft(ce(2)).add(ce(13)))))),l.addAssign(ce(o)),u.addAssign(ce(a)),f.addAssign(ce(r)),sk(l,u,f),l.addAssign(ce(s)),Nu(l,u,f)}),lk=Zt(([n,t,e,i,s])=>{const r=ot(s).toVar(),a=ot(i).toVar(),o=ot(e).toVar(),h=ot(t).toVar(),l=ot(n).toVar(),u=ce(ce(5)).toVar(),f=ce().toVar(),m=ce().toVar(),g=ce().toVar();return f.assign(m.assign(g.assign(ce(ot(3735928559)).add(u.shiftLeft(ce(2)).add(ce(13)))))),f.addAssign(ce(l)),m.addAssign(ce(h)),g.addAssign(ce(o)),sk(f,m,g),f.addAssign(ce(a)),m.addAssign(ce(r)),Nu(f,m,g)}),Ai=Cr([rk,ak,ok,hk,lk]),ck=Zt(([n,t])=>{const e=ot(t).toVar(),i=ot(n).toVar(),s=ce(Ai(i,e)).toVar(),r=jf().toVar();return r.x.assign(s.bitAnd(ot(255))),r.y.assign(s.shiftRight(ot(8)).bitAnd(ot(255))),r.z.assign(s.shiftRight(ot(16)).bitAnd(ot(255))),r}),uk=Zt(([n,t,e])=>{const i=ot(e).toVar(),s=ot(t).toVar(),r=ot(n).toVar(),a=ce(Ai(r,s,i)).toVar(),o=jf().toVar();return o.x.assign(a.bitAnd(ot(255))),o.y.assign(a.shiftRight(ot(8)).bitAnd(ot(255))),o.z.assign(a.shiftRight(ot(16)).bitAnd(ot(255))),o}),dr=Cr([ck,uk]),dk=Zt(([n])=>{const t=Pe(n).toVar(),e=ot().toVar(),i=ot().toVar(),s=ct(Gi(t.x,e)).toVar(),r=ct(Gi(t.y,i)).toVar(),a=ct(Kr(s)).toVar(),o=ct(Kr(r)).toVar(),h=ct($N(Pn(Ai(e,i),s,r),Pn(Ai(e.add(ot(1)),i),s.sub(1),r),Pn(Ai(e,i.add(ot(1))),s,r.sub(1)),Pn(Ai(e.add(ot(1)),i.add(ot(1))),s.sub(1),r.sub(1)),a,o)).toVar();return ek(h)}),fk=Zt(([n])=>{const t=Pt(n).toVar(),e=ot().toVar(),i=ot().toVar(),s=ot().toVar(),r=ct(Gi(t.x,e)).toVar(),a=ct(Gi(t.y,i)).toVar(),o=ct(Gi(t.z,s)).toVar(),h=ct(Kr(r)).toVar(),l=ct(Kr(a)).toVar(),u=ct(Kr(o)).toVar(),f=ct(qN(Pn(Ai(e,i,s),r,a,o),Pn(Ai(e.add(ot(1)),i,s),r.sub(1),a,o),Pn(Ai(e,i.add(ot(1)),s),r,a.sub(1),o),Pn(Ai(e.add(ot(1)),i.add(ot(1)),s),r.sub(1),a.sub(1),o),Pn(Ai(e,i,s.add(ot(1))),r,a,o.sub(1)),Pn(Ai(e.add(ot(1)),i,s.add(ot(1))),r.sub(1),a,o.sub(1)),Pn(Ai(e,i.add(ot(1)),s.add(ot(1))),r,a.sub(1),o.sub(1)),Pn(Ai(e.add(ot(1)),i.add(ot(1)),s.add(ot(1))),r.sub(1),a.sub(1),o.sub(1)),h,l,u)).toVar();return nk(f)}),Vrt=Cr([dk,fk]),pk=Zt(([n])=>{const t=Pe(n).toVar(),e=ot().toVar(),i=ot().toVar(),s=ct(Gi(t.x,e)).toVar(),r=ct(Gi(t.y,i)).toVar(),a=ct(Kr(s)).toVar(),o=ct(Kr(r)).toVar(),h=Pt($N(ur(dr(e,i),s,r),ur(dr(e.add(ot(1)),i),s.sub(1),r),ur(dr(e,i.add(ot(1))),s,r.sub(1)),ur(dr(e.add(ot(1)),i.add(ot(1))),s.sub(1),r.sub(1)),a,o)).toVar();return ek(h)}),mk=Zt(([n])=>{const t=Pt(n).toVar(),e=ot().toVar(),i=ot().toVar(),s=ot().toVar(),r=ct(Gi(t.x,e)).toVar(),a=ct(Gi(t.y,i)).toVar(),o=ct(Gi(t.z,s)).toVar(),h=ct(Kr(r)).toVar(),l=ct(Kr(a)).toVar(),u=ct(Kr(o)).toVar(),f=Pt(qN(ur(dr(e,i,s),r,a,o),ur(dr(e.add(ot(1)),i,s),r.sub(1),a,o),ur(dr(e,i.add(ot(1)),s),r,a.sub(1),o),ur(dr(e.add(ot(1)),i.add(ot(1)),s),r.sub(1),a.sub(1),o),ur(dr(e,i,s.add(ot(1))),r,a,o.sub(1)),ur(dr(e.add(ot(1)),i,s.add(ot(1))),r.sub(1),a,o.sub(1)),ur(dr(e,i.add(ot(1)),s.add(ot(1))),r,a.sub(1),o.sub(1)),ur(dr(e.add(ot(1)),i.add(ot(1)),s.add(ot(1))),r.sub(1),a.sub(1),o.sub(1)),h,l,u)).toVar();return nk(f)}),Wrt=Cr([pk,mk]),$rt=Zt(([n])=>{const t=ct(n).toVar(),e=ot(en(t)).toVar();return jn(Ai(e))}),Yrt=Zt(([n])=>{const t=Pe(n).toVar(),e=ot(en(t.x)).toVar(),i=ot(en(t.y)).toVar();return jn(Ai(e,i))}),Hrt=Zt(([n])=>{const t=Pt(n).toVar(),e=ot(en(t.x)).toVar(),i=ot(en(t.y)).toVar(),s=ot(en(t.z)).toVar();return jn(Ai(e,i,s))}),qrt=Zt(([n])=>{const t=li(n).toVar(),e=ot(en(t.x)).toVar(),i=ot(en(t.y)).toVar(),s=ot(en(t.z)).toVar(),r=ot(en(t.w)).toVar();return jn(Ai(e,i,s,r))}),gk=Zt(([n])=>{const t=ct(n).toVar(),e=ot(en(t)).toVar();return Pt(jn(Ai(e,ot(0))),jn(Ai(e,ot(1))),jn(Ai(e,ot(2))))}),yk=Zt(([n])=>{const t=Pe(n).toVar(),e=ot(en(t.x)).toVar(),i=ot(en(t.y)).toVar();return Pt(jn(Ai(e,i,ot(0))),jn(Ai(e,i,ot(1))),jn(Ai(e,i,ot(2))))}),_k=Zt(([n])=>{const t=Pt(n).toVar(),e=ot(en(t.x)).toVar(),i=ot(en(t.y)).toVar(),s=ot(en(t.z)).toVar();return Pt(jn(Ai(e,i,s,ot(0))),jn(Ai(e,i,s,ot(1))),jn(Ai(e,i,s,ot(2))))}),xk=Zt(([n])=>{const t=li(n).toVar(),e=ot(en(t.x)).toVar(),i=ot(en(t.y)).toVar(),s=ot(en(t.z)).toVar(),r=ot(en(t.w)).toVar();return Pt(jn(Ai(e,i,s,r,ot(0))),jn(Ai(e,i,s,r,ot(1))),jn(Ai(e,i,s,r,ot(2))))}),vk=Cr([gk,yk,_k,xk]),Um=Zt(([n,t,e,i])=>{const s=ct(i).toVar(),r=ct(e).toVar(),a=ot(t).toVar(),o=Pt(n).toVar(),h=ct(0).toVar(),l=ct(1).toVar();return Un({start:ot(0),end:a},({i:u})=>{h.addAssign(l.mul(Vrt(o))),l.mulAssign(s),o.mulAssign(r)}),h}),wk=Zt(([n,t,e,i])=>{const s=ct(i).toVar(),r=ct(e).toVar(),a=ot(t).toVar(),o=Pt(n).toVar(),h=Pt(0).toVar(),l=ct(1).toVar();return Un({start:ot(0),end:a},({i:u})=>{h.addAssign(l.mul(Wrt(o))),l.mulAssign(s),o.mulAssign(r)}),h}),Xrt=Zt(([n,t,e,i])=>{const s=ct(i).toVar(),r=ct(e).toVar(),a=ot(t).toVar(),o=Pt(n).toVar();return Pe(Um(o,a,r,s),Um(o.add(Pt(ot(19),ot(193),ot(17))),a,r,s))}),jrt=Zt(([n,t,e,i])=>{const s=ct(i).toVar(),r=ct(e).toVar(),a=ot(t).toVar(),o=Pt(n).toVar(),h=Pt(wk(o,a,r,s)).toVar(),l=ct(Um(o.add(Pt(ot(19),ot(193),ot(17))),a,r,s)).toVar();return li(h,l)}),bk=Zt(([n,t,e,i,s,r,a])=>{const o=ot(a).toVar(),h=ct(r).toVar(),l=ot(s).toVar(),u=ot(i).toVar(),f=ot(e).toVar(),m=ot(t).toVar(),g=Pe(n).toVar(),y=Pt(vk(Pe(m.add(u),f.add(l)))).toVar(),_=Pe(y.x,y.y).toVar();_.subAssign(.5),_.mulAssign(h),_.addAssign(.5);const w=Pe(Pe(ct(m),ct(f)).add(_)).toVar(),M=Pe(w.sub(g)).toVar();return Bi(o.equal(ot(2)),()=>pr(M.x).add(pr(M.y))),Bi(o.equal(ot(3)),()=>dl(pr(M.x),pr(M.y))),Kf(M,M)}),Mk=Zt(([n,t,e,i,s,r,a,o,h])=>{const l=ot(h).toVar(),u=ct(o).toVar(),f=ot(a).toVar(),m=ot(r).toVar(),g=ot(s).toVar(),y=ot(i).toVar(),_=ot(e).toVar(),w=ot(t).toVar(),M=Pt(n).toVar(),T=Pt(vk(Pt(w.add(g),_.add(m),y.add(f)))).toVar();T.subAssign(.5),T.mulAssign(u),T.addAssign(.5);const A=Pt(Pt(ct(w),ct(_),ct(y)).add(T)).toVar(),R=Pt(A.sub(M)).toVar();return Bi(l.equal(ot(2)),()=>pr(R.x).add(pr(R.y).add(pr(R.z)))),Bi(l.equal(ot(3)),()=>dl(dl(pr(R.x),pr(R.y)),pr(R.z))),Kf(R,R)}),ku=Cr([bk,Mk]),Zrt=Zt(([n,t,e])=>{const i=ot(e).toVar(),s=ct(t).toVar(),r=Pe(n).toVar(),a=ot().toVar(),o=ot().toVar(),h=Pe(Gi(r.x,a),Gi(r.y,o)).toVar(),l=ct(1e6).toVar();return Un({start:-1,end:ot(1),name:"x",condition:"<="},({x:u})=>{Un({start:-1,end:ot(1),name:"y",condition:"<="},({y:f})=>{const m=ct(ku(h,u,f,a,o,s,i)).toVar();l.assign(pf(l,m))})}),Bi(i.equal(ot(0)),()=>{l.assign(Rl(l))}),l}),Krt=Zt(([n,t,e])=>{const i=ot(e).toVar(),s=ct(t).toVar(),r=Pe(n).toVar(),a=ot().toVar(),o=ot().toVar(),h=Pe(Gi(r.x,a),Gi(r.y,o)).toVar(),l=Pe(1e6,1e6).toVar();return Un({start:-1,end:ot(1),name:"x",condition:"<="},({x:u})=>{Un({start:-1,end:ot(1),name:"y",condition:"<="},({y:f})=>{const m=ct(ku(h,u,f,a,o,s,i)).toVar();Bi(m.lessThan(l.x),()=>{l.y.assign(l.x),l.x.assign(m)}).elseif(m.lessThan(l.y),()=>{l.y.assign(m)})})}),Bi(i.equal(ot(0)),()=>{l.assign(Rl(l))}),l}),Jrt=Zt(([n,t,e])=>{const i=ot(e).toVar(),s=ct(t).toVar(),r=Pe(n).toVar(),a=ot().toVar(),o=ot().toVar(),h=Pe(Gi(r.x,a),Gi(r.y,o)).toVar(),l=Pt(1e6,1e6,1e6).toVar();return Un({start:-1,end:ot(1),name:"x",condition:"<="},({x:u})=>{Un({start:-1,end:ot(1),name:"y",condition:"<="},({y:f})=>{const m=ct(ku(h,u,f,a,o,s,i)).toVar();Bi(m.lessThan(l.x),()=>{l.z.assign(l.y),l.y.assign(l.x),l.x.assign(m)}).elseif(m.lessThan(l.y),()=>{l.z.assign(l.y),l.y.assign(m)}).elseif(m.lessThan(l.z),()=>{l.z.assign(m)})})}),Bi(i.equal(ot(0)),()=>{l.assign(Rl(l))}),l}),Qrt=Zt(([n,t,e])=>{const i=ot(e).toVar(),s=ct(t).toVar(),r=Pt(n).toVar(),a=ot().toVar(),o=ot().toVar(),h=ot().toVar(),l=Pt(Gi(r.x,a),Gi(r.y,o),Gi(r.z,h)).toVar(),u=ct(1e6).toVar();return Un({start:-1,end:ot(1),name:"x",condition:"<="},({x:f})=>{Un({start:-1,end:ot(1),name:"y",condition:"<="},({y:m})=>{Un({start:-1,end:ot(1),name:"z",condition:"<="},({z:g})=>{const y=ct(ku(l,f,m,g,a,o,h,s,i)).toVar();u.assign(pf(u,y))})})}),Bi(i.equal(ot(0)),()=>{u.assign(Rl(u))}),u}),tat=Zt(([n,t,e])=>{const i=ot(e).toVar(),s=ct(t).toVar(),r=Pt(n).toVar(),a=ot().toVar(),o=ot().toVar(),h=ot().toVar(),l=Pt(Gi(r.x,a),Gi(r.y,o),Gi(r.z,h)).toVar(),u=Pe(1e6,1e6).toVar();return Un({start:-1,end:ot(1),name:"x",condition:"<="},({x:f})=>{Un({start:-1,end:ot(1),name:"y",condition:"<="},({y:m})=>{Un({start:-1,end:ot(1),name:"z",condition:"<="},({z:g})=>{const y=ct(ku(l,f,m,g,a,o,h,s,i)).toVar();Bi(y.lessThan(u.x),()=>{u.y.assign(u.x),u.x.assign(y)}).elseif(y.lessThan(u.y),()=>{u.y.assign(y)})})})}),Bi(i.equal(ot(0)),()=>{u.assign(Rl(u))}),u}),eat=Zt(([n,t,e])=>{const i=ot(e).toVar(),s=ct(t).toVar(),r=Pt(n).toVar(),a=ot().toVar(),o=ot().toVar(),h=ot().toVar(),l=Pt(Gi(r.x,a),Gi(r.y,o),Gi(r.z,h)).toVar(),u=Pt(1e6,1e6,1e6).toVar();return Un({start:-1,end:ot(1),name:"x",condition:"<="},({x:f})=>{Un({start:-1,end:ot(1),name:"y",condition:"<="},({y:m})=>{Un({start:-1,end:ot(1),name:"z",condition:"<="},({z:g})=>{const y=ct(ku(l,f,m,g,a,o,h,s,i)).toVar();Bi(y.lessThan(u.x),()=>{u.z.assign(u.y),u.y.assign(u.x),u.x.assign(y)}).elseif(y.lessThan(u.y),()=>{u.z.assign(u.y),u.y.assign(y)}).elseif(y.lessThan(u.z),()=>{u.z.assign(y)})})})}),Bi(i.equal(ot(0)),()=>{u.assign(Rl(u))}),u});Xc.setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]});yf.setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]});en.setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]});VN.setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]});WN.setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]});YN.setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]});HN.setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]});XN.setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]});jN.setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]});ZN.setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]});KN.setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]});JN.setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]});QN.setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]});tk.setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]});ik.setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]});Bs.setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]});Nu.setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]});jn.setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]});Kr.setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]});rk.setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]});ak.setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]});ok.setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]});hk.setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]});lk.setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]});ck.setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]});uk.setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]});dk.setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]});fk.setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]});pk.setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]});mk.setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]});$rt.setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]});Yrt.setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]});Hrt.setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]});qrt.setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]});gk.setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]});yk.setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]});_k.setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]});xk.setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]});Um.setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});wk.setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});Xrt.setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});jrt.setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});bk.setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Mk.setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Zrt.setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Krt.setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Jrt.setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Qrt.setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});tat.setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});eat.setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});const iat=Zt(([n])=>{const t=Pt(n).toVar(),e=ct(t.x).toVar(),i=ct(t.y).toVar(),s=ct(t.z).toVar();Bi(i.lessThan(1e-4),()=>Pt(s,s,s)).else(()=>{e.assign(tn(6,e.sub(Zf(e))));const r=ot(_I(e)).toVar(),a=ct(e.sub(ct(r))).toVar(),o=ct(s.mul(Hn(1,i))).toVar(),h=ct(s.mul(Hn(1,i.mul(a)))).toVar(),l=ct(s.mul(Hn(1,i.mul(Hn(1,a))))).toVar();return Bi(r.equal(ot(0)),()=>Pt(s,l,o)).elseif(r.equal(ot(1)),()=>Pt(h,s,o)).elseif(r.equal(ot(2)),()=>Pt(o,s,l)).elseif(r.equal(ot(3)),()=>Pt(o,h,s)).elseif(r.equal(ot(4)),()=>Pt(l,o,s)),Pt(s,o,h)})}),nat=Zt(([n])=>{const t=Pt(n).toVar(),e=ct(t.x).toVar(),i=ct(t.y).toVar(),s=ct(t.z).toVar(),r=ct(pf(e,pf(i,s))).toVar(),a=ct(dl(e,dl(i,s))).toVar(),o=ct(a.sub(r)).toVar(),h=ct().toVar(),l=ct().toVar(),u=ct().toVar();return u.assign(a),Bi(a.greaterThan(0),()=>{l.assign(o.div(a))}).else(()=>{l.assign(0)}),Bi(l.lessThanEqual(0),()=>{h.assign(0)}).else(()=>{Bi(e.greaterThanEqual(a),()=>{h.assign(i.sub(s).div(o))}).elseif(i.greaterThanEqual(a),()=>{h.assign(wr(2,s.sub(e).div(o)))}).else(()=>{h.assign(wr(4,e.sub(i).div(o)))}),h.mulAssign(1/6),Bi(h.lessThan(0),()=>{h.addAssign(1)})}),Pt(h,l,u)});iat.setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]});nat.setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]});const sat=Zt(([n])=>{const t=Pt(n).toVar(),e=tI(mI(t,Pt(.04045))).toVar(),i=Pt(t.div(12.92)).toVar(),s=Pt(n2(dl(t.add(Pt(.055)),Pt(0)).div(1.055),Pt(2.4))).toVar();return Ua(i,s,e)});sat.setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]});async function rat(n,t,e,i){const s=Ek(n),r="feature-"+Date.now();s.setId(r),e.addFeature(s),$f(i,{data:{coords:n,id:r,lable:"Pin"},type:"pin"}),Sk(r,s,e,t,"Pin");const a=s.getGeometry().getExtent();t.getView().fit(a)}function aat(n,t,e){const i=Ek(n.coords);i.setId(n.id),e.addFeature(i),Sk(n.id,i,e,t,n.lable)}function Ek(n){const t=new mr({geometry:new Ra(n),name:"New Pin"}),e=new Hi({image:new vl({src:"https://cdn-icons-png.flaticon.com/512/684/684908.png",scale:.04})});return t.setStyle(e),t}function oat(n,t,e){const i=e.getFeatureById(n);if(!!i)if(t.checked){const s=i.get("storedStyle")||null;i.setStyle(s||uR(i))}else i.set("storedStyle",i.getStyle()),i.setStyle(new Hi)}function Sk(n,t,e,i,s){const r=document.getElementById("measurements"),a=r.children.length,o=document.createElement("li");o.setAttribute("id",`li-item${a}`),o.setAttribute("data-feature-id",n);const h=document.getElementById("labelInput").value||s;o.innerHTML=`
    <div class='flex'>
      <i class="fa-solid fa-map-marker-alt"></i>
      <input type="checkbox" class="measurement-checkbox" data-index="${a}" checked>
      <div id="sidenav-list-item-r1${a}" style="min-width:200px">
        <span>${h}</span>
      </div>
    </div>
    <button>
      <i class="fas fa-trash" style="font-size:15px;"></i>
    </button>
  `,hat(o,n,e,t,i,a,h),r.appendChild(o),o.querySelector("div").click()}function hat(n,t,e,i,s,r,a){const o=n.querySelector("input[type='checkbox']"),h=n.querySelector("button"),l=n.querySelector(`#sidenav-list-item-r1${r}`);o.addEventListener("change",()=>oat(t,o,e)),h.addEventListener("click",async()=>{await lat(t,n,e)}),l.addEventListener("click",()=>{uat(i,t,e,s,n,a)})}async function lat(n,t,e){const i=e.getFeatureById(n);i?(e.removeFeature(i),t.remove(),cat(),await Cw(n)):console.error(`Feature with ID ${n} not found.`)}function cat(){document.querySelectorAll("#measurements li").forEach((t,e)=>{t.querySelector("input[type='checkbox']").setAttribute("data-index",e),t.setAttribute("value",e)})}function uat(n,t,e,i,s,r){document.querySelectorAll("#measurements li").forEach(h=>{h.style.backgroundColor="";const l=e.getFeatureById(h.getAttribute("data-feature-id"));l&&l.setStyle(uR(l))}),s.style.backgroundColor="gray",n.setStyle(new Hi({image:new vl({src:"https://cdn-icons-png.flaticon.com/512/684/684908.png",scale:.06})})),dat(n,t,i,r);const o=n.getGeometry().getExtent();(o[0]+o[2])/2,(o[1]+o[3])/2,i.getView().fit(o)}function dat(n,t,e,i){const s=document.getElementById("edit-options"),a=n.getGeometry().getExtent(),o=[(a[0]+a[2])/2,(a[1]+a[3])/2],[h,l]=mu(o,e.getView().getProjection(),"EPSG:4326");s.innerHTML=`
    <div class='close-btn-div'>
      <button class='close-btn' id='close-btn'><i class="fa-solid fa-x"></i></button>
    </div>
    <div class='flex align'>
      <div>
        <label for='name'>Name</label>
        <input type="text" value="${i||"Pin"}" class='edit-name' id='name'>
      </div>
    </div>
    <br>
    <h4>Center Coordinates: ${l.toFixed(6)}, ${h.toFixed(6)}</h4>
    `,fat(n,t)}function fat(n,t,e){const i=document.getElementById("edit-options"),s=i.querySelector("input[type='text']");s.addEventListener("change",()=>pat(s,t)),document.getElementById("close-btn").addEventListener("click",()=>i.innerHTML="")}async function pat(n,t){try{const e=document.querySelector(`li[data-feature-id="${t}"]`);await El.put(`${Sl}updateMeasurementByFeatureId/${t}`,{lable:n.value}),e.querySelector("span").textContent=n.value}catch(e){console.log(e)}}class mat{constructor(t){this._pointer=0,this._eof=!1,this._data=t}next(){if(!this.hasNext())throw this._eof?new Error("Cannot call 'next' after EOF group has been read"):new Error("Unexpected end of input: EOF group not read before end of file. Ended on code "+this._data[this._pointer]);const t={code:parseInt(this._data[this._pointer])};return this._pointer++,t.value=BS(t.code,this._data[this._pointer].trim()),this._pointer++,t.code===0&&t.value==="EOF"&&(this._eof=!0),this.lastReadGroup=t,t}peek(){if(!this.hasNext())throw this._eof?new Error("Cannot call 'next' after EOF group has been read"):new Error("Unexpected end of input: EOF group not read before end of file. Ended on code "+this._data[this._pointer]);const t={code:parseInt(this._data[this._pointer])};return t.value=BS(t.code,this._data[this._pointer+1].trim()),t}rewind(t=1){this._pointer=this._pointer-t*2}hasNext(){return!(this._eof||this._pointer>this._data.length-2)}isEOF(){return this._eof}}function BS(n,t){return n<=9?t:n>=10&&n<=59?parseFloat(t):n>=60&&n<=99?parseInt(t):n>=100&&n<=109?t:n>=110&&n<=149?parseFloat(t):n>=160&&n<=179?parseInt(t):n>=210&&n<=239?parseFloat(t):n>=270&&n<=289?parseInt(t):n>=290&&n<=299?gat(t):n>=300&&n<=369?t:n>=370&&n<=389?parseInt(t):n>=390&&n<=399?t:n>=400&&n<=409?parseInt(t):n>=410&&n<=419?t:n>=420&&n<=429?parseInt(t):n>=430&&n<=439?t:n>=440&&n<=459?parseInt(t):n>=460&&n<=469?parseFloat(t):n>=470&&n<=481||n===999||n>=1e3&&n<=1009?t:n>=1010&&n<=1059?parseFloat(t):n>=1060&&n<=1071?parseInt(t):(console.log("WARNING: Group code does not have a defined type: %j",{code:n,value:t}),t)}function gat(n){if(n==="0")return!1;if(n==="1")return!0;throw TypeError("String '"+n+"' cannot be cast to Boolean type")}const Tk=[0,16711680,16776960,65280,65535,255,16711935,16777215,8421504,12632256,16711680,16744319,13369344,13395558,10027008,10046540,8323072,8339263,4980736,4990502,16727808,16752511,13382400,13401958,10036736,10051404,8331008,8343359,4985600,4992806,16744192,16760703,13395456,13408614,10046464,10056268,8339200,8347455,4990464,4995366,16760576,16768895,13408512,13415014,10056192,10061132,8347392,8351551,4995328,4997670,16776960,16777087,13421568,13421670,10000384,10000460,8355584,8355647,5000192,5000230,12582656,14679935,10079232,11717734,7510016,8755276,6258432,7307071,3755008,4344870,8388352,12582783,6736896,10079334,5019648,7510092,4161280,6258495,2509824,3755046,4194048,10485631,3394560,8375398,2529280,6264908,2064128,5209919,1264640,3099686,65280,8388479,52224,6736998,38912,5019724,32512,4161343,19456,2509862,65343,8388511,52275,6737023,38950,5019743,32543,4161359,19475,2509871,65407,8388543,52326,6737049,38988,5019762,32575,4161375,19494,2509881,65471,8388575,52377,6737074,39026,5019781,32607,4161391,19513,2509890,65535,8388607,52428,6737100,39064,5019800,32639,4161407,19532,2509900,49151,8380415,39372,6730444,29336,5014936,24447,4157311,14668,2507340,32767,8372223,26316,6724044,19608,5010072,16255,4153215,9804,2505036,16383,8364031,13260,6717388,9880,5005208,8063,4149119,4940,2502476,255,8355839,204,6710988,152,5000344,127,4145023,76,2500172,4129023,10452991,3342540,8349388,2490520,6245528,2031743,5193599,1245260,3089996,8323327,12550143,6684876,10053324,4980888,7490712,4128895,6242175,2490444,3745356,12517631,14647295,10027212,11691724,7471256,8735896,6226047,7290751,3735628,4335180,16711935,16744447,13369548,13395660,9961624,9981080,8323199,8339327,4980812,4990540,16711871,16744415,13369497,13395634,9961586,9981061,8323167,8339311,4980793,4990530,16711807,16744383,13369446,13395609,9961548,9981042,8323135,8339295,4980774,4990521,16711743,16744351,13369395,13395583,9961510,9981023,8323103,8339279,4980755,4990511,3355443,5987163,8684676,11382189,14079702,16777215];function yat(n){return Tk[n]}function oi(n){const t={};n.rewind();let e=n.next(),i=e.code;if(t.x=e.value,i+=10,e=n.next(),e.code!=i)throw new Error("Expected code for point value to be "+i+" but got "+e.code+".");return t.y=e.value,i+=10,e=n.next(),e.code!=i?(n.rewind(),t):(t.z=e.value,t)}function Jn(n,t,e){switch(t.code){case 0:n.type=t.value;break;case 5:n.handle=t.value;break;case 6:n.lineType=t.value;break;case 8:n.layer=t.value;break;case 48:n.lineTypeScale=t.value;break;case 60:n.visible=t.value===0;break;case 62:n.colorIndex=t.value,n.color=yat(Math.abs(t.value));break;case 67:n.inPaperSpace=t.value!==0;break;case 100:break;case 101:for(;t.code!=0;)t=e.next();e.rewind();break;case 330:n.ownerHandle=t.value;break;case 347:n.materialObjectHandle=t.value;break;case 370:n.lineweight=t.value;break;case 420:n.color=t.value;break;case 1e3:n.extendedData=n.extendedData||{},n.extendedData.customStrings=n.extendedData.customStrings||[],n.extendedData.customStrings.push(t.value);break;case 1001:n.extendedData=n.extendedData||{},n.extendedData.applicationName=t.value;break;default:return!1}return!0}class _at{constructor(){this.ForEntityName="3DFACE"}parseEntity(t,e){const i={type:e.value,vertices:[]};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 70:i.shape=(e.value&1)===1,i.hasContinuousLinetypePattern=(e.value&128)===128;break;case 10:i.vertices=xat(t,e),e=t.lastReadGroup;break;default:Jn(i,e,t);break}e=t.next()}return i}}function xat(n,t){var e=[],i=!1,s=!1,r=4;for(let o=0;o<=r;o++){for(var a={};!n.isEOF()&&!(t.code===0||s);){switch(t.code){case 10:case 11:case 12:case 13:if(i){s=!0;continue}a.x=t.value,i=!0;break;case 20:case 21:case 22:case 23:a.y=t.value;break;case 30:case 31:case 32:case 33:a.z=t.value;break;default:return e}t=n.next()}e.push(a),i=!1,s=!1}return n.rewind(),e}class vat{constructor(){this.ForEntityName="ARC"}parseEntity(t,e){const i={type:e.value};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 10:i.center=oi(t);break;case 40:i.radius=e.value;break;case 50:i.startAngle=Math.PI/180*e.value;break;case 51:i.endAngle=Math.PI/180*e.value,i.angleLength=i.endAngle-i.startAngle;break;case 210:i.extrusionDirectionX=e.value;break;case 220:i.extrusionDirectionY=e.value;break;case 230:i.extrusionDirectionZ=e.value;break;default:Jn(i,e,t);break}e=t.next()}return i}}class wat{constructor(){this.ForEntityName="ATTDEF"}parseEntity(t,e){var i={type:e.value,scale:1,textStyle:"STANDARD"};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 1:i.text=e.value;break;case 2:i.tag=e.value;break;case 3:i.prompt=e.value;break;case 7:i.textStyle=e.value;break;case 10:i.startPoint=oi(t);break;case 11:i.endPoint=oi(t);break;case 39:i.thickness=e.value;break;case 40:i.textHeight=e.value;break;case 41:i.scale=e.value;break;case 50:i.rotation=e.value;break;case 51:i.obliqueAngle=e.value;break;case 70:i.invisible=!!(e.value&1),i.constant=!!(e.value&2),i.verificationRequired=!!(e.value&4),i.preset=!!(e.value&8);break;case 71:i.backwards=!!(e.value&2),i.mirrored=!!(e.value&4);break;case 72:i.horizontalJustification=e.value;break;case 73:i.fieldLength=e.value;break;case 74:i.verticalJustification=e.value;break;case 100:break;case 210:i.extrusionDirectionX=e.value;break;case 220:i.extrusionDirectionY=e.value;break;case 230:i.extrusionDirectionZ=e.value;break;default:Jn(i,e,t);break}e=t.next()}return i}}class bat{constructor(){this.ForEntityName="CIRCLE"}parseEntity(t,e){const i={type:e.value};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 10:i.center=oi(t);break;case 40:i.radius=e.value;break;case 50:i.startAngle=Math.PI/180*e.value;break;case 51:const s=Math.PI/180*e.value;s<i.startAngle?i.angleLength=s+2*Math.PI-i.startAngle:i.angleLength=s-i.startAngle,i.endAngle=s;break;default:Jn(i,e,t);break}e=t.next()}return i}}class Mat{constructor(){this.ForEntityName="DIMENSION"}parseEntity(t,e){const i={type:e.value};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 2:i.block=e.value;break;case 10:i.anchorPoint=oi(t);break;case 11:i.middleOfText=oi(t);break;case 12:i.insertionPoint=oi(t);break;case 13:i.linearOrAngularPoint1=oi(t);break;case 14:i.linearOrAngularPoint2=oi(t);break;case 15:i.diameterOrRadiusPoint=oi(t);break;case 16:i.arcPoint=oi(t);break;case 70:i.dimensionType=e.value;break;case 71:i.attachmentPoint=e.value;break;case 42:i.actualMeasurement=e.value;break;case 1:i.text=e.value;break;case 50:i.angle=e.value;break;default:Jn(i,e,t);break}e=t.next()}return i}}class Eat{constructor(){this.ForEntityName="ELLIPSE"}parseEntity(t,e){const i={type:e.value};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 10:i.center=oi(t);break;case 11:i.majorAxisEndPoint=oi(t);break;case 40:i.axisRatio=e.value;break;case 41:i.startAngle=e.value;break;case 42:i.endAngle=e.value;break;case 2:i.name=e.value;break;default:Jn(i,e,t);break}e=t.next()}return i}}class Sat{constructor(){this.ForEntityName="INSERT"}parseEntity(t,e){const i={type:e.value};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 2:i.name=e.value;break;case 41:i.xScale=e.value;break;case 42:i.yScale=e.value;break;case 43:i.zScale=e.value;break;case 10:i.position=oi(t);break;case 50:i.rotation=e.value;break;case 70:i.columnCount=e.value;break;case 71:i.rowCount=e.value;break;case 44:i.columnSpacing=e.value;break;case 45:i.rowSpacing=e.value;break;case 210:i.extrusionDirection=oi(t);break;default:Jn(i,e,t);break}e=t.next()}return i}}class Tat{constructor(){this.ForEntityName="LINE"}parseEntity(t,e){const i={type:e.value,vertices:[]};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 10:i.vertices.unshift(oi(t));break;case 11:i.vertices.push(oi(t));break;case 210:i.extrusionDirection=oi(t);break;case 100:break;default:Jn(i,e,t);break}e=t.next()}return i}}class Cat{constructor(){this.ForEntityName="LWPOLYLINE"}parseEntity(t,e){const i={type:e.value,vertices:[]};let s=0;for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 38:i.elevation=e.value;break;case 39:i.depth=e.value;break;case 70:i.shape=(e.value&1)===1,i.hasContinuousLinetypePattern=(e.value&128)===128;break;case 90:s=e.value;break;case 10:i.vertices=Aat(s,t);break;case 43:e.value!==0&&(i.width=e.value);break;case 210:i.extrusionDirectionX=e.value;break;case 220:i.extrusionDirectionY=e.value;break;case 230:i.extrusionDirectionZ=e.value;break;default:Jn(i,e,t);break}e=t.next()}return i}}function Aat(n,t){if(!n||n<=0)throw Error("n must be greater than 0 verticies");const e=[];let i=!1,s=!1,r=t.lastReadGroup;for(let a=0;a<n;a++){const o={};for(;!t.isEOF()&&!(r.code===0||s);){switch(r.code){case 10:if(i){s=!0;continue}o.x=r.value,i=!0;break;case 20:o.y=r.value;break;case 30:o.z=r.value;break;case 40:o.startWidth=r.value;break;case 41:o.endWidth=r.value;break;case 42:r.value!=0&&(o.bulge=r.value);break;default:return t.rewind(),i&&e.push(o),t.rewind(),e}r=t.next()}e.push(o),i=!1,s=!1}return t.rewind(),e}class Rat{constructor(){this.ForEntityName="MTEXT"}parseEntity(t,e){const i={type:e.value};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 3:i.text?i.text+=e.value:i.text=e.value;break;case 1:i.text?i.text+=e.value:i.text=e.value;break;case 10:i.position=oi(t);break;case 11:i.directionVector=oi(t);break;case 40:i.height=e.value;break;case 41:i.width=e.value;break;case 50:i.rotation=e.value;break;case 71:i.attachmentPoint=e.value;break;case 72:i.drawingDirection=e.value;break;default:Jn(i,e,t);break}e=t.next()}return i}}class Iat{constructor(){this.ForEntityName="POINT"}parseEntity(t,e){const s={type:e.value};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 10:s.position=oi(t);break;case 39:s.thickness=e.value;break;case 210:s.extrusionDirection=oi(t);break;case 100:break;default:Jn(s,e,t);break}e=t.next()}return s}}class Nat{constructor(){this.ForEntityName="VERTEX"}parseEntity(t,e){var i={type:e.value};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 10:i.x=e.value;break;case 20:i.y=e.value;break;case 30:i.z=e.value;break;case 40:break;case 41:break;case 42:e.value!=0&&(i.bulge=e.value);break;case 70:i.curveFittingVertex=(e.value&1)!==0,i.curveFitTangent=(e.value&2)!==0,i.splineVertex=(e.value&8)!==0,i.splineControlPoint=(e.value&16)!==0,i.threeDPolylineVertex=(e.value&32)!==0,i.threeDPolylineMesh=(e.value&64)!==0,i.polyfaceMeshVertex=(e.value&128)!==0;break;case 50:break;case 71:i.faceA=e.value;break;case 72:i.faceB=e.value;break;case 73:i.faceC=e.value;break;case 74:i.faceD=e.value;break;default:Jn(i,e,t);break}e=t.next()}return i}}class kat{constructor(){this.ForEntityName="POLYLINE"}parseEntity(t,e){var i={type:e.value,vertices:[]};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 10:break;case 20:break;case 30:break;case 39:i.thickness=e.value;break;case 40:break;case 41:break;case 70:i.shape=(e.value&1)!==0,i.includesCurveFitVertices=(e.value&2)!==0,i.includesSplineFitVertices=(e.value&4)!==0,i.is3dPolyline=(e.value&8)!==0,i.is3dPolygonMesh=(e.value&16)!==0,i.is3dPolygonMeshClosed=(e.value&32)!==0,i.isPolyfaceMesh=(e.value&64)!==0,i.hasContinuousLinetypePattern=(e.value&128)!==0;break;case 71:break;case 72:break;case 73:break;case 74:break;case 75:break;case 210:i.extrusionDirection=oi(t);break;default:Jn(i,e,t);break}e=t.next()}return i.vertices=Lat(t,e),i}}function Lat(n,t){const e=new Nat,i=[];for(;!n.isEOF();)if(t.code===0){if(t.value==="VERTEX")i.push(e.parseEntity(n,t)),t=n.lastReadGroup;else if(t.value==="SEQEND"){Oat(n,t);break}}return i}function Oat(n,t){const e={type:t.value};for(t=n.next();!n.isEOF()&&t.code!=0;)Jn(e,t,n),t=n.next();return e}class Pat{constructor(){this.ForEntityName="SOLID"}parseEntity(t,e){const i={type:e.value,points:[]};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 10:i.points[0]=oi(t);break;case 11:i.points[1]=oi(t);break;case 12:i.points[2]=oi(t);break;case 13:i.points[3]=oi(t);break;case 210:i.extrusionDirection=oi(t);break;default:Jn(i,e,t);break}e=t.next()}return i}}class Fat{constructor(){this.ForEntityName="SPLINE"}parseEntity(t,e){const i={type:e.value};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 10:i.controlPoints||(i.controlPoints=[]),i.controlPoints.push(oi(t));break;case 11:i.fitPoints||(i.fitPoints=[]),i.fitPoints.push(oi(t));break;case 12:i.startTangent=oi(t);break;case 13:i.endTangent=oi(t);break;case 40:i.knotValues||(i.knotValues=[]),i.knotValues.push(e.value);break;case 70:(e.value&1)!=0&&(i.closed=!0),(e.value&2)!=0&&(i.periodic=!0),(e.value&4)!=0&&(i.rational=!0),(e.value&8)!=0&&(i.planar=!0),(e.value&16)!=0&&(i.planar=!0,i.linear=!0);break;case 71:i.degreeOfSplineCurve=e.value;break;case 72:i.numberOfKnots=e.value;break;case 73:i.numberOfControlPoints=e.value;break;case 74:i.numberOfFitPoints=e.value;break;case 210:i.normalVector=oi(t);break;default:Jn(i,e,t);break}e=t.next()}return i}}class Dat{constructor(){this.ForEntityName="TEXT"}parseEntity(t,e){const i={type:e.value};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 10:i.startPoint=oi(t);break;case 11:i.endPoint=oi(t);break;case 40:i.textHeight=e.value;break;case 41:i.xScale=e.value;break;case 50:i.rotation=e.value;break;case 1:i.text=e.value;break;case 72:i.halign=e.value;break;case 73:i.valign=e.value;break;default:Jn(i,e,t);break}e=t.next()}return i}}var Ck={exports:{}};(function(n){(function(t,e){n.exports?n.exports=e():t.log=e()})(wa,function(){var t=function(){},e="undefined",i=typeof window!==e&&typeof window.navigator!==e&&/Trident\/|MSIE /.test(window.navigator.userAgent),s=["trace","debug","info","warn","error"],r={},a=null;function o(_,w){var M=_[w];if(typeof M.bind=="function")return M.bind(_);try{return Function.prototype.bind.call(M,_)}catch{return function(){return Function.prototype.apply.apply(M,[_,arguments])}}}function h(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(_){return _==="debug"&&(_="log"),typeof console===e?!1:_==="trace"&&i?h:console[_]!==void 0?o(console,_):console.log!==void 0?o(console,"log"):t}function u(){for(var _=this.getLevel(),w=0;w<s.length;w++){var M=s[w];this[M]=w<_?t:this.methodFactory(M,_,this.name)}if(this.log=this.debug,typeof console===e&&_<this.levels.SILENT)return"No console available for logging"}function f(_){return function(){typeof console!==e&&(u.call(this),this[_].apply(this,arguments))}}function m(_,w,M){return l(_)||f.apply(this,arguments)}function g(_,w){var M=this,T,A,R,I="loglevel";typeof _=="string"?I+=":"+_:typeof _=="symbol"&&(I=void 0);function L(ut){var Z=(s[ut]||"silent").toUpperCase();if(!(typeof window===e||!I)){try{window.localStorage[I]=Z;return}catch{}try{window.document.cookie=encodeURIComponent(I)+"="+Z+";"}catch{}}}function k(){var ut;if(!(typeof window===e||!I)){try{ut=window.localStorage[I]}catch{}if(typeof ut===e)try{var Z=window.document.cookie,ht=encodeURIComponent(I),O=Z.indexOf(ht+"=");O!==-1&&(ut=/^([^;]+)/.exec(Z.slice(O+ht.length+1))[1])}catch{}return M.levels[ut]===void 0&&(ut=void 0),ut}}function Y(){if(!(typeof window===e||!I)){try{window.localStorage.removeItem(I)}catch{}try{window.document.cookie=encodeURIComponent(I)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function K(ut){var Z=ut;if(typeof Z=="string"&&M.levels[Z.toUpperCase()]!==void 0&&(Z=M.levels[Z.toUpperCase()]),typeof Z=="number"&&Z>=0&&Z<=M.levels.SILENT)return Z;throw new TypeError("log.setLevel() called with invalid level: "+ut)}M.name=_,M.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},M.methodFactory=w||m,M.getLevel=function(){return R!=null?R:A!=null?A:T},M.setLevel=function(ut,Z){return R=K(ut),Z!==!1&&L(R),u.call(M)},M.setDefaultLevel=function(ut){A=K(ut),k()||M.setLevel(ut,!1)},M.resetLevel=function(){R=null,Y(),u.call(M)},M.enableAll=function(ut){M.setLevel(M.levels.TRACE,ut)},M.disableAll=function(ut){M.setLevel(M.levels.SILENT,ut)},M.rebuild=function(){if(a!==M&&(T=K(a.getLevel())),u.call(M),a===M)for(var ut in r)r[ut].rebuild()},T=K(a?a.getLevel():"WARN");var rt=k();rt!=null&&(R=K(rt)),u.call(M)}a=new g,a.getLogger=function(w){if(typeof w!="symbol"&&typeof w!="string"||w==="")throw new TypeError("You must supply a name when creating a logger.");var M=r[w];return M||(M=r[w]=new g(w,a.methodFactory)),M};var y=typeof window!==e?window.log:void 0;return a.noConflict=function(){return typeof window!==e&&window.log===a&&(window.log=y),a},a.getLoggers=function(){return r},a.default=a,a})})(Ck);const ri=Ck.exports;ri.setLevel("error");function zat(n){n.registerEntityHandler(_at),n.registerEntityHandler(vat),n.registerEntityHandler(wat),n.registerEntityHandler(bat),n.registerEntityHandler(Mat),n.registerEntityHandler(Eat),n.registerEntityHandler(Sat),n.registerEntityHandler(Tat),n.registerEntityHandler(Cat),n.registerEntityHandler(Rat),n.registerEntityHandler(Iat),n.registerEntityHandler(kat),n.registerEntityHandler(Pat),n.registerEntityHandler(Fat),n.registerEntityHandler(Dat)}class Ak{constructor(){this._entityHandlers={},zat(this)}parse(t){return typeof t=="string"?this._parse(t):(console.error("Cannot read dxf source of type `"+typeof t),null)}registerEntityHandler(t){const e=new t;this._entityHandlers[e.ForEntityName]=e}parseSync(t){return this.parse(t)}parseStream(t){let e="";const i=this;return new Promise((s,r)=>{t.on("data",a=>{e+=a}),t.on("end",()=>{try{s(i._parse(e))}catch(a){r(a)}}),t.on("error",a=>{r(a)})})}_parse(t){const e={};let i=0;const s=t.split(/\r\n|\r|\n/g),r=new mat(s);if(!r.hasNext())throw Error("Empty file");const a=this;let o;function h(){for(o=r.next();!r.isEOF();)if(o.code===0&&o.value==="SECTION"){if(o=r.next(),o.code!==2){console.error("Unexpected code %s after 0:SECTION",Rk(o)),o=r.next();continue}o.value==="HEADER"?(ri.debug("> HEADER"),e.header=l(),ri.debug("<")):o.value==="BLOCKS"?(ri.debug("> BLOCKS"),e.blocks=u(),ri.debug("<")):o.value==="ENTITIES"?(ri.debug("> ENTITIES"),e.entities=A(!1),ri.debug("<")):o.value==="TABLES"?(ri.debug("> TABLES"),e.tables=m(),ri.debug("<")):o.value==="EOF"?ri.debug("EOF"):ri.warn("Skipping section '%s'",o.value)}else o=r.next()}function l(){let L=null,k=null;const Y={};for(o=r.next();;){if(xa(o,0,"ENDSEC")){L&&(Y[L]=k);break}else o.code===9?(L&&(Y[L]=k),L=o.value):o.code===10?k={x:o.value}:o.code===20?k.y=o.value:o.code===30?k.z=o.value:k=o.value;o=r.next()}return o=r.next(),Y}function u(){const L={};for(o=r.next();o.value!=="EOF"&&!xa(o,0,"ENDSEC");)if(xa(o,0,"BLOCK")){ri.debug("block {");const k=f();ri.debug("}"),I(k),k.name?L[k.name]=k:ri.error('block with handle "'+k.handle+'" is missing a name.')}else Hh(o),o=r.next();return L}function f(){const L={};for(o=r.next();o.value!=="EOF";){switch(o.code){case 1:L.xrefPath=o.value,o=r.next();break;case 2:L.name=o.value,o=r.next();break;case 3:L.name2=o.value,o=r.next();break;case 5:L.handle=o.value,o=r.next();break;case 8:L.layer=o.value,o=r.next();break;case 10:L.position=R(o),o=r.next();break;case 67:L.paperSpace=!!(o.value&&o.value==1),o=r.next();break;case 70:o.value!=0&&(L.type=o.value),o=r.next();break;case 100:o=r.next();break;case 330:L.ownerHandle=o.value,o=r.next();break;case 0:if(o.value=="ENDBLK")break;L.entities=A(!0);break;default:Hh(o),o=r.next()}if(xa(o,0,"ENDBLK")){o=r.next();break}}return L}function m(){const L={};for(o=r.next();o.value!=="EOF"&&!xa(o,0,"ENDSEC");)xa(o,0,"TABLE")?(o=r.next(),T[o.value]?(ri.debug(o.value+" Table {"),L[T[o.value].tableName]=y(o),ri.debug("}")):ri.debug("Unhandled Table "+o.value)):o=r.next();return o=r.next(),L}const g="ENDTAB";function y(L){const k=T[L.value],Y={};let K=0;for(o=r.next();!xa(o,0,g);)switch(o.code){case 5:Y.handle=o.value,o=r.next();break;case 330:Y.ownerHandle=o.value,o=r.next();break;case 100:o.value==="AcDbSymbolTable"||Hh(o),o=r.next();break;case 70:K=o.value,o=r.next();break;case 0:o.value===k.dxfSymbolName?Y[k.tableRecordsProperty]=k.parseTableRecords():(Hh(o),o=r.next());break;default:Hh(o),o=r.next()}const rt=Y[k.tableRecordsProperty];if(rt){let ut=(()=>{if(rt.constructor===Array)return rt.length;if(typeof rt=="object")return Object.keys(rt).length})();K!==ut&&ri.warn("Parsed "+ut+" "+k.dxfSymbolName+"'s but expected "+K)}return o=r.next(),Y}function _(){const L=[];let k={};for(ri.debug("ViewPort {"),o=r.next();!xa(o,0,g);)switch(o.code){case 2:k.name=o.value,o=r.next();break;case 10:k.lowerLeftCorner=R(o),o=r.next();break;case 11:k.upperRightCorner=R(o),o=r.next();break;case 12:k.center=R(o),o=r.next();break;case 13:k.snapBasePoint=R(o),o=r.next();break;case 14:k.snapSpacing=R(o),o=r.next();break;case 15:k.gridSpacing=R(o),o=r.next();break;case 16:k.viewDirectionFromTarget=R(o),o=r.next();break;case 17:k.viewTarget=R(o),o=r.next();break;case 42:k.lensLength=o.value,o=r.next();break;case 43:k.frontClippingPlane=o.value,o=r.next();break;case 44:k.backClippingPlane=o.value,o=r.next();break;case 45:k.viewHeight=o.value,o=r.next();break;case 50:k.snapRotationAngle=o.value,o=r.next();break;case 51:k.viewTwistAngle=o.value,o=r.next();break;case 79:k.orthographicType=o.value,o=r.next();break;case 110:k.ucsOrigin=R(o),o=r.next();break;case 111:k.ucsXAxis=R(o),o=r.next();break;case 112:k.ucsYAxis=R(o),o=r.next();break;case 110:k.ucsOrigin=R(o),o=r.next();break;case 281:k.renderMode=o.value,o=r.next();break;case 281:k.defaultLightingType=o.value,o=r.next();break;case 292:k.defaultLightingOn=o.value,o=r.next();break;case 330:k.ownerHandle=o.value,o=r.next();break;case 63:case 421:case 431:k.ambientColor=o.value,o=r.next();break;case 0:o.value==="VPORT"&&(ri.debug("}"),L.push(k),ri.debug("ViewPort {"),k={},o=r.next());break;default:Hh(o),o=r.next();break}return ri.debug("}"),L.push(k),L}function w(){const L={};let k={},Y=0,K;for(ri.debug("LType {"),o=r.next();!xa(o,0,"ENDTAB");)switch(o.code){case 2:k.name=o.value,K=o.value,o=r.next();break;case 3:k.description=o.value,o=r.next();break;case 73:Y=o.value,Y>0&&(k.pattern=[]),o=r.next();break;case 40:k.patternLength=o.value,o=r.next();break;case 49:k.pattern.push(o.value),o=r.next();break;case 0:ri.debug("}"),Y>0&&Y!==k.pattern.length&&ri.warn("lengths do not match on LTYPE pattern"),L[K]=k,k={},ri.debug("LType {"),o=r.next();break;default:o=r.next()}return ri.debug("}"),L[K]=k,L}function M(){const L={};let k={},Y;for(ri.debug("Layer {"),o=r.next();!xa(o,0,"ENDTAB");)switch(o.code){case 2:k.name=o.value,Y=o.value,o=r.next();break;case 62:k.visible=o.value>=0,k.colorIndex=Math.abs(o.value),k.color=Bat(k.colorIndex),o=r.next();break;case 70:k.frozen=(o.value&1)!=0||(o.value&2)!=0,o=r.next();break;case 0:o.value==="LAYER"&&(ri.debug("}"),L[Y]=k,ri.debug("Layer {"),k={},Y=void 0,o=r.next());break;default:Hh(o),o=r.next();break}return ri.debug("}"),L[Y]=k,L}const T={VPORT:{tableRecordsProperty:"viewPorts",tableName:"viewPort",dxfSymbolName:"VPORT",parseTableRecords:_},LTYPE:{tableRecordsProperty:"lineTypes",tableName:"lineType",dxfSymbolName:"LTYPE",parseTableRecords:w},LAYER:{tableRecordsProperty:"layers",tableName:"layer",dxfSymbolName:"LAYER",parseTableRecords:M}};function A(L){const k=[],Y=L?"ENDBLK":"ENDSEC";for(L||(o=r.next());;)if(o.code===0){if(o.value===Y)break;const K=a._entityHandlers[o.value];if(K!=null){ri.debug(o.value+" {");const rt=K.parseEntity(r,o);o=r.lastReadGroup,ri.debug("}"),I(rt),k.push(rt)}else{ri.warn("Unhandled entity "+o.value),o=r.next();continue}}else o=r.next();return Y=="ENDSEC"&&(o=r.next()),k}function R(L){const k={};let Y=L.code;if(k.x=L.value,Y+=10,L=r.next(),L.code!=Y)throw new Error("Expected code for point value to be "+Y+" but got "+L.code+".");return k.y=L.value,Y+=10,L=r.next(),L.code!=Y?(r.rewind(),k):(k.z=L.value,k)}function I(L){if(!L)throw new TypeError("entity cannot be undefined or null");L.handle||(L.handle=i++)}return h(),e}}function xa(n,t,e){return n.code===t&&n.value===e}function Hh(n){ri.debug("unhandled group "+Rk(n))}function Rk(n){return n.code+":"+n.value}function Bat(n){return Tk[n]}async function p2(n,t,e=null,i=null,s=null){if(e)try{const r=await fetch(e);if(!r.ok)throw new Error(`Failed to fetch DXF file from URL: ${r.statusText}`);const a=await r.text();console.log(s);const o=await Uat(a);US(o,s||"DXF",t,i)}catch(r){console.error("Error processing presigned KML:",r)}else if(n&&n.target.files){const r=n.target.files;for(let a of r)try{const o=a.name.split(".").pop().toLowerCase();let h,l;if(o==="dxf")h=await Gat(a),l="dxf";else if(o==="dwg")h=await Vat(a),l="dxf";else throw new Error("Unsupported file type");const u="feature-"+Date.now(),f=new FormData,m={id:u,name:a.name};f.append("data",m),f.append("id",u),f.append("label",a.name),f.append("file",a),f.append("type",l),await $f("",f),US(h,a.name,t,u)}catch(o){console.error(`Error processing ${a.name}:`,o),alert(`Error processing ${a.name}: ${o.message}`)}}}async function Uat(n){return new Promise((t,e)=>{try{const s=new Ak().parseSync(n),r=Ik(s);t(r)}catch(i){e(i)}})}async function Gat(n){return new Promise((t,e)=>{const i=new FileReader;i.onload=async s=>{try{const a=new Ak().parseSync(s.target.result),o=Ik(a);t(o)}catch(r){e(r)}},i.onerror=s=>e(s),i.readAsText(n)})}function Ik(n){const t=[];return Object.values(n.entities).forEach(e=>{let i;switch(e.type){case"LINE":V1(e.vertices[0])&&V1(e.vertices[1])&&(i={type:"LineString",coordinates:[[e.vertices[0].x,e.vertices[0].y],[e.vertices[1].x,e.vertices[1].y]]});break;case"LWPOLYLINE":case"POLYLINE":const s=e.vertices.filter(V1);s.length>=2&&(i={type:"LineString",coordinates:s.map(r=>[r.x,r.y])});break}i&&t.push({type:"Feature",geometry:i,properties:{}})}),{type:"FeatureCollection",features:t}}function V1(n){return n&&typeof n.x=="number"&&typeof n.y=="number"&&isFinite(n.x)&&isFinite(n.y)}async function Vat(n){throw new Error("DWG processing is not implemented. Consider converting to DXF first.")}function US(n,t,e,i){const s=new Nf({features:new AA().readFeatures(n,{featureProjection:e.getView().getProjection()})}),r=new vu({source:s,style:new Hi({stroke:new Xn({color:"blue",width:2}),fill:new _n({color:"rgba(0, 0, 255, 0.1)"})})});r.set("id","file"),e.addLayer(r),Aw(r,t,e,i),e.getView().fit(s.getExtent(),{padding:[50,50,50,50]})}let jc=10,vp=2,ud=[],GS=[],ix=null,W1,Zg,fh,Gm=0,Dp=null,uu,zp,e0="";const Wat=1,Nk=document.getElementById("secondnav"),nx=document.getElementById("layer-list"),kk=document.getElementsByClassName("layer-list-item"),sx=document.getElementById("cursor"),rx=document.getElementById("areaBtn"),ax=document.getElementById("lineBtn"),ox=document.getElementById("locate"),_f=document.getElementById("unitConversion"),Kg=document.getElementById("acres"),Jg=document.getElementById("hectares"),$at=document.getElementById("lat-long"),Yat=document.getElementById("lat-long-click"),m2=document.getElementById("overlay"),Lk=document.getElementById("edit-options");Hs.defs("EPSG:32643","+proj=utm +zone=43 +datum=WGS84 +units=m +no_defs");uY(Hs);document.addEventListener("DOMContentLoaded",async()=>{const{data:n}=await El.get(`${Sl}arthouses/project/668e5b8a563e4675ea04724b`);zp=n,GS=zp.map(o=>o.date),ud=eQ(GS);const t=ud[ud.length-1],e=iQ(ud),i=new Date;new Date(i).setFullYear(i.getFullYear()-1);const r=nQ(ud[0],i);for(let o=r;o>=0;o--){const h=document.createElement("div");e.includes(ue(new Date(i.getTime()-o*24*60*60*1e3)).format("YYYY-MM-DD"))?(e[e.length-1]==ue(new Date(i.getTime()-o*24*60*60*1e3)).format("YYYY-MM-DD")?(Dp=h,h.setAttribute("class","layer-list-date-div selected-item")):h.setAttribute("class","layer-list-date-div"),h.setAttribute("id",`layer-list-date-id=${o}`),h.innerHTML=`
            <div class="layer-list-item-filled">
              <div class="filled-div">
                <div class"filled-div-thumbnail">
                </div>
                <div class="filled-div-date">
                  <p>${ue(new Date(i.getTime()-o*24*60*60*1e3)).format("YYYY-MM-DD")}</p>
                </div>
              </div>        
            </div>
            <div class='stand'>
            </div>                
            <div class='circle'>
            </div>
          `,h.addEventListener("click",()=>{eot(h)})):(h.setAttribute("class","layer-list-item"),h.style.color="black",h.style.width=`${jc}px`,h.style.minWidth=`${jc}px`),nx.appendChild(h)}let a="";zp.map(async o=>{if(o.date==t){a=o.images[0],e0=o._id;const h=await dR(o._id);localStorage.setItem("orhtoId",o._id),h.annotations,Fk(h.annotations)}}),Pk(a),setTimeout(()=>{tot(),v2()},100)});const Hat=new Cf({source:new lg({url:"https://gisdemo.s3.ap-south-1.amazonaws.com/mahalaxmicog.tif"})}),qat=new Cf({source:new lg({url:"https://gisdemo.s3.ap-south-1.amazonaws.com/mahalaxmicog.tif"})}),Xat=new Cf({source:new lg({url:"https://gisdemo.s3.ap-south-1.amazonaws.com/mahalaxmicog.tif"})}),Ok=new Cf({source:new h7({}),projection:"EPSG:32643"});Ok.set({id:"mapLayer"});const jat=Ri("EPSG:32643"),Ei=new p9({target:"map",layers:[Ok],view:new ba({projection:jat,center:[0,0],zoom:11.5})});function Pk(n){const t=Tw(n);if(Ei.removeLayer(W1),Ei.getLayers().getArray().forEach(e=>{e.get("id")=="file"&&(console.log(e.get("id")),Ei.removeLayer(e))}),t=="tif"){const e=new y8({sources:[{url:n,projection:"EPSG:32643"}]});W1=new Cf({source:e}),Ei.getLayers().insertAt(2,W1),e.getView().then(i=>{const s=i.extent,r=[(s[0]+s[2])/2,(s[1]+s[3])/2];Ei.getView().setCenter(r),Ei.getView().fit(s)})}else t=="kml"&&Fg(null,n,Ei,!1)}Ei.on("pointermove",n=>{if(n.dragging)return;const t=Ei.getEventCoordinate(n.originalEvent),e=mu(t,"EPSG:32643","EPSG:4326");$at.textContent=`Lat: ${e[1]}, Lon: ${e[0]}`});Ei.on("click",n=>{if(n.dragging)return;const t=Ei.getEventCoordinate(n.originalEvent),e=mu(t,"EPSG:32643","EPSG:4326");Yat.textContent=`Lat: ${e[1]}, Lon: ${e[0]}`});const Vr=new Nf({sources:[{url:"https://gisdemo.s3.ap-south-1.amazonaws.com/mahalaxmicog.tif"}]}),Zat=new vu({source:Vr,style:new Hi({fill:new _n({color:"rgba(255, 255, 255, 0.3)"}),stroke:new Xn({color:"#ffcc33",width:2}),image:new _u({radius:7,fill:new _n({color:"#ffcc33"})})})});Ei.addLayer(Zat);const Lu=document.createElement("div");Lu.className="tooltip";const g2=new Fv({element:Lu,offset:[15,0],positioning:"center-left"});Ei.addOverlay(g2);const y2=new tA({source:Vr,type:"LineString"}),_2=new tA({source:Vr,type:"Polygon"}),Kat=new Ml({handleEvent:function(n){if(n.type==="click"){const t=Ei.getEventCoordinate(n.originalEvent);return rat(t,Ei,Vr,e0),!1}return!0}}),x2=new T7({layers:[Hat,qat,Xat]}),Qg={select:x2,line:y2,polygon:_2,pin:Kat};function i0(n,t){Ei.removeInteraction(ix),Ei.addInteraction(n),ix=n,[sx,rx,ax,ox].forEach(e=>{e.style.backgroundColor=e===t?"#636363":"transparent"})}sx.addEventListener("click",function(){i0(Qg.select,sx),_f.disabled=!1,Kg.disabled=!0,Jg.disabled=!0});document.addEventListener("keydown",function(n){n.key==="Escape"&&i0(ix,null)});ax.addEventListener("click",function(){i0(Qg.line,ax),_f.value="meters",_f.disabled=!1,Kg.disabled=!0,Jg.disabled=!0});rx.addEventListener("click",function(){i0(Qg.polygon,rx),_f.disabled=!1,Kg.disabled=!1,Jg.disabled=!1});ox.addEventListener("click",function(){i0(Qg.pin,ox),_f.disabled=!1,Kg.disabled=!0,Jg.disabled=!0});x2.on("select",function(n){if(n.selected.length>0){const t=n.selected[0];handleLayerSelection(t)}else Lk.innerHTML=""});x2.getFeatures().on("add",function(n){n.element.setStyle(selectStyle)});y2.on("drawstart",function(n){Zg=n.feature,fh=document.createElement("div"),fh.className="tooltip tooltip-static",uu=new Fv({element:fh,offset:[0,-15],positioning:"bottom-center"}),Ei.addOverlay(uu),n.feature.getGeometry().on("change",function(t){const e=document.getElementById("unitConversion").value,i=t.target,s=Sc(i,e),r=i.getLastCoordinate();g2.setPosition(r),Lu.innerHTML=s})});_2.on("drawstart",function(n){Zg=n.feature,fh=document.createElement("div"),fh.className="tooltip tooltip-static",uu=new Fv({element:fh,offset:[0,-15],positioning:"bottom-center"}),Ei.addOverlay(uu),n.feature.getGeometry().on("change",function(t){const e=document.getElementById("unitConversion").value,i=t.target,s=Tc(i,e),r=i.getInteriorPoint().getCoordinates();g2.setPosition(r),Lu.innerHTML=s})});y2.on("drawend",n=>xR(n,!1,fh,uu,Zg,Lu,Vr,Ei,e0));_2.on("drawend",n=>xR(n,!0,fh,uu,Zg,Lu,Vr,Ei,e0));const Jat=document.querySelectorAll("#measurements li");Jat.forEach((n,t)=>{n.addEventListener("click",function(){dY(t)})});document.getElementById("files").addEventListener("change",n=>{var e;const t=Tw((e=n.target.files[0])==null?void 0:e.name);switch(t){case"kml":case"kmz":Fg(n,null,Ei);break;case"zip":case"shp":pR(n,Ei);break;case"dwg":case"dxf":p2(n,Ei);break;default:console.log("Unsupported file type:",t)}});const ty=document.body;ty.addEventListener("dragenter",n=>{n.preventDefault(),n.stopPropagation(),m2.style.display="flex"});ty.addEventListener("dragover",n=>{n.preventDefault(),n.stopPropagation()});ty.addEventListener("dragleave",n=>{n.preventDefault(),n.stopPropagation(),n.relatedTarget===null&&(m2.style.display="none")});ty.addEventListener("drop",n=>{n.preventDefault(),n.stopPropagation(),m2.style.display="none";const t=n.dataTransfer.files;Qat(t,Ei)});function Qat(n,t){for(let e=0;e<n.length;e++){const i=n[e],s=i.name,r=Tw(s);switch(r){case"kml":case"kmz":Fg({target:{files:[i]}},null,t);break;case"zip":case"shp":pR({target:{files:[i]}},t);break;case"dwg":case"dxf":p2({target:{files:[i]}},t);break;default:console.log("Unsupported file type:",r)}}}function tot(){nx.scrollLeft=nx.scrollWidth}Nk.addEventListener("wheel",n=>{n.preventDefault();const e=-Math.sign(n.deltaY);vp+=e*Wat,vp=Math.max(.1,Math.min(vp,500)),jc=1*vp,Array.from(kk).forEach(i=>{i.style.width=`${jc}px`,i.style.minWidth=`${jc}px`}),Gm=Math.max(0,Gm-e),v2()});function v2(){const n=Math.floor(Nk.clientWidth/jc);Array.from(kk).forEach((t,e)=>{e>=Gm&&e<Gm+n&&(t.style.display="block")})}window.addEventListener("resize",v2);const eot=async n=>{Dp&&Dp.classList.remove("selected-item"),Vr.clear(),n.classList.add("selected-item"),Dp=n,document.getElementById("measurements").innerHTML="";const t=n.querySelector(".filled-div-date p");if(t){const e=t.textContent;let i="";zp.map(async s=>{if(ue(s.date).format("YYYY-MM-DD")==e){i=s.images[0];const r=await dR(s._id);r.annotations,Fk(r.annotations),e0=s._id,localStorage.setItem("orhtoId",s._id)}}),i?Pk(i):console.log(`No file found for date: ${e}`)}Lk.innerHTML=""},Fk=n=>{Vr.clear();for(let t=0;t<(n==null?void 0:n.length);t++)switch(n[t].type){case"line":kE(n[t].data,!1,Vr,Ei);break;case"polygon":kE(n[t].data,!0,Vr,Ei);break;case"pin":aat(n[t].data,Ei,Vr);break;case"kml":case"kmz":Fg(null,n[t].data.url,Ei,!0,n[t].data.id,n[t].data.lable);break;case"zip":case"shp":cQ(Ei,n[t].data.url,n[t].data.id,n[t].data.lable);break;case"dwg":case"dxf":p2(null,Ei,n[t].data.url,n[t].data.id,n[t].data.lable);break;default:console.log("Unsupported file type:",n[t].type)}},VS=document.getElementById("map"),Ud=document.getElementsByClassName("sidenav1")[0],dd=document.getElementById("collapse-left"),Gd=document.getElementsByClassName("sidenav2")[0],fd=document.getElementById("collapse-right"),$1=document.getElementById("secondnav"),Y1=document.getElementById("collapse-top"),WS=document.getElementsByClassName("tool-tip")[0];dd.addEventListener("click",()=>{Ud.style.display=="none"?(Ud.style.display="block",dd.style.left="25%",dd.innerHTML="<"):(Ud.style.display="none",dd.style.left="0px",dd.innerHTML=">")});fd.addEventListener("click",()=>{Gd.style.display=="none"?(Gd.style.display="block",fd.style.right="25%",fd.innerHTML=">",WS.style.right="26%"):(Gd.style.display="none",fd.style.right="0px",fd.innerHTML="<",WS.style.right="1%")});Y1.addEventListener("click",()=>{$1.style.display=="none"?($1.style.display="block",Y1.innerHTML="<",Ud.style.height="77.9vh",Gd.style.height="77.9vh",VS.style.height="77.9vh"):($1.style.display="none",Y1.innerHTML=">",Ud.style.height="89.7vh",Gd.style.height="89.7vh",VS.style.height="89.7vh")});export{fot as L,pot as a};
